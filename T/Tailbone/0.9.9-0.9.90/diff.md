# Comparing `tmp/Tailbone-0.9.9.tar.gz` & `tmp/Tailbone-0.9.90.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "/home/lance/src/tailbone/dist/tmpqyoluhzt/Tailbone-0.9.9.tar", last modified: Wed Feb 22 01:14:55 2023, max compression
+gzip compressed data, was "Tailbone-0.9.90.tar", last modified: Mon Apr  1 23:28:51 2024, max compression
```

## Comparing `Tailbone-0.9.9.tar` & `Tailbone-0.9.90.tar`

### file list

```diff
@@ -1,502 +1,516 @@
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/
--rw-r--r--   0 lance     (1000) lance     (1000)    10342 2023-02-12 03:10:54.000000 Tailbone-0.9.9/tailbone/subscribers.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/reports/
--rw-r--r--   0 lance     (1000) lance     (1000)     3577 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/reports/ordering_worksheet.mako
--rw-rw-r--   0 lance     (1000) lance     (1000)     2481 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/reports/inventory_worksheet.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1632 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/scaffolds.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/grids/
--rw-r--r--   0 lance     (1000) lance     (1000)    39197 2023-02-14 23:30:56.000000 Tailbone-0.9.9/tailbone/grids/filters.py
--rw-r--r--   0 lance     (1000) lance     (1000)    62419 2023-02-14 23:31:26.000000 Tailbone-0.9.9/tailbone/grids/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1077 2021-01-30 20:30:05.000000 Tailbone-0.9.9/tailbone/grids/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)    28553 2023-02-04 01:48:39.000000 Tailbone-0.9.9/tailbone/menus.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2691 2022-12-24 05:29:45.000000 Tailbone-0.9.9/tailbone/cleanup.py
--rw-r--r--   0 lance     (1000) lance     (1000)     8274 2023-02-07 18:19:37.000000 Tailbone-0.9.9/tailbone/db.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/
--rw-r--r--   0 lance     (1000) lance     (1000)     2518 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/templates/feedback_dialog_buefy.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/reports/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/
--rw-r--r--   0 lance     (1000) lance     (1000)      691 2023-02-03 05:22:09.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/generate.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1082 2022-11-28 23:53:29.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      346 2021-12-15 01:04:51.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/delete.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1817 2023-02-03 05:22:38.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/choose.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      635 2022-01-08 19:00:03.000000 Tailbone-0.9.9/tailbone/templates/reports/generated/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/reports/problems/
--rw-r--r--   0 lance     (1000) lance     (1000)     2397 2022-11-19 18:52:15.000000 Tailbone-0.9.9/tailbone/templates/reports/problems/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3202 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/reports/ordering.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1365 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/reports/inventory.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/principal/
--rw-r--r--   0 lance     (1000) lance     (1000)     3926 2023-02-03 05:23:45.000000 Tailbone-0.9.9/tailbone/templates/principal/find_by_perm.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      369 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/principal/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/grids/
--rw-r--r--   0 lance     (1000) lance     (1000)      755 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/grids/nav.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    21371 2023-02-10 19:06:04.000000 Tailbone-0.9.9/tailbone/templates/grids/buefy.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1584 2022-12-25 20:38:13.000000 Tailbone-0.9.9/tailbone/templates/grids/filters_buefy.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1573 2019-05-06 23:17:43.000000 Tailbone-0.9.9/tailbone/templates/grids/filters.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      910 2018-09-23 00:20:31.000000 Tailbone-0.9.9/tailbone/templates/grids/grid.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3024 2023-02-02 00:24:21.000000 Tailbone-0.9.9/tailbone/templates/grids/b-table.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      795 2019-04-15 23:05:35.000000 Tailbone-0.9.9/tailbone/templates/grids/complete.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tables/
--rw-r--r--   0 lance     (1000) lance     (1000)    30330 2023-02-02 00:25:12.000000 Tailbone-0.9.9/tailbone/templates/tables/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1518 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/templates/feedback.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1509 2023-01-29 17:00:34.000000 Tailbone-0.9.9/tailbone/templates/multi_file_upload.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1686 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/templates/menu.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/vendors/
--rw-r--r--   0 lance     (1000) lance     (1000)     1850 2022-05-15 21:04:06.000000 Tailbone-0.9.9/tailbone/templates/vendors/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/users/
--rw-r--r--   0 lance     (1000) lance     (1000)      481 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/users/find_by_perm.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1314 2022-02-15 02:30:15.000000 Tailbone-0.9.9/tailbone/templates/users/preferences.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      655 2022-02-14 23:08:35.000000 Tailbone-0.9.9/tailbone/templates/users/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/labels/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/labels/profiles/
--rw-r--r--   0 lance     (1000) lance     (1000)      432 2019-05-23 22:57:42.000000 Tailbone-0.9.9/tailbone/templates/labels/profiles/printer.mako
--rw-rw-r--   0 lance     (1000) lance     (1000)      314 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/templates/labels/profiles/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1232 2023-02-09 02:19:12.000000 Tailbone-0.9.9/tailbone/templates/labels/profiles/view.mako
--rw-rw-r--   0 lance     (1000) lance     (1000)      620 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/templates/labels/profiles/edit.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/master/
--rw-r--r--   0 lance     (1000) lance     (1000)      879 2021-12-13 19:43:47.000000 Tailbone-0.9.9/tailbone/templates/master/edit_row.mako
--rw-rw-r--   0 lance     (1000) lance     (1000)      248 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/templates/master/create_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      174 2019-05-22 20:24:53.000000 Tailbone-0.9.9/tailbone/templates/master/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     5610 2023-02-03 05:24:29.000000 Tailbone-0.9.9/tailbone/templates/master/merge.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      584 2023-02-03 18:10:14.000000 Tailbone-0.9.9/tailbone/templates/master/form.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3266 2021-05-14 17:13:11.000000 Tailbone-0.9.9/tailbone/templates/master/view_version.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1033 2023-02-03 22:16:07.000000 Tailbone-0.9.9/tailbone/templates/master/versions.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3058 2023-02-03 18:11:06.000000 Tailbone-0.9.9/tailbone/templates/master/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      170 2018-11-23 00:24:59.000000 Tailbone-0.9.9/tailbone/templates/master/import_file.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1401 2023-02-03 05:26:22.000000 Tailbone-0.9.9/tailbone/templates/master/delete.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      709 2023-02-03 05:26:29.000000 Tailbone-0.9.9/tailbone/templates/master/view_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    23855 2023-02-03 05:29:08.000000 Tailbone-0.9.9/tailbone/templates/master/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      136 2023-02-03 18:11:06.000000 Tailbone-0.9.9/tailbone/templates/master/edit.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      893 2021-12-14 03:26:58.000000 Tailbone-0.9.9/tailbone/templates/master/configure.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1376 2023-02-03 05:30:32.000000 Tailbone-0.9.9/tailbone/templates/master/clone.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1681 2023-02-03 03:16:55.000000 Tailbone-0.9.9/tailbone/templates/page.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/purchases/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/purchases/batches/
--rw-r--r--   0 lance     (1000) lance     (1000)      117 2023-02-03 22:16:48.000000 Tailbone-0.9.9/tailbone/templates/purchases/batches/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      278 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/purchases/batches/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/purchases/credits/
--rw-r--r--   0 lance     (1000) lance     (1000)     2469 2023-02-03 23:08:13.000000 Tailbone-0.9.9/tailbone/templates/purchases/credits/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      555 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/purchases/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2630 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/purchases/receiving_worksheet.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/roles/
--rw-r--r--   0 lance     (1000) lance     (1000)      407 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/roles/find_by_perm.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      536 2020-07-17 00:43:21.000000 Tailbone-0.9.9/tailbone/templates/roles/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      867 2023-02-03 05:30:47.000000 Tailbone-0.9.9/tailbone/templates/roles/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      330 2020-06-22 20:36:16.000000 Tailbone-0.9.9/tailbone/templates/roles/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      541 2020-06-22 19:53:23.000000 Tailbone-0.9.9/tailbone/templates/roles/edit.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/custorders/
--rw-r--r--   0 lance     (1000) lance     (1000)    88160 2023-02-03 05:31:02.000000 Tailbone-0.9.9/tailbone/templates/custorders/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     5225 2023-01-11 21:38:41.000000 Tailbone-0.9.9/tailbone/templates/custorders/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/custorders/items/
--rw-r--r--   0 lance     (1000) lance     (1000)    14412 2023-02-02 00:28:24.000000 Tailbone-0.9.9/tailbone/templates/custorders/items/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/departments/
--rw-rw-r--   0 lance     (1000) lance     (1000)      294 2023-02-03 05:31:15.000000 Tailbone-0.9.9/tailbone/templates/departments/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/receiving/
--rw-r--r--   0 lance     (1000) lance     (1000)     1495 2023-02-03 05:31:39.000000 Tailbone-0.9.9/tailbone/templates/receiving/declare_credit.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      117 2023-02-03 05:32:11.000000 Tailbone-0.9.9/tailbone/templates/receiving/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1400 2023-02-03 05:32:35.000000 Tailbone-0.9.9/tailbone/templates/receiving/receive_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      305 2018-10-24 22:53:24.000000 Tailbone-0.9.9/tailbone/templates/receiving/transform_unit_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    10589 2023-02-10 19:06:04.000000 Tailbone-0.9.9/tailbone/templates/receiving/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    21656 2023-02-03 05:33:59.000000 Tailbone-0.9.9/tailbone/templates/receiving/view_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     7274 2023-01-08 17:38:39.000000 Tailbone-0.9.9/tailbone/templates/receiving/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/messages/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/messages/archive/
--rw-r--r--   0 lance     (1000) lance     (1000)      353 2023-02-03 05:34:09.000000 Tailbone-0.9.9/tailbone/templates/messages/archive/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1364 2023-02-03 05:34:56.000000 Tailbone-0.9.9/tailbone/templates/messages/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3206 2023-02-03 05:35:31.000000 Tailbone-0.9.9/tailbone/templates/messages/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/messages/sent/
--rw-rw-r--   0 lance     (1000) lance     (1000)      354 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/templates/messages/sent/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1101 2019-11-05 01:03:51.000000 Tailbone-0.9.9/tailbone/templates/messages/recipients.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1761 2023-02-03 05:35:48.000000 Tailbone-0.9.9/tailbone/templates/messages/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/messages/inbox/
--rw-r--r--   0 lance     (1000) lance     (1000)      355 2023-02-03 05:35:57.000000 Tailbone-0.9.9/tailbone/templates/messages/inbox/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/forms/
--rw-r--r--   0 lance     (1000) lance     (1000)       67 2023-02-03 05:36:08.000000 Tailbone-0.9.9/tailbone/templates/forms/form.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     6607 2023-01-29 16:59:34.000000 Tailbone-0.9.9/tailbone/templates/forms/deform_buefy.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      265 2022-08-09 03:19:59.000000 Tailbone-0.9.9/tailbone/templates/forms/util.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1603 2023-02-03 05:36:20.000000 Tailbone-0.9.9/tailbone/templates/form.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/customers/
--rw-r--r--   0 lance     (1000) lance     (1000)     1056 2023-02-03 22:36:48.000000 Tailbone-0.9.9/tailbone/templates/customers/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/customers/pending/
--rw-r--r--   0 lance     (1000) lance     (1000)     5021 2021-12-24 01:59:01.000000 Tailbone-0.9.9/tailbone/templates/customers/pending/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1075 2022-08-09 04:37:20.000000 Tailbone-0.9.9/tailbone/templates/customers/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/employees/
--rw-r--r--   0 lance     (1000) lance     (1000)      259 2019-04-12 19:47:07.000000 Tailbone-0.9.9/tailbone/templates/employees/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      899 2023-02-03 22:40:11.000000 Tailbone-0.9.9/tailbone/templates/autocomplete.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1170 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/exception.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/luigi/
--rw-r--r--   0 lance     (1000) lance     (1000)    12842 2023-02-02 00:29:33.000000 Tailbone-0.9.9/tailbone/templates/luigi/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    14033 2023-02-02 00:30:45.000000 Tailbone-0.9.9/tailbone/templates/luigi/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/appinfo/
--rw-r--r--   0 lance     (1000) lance     (1000)     3235 2023-02-02 00:31:07.000000 Tailbone-0.9.9/tailbone/templates/appinfo/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     7318 2023-02-02 00:31:53.000000 Tailbone-0.9.9/tailbone/templates/appinfo/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/ordering/
--rw-r--r--   0 lance     (1000) lance     (1000)      112 2023-02-03 05:36:48.000000 Tailbone-0.9.9/tailbone/templates/ordering/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    16377 2021-02-01 03:51:46.000000 Tailbone-0.9.9/tailbone/templates/ordering/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    11560 2023-02-03 05:37:47.000000 Tailbone-0.9.9/tailbone/templates/ordering/worksheet.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1649 2023-02-07 22:11:44.000000 Tailbone-0.9.9/tailbone/templates/login.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/shifts/
--rw-r--r--   0 lance     (1000) lance     (1000)     1463 2023-02-03 22:42:48.000000 Tailbone-0.9.9/tailbone/templates/shifts/timesheet_edit.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      900 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/shifts/schedule_print.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2538 2023-02-03 22:44:07.000000 Tailbone-0.9.9/tailbone/templates/shifts/schedule_edit.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      813 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/shifts/schedule_print_employee.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     6116 2023-02-03 22:43:25.000000 Tailbone-0.9.9/tailbone/templates/shifts/base.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1025 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/shifts/schedule.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      833 2023-02-03 22:45:27.000000 Tailbone-0.9.9/tailbone/templates/shifts/timesheet.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    13008 2023-01-17 03:55:16.000000 Tailbone-0.9.9/tailbone/templates/configure-menus.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      471 2019-08-03 00:53:47.000000 Tailbone-0.9.9/tailbone/templates/about.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/upgrades/
--rw-r--r--   0 lance     (1000) lance     (1000)     9414 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/upgrades/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     5196 2023-02-02 00:32:20.000000 Tailbone-0.9.9/tailbone/templates/upgrades/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/views/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/views/model/
--rw-r--r--   0 lance     (1000) lance     (1000)     9427 2023-01-16 19:50:05.000000 Tailbone-0.9.9/tailbone/templates/views/model/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    32847 2023-02-04 00:05:40.000000 Tailbone-0.9.9/tailbone/templates/base.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      797 2023-02-03 05:38:48.000000 Tailbone-0.9.9/tailbone/templates/util.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1066 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/templates/feedback_dialog.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/email-bounces/
--rw-r--r--   0 lance     (1000) lance     (1000)     1667 2023-02-03 23:03:42.000000 Tailbone-0.9.9/tailbone/templates/email-bounces/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/workorders/
--rw-r--r--   0 lance     (1000) lance     (1000)     7838 2022-08-10 02:05:11.000000 Tailbone-0.9.9/tailbone/templates/workorders/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2776 2023-01-19 03:56:10.000000 Tailbone-0.9.9/tailbone/templates/formposter.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/people/
--rw-r--r--   0 lance     (1000) lance     (1000)    58478 2023-02-02 00:34:18.000000 Tailbone-0.9.9/tailbone/templates/people/view_profile_buefy.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1106 2023-02-03 05:39:41.000000 Tailbone-0.9.9/tailbone/templates/people/view.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/people/merge-requests/
--rw-r--r--   0 lance     (1000) lance     (1000)     1183 2023-02-03 05:39:54.000000 Tailbone-0.9.9/tailbone/templates/people/merge-requests/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3654 2023-02-03 05:40:07.000000 Tailbone-0.9.9/tailbone/templates/people/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/ifps-plu-codes/
--rw-r--r--   0 lance     (1000) lance     (1000)      281 2020-12-07 01:28:53.000000 Tailbone-0.9.9/tailbone/templates/ifps-plu-codes/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      672 2019-08-24 02:39:03.000000 Tailbone-0.9.9/tailbone/templates/home.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tempmon/
--rw-r--r--   0 lance     (1000) lance     (1000)     3718 2023-02-03 05:40:48.000000 Tailbone-0.9.9/tailbone/templates/tempmon/dashboard.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tempmon/readings/
--rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:17:35.000000 Tailbone-0.9.9/tailbone/templates/tempmon/readings/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tempmon/probes/
--rw-r--r--   0 lance     (1000) lance     (1000)     3298 2023-02-03 05:41:19.000000 Tailbone-0.9.9/tailbone/templates/tempmon/probes/graph.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3149 2023-02-03 05:41:51.000000 Tailbone-0.9.9/tailbone/templates/tempmon/probes/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:18:44.000000 Tailbone-0.9.9/tailbone/templates/tempmon/probes/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tempmon/appliances/
--rw-r--r--   0 lance     (1000) lance     (1000)      510 2023-01-14 00:38:46.000000 Tailbone-0.9.9/tailbone/templates/tempmon/appliances/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      736 2020-04-05 00:31:41.000000 Tailbone-0.9.9/tailbone/templates/tempmon/appliances/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/tempmon/clients/
--rw-r--r--   0 lance     (1000) lance     (1000)     1044 2023-02-03 05:42:03.000000 Tailbone-0.9.9/tailbone/templates/tempmon/clients/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:17:35.000000 Tailbone-0.9.9/tailbone/templates/tempmon/clients/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/
--rw-r--r--   0 lance     (1000) lance     (1000)     1288 2023-02-03 05:42:10.000000 Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/create.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      247 2022-01-06 20:44:32.000000 Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/view_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      309 2022-01-06 18:52:39.000000 Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1388 2022-01-08 19:35:47.000000 Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/inventory/
--rw-r--r--   0 lance     (1000) lance     (1000)     8881 2023-02-03 05:42:38.000000 Tailbone-0.9.9/tailbone/templates/batch/inventory/desktop_form.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/newproduct/
--rw-r--r--   0 lance     (1000) lance     (1000)      160 2022-08-30 15:56:25.000000 Tailbone-0.9.9/tailbone/templates/batch/newproduct/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/pricing/
--rw-r--r--   0 lance     (1000) lance     (1000)      536 2022-06-14 18:18:31.000000 Tailbone-0.9.9/tailbone/templates/batch/pricing/configure.mako
--rw-r--r--   0 lance     (1000) lance     (1000)       84 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/batch/create.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/batch/importer/
--rw-r--r--   0 lance     (1000) lance     (1000)     2387 2023-02-03 05:42:46.000000 Tailbone-0.9.9/tailbone/templates/batch/importer/view_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    11873 2023-02-03 05:50:11.000000 Tailbone-0.9.9/tailbone/templates/batch/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      509 2023-02-03 05:50:25.000000 Tailbone-0.9.9/tailbone/templates/batch/worksheet.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     4716 2023-02-03 05:51:09.000000 Tailbone-0.9.9/tailbone/templates/batch/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)       81 2019-06-08 19:26:19.000000 Tailbone-0.9.9/tailbone/templates/batch/edit.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      121 2020-03-24 00:26:09.000000 Tailbone-0.9.9/tailbone/templates/change_password.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/deform/
--rw-r--r--   0 lance     (1000) lance     (1000)     1213 2023-02-03 05:51:23.000000 Tailbone-0.9.9/tailbone/templates/deform/checked_password.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     2164 2023-02-03 05:51:49.000000 Tailbone-0.9.9/tailbone/templates/deform/select.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      710 2023-02-03 05:52:00.000000 Tailbone-0.9.9/tailbone/templates/deform/percentinput.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      257 2023-01-29 16:59:23.000000 Tailbone-0.9.9/tailbone/templates/deform/multi_file_upload.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      918 2023-02-03 05:52:17.000000 Tailbone-0.9.9/tailbone/templates/deform/autocomplete_jquery.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     1979 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/deform/select_jquery.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      509 2019-06-28 17:09:23.000000 Tailbone-0.9.9/tailbone/templates/deform/numericinput.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      758 2023-02-03 05:52:34.000000 Tailbone-0.9.9/tailbone/templates/deform/file_upload.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      545 2021-01-06 00:19:12.000000 Tailbone-0.9.9/tailbone/templates/deform/checkbox_dynamic.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      894 2023-02-04 01:42:19.000000 Tailbone-0.9.9/tailbone/templates/deform/textinput.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      943 2023-02-03 05:53:06.000000 Tailbone-0.9.9/tailbone/templates/deform/cases_units.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      616 2023-02-07 22:10:56.000000 Tailbone-0.9.9/tailbone/templates/deform/password.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      963 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/templates/deform/numberinput.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      655 2023-02-03 05:53:32.000000 Tailbone-0.9.9/tailbone/templates/deform/time_jquery.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      601 2019-11-04 23:21:16.000000 Tailbone-0.9.9/tailbone/templates/deform/message_recipients_buefy.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      597 2023-02-03 05:53:42.000000 Tailbone-0.9.9/tailbone/templates/deform/date_jquery.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      481 2023-02-03 05:53:52.000000 Tailbone-0.9.9/tailbone/templates/deform/textarea.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      581 2019-02-23 02:44:18.000000 Tailbone-0.9.9/tailbone/templates/deform/date_plain.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     2102 2023-02-03 05:54:03.000000 Tailbone-0.9.9/tailbone/templates/deform/permissions.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     1160 2022-07-21 02:27:26.000000 Tailbone-0.9.9/tailbone/templates/deform/select_dynamic.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      492 2023-02-03 05:54:15.000000 Tailbone-0.9.9/tailbone/templates/deform/checkbox.pt
--rw-r--r--   0 lance     (1000) lance     (1000)      875 2022-11-19 23:40:01.000000 Tailbone-0.9.9/tailbone/templates/deform/problem_report_days.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     1718 2019-09-06 22:13:34.000000 Tailbone-0.9.9/tailbone/templates/deform/select_plain.pt
--rw-r--r--   0 lance     (1000) lance     (1000)     7512 2022-12-28 04:29:27.000000 Tailbone-0.9.9/tailbone/templates/page_help.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      772 2021-11-04 22:56:35.000000 Tailbone-0.9.9/tailbone/templates/base_meta.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/datasync/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/datasync/changes/
--rw-r--r--   0 lance     (1000) lance     (1000)     2125 2023-02-03 05:54:34.000000 Tailbone-0.9.9/tailbone/templates/datasync/changes/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     5964 2023-02-02 00:35:51.000000 Tailbone-0.9.9/tailbone/templates/datasync/status.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    31019 2023-02-02 00:43:40.000000 Tailbone-0.9.9/tailbone/templates/datasync/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/members/
--rw-r--r--   0 lance     (1000) lance     (1000)      527 2020-03-18 18:02:17.000000 Tailbone-0.9.9/tailbone/templates/members/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      541 2019-06-15 23:03:40.000000 Tailbone-0.9.9/tailbone/templates/diff.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     6314 2023-02-03 05:54:56.000000 Tailbone-0.9.9/tailbone/templates/appsettings.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    12583 2023-02-02 00:37:54.000000 Tailbone-0.9.9/tailbone/templates/generate_feature.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     9425 2023-01-16 17:56:04.000000 Tailbone-0.9.9/tailbone/templates/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/poser/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/poser/reports/
--rw-r--r--   0 lance     (1000) lance     (1000)     2382 2022-03-04 00:35:18.000000 Tailbone-0.9.9/tailbone/templates/poser/reports/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     3917 2022-03-21 22:32:51.000000 Tailbone-0.9.9/tailbone/templates/poser/setup.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/poser/views/
--rw-r--r--   0 lance     (1000) lance     (1000)     1120 2022-03-21 22:32:51.000000 Tailbone-0.9.9/tailbone/templates/poser/views/configure.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1736 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/upgrade.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/importing/
--rw-r--r--   0 lance     (1000) lance     (1000)      671 2021-12-07 03:21:19.000000 Tailbone-0.9.9/tailbone/templates/importing/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2643 2021-12-07 03:29:19.000000 Tailbone-0.9.9/tailbone/templates/importing/runjob.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      294 2021-12-06 18:34:10.000000 Tailbone-0.9.9/tailbone/templates/importing/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     6187 2023-02-02 00:43:01.000000 Tailbone-0.9.9/tailbone/templates/importing/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/settings/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/settings/email/
--rw-r--r--   0 lance     (1000) lance     (1000)     3013 2023-02-03 05:55:09.000000 Tailbone-0.9.9/tailbone/templates/settings/email/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1923 2022-08-06 23:37:28.000000 Tailbone-0.9.9/tailbone/templates/settings/email/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2579 2022-08-07 22:50:36.000000 Tailbone-0.9.9/tailbone/templates/settings/email/configure.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    16343 2022-12-24 02:06:19.000000 Tailbone-0.9.9/tailbone/templates/generate_project.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/products/
--rw-r--r--   0 lance     (1000) lance     (1000)     3760 2023-02-03 06:21:59.000000 Tailbone-0.9.9/tailbone/templates/products/batch.mako
--rw-r--r--   0 lance     (1000) lance     (1000)    13299 2023-02-11 03:23:43.000000 Tailbone-0.9.9/tailbone/templates/products/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     8743 2023-02-02 00:39:33.000000 Tailbone-0.9.9/tailbone/templates/products/lookup.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/products/pending/
--rw-r--r--   0 lance     (1000) lance     (1000)     4435 2021-12-24 01:58:50.000000 Tailbone-0.9.9/tailbone/templates/products/pending/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2929 2023-02-03 05:58:51.000000 Tailbone-0.9.9/tailbone/templates/products/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     4184 2023-02-10 18:21:07.000000 Tailbone-0.9.9/tailbone/templates/products/configure.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/themes/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/themes/falafel/
--rw-r--r--   0 lance     (1000) lance     (1000)       93 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/themes/falafel/base.mako
--rw-r--r--   0 lance     (1000) lance     (1000)       96 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/themes/falafel/upgrade.mako
--rw-r--r--   0 lance     (1000) lance     (1000)       97 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/themes/falafel/progress.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/units-of-measure/
--rw-r--r--   0 lance     (1000) lance     (1000)     1899 2021-01-27 14:56:25.000000 Tailbone-0.9.9/tailbone/templates/units-of-measure/index.mako
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/
--rw-r--r--   0 lance     (1000) lance     (1000)     1625 2023-02-02 00:39:56.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/rollover.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      389 2022-03-17 21:59:40.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/view.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      357 2022-02-19 22:34:34.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/view_row.mako
--rw-r--r--   0 lance     (1000) lance     (1000)      295 2022-01-01 22:14:16.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/index.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     1862 2023-01-02 18:38:43.000000 Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/configure.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     6614 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/templates/progress.mako
--rw-r--r--   0 lance     (1000) lance     (1000)     2730 2023-01-16 18:44:24.000000 Tailbone-0.9.9/tailbone/handler.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/forms/
--rw-r--r--   0 lance     (1000) lance     (1000)     2315 2023-02-12 04:03:31.000000 Tailbone-0.9.9/tailbone/forms/receiving.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1995 2023-02-12 04:03:46.000000 Tailbone-0.9.9/tailbone/forms/common.py
--rw-r--r--   0 lance     (1000) lance     (1000)    16102 2023-02-12 03:11:23.000000 Tailbone-0.9.9/tailbone/forms/widgets.py
--rw-r--r--   0 lance     (1000) lance     (1000)    46925 2023-02-03 07:12:49.000000 Tailbone-0.9.9/tailbone/forms/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4920 2023-02-12 04:03:15.000000 Tailbone-0.9.9/tailbone/forms/types.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1099 2018-11-23 00:06:07.000000 Tailbone-0.9.9/tailbone/forms/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12442 2023-02-03 23:32:18.000000 Tailbone-0.9.9/tailbone/util.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3466 2022-08-20 22:12:54.000000 Tailbone-0.9.9/tailbone/progress.py
--rw-r--r--   0 lance     (1000) lance     (1000)     5062 2023-02-12 04:03:57.000000 Tailbone-0.9.9/tailbone/auth.py
--rw-r--r--   0 lance     (1000) lance     (1000)     5418 2022-12-07 20:00:13.000000 Tailbone-0.9.9/tailbone/beaker.py
--rw-r--r--   0 lance     (1000) lance     (1000)    11188 2023-02-04 00:06:12.000000 Tailbone-0.9.9/tailbone/app.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/purchasing/
--rw-r--r--   0 lance     (1000) lance     (1000)    36721 2023-02-12 03:12:23.000000 Tailbone-0.9.9/tailbone/views/purchasing/batch.py
--rw-r--r--   0 lance     (1000) lance     (1000)    89248 2023-02-12 03:13:09.000000 Tailbone-0.9.9/tailbone/views/purchasing/receiving.py
--rw-r--r--   0 lance     (1000) lance     (1000)    19691 2023-02-12 03:13:39.000000 Tailbone-0.9.9/tailbone/views/purchasing/ordering.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12753 2023-02-12 03:13:48.000000 Tailbone-0.9.9/tailbone/views/purchasing/costing.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1266 2021-09-29 15:13:18.000000 Tailbone-0.9.9/tailbone/views/purchasing/__init__.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/asgi/
--rw-r--r--   0 lance     (1000) lance     (1000)     7840 2022-08-21 03:39:57.000000 Tailbone-0.9.9/tailbone/views/asgi/upgrades.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2654 2022-08-20 22:38:06.000000 Tailbone-0.9.9/tailbone/views/asgi/datasync.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4315 2023-02-12 04:02:32.000000 Tailbone-0.9.9/tailbone/views/asgi/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)    96304 2023-02-12 03:14:36.000000 Tailbone-0.9.9/tailbone/views/products.py
--rw-r--r--   0 lance     (1000) lance     (1000)    24557 2023-02-12 03:14:59.000000 Tailbone-0.9.9/tailbone/views/customers.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3197 2022-11-23 18:17:10.000000 Tailbone-0.9.9/tailbone/views/reportcodes.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1958 2022-12-10 05:04:58.000000 Tailbone-0.9.9/tailbone/views/taxes.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6801 2023-02-03 06:44:00.000000 Tailbone-0.9.9/tailbone/views/menus.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/vendors/
--rw-r--r--   0 lance     (1000) lance     (1000)     1407 2019-10-09 18:53:24.000000 Tailbone-0.9.9/tailbone/views/vendors/catalogs.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1407 2019-10-09 20:37:31.000000 Tailbone-0.9.9/tailbone/views/vendors/invoices.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7745 2022-12-21 23:46:17.000000 Tailbone-0.9.9/tailbone/views/vendors/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1237 2022-03-04 18:31:55.000000 Tailbone-0.9.9/tailbone/views/vendors/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2566 2022-11-23 18:18:26.000000 Tailbone-0.9.9/tailbone/views/inventory.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/labels/
--rw-r--r--   0 lance     (1000) lance     (1000)     1370 2019-10-09 16:08:43.000000 Tailbone-0.9.9/tailbone/views/labels/batch.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6330 2023-02-09 02:19:03.000000 Tailbone-0.9.9/tailbone/views/labels/profiles.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1155 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/views/labels/__init__.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/purchases/
--rw-r--r--   0 lance     (1000) lance     (1000)     6851 2023-02-12 03:15:03.000000 Tailbone-0.9.9/tailbone/views/purchases/credits.py
--rw-r--r--   0 lance     (1000) lance     (1000)    13768 2022-11-23 18:06:10.000000 Tailbone-0.9.9/tailbone/views/purchases/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1159 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/views/purchases/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2010 2023-01-19 02:11:37.000000 Tailbone-0.9.9/tailbone/views/essentials.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12394 2023-02-12 03:15:13.000000 Tailbone-0.9.9/tailbone/views/employees.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1816 2022-11-23 18:18:05.000000 Tailbone-0.9.9/tailbone/views/permissions.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/custorders/
--rw-r--r--   0 lance     (1000) lance     (1000)     7676 2023-02-12 15:33:23.000000 Tailbone-0.9.9/tailbone/views/custorders/batch.py
--rw-r--r--   0 lance     (1000) lance     (1000)    40125 2023-02-12 04:00:36.000000 Tailbone-0.9.9/tailbone/views/custorders/orders.py
--rw-r--r--   0 lance     (1000) lance     (1000)    20943 2023-02-12 03:15:57.000000 Tailbone-0.9.9/tailbone/views/custorders/items.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1948 2022-11-23 18:19:21.000000 Tailbone-0.9.9/tailbone/views/custorders/creating.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1213 2020-08-02 04:53:28.000000 Tailbone-0.9.9/tailbone/views/custorders/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)   210164 2023-02-21 17:20:01.000000 Tailbone-0.9.9/tailbone/views/master.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6541 2022-11-23 18:27:00.000000 Tailbone-0.9.9/tailbone/views/members.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3726 2022-11-23 18:16:15.000000 Tailbone-0.9.9/tailbone/views/stores.py
--rw-r--r--   0 lance     (1000) lance     (1000)    17512 2022-08-21 03:59:27.000000 Tailbone-0.9.9/tailbone/views/email.py
--rw-r--r--   0 lance     (1000) lance     (1000)    11286 2023-02-03 06:49:24.000000 Tailbone-0.9.9/tailbone/views/luigi.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7542 2023-02-03 06:37:12.000000 Tailbone-0.9.9/tailbone/views/projects.py
--rw-r--r--   0 lance     (1000) lance     (1000)    29862 2023-02-12 03:17:08.000000 Tailbone-0.9.9/tailbone/views/reports.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2483 2022-11-23 18:18:45.000000 Tailbone-0.9.9/tailbone/views/filemon.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2502 2022-11-23 18:19:27.000000 Tailbone-0.9.9/tailbone/views/customergroups.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7810 2022-11-23 18:19:41.000000 Tailbone-0.9.9/tailbone/views/bouncer.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3712 2022-11-23 17:57:17.000000 Tailbone-0.9.9/tailbone/views/categories.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/shifts/
--rw-r--r--   0 lance     (1000) lance     (1000)     5387 2023-02-12 03:56:32.000000 Tailbone-0.9.9/tailbone/views/shifts/timesheet.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6825 2022-11-23 18:16:41.000000 Tailbone-0.9.9/tailbone/views/shifts/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)    21911 2023-02-12 03:57:10.000000 Tailbone-0.9.9/tailbone/views/shifts/lib.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1207 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/views/shifts/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     9975 2023-02-12 03:56:46.000000 Tailbone-0.9.9/tailbone/views/shifts/schedule.py
--rw-r--r--   0 lance     (1000) lance     (1000)    24944 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/views/upgrades.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2491 2022-11-23 18:17:55.000000 Tailbone-0.9.9/tailbone/views/progress.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7062 2023-01-17 02:23:29.000000 Tailbone-0.9.9/tailbone/views/views.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12308 2023-02-12 03:17:37.000000 Tailbone-0.9.9/tailbone/views/common.py
--rw-r--r--   0 lance     (1000) lance     (1000)     9572 2023-02-07 22:11:28.000000 Tailbone-0.9.9/tailbone/views/auth.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4026 2023-02-03 06:50:35.000000 Tailbone-0.9.9/tailbone/views/features.py
--rw-r--r--   0 lance     (1000) lance     (1000)    16596 2022-08-25 01:06:23.000000 Tailbone-0.9.9/tailbone/views/datasync.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2778 2022-11-23 18:18:37.000000 Tailbone-0.9.9/tailbone/views/ifps.py
--rw-r--r--   0 lance     (1000) lance     (1000)    55250 2023-02-12 03:18:47.000000 Tailbone-0.9.9/tailbone/views/people.py
--rw-r--r--   0 lance     (1000) lance     (1000)    20040 2023-02-03 06:30:15.000000 Tailbone-0.9.9/tailbone/views/roles.py
--rw-r--r--   0 lance     (1000) lance     (1000)    23650 2023-02-12 03:55:46.000000 Tailbone-0.9.9/tailbone/views/users.py
--rw-r--r--   0 lance     (1000) lance     (1000)     5677 2023-02-03 22:10:08.000000 Tailbone-0.9.9/tailbone/views/subdepartments.py
--rw-r--r--   0 lance     (1000) lance     (1000)    15212 2023-01-17 06:00:06.000000 Tailbone-0.9.9/tailbone/views/tables.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3974 2022-07-19 19:48:52.000000 Tailbone-0.9.9/tailbone/views/brands.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6469 2023-02-03 06:39:47.000000 Tailbone-0.9.9/tailbone/views/principal.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6101 2023-02-12 03:19:03.000000 Tailbone-0.9.9/tailbone/views/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)    21164 2023-02-03 06:50:07.000000 Tailbone-0.9.9/tailbone/views/importing.py
--rw-r--r--   0 lance     (1000) lance     (1000)    13863 2023-02-03 06:25:44.000000 Tailbone-0.9.9/tailbone/views/workorders.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/tempmon/
--rw-r--r--   0 lance     (1000) lance     (1000)     4207 2022-11-23 18:15:17.000000 Tailbone-0.9.9/tailbone/views/tempmon/readings.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6526 2023-01-14 02:16:48.000000 Tailbone-0.9.9/tailbone/views/tempmon/appliances.py
--rw-r--r--   0 lance     (1000) lance     (1000)     9738 2023-01-14 02:16:41.000000 Tailbone-0.9.9/tailbone/views/tempmon/clients.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3476 2023-02-03 06:28:36.000000 Tailbone-0.9.9/tailbone/views/tempmon/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12249 2023-02-03 06:27:42.000000 Tailbone-0.9.9/tailbone/views/tempmon/probes.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6056 2023-02-12 15:31:40.000000 Tailbone-0.9.9/tailbone/views/tempmon/dashboard.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1344 2020-04-04 20:42:25.000000 Tailbone-0.9.9/tailbone/views/tempmon/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1428 2022-08-16 15:24:10.000000 Tailbone-0.9.9/tailbone/views/handheld.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/batch/
--rw-r--r--   0 lance     (1000) lance     (1000)     3698 2021-10-31 02:25:39.000000 Tailbone-0.9.9/tailbone/views/batch/delproduct.py
--rw-r--r--   0 lance     (1000) lance     (1000)     9424 2020-01-28 23:23:15.000000 Tailbone-0.9.9/tailbone/views/batch/product.py
--rw-r--r--   0 lance     (1000) lance     (1000)    19113 2023-02-12 03:19:20.000000 Tailbone-0.9.9/tailbone/views/batch/inventory.py
--rw-r--r--   0 lance     (1000) lance     (1000)     5646 2022-08-30 18:50:39.000000 Tailbone-0.9.9/tailbone/views/batch/newproduct.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6644 2022-08-14 04:58:46.000000 Tailbone-0.9.9/tailbone/views/batch/vendorinvoice.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7101 2022-01-10 20:54:44.000000 Tailbone-0.9.9/tailbone/views/batch/labels.py
--rw-r--r--   0 lance     (1000) lance     (1000)    10066 2023-02-12 03:19:22.000000 Tailbone-0.9.9/tailbone/views/batch/importer.py
--rw-r--r--   0 lance     (1000) lance     (1000)    59451 2023-02-12 04:02:14.000000 Tailbone-0.9.9/tailbone/views/batch/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6273 2022-08-14 04:23:06.000000 Tailbone-0.9.9/tailbone/views/batch/handheld.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1075 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/views/batch/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12439 2022-10-19 21:22:58.000000 Tailbone-0.9.9/tailbone/views/batch/pricing.py
--rw-r--r--   0 lance     (1000) lance     (1000)    15260 2023-02-21 23:34:49.000000 Tailbone-0.9.9/tailbone/views/batch/vendorcatalog.py
--rw-r--r--   0 lance     (1000) lance     (1000)     6163 2022-12-25 18:44:17.000000 Tailbone-0.9.9/tailbone/views/exports.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4350 2022-11-23 18:14:52.000000 Tailbone-0.9.9/tailbone/views/uoms.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7306 2023-02-03 06:52:40.000000 Tailbone-0.9.9/tailbone/views/departments.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/poser/
--rw-r--r--   0 lance     (1000) lance     (1000)     2470 2022-05-11 01:00:46.000000 Tailbone-0.9.9/tailbone/views/poser/master.py
--rw-r--r--   0 lance     (1000) lance     (1000)    10063 2022-05-11 01:00:44.000000 Tailbone-0.9.9/tailbone/views/poser/reports.py
--rw-r--r--   0 lance     (1000) lance     (1000)    11220 2022-07-26 17:01:09.000000 Tailbone-0.9.9/tailbone/views/poser/views.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1138 2022-03-05 00:03:03.000000 Tailbone-0.9.9/tailbone/views/poser/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)    16690 2023-02-12 03:19:58.000000 Tailbone-0.9.9/tailbone/views/settings.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2065 2022-11-23 18:19:03.000000 Tailbone-0.9.9/tailbone/views/depositlinks.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2797 2022-12-10 15:46:54.000000 Tailbone-0.9.9/tailbone/views/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3231 2022-11-23 18:00:03.000000 Tailbone-0.9.9/tailbone/views/families.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/views/trainwreck/
--rw-r--r--   0 lance     (1000) lance     (1000)     1582 2022-11-23 18:15:06.000000 Tailbone-0.9.9/tailbone/views/trainwreck/defaults.py
--rw-r--r--   0 lance     (1000) lance     (1000)    14286 2023-02-03 06:26:52.000000 Tailbone-0.9.9/tailbone/views/trainwreck/base.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1135 2023-01-19 01:57:13.000000 Tailbone-0.9.9/tailbone/views/trainwreck/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2951 2021-11-09 23:17:17.000000 Tailbone-0.9.9/tailbone/views/versions.py
--rw-r--r--   0 lance     (1000) lance     (1000)    20427 2023-02-12 03:20:00.000000 Tailbone-0.9.9/tailbone/views/messages.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1946 2023-01-12 21:03:16.000000 Tailbone-0.9.9/tailbone/helpers.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/api/
--rw-r--r--   0 lance     (1000) lance     (1000)     6539 2023-02-12 04:04:14.000000 Tailbone-0.9.9/tailbone/api/products.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1833 2022-08-14 05:48:19.000000 Tailbone-0.9.9/tailbone/api/customers.py
--rw-r--r--   0 lance     (1000) lance     (1000)    22057 2023-02-12 03:20:10.000000 Tailbone-0.9.9/tailbone/api/master.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1719 2022-08-14 05:51:19.000000 Tailbone-0.9.9/tailbone/api/vendors.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1489 2022-08-14 05:42:00.000000 Tailbone-0.9.9/tailbone/api/master2.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2126 2022-08-14 05:50:11.000000 Tailbone-0.9.9/tailbone/api/upgrades.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4276 2023-02-12 04:04:31.000000 Tailbone-0.9.9/tailbone/api/common.py
--rw-r--r--   0 lance     (1000) lance     (1000)     7804 2022-08-14 05:44:13.000000 Tailbone-0.9.9/tailbone/api/auth.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1547 2023-01-30 00:46:27.000000 Tailbone-0.9.9/tailbone/api/labels.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1802 2022-08-14 05:49:24.000000 Tailbone-0.9.9/tailbone/api/people.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2067 2022-08-14 05:50:38.000000 Tailbone-0.9.9/tailbone/api/users.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4689 2022-12-04 15:22:50.000000 Tailbone-0.9.9/tailbone/api/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     8607 2022-08-31 02:51:40.000000 Tailbone-0.9.9/tailbone/api/workorders.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/api/batch/
--rw-r--r--   0 lance     (1000) lance     (1000)     6799 2022-09-08 01:45:18.000000 Tailbone-0.9.9/tailbone/api/batch/inventory.py
--rw-r--r--   0 lance     (1000) lance     (1000)    19661 2023-02-12 04:04:45.000000 Tailbone-0.9.9/tailbone/api/batch/receiving.py
--rw-r--r--   0 lance     (1000) lance     (1000)    11689 2022-12-08 20:54:28.000000 Tailbone-0.9.9/tailbone/api/batch/ordering.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2688 2022-08-14 05:59:35.000000 Tailbone-0.9.9/tailbone/api/batch/labels.py
--rw-r--r--   0 lance     (1000) lance     (1000)    12913 2023-02-12 04:05:06.000000 Tailbone-0.9.9/tailbone/api/batch/core.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1097 2019-11-11 20:08:35.000000 Tailbone-0.9.9/tailbone/api/batch/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1389 2022-08-14 05:48:55.000000 Tailbone-0.9.9/tailbone/api/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)       48 2023-02-22 01:14:17.000000 Tailbone-0.9.9/tailbone/_version.py
--rw-r--r--   0 lance     (1000) lance     (1000)     4530 2021-12-15 23:40:27.000000 Tailbone-0.9.9/tailbone/diffs.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1696 2020-02-28 23:40:40.000000 Tailbone-0.9.9/tailbone/exceptions.py
--rw-r--r--   0 lance     (1000) lance     (1000)     2637 2019-02-26 03:11:49.000000 Tailbone-0.9.9/tailbone/tweens.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1901 2023-01-15 00:47:07.000000 Tailbone-0.9.9/tailbone/providers.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1161 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3290 2022-08-17 00:32:35.000000 Tailbone-0.9.9/tailbone/asgi.py
--rw-r--r--   0 lance     (1000) lance     (1000)     3067 2021-01-23 03:31:00.000000 Tailbone-0.9.9/tailbone/webapi.py
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/static/
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/static/files/
--rw-r--r--   0 lance     (1000) lance     (1000)     7593 2022-01-06 18:40:01.000000 Tailbone-0.9.9/tailbone/static/files/vendor_catalog_template.xlsx
--rw-r--r--   0 lance     (1000) lance     (1000)     5041 2022-08-30 13:52:10.000000 Tailbone-0.9.9/tailbone/static/files/newproduct_template.xlsx
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/static/css/
--rw-r--r--   0 lance     (1000) lance     (1000)     4880 2021-01-17 02:38:15.000000 Tailbone-0.9.9/tailbone/static/css/codehilite.css
--rw-r--r--   0 lance     (1000) lance     (1000)     5542 2023-02-03 23:02:02.000000 Tailbone-0.9.9/tailbone/static/css/grids.css
--rw-r--r--   0 lance     (1000) lance     (1000)      208 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/static/css/purchases.css
--rw-r--r--   0 lance     (1000) lance     (1000)     1439 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/css/forms.css
--rw-r--r--   0 lance     (1000) lance     (1000)      789 2020-08-02 03:09:36.000000 Tailbone-0.9.9/tailbone/static/css/diffs.css
--rw-r--r--   0 lance     (1000) lance     (1000)      965 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/css/progress.css
--rw-r--r--   0 lance     (1000) lance     (1000)      575 2019-06-05 00:52:33.000000 Tailbone-0.9.9/tailbone/static/css/perms.css
--rw-r--r--   0 lance     (1000) lance     (1000)      390 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/css/filters.css
--rw-r--r--   0 lance     (1000) lance     (1000)     2650 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/css/layout.css
--rw-r--r--   0 lance     (1000) lance     (1000)     7346 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/css/normalize.css
--rw-r--r--   0 lance     (1000) lance     (1000)      440 2021-01-30 19:10:34.000000 Tailbone-0.9.9/tailbone/static/css/base.css
--rw-rw-r--   0 lance     (1000) lance     (1000)     1664 2017-07-18 18:57:10.000000 Tailbone-0.9.9/tailbone/static/css/timesheet.css
--rw-r--r--   0 lance     (1000) lance     (1000)     1173 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/css/grids.rowstatus.css
--rw-rw-r--   0 lance     (1000) lance     (1000)      225 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/static/css/schedule_print.css
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/static/js/
--rw-r--r--   0 lance     (1000) lance     (1000)     1637 2019-06-24 23:30:10.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.oncebutton.js
--rw-r--r--   0 lance     (1000) lance     (1000)      813 2021-10-12 18:14:50.000000 Tailbone-0.9.9/tailbone/static/js/debounce.js
--rw-r--r--   0 lance     (1000) lance     (1000)     9498 2022-12-26 21:32:08.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.autocomplete.js
--rw-r--r--   0 lance     (1000) lance     (1000)     2380 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/static/js/numeric.js
--rw-r--r--   0 lance     (1000) lance     (1000)     1385 2023-02-02 22:24:46.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.feedback.js
--rw-r--r--   0 lance     (1000) lance     (1000)     1514 2022-07-26 20:56:38.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.numericinput.js
--rw-r--r--   0 lance     (1000) lance     (1000)     1634 2020-11-25 22:42:00.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.datepicker.js
--rw-r--r--   0 lance     (1000) lance     (1000)     3407 2019-11-05 01:06:58.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.message_recipients.js
--rw-r--r--   0 lance     (1000) lance     (1000)      437 2019-05-22 20:31:04.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.timepicker.js
--rw-r--r--   0 lance     (1000) lance     (1000)     4178 2022-11-15 22:21:22.000000 Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.grid.js
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/tailbone/static/img/
--rw-r--r--   0 lance     (1000) lance     (1000)      771 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/loading.gif
--rw-r--r--   0 lance     (1000) lance     (1000)      616 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/view.png
--rw-r--r--   0 lance     (1000) lance     (1000)      542 2015-03-10 02:10:41.000000 Tailbone-0.9.9/tailbone/static/img/save.png
--rw-rw-r--   0 lance     (1000) lance     (1000)     2077 2016-12-17 08:48:19.000000 Tailbone-0.9.9/tailbone/static/img/product.png
--rw-r--r--   0 lance     (1000) lance     (1000)      533 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/edit.png
--rw-r--r--   0 lance     (1000) lance     (1000)      169 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/sort_arrow_up.png
--rw-r--r--   0 lance     (1000) lance     (1000)   107339 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/Hymenocephalus_italicus.jpg
--rw-r--r--   0 lance     (1000) lance     (1000)    20687 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/home_logo.png
--rw-r--r--   0 lance     (1000) lance     (1000)      158 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/sort_arrow_down.png
--rw-r--r--   0 lance     (1000) lance     (1000)     5694 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/rattail.ico
--rw-rw-r--   0 lance     (1000) lance     (1000)    10375 2022-11-21 03:00:53.000000 Tailbone-0.9.9/tailbone/static/img/testing.png
--rw-r--r--   0 lance     (1000) lance     (1000)      641 2013-09-10 19:45:39.000000 Tailbone-0.9.9/tailbone/static/img/delete.png
--rw-r--r--   0 lance     (1000) lance     (1000)     1152 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/static/__init__.py
--rw-r--r--   0 lance     (1000) lance     (1000)       26 2018-03-01 00:58:49.000000 Tailbone-0.9.9/tailbone/static/robots.txt
--rw-r--r--   0 lance     (1000) lance     (1000)     2984 2023-02-02 00:40:54.000000 Tailbone-0.9.9/tailbone/config.py
--rw-r--r--   0 lance     (1000) lance     (1000)      489 2022-01-13 00:06:52.000000 Tailbone-0.9.9/MANIFEST.in
--rw-r--r--   0 lance     (1000) lance     (1000)     6916 2023-02-11 17:51:28.000000 Tailbone-0.9.9/setup.py
--rw-r--r--   0 lance     (1000) lance     (1000)      146 2023-02-22 01:14:55.000000 Tailbone-0.9.9/setup.cfg
--rw-r--r--   0 lance     (1000) lance     (1000)    35147 2018-03-01 00:58:49.000000 Tailbone-0.9.9/COPYING.txt
--rw-r--r--   0 lance     (1000) lance     (1000)   145290 2023-02-22 01:14:13.000000 Tailbone-0.9.9/CHANGES.rst
--rw-r--r--   0 lance     (1000) lance     (1000)      269 2014-04-22 17:10:45.000000 Tailbone-0.9.9/README.rst
--rw-r--r--   0 lance     (1000) lance     (1000)     1511 2022-08-24 23:26:54.000000 Tailbone-0.9.9/tasks.py
--rw-r--r--   0 lance     (1000) lance     (1000)     1147 2023-02-22 01:14:55.000000 Tailbone-0.9.9/PKG-INFO
-drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2023-02-22 01:14:55.000000 Tailbone-0.9.9/Tailbone.egg-info/
--rw-r--r--   0 lance     (1000) lance     (1000)        1 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/dependency_links.txt
--rw-r--r--   0 lance     (1000) lance     (1000)        1 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/not-zip-safe
--rw-r--r--   0 lance     (1000) lance     (1000)    14504 2023-02-22 01:14:55.000000 Tailbone-0.9.9/Tailbone.egg-info/SOURCES.txt
--rw-r--r--   0 lance     (1000) lance     (1000)      273 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/entry_points.txt
--rw-r--r--   0 lance     (1000) lance     (1000)      446 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/requires.txt
--rw-r--r--   0 lance     (1000) lance     (1000)        9 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/top_level.txt
--rw-r--r--   0 lance     (1000) lance     (1000)     1147 2023-02-22 01:14:54.000000 Tailbone-0.9.9/Tailbone.egg-info/PKG-INFO
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/
+-rw-r--r--   0 lance     (1000) lance     (1000)   159981 2024-04-01 23:28:19.000000 Tailbone-0.9.90/CHANGES.rst
+-rw-r--r--   0 lance     (1000) lance     (1000)    35147 2018-03-01 00:58:49.000000 Tailbone-0.9.90/COPYING.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)      489 2022-01-13 00:06:52.000000 Tailbone-0.9.90/MANIFEST.in
+-rw-r--r--   0 lance     (1000) lance     (1000)     2573 2024-04-01 23:28:51.293865 Tailbone-0.9.90/PKG-INFO
+-rw-r--r--   0 lance     (1000) lance     (1000)      269 2014-04-22 17:10:45.000000 Tailbone-0.9.90/README.rst
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/Tailbone.egg-info/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2573 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/PKG-INFO
+-rw-r--r--   0 lance     (1000) lance     (1000)    14878 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/SOURCES.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)        1 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/dependency_links.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)      272 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/entry_points.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)        1 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/not-zip-safe
+-rw-r--r--   0 lance     (1000) lance     (1000)      448 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/requires.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)        9 2024-04-01 23:28:51.000000 Tailbone-0.9.90/Tailbone.egg-info/top_level.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)     2128 2024-04-01 23:28:51.293865 Tailbone-0.9.90/setup.cfg
+-rw-r--r--   0 lance     (1000) lance     (1000)     1008 2023-05-16 20:02:32.000000 Tailbone-0.9.90/setup.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1161 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)       49 2024-04-01 23:28:24.000000 Tailbone-0.9.90/tailbone/_version.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/api/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1389 2022-08-14 05:48:55.000000 Tailbone-0.9.90/tailbone/api/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7865 2023-05-17 04:11:43.000000 Tailbone-0.9.90/tailbone/api/auth.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/api/batch/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1097 2019-11-11 20:08:35.000000 Tailbone-0.9.90/tailbone/api/batch/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    12760 2023-11-02 00:42:53.000000 Tailbone-0.9.90/tailbone/api/batch/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7150 2023-11-15 15:46:15.000000 Tailbone-0.9.90/tailbone/api/batch/inventory.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2688 2022-08-14 05:59:35.000000 Tailbone-0.9.90/tailbone/api/batch/labels.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    11602 2023-09-17 22:23:51.000000 Tailbone-0.9.90/tailbone/api/batch/ordering.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    20393 2023-11-02 00:43:37.000000 Tailbone-0.9.90/tailbone/api/batch/receiving.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     5099 2023-05-17 04:34:48.000000 Tailbone-0.9.90/tailbone/api/common.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     4643 2023-06-17 03:15:35.000000 Tailbone-0.9.90/tailbone/api/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1833 2022-08-14 05:48:19.000000 Tailbone-0.9.90/tailbone/api/customers.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1202 2023-05-20 00:29:29.000000 Tailbone-0.9.90/tailbone/api/essentials.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1547 2023-01-30 00:46:27.000000 Tailbone-0.9.90/tailbone/api/labels.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    21938 2023-10-08 17:24:00.000000 Tailbone-0.9.90/tailbone/api/master.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1489 2022-08-14 05:42:00.000000 Tailbone-0.9.90/tailbone/api/master2.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1802 2022-08-14 05:49:24.000000 Tailbone-0.9.90/tailbone/api/people.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7461 2023-09-02 15:55:47.000000 Tailbone-0.9.90/tailbone/api/products.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2126 2022-08-14 05:50:11.000000 Tailbone-0.9.90/tailbone/api/upgrades.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2181 2023-05-03 00:13:09.000000 Tailbone-0.9.90/tailbone/api/users.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1719 2022-08-14 05:51:19.000000 Tailbone-0.9.90/tailbone/api/vendors.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     8607 2022-08-31 02:51:40.000000 Tailbone-0.9.90/tailbone/api/workorders.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    11334 2023-10-24 01:35:10.000000 Tailbone-0.9.90/tailbone/app.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3290 2022-08-17 00:32:35.000000 Tailbone-0.9.90/tailbone/asgi.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6324 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/auth.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     5418 2022-12-07 20:00:13.000000 Tailbone-0.9.90/tailbone/beaker.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2691 2022-12-24 05:29:45.000000 Tailbone-0.9.90/tailbone/cleanup.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2931 2023-11-02 00:44:30.000000 Tailbone-0.9.90/tailbone/config.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     8274 2023-02-07 18:19:37.000000 Tailbone-0.9.90/tailbone/db.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9796 2023-12-01 00:13:00.000000 Tailbone-0.9.90/tailbone/diffs.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1696 2020-02-28 23:40:40.000000 Tailbone-0.9.90/tailbone/exceptions.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/forms/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1107 2023-09-17 00:47:36.000000 Tailbone-0.9.90/tailbone/forms/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1995 2023-02-12 04:03:46.000000 Tailbone-0.9.90/tailbone/forms/common.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    49488 2024-03-26 17:53:16.000000 Tailbone-0.9.90/tailbone/forms/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2361 2023-08-29 21:08:45.000000 Tailbone-0.9.90/tailbone/forms/receiving.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7041 2023-10-09 20:50:24.000000 Tailbone-0.9.90/tailbone/forms/types.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    20440 2023-12-02 01:47:37.000000 Tailbone-0.9.90/tailbone/forms/widgets.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/grids/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1077 2021-01-30 20:30:05.000000 Tailbone-0.9.90/tailbone/grids/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    70611 2024-03-26 16:48:40.000000 Tailbone-0.9.90/tailbone/grids/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    40585 2023-12-11 19:49:51.000000 Tailbone-0.9.90/tailbone/grids/filters.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2730 2023-01-16 18:44:24.000000 Tailbone-0.9.90/tailbone/handler.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1883 2023-05-05 02:26:43.000000 Tailbone-0.9.90/tailbone/helpers.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    29626 2023-10-29 20:45:59.000000 Tailbone-0.9.90/tailbone/menus.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3466 2022-08-20 22:12:54.000000 Tailbone-0.9.90/tailbone/progress.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1901 2023-01-15 00:47:07.000000 Tailbone-0.9.90/tailbone/providers.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.253864 Tailbone-0.9.90/tailbone/reports/
+-rw-rw-r--   0 lance     (1000) lance     (1000)     2481 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/reports/inventory_worksheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3577 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/reports/ordering_worksheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1632 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/scaffolds.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.257864 Tailbone-0.9.90/tailbone/static/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1152 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/static/__init__.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.257864 Tailbone-0.9.90/tailbone/static/css/
+-rw-r--r--   0 lance     (1000) lance     (1000)      440 2021-01-30 19:10:34.000000 Tailbone-0.9.90/tailbone/static/css/base.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     4880 2021-01-17 02:38:15.000000 Tailbone-0.9.90/tailbone/static/css/codehilite.css
+-rw-r--r--   0 lance     (1000) lance     (1000)      789 2020-08-02 03:09:36.000000 Tailbone-0.9.90/tailbone/static/css/diffs.css
+-rw-r--r--   0 lance     (1000) lance     (1000)      390 2023-02-02 22:24:46.000000 Tailbone-0.9.90/tailbone/static/css/filters.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     1439 2023-02-02 22:24:46.000000 Tailbone-0.9.90/tailbone/static/css/forms.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     5542 2023-02-03 23:02:02.000000 Tailbone-0.9.90/tailbone/static/css/grids.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     1173 2023-02-02 22:24:46.000000 Tailbone-0.9.90/tailbone/static/css/grids.rowstatus.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     2671 2023-10-25 15:44:50.000000 Tailbone-0.9.90/tailbone/static/css/layout.css
+-rw-r--r--   0 lance     (1000) lance     (1000)     7346 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/css/normalize.css
+-rw-r--r--   0 lance     (1000) lance     (1000)      575 2019-06-05 00:52:33.000000 Tailbone-0.9.90/tailbone/static/css/perms.css
+-rw-r--r--   0 lance     (1000) lance     (1000)      965 2023-02-02 22:24:46.000000 Tailbone-0.9.90/tailbone/static/css/progress.css
+-rw-r--r--   0 lance     (1000) lance     (1000)      208 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/static/css/purchases.css
+-rw-rw-r--   0 lance     (1000) lance     (1000)      225 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/static/css/schedule_print.css
+-rw-rw-r--   0 lance     (1000) lance     (1000)     1664 2017-07-18 18:57:10.000000 Tailbone-0.9.90/tailbone/static/css/timesheet.css
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.257864 Tailbone-0.9.90/tailbone/static/files/
+-rw-r--r--   0 lance     (1000) lance     (1000)     5041 2022-08-30 13:52:10.000000 Tailbone-0.9.90/tailbone/static/files/newproduct_template.xlsx
+-rw-r--r--   0 lance     (1000) lance     (1000)     7593 2022-01-06 18:40:01.000000 Tailbone-0.9.90/tailbone/static/files/vendor_catalog_template.xlsx
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.257864 Tailbone-0.9.90/tailbone/static/img/
+-rw-r--r--   0 lance     (1000) lance     (1000)   107339 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/Hymenocephalus_italicus.jpg
+-rw-r--r--   0 lance     (1000) lance     (1000)      641 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/delete.png
+-rw-r--r--   0 lance     (1000) lance     (1000)      533 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/edit.png
+-rw-r--r--   0 lance     (1000) lance     (1000)    20687 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/home_logo.png
+-rw-r--r--   0 lance     (1000) lance     (1000)      771 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/loading.gif
+-rw-rw-r--   0 lance     (1000) lance     (1000)     2077 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/static/img/product.png
+-rw-r--r--   0 lance     (1000) lance     (1000)     5694 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/rattail.ico
+-rw-r--r--   0 lance     (1000) lance     (1000)      542 2015-03-10 02:10:41.000000 Tailbone-0.9.90/tailbone/static/img/save.png
+-rw-r--r--   0 lance     (1000) lance     (1000)      158 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/sort_arrow_down.png
+-rw-r--r--   0 lance     (1000) lance     (1000)      169 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/sort_arrow_up.png
+-rw-rw-r--   0 lance     (1000) lance     (1000)    10375 2022-11-21 03:00:53.000000 Tailbone-0.9.90/tailbone/static/img/testing.png
+-rw-r--r--   0 lance     (1000) lance     (1000)      616 2013-09-10 19:45:39.000000 Tailbone-0.9.90/tailbone/static/img/view.png
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.257864 Tailbone-0.9.90/tailbone/static/js/
+-rw-r--r--   0 lance     (1000) lance     (1000)      813 2021-10-12 18:14:50.000000 Tailbone-0.9.90/tailbone/static/js/debounce.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     2380 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/static/js/numeric.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     9498 2023-10-26 01:03:48.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.autocomplete.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     1634 2020-11-25 22:42:00.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.datepicker.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     4561 2023-06-16 17:21:44.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.grid.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     3407 2019-11-05 01:06:58.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.message_recipients.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     1514 2022-07-26 20:56:38.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.numericinput.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     1637 2019-06-24 23:30:10.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.oncebutton.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     1403 2023-09-17 00:42:09.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.timepicker.js
+-rw-r--r--   0 lance     (1000) lance     (1000)     1427 2023-06-06 16:53:17.000000 Tailbone-0.9.90/tailbone/static/js/tailbone.feedback.js
+-rw-r--r--   0 lance     (1000) lance     (1000)       26 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/static/robots.txt
+-rw-r--r--   0 lance     (1000) lance     (1000)    10327 2023-11-01 13:09:36.000000 Tailbone-0.9.90/tailbone/subscribers.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/
+-rw-r--r--   0 lance     (1000) lance     (1000)      471 2019-08-03 00:53:47.000000 Tailbone-0.9.90/tailbone/templates/about.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/appinfo/
+-rw-r--r--   0 lance     (1000) lance     (1000)     7318 2023-02-02 00:31:53.000000 Tailbone-0.9.90/tailbone/templates/appinfo/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3270 2023-10-24 14:53:32.000000 Tailbone-0.9.90/tailbone/templates/appinfo/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     6314 2023-02-03 05:54:56.000000 Tailbone-0.9.90/tailbone/templates/appsettings.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      899 2023-02-03 22:40:11.000000 Tailbone-0.9.90/tailbone/templates/autocomplete.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    33683 2023-11-17 23:00:34.000000 Tailbone-0.9.90/tailbone/templates/base.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      772 2021-11-04 22:56:35.000000 Tailbone-0.9.90/tailbone/templates/base_meta.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/batch/
+-rw-r--r--   0 lance     (1000) lance     (1000)       84 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/batch/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)       81 2019-06-08 19:26:19.000000 Tailbone-0.9.90/tailbone/templates/batch/edit.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/batch/importer/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2387 2023-02-03 05:42:46.000000 Tailbone-0.9.90/tailbone/templates/batch/importer/view_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     4716 2023-02-03 05:51:09.000000 Tailbone-0.9.90/tailbone/templates/batch/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/batch/inventory/
+-rw-r--r--   0 lance     (1000) lance     (1000)    10312 2023-10-06 20:50:38.000000 Tailbone-0.9.90/tailbone/templates/batch/inventory/desktop_form.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/batch/newproduct/
+-rw-r--r--   0 lance     (1000) lance     (1000)      160 2022-08-30 15:56:25.000000 Tailbone-0.9.90/tailbone/templates/batch/newproduct/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.261864 Tailbone-0.9.90/tailbone/templates/batch/pos/
+-rw-r--r--   0 lance     (1000) lance     (1000)      285 2023-10-07 04:17:54.000000 Tailbone-0.9.90/tailbone/templates/batch/pos/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/batch/pricing/
+-rw-r--r--   0 lance     (1000) lance     (1000)      536 2022-06-14 18:18:31.000000 Tailbone-0.9.90/tailbone/templates/batch/pricing/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1388 2022-01-08 19:35:47.000000 Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1288 2023-02-03 05:42:10.000000 Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      309 2022-01-06 18:52:39.000000 Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      247 2022-01-06 20:44:32.000000 Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/view_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    11873 2023-02-03 05:50:11.000000 Tailbone-0.9.90/tailbone/templates/batch/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      509 2023-02-03 05:50:25.000000 Tailbone-0.9.90/tailbone/templates/batch/worksheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      121 2020-03-24 00:26:09.000000 Tailbone-0.9.90/tailbone/templates/change_password.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    13008 2023-01-17 03:55:16.000000 Tailbone-0.9.90/tailbone/templates/configure-menus.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     9425 2023-01-16 17:56:04.000000 Tailbone-0.9.90/tailbone/templates/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/customers/
+-rw-r--r--   0 lance     (1000) lance     (1000)     3775 2023-06-11 18:38:46.000000 Tailbone-0.9.90/tailbone/templates/customers/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/customers/pending/
+-rw-r--r--   0 lance     (1000) lance     (1000)     5021 2021-12-24 01:59:01.000000 Tailbone-0.9.90/tailbone/templates/customers/pending/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1215 2023-10-12 04:47:13.000000 Tailbone-0.9.90/tailbone/templates/customers/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/custorders/
+-rw-r--r--   0 lance     (1000) lance     (1000)     6522 2023-10-25 00:29:26.000000 Tailbone-0.9.90/tailbone/templates/custorders/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    92495 2023-10-26 14:28:39.000000 Tailbone-0.9.90/tailbone/templates/custorders/create.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/custorders/items/
+-rw-r--r--   0 lance     (1000) lance     (1000)    16046 2023-09-12 17:35:33.000000 Tailbone-0.9.90/tailbone/templates/custorders/items/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)       81 2023-09-10 19:59:06.000000 Tailbone-0.9.90/tailbone/templates/custorders/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/datasync/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.265864 Tailbone-0.9.90/tailbone/templates/datasync/changes/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2125 2023-02-03 05:54:34.000000 Tailbone-0.9.90/tailbone/templates/datasync/changes/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    31019 2023-02-02 00:43:40.000000 Tailbone-0.9.90/tailbone/templates/datasync/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     5964 2023-02-02 00:35:51.000000 Tailbone-0.9.90/tailbone/templates/datasync/status.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/deform/
+-rw-r--r--   0 lance     (1000) lance     (1000)      918 2023-02-03 05:52:17.000000 Tailbone-0.9.90/tailbone/templates/deform/autocomplete_jquery.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      943 2023-02-03 05:53:06.000000 Tailbone-0.9.90/tailbone/templates/deform/cases_units.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      492 2023-02-03 05:54:15.000000 Tailbone-0.9.90/tailbone/templates/deform/checkbox.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      545 2021-01-06 00:19:12.000000 Tailbone-0.9.90/tailbone/templates/deform/checkbox_dynamic.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     1213 2023-02-03 05:51:23.000000 Tailbone-0.9.90/tailbone/templates/deform/checked_password.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      597 2023-02-03 05:53:42.000000 Tailbone-0.9.90/tailbone/templates/deform/date_jquery.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      581 2019-02-23 02:44:18.000000 Tailbone-0.9.90/tailbone/templates/deform/date_plain.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      543 2023-09-17 01:00:05.000000 Tailbone-0.9.90/tailbone/templates/deform/datetime_falafel.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      758 2023-02-03 05:52:34.000000 Tailbone-0.9.90/tailbone/templates/deform/file_upload.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      601 2019-11-04 23:21:16.000000 Tailbone-0.9.90/tailbone/templates/deform/message_recipients_buefy.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      257 2023-01-29 16:59:23.000000 Tailbone-0.9.90/tailbone/templates/deform/multi_file_upload.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      963 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/deform/numberinput.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      509 2019-06-28 17:09:23.000000 Tailbone-0.9.90/tailbone/templates/deform/numericinput.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      616 2023-02-07 22:10:56.000000 Tailbone-0.9.90/tailbone/templates/deform/password.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      710 2023-02-03 05:52:00.000000 Tailbone-0.9.90/tailbone/templates/deform/percentinput.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     2102 2023-02-03 05:54:03.000000 Tailbone-0.9.90/tailbone/templates/deform/permissions.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      875 2022-11-19 23:40:01.000000 Tailbone-0.9.90/tailbone/templates/deform/problem_report_days.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     2164 2023-02-03 05:51:49.000000 Tailbone-0.9.90/tailbone/templates/deform/select.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     1177 2023-08-08 19:10:04.000000 Tailbone-0.9.90/tailbone/templates/deform/select_dynamic.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     1979 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/deform/select_jquery.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)     1718 2019-09-06 22:13:34.000000 Tailbone-0.9.90/tailbone/templates/deform/select_plain.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      550 2023-03-23 15:17:29.000000 Tailbone-0.9.90/tailbone/templates/deform/textarea.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      894 2023-02-04 01:42:19.000000 Tailbone-0.9.90/tailbone/templates/deform/textinput.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      230 2023-09-26 00:21:51.000000 Tailbone-0.9.90/tailbone/templates/deform/time_falafel.pt
+-rw-r--r--   0 lance     (1000) lance     (1000)      655 2023-02-03 05:53:32.000000 Tailbone-0.9.90/tailbone/templates/deform/time_jquery.pt
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/departments/
+-rw-rw-r--   0 lance     (1000) lance     (1000)      294 2023-02-03 05:31:15.000000 Tailbone-0.9.90/tailbone/templates/departments/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      551 2023-10-09 05:16:53.000000 Tailbone-0.9.90/tailbone/templates/diff.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/email-bounces/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1659 2023-09-08 15:46:55.000000 Tailbone-0.9.90/tailbone/templates/email-bounces/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/employees/
+-rw-r--r--   0 lance     (1000) lance     (1000)      626 2023-06-11 04:11:26.000000 Tailbone-0.9.90/tailbone/templates/employees/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      259 2019-04-12 19:47:07.000000 Tailbone-0.9.90/tailbone/templates/employees/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1170 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/exception.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1493 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/templates/form.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2779 2023-06-17 19:13:31.000000 Tailbone-0.9.90/tailbone/templates/formposter.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/forms/
+-rw-r--r--   0 lance     (1000) lance     (1000)     7047 2023-10-05 18:09:53.000000 Tailbone-0.9.90/tailbone/templates/forms/deform_buefy.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)       67 2023-02-03 05:36:08.000000 Tailbone-0.9.90/tailbone/templates/forms/form.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      265 2022-08-09 03:19:59.000000 Tailbone-0.9.90/tailbone/templates/forms/util.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    12583 2023-02-02 00:37:54.000000 Tailbone-0.9.90/tailbone/templates/generate_feature.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/generated-projects/
+-rw-r--r--   0 lance     (1000) lance     (1000)      582 2023-05-04 18:51:55.000000 Tailbone-0.9.90/tailbone/templates/generated-projects/create.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/grids/
+-rw-r--r--   0 lance     (1000) lance     (1000)     3024 2023-02-02 00:24:21.000000 Tailbone-0.9.90/tailbone/templates/grids/b-table.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    28295 2023-10-11 03:10:01.000000 Tailbone-0.9.90/tailbone/templates/grids/buefy.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1573 2019-05-06 23:17:43.000000 Tailbone-0.9.90/tailbone/templates/grids/filters.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1898 2023-10-11 03:10:01.000000 Tailbone-0.9.90/tailbone/templates/grids/filters_buefy.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      755 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/grids/nav.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      672 2019-08-24 02:39:03.000000 Tailbone-0.9.90/tailbone/templates/home.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/ifps-plu-codes/
+-rw-r--r--   0 lance     (1000) lance     (1000)      281 2020-12-07 01:28:53.000000 Tailbone-0.9.90/tailbone/templates/ifps-plu-codes/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.269864 Tailbone-0.9.90/tailbone/templates/importing/
+-rw-r--r--   0 lance     (1000) lance     (1000)     6187 2023-02-02 00:43:01.000000 Tailbone-0.9.90/tailbone/templates/importing/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      294 2021-12-06 18:34:10.000000 Tailbone-0.9.90/tailbone/templates/importing/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2643 2021-12-07 03:29:19.000000 Tailbone-0.9.90/tailbone/templates/importing/runjob.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      671 2021-12-07 03:21:19.000000 Tailbone-0.9.90/tailbone/templates/importing/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.249864 Tailbone-0.9.90/tailbone/templates/labels/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/labels/profiles/
+-rw-rw-r--   0 lance     (1000) lance     (1000)      314 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/templates/labels/profiles/create.mako
+-rw-rw-r--   0 lance     (1000) lance     (1000)      620 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/templates/labels/profiles/edit.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      432 2019-05-23 22:57:42.000000 Tailbone-0.9.90/tailbone/templates/labels/profiles/printer.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1232 2023-02-09 02:19:12.000000 Tailbone-0.9.90/tailbone/templates/labels/profiles/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1649 2023-02-07 22:11:44.000000 Tailbone-0.9.90/tailbone/templates/login.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/luigi/
+-rw-r--r--   0 lance     (1000) lance     (1000)    14033 2023-02-02 00:30:45.000000 Tailbone-0.9.90/tailbone/templates/luigi/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    12842 2023-02-02 00:29:33.000000 Tailbone-0.9.90/tailbone/templates/luigi/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/master/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1376 2023-02-03 05:30:32.000000 Tailbone-0.9.90/tailbone/templates/master/clone.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      893 2021-12-14 03:26:58.000000 Tailbone-0.9.90/tailbone/templates/master/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      174 2019-05-22 20:24:53.000000 Tailbone-0.9.90/tailbone/templates/master/create.mako
+-rw-rw-r--   0 lance     (1000) lance     (1000)      248 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/templates/master/create_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1401 2023-02-03 05:26:22.000000 Tailbone-0.9.90/tailbone/templates/master/delete.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      226 2023-10-10 02:06:31.000000 Tailbone-0.9.90/tailbone/templates/master/edit.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      879 2021-12-13 19:43:47.000000 Tailbone-0.9.90/tailbone/templates/master/edit_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      584 2023-02-03 18:10:14.000000 Tailbone-0.9.90/tailbone/templates/master/form.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      170 2018-11-23 00:24:59.000000 Tailbone-0.9.90/tailbone/templates/master/import_file.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    25083 2023-09-15 18:45:55.000000 Tailbone-0.9.90/tailbone/templates/master/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     5560 2023-06-19 02:20:45.000000 Tailbone-0.9.90/tailbone/templates/master/merge.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1033 2023-02-03 22:16:07.000000 Tailbone-0.9.90/tailbone/templates/master/versions.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    11299 2023-10-23 20:28:04.000000 Tailbone-0.9.90/tailbone/templates/master/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      709 2023-02-03 05:26:29.000000 Tailbone-0.9.90/tailbone/templates/master/view_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1413 2023-10-10 15:07:41.000000 Tailbone-0.9.90/tailbone/templates/master/view_version.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/members/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2342 2023-08-26 14:11:45.000000 Tailbone-0.9.90/tailbone/templates/members/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      262 2023-06-14 19:01:14.000000 Tailbone-0.9.90/tailbone/templates/members/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1686 2023-02-02 22:24:46.000000 Tailbone-0.9.90/tailbone/templates/menu.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/messages/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/messages/archive/
+-rw-r--r--   0 lance     (1000) lance     (1000)      353 2023-02-03 05:34:09.000000 Tailbone-0.9.90/tailbone/templates/messages/archive/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1777 2023-03-23 15:22:59.000000 Tailbone-0.9.90/tailbone/templates/messages/create.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/messages/inbox/
+-rw-r--r--   0 lance     (1000) lance     (1000)      355 2023-02-03 05:35:57.000000 Tailbone-0.9.90/tailbone/templates/messages/inbox/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1761 2023-02-03 05:35:48.000000 Tailbone-0.9.90/tailbone/templates/messages/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1101 2019-11-05 01:03:51.000000 Tailbone-0.9.90/tailbone/templates/messages/recipients.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/messages/sent/
+-rw-rw-r--   0 lance     (1000) lance     (1000)      354 2016-12-17 08:48:19.000000 Tailbone-0.9.90/tailbone/templates/messages/sent/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3206 2023-02-03 05:35:31.000000 Tailbone-0.9.90/tailbone/templates/messages/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1509 2023-01-29 17:00:34.000000 Tailbone-0.9.90/tailbone/templates/multi_file_upload.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.273864 Tailbone-0.9.90/tailbone/templates/ordering/
+-rw-r--r--   0 lance     (1000) lance     (1000)      112 2023-02-03 05:36:48.000000 Tailbone-0.9.90/tailbone/templates/ordering/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    16377 2021-02-01 03:51:46.000000 Tailbone-0.9.90/tailbone/templates/ordering/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    11560 2023-02-03 05:37:47.000000 Tailbone-0.9.90/tailbone/templates/ordering/worksheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1813 2023-08-28 02:36:03.000000 Tailbone-0.9.90/tailbone/templates/page.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     7512 2022-12-28 04:29:27.000000 Tailbone-0.9.90/tailbone/templates/page_help.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/people/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1296 2023-06-17 19:36:29.000000 Tailbone-0.9.90/tailbone/templates/people/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3654 2023-02-03 05:40:07.000000 Tailbone-0.9.90/tailbone/templates/people/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/people/merge-requests/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1183 2023-02-03 05:39:54.000000 Tailbone-0.9.90/tailbone/templates/people/merge-requests/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1106 2023-02-03 05:39:41.000000 Tailbone-0.9.90/tailbone/templates/people/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    84972 2024-04-01 23:03:00.000000 Tailbone-0.9.90/tailbone/templates/people/view_profile_buefy.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/poser/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/poser/reports/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2382 2022-03-04 00:35:18.000000 Tailbone-0.9.90/tailbone/templates/poser/reports/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3917 2022-03-21 22:32:51.000000 Tailbone-0.9.90/tailbone/templates/poser/setup.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/poser/views/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1120 2022-03-21 22:32:51.000000 Tailbone-0.9.90/tailbone/templates/poser/views/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/principal/
+-rw-r--r--   0 lance     (1000) lance     (1000)     7974 2023-10-18 22:35:09.000000 Tailbone-0.9.90/tailbone/templates/principal/find_by_perm.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      319 2023-10-18 21:45:40.000000 Tailbone-0.9.90/tailbone/templates/principal/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/products/
+-rw-r--r--   0 lance     (1000) lance     (1000)     3760 2024-03-26 17:53:16.000000 Tailbone-0.9.90/tailbone/templates/products/batch.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     4184 2023-08-25 13:40:55.000000 Tailbone-0.9.90/tailbone/templates/products/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2929 2023-02-03 05:58:51.000000 Tailbone-0.9.90/tailbone/templates/products/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    11948 2023-10-26 15:05:27.000000 Tailbone-0.9.90/tailbone/templates/products/lookup.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/products/pending/
+-rw-r--r--   0 lance     (1000) lance     (1000)     4913 2023-10-27 01:41:10.000000 Tailbone-0.9.90/tailbone/templates/products/pending/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    13299 2023-02-11 03:23:43.000000 Tailbone-0.9.90/tailbone/templates/products/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     6614 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/progress.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/purchases/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/purchases/batches/
+-rw-r--r--   0 lance     (1000) lance     (1000)      117 2023-02-03 22:16:48.000000 Tailbone-0.9.90/tailbone/templates/purchases/batches/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      278 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/purchases/batches/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.277865 Tailbone-0.9.90/tailbone/templates/purchases/credits/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2469 2023-02-03 23:08:13.000000 Tailbone-0.9.90/tailbone/templates/purchases/credits/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2630 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/purchases/receiving_worksheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      555 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/purchases/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/receiving/
+-rw-r--r--   0 lance     (1000) lance     (1000)     7668 2023-09-17 23:19:14.000000 Tailbone-0.9.90/tailbone/templates/receiving/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      117 2023-02-03 05:32:11.000000 Tailbone-0.9.90/tailbone/templates/receiving/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1495 2023-02-03 05:31:39.000000 Tailbone-0.9.90/tailbone/templates/receiving/declare_credit.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1400 2023-02-03 05:32:35.000000 Tailbone-0.9.90/tailbone/templates/receiving/receive_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      305 2018-10-24 22:53:24.000000 Tailbone-0.9.90/tailbone/templates/receiving/transform_unit_row.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    13336 2023-11-02 01:52:57.000000 Tailbone-0.9.90/tailbone/templates/receiving/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)    21718 2023-07-07 22:11:23.000000 Tailbone-0.9.90/tailbone/templates/receiving/view_row.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/reports/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/reports/generated/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1817 2023-02-03 05:22:38.000000 Tailbone-0.9.90/tailbone/templates/reports/generated/choose.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      635 2022-01-08 19:00:03.000000 Tailbone-0.9.90/tailbone/templates/reports/generated/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      346 2021-12-15 01:04:51.000000 Tailbone-0.9.90/tailbone/templates/reports/generated/delete.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      691 2023-02-03 05:22:09.000000 Tailbone-0.9.90/tailbone/templates/reports/generated/generate.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1082 2022-11-28 23:53:29.000000 Tailbone-0.9.90/tailbone/templates/reports/generated/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1365 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/reports/inventory.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3202 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/reports/ordering.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/reports/problems/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2397 2022-11-19 18:52:15.000000 Tailbone-0.9.90/tailbone/templates/reports/problems/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/roles/
+-rw-r--r--   0 lance     (1000) lance     (1000)      536 2020-07-17 00:43:21.000000 Tailbone-0.9.90/tailbone/templates/roles/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      541 2020-06-22 19:53:23.000000 Tailbone-0.9.90/tailbone/templates/roles/edit.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      407 2023-03-25 18:02:44.000000 Tailbone-0.9.90/tailbone/templates/roles/find_by_perm.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      330 2020-06-22 20:36:16.000000 Tailbone-0.9.90/tailbone/templates/roles/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      867 2023-06-14 19:26:51.000000 Tailbone-0.9.90/tailbone/templates/roles/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.249864 Tailbone-0.9.90/tailbone/templates/settings/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/settings/email/
+-rw-r--r--   0 lance     (1000) lance     (1000)     4605 2023-08-31 04:30:54.000000 Tailbone-0.9.90/tailbone/templates/settings/email/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1923 2022-08-06 23:37:28.000000 Tailbone-0.9.90/tailbone/templates/settings/email/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3005 2023-08-31 04:29:03.000000 Tailbone-0.9.90/tailbone/templates/settings/email/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/shifts/
+-rw-r--r--   0 lance     (1000) lance     (1000)     6116 2023-02-03 22:43:25.000000 Tailbone-0.9.90/tailbone/templates/shifts/base.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1025 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/shifts/schedule.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2538 2023-02-03 22:44:07.000000 Tailbone-0.9.90/tailbone/templates/shifts/schedule_edit.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      900 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/shifts/schedule_print.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      813 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/shifts/schedule_print_employee.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      833 2023-02-03 22:45:27.000000 Tailbone-0.9.90/tailbone/templates/shifts/timesheet.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1463 2023-02-03 22:42:48.000000 Tailbone-0.9.90/tailbone/templates/shifts/timesheet_edit.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/tables/
+-rw-r--r--   0 lance     (1000) lance     (1000)    31927 2023-05-13 02:23:37.000000 Tailbone-0.9.90/tailbone/templates/tables/create.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      307 2023-05-13 01:29:02.000000 Tailbone-0.9.90/tailbone/templates/tables/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      245 2023-05-13 01:31:53.000000 Tailbone-0.9.90/tailbone/templates/tables/migrations.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/tempmon/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.281865 Tailbone-0.9.90/tailbone/templates/tempmon/appliances/
+-rw-r--r--   0 lance     (1000) lance     (1000)      736 2020-04-05 00:31:41.000000 Tailbone-0.9.90/tailbone/templates/tempmon/appliances/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      510 2023-01-14 00:38:46.000000 Tailbone-0.9.90/tailbone/templates/tempmon/appliances/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/tempmon/clients/
+-rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:17:35.000000 Tailbone-0.9.90/tailbone/templates/tempmon/clients/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1044 2023-10-05 17:49:24.000000 Tailbone-0.9.90/tailbone/templates/tempmon/clients/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     3718 2023-02-03 05:40:48.000000 Tailbone-0.9.90/tailbone/templates/tempmon/dashboard.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/tempmon/probes/
+-rw-r--r--   0 lance     (1000) lance     (1000)     3664 2023-07-07 22:38:34.000000 Tailbone-0.9.90/tailbone/templates/tempmon/probes/graph.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:18:44.000000 Tailbone-0.9.90/tailbone/templates/tempmon/probes/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2738 2023-10-05 17:29:42.000000 Tailbone-0.9.90/tailbone/templates/tempmon/probes/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/tempmon/readings/
+-rw-r--r--   0 lance     (1000) lance     (1000)      305 2020-04-05 00:17:35.000000 Tailbone-0.9.90/tailbone/templates/tempmon/readings/index.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.249864 Tailbone-0.9.90/tailbone/templates/themes/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/themes/falafel/
+-rw-r--r--   0 lance     (1000) lance     (1000)       93 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/themes/falafel/base.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)       97 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/themes/falafel/progress.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)       96 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/themes/falafel/upgrade.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.249864 Tailbone-0.9.90/tailbone/templates/trainwreck/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1862 2023-01-02 18:38:43.000000 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      295 2022-01-01 22:14:16.000000 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1625 2023-02-02 00:39:56.000000 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/rollover.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      389 2022-03-17 21:59:40.000000 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      357 2022-02-19 22:34:34.000000 Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/view_row.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/units-of-measure/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1899 2021-01-27 14:56:25.000000 Tailbone-0.9.90/tailbone/templates/units-of-measure/index.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1736 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/upgrade.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/upgrades/
+-rw-r--r--   0 lance     (1000) lance     (1000)     5196 2023-02-02 00:32:20.000000 Tailbone-0.9.90/tailbone/templates/upgrades/configure.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     9414 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/templates/upgrades/view.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/users/
+-rw-r--r--   0 lance     (1000) lance     (1000)      481 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/templates/users/find_by_perm.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     1314 2022-02-15 02:30:15.000000 Tailbone-0.9.90/tailbone/templates/users/preferences.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     4517 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/templates/users/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)      797 2023-02-03 05:38:48.000000 Tailbone-0.9.90/tailbone/templates/util.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/vendors/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1850 2022-05-15 21:04:06.000000 Tailbone-0.9.90/tailbone/templates/vendors/configure.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.249864 Tailbone-0.9.90/tailbone/templates/views/
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/views/model/
+-rw-r--r--   0 lance     (1000) lance     (1000)     9427 2023-01-16 19:50:05.000000 Tailbone-0.9.90/tailbone/templates/views/model/create.mako
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.285865 Tailbone-0.9.90/tailbone/templates/workorders/
+-rw-r--r--   0 lance     (1000) lance     (1000)     7838 2022-08-10 02:05:11.000000 Tailbone-0.9.90/tailbone/templates/workorders/view.mako
+-rw-r--r--   0 lance     (1000) lance     (1000)     2637 2019-02-26 03:11:49.000000 Tailbone-0.9.90/tailbone/tweens.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    13431 2023-11-12 03:25:41.000000 Tailbone-0.9.90/tailbone/util.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/
+-rw-r--r--   0 lance     (1000) lance     (1000)     2797 2022-12-10 15:46:54.000000 Tailbone-0.9.90/tailbone/views/__init__.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/asgi/
+-rw-r--r--   0 lance     (1000) lance     (1000)     4315 2023-06-09 19:22:50.000000 Tailbone-0.9.90/tailbone/views/asgi/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2654 2022-08-20 22:38:06.000000 Tailbone-0.9.90/tailbone/views/asgi/datasync.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7840 2022-08-21 03:39:57.000000 Tailbone-0.9.90/tailbone/views/asgi/upgrades.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9533 2023-12-13 18:05:29.000000 Tailbone-0.9.90/tailbone/views/auth.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/batch/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1075 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/views/batch/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    59583 2023-11-06 00:30:51.000000 Tailbone-0.9.90/tailbone/views/batch/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3698 2021-10-31 02:25:39.000000 Tailbone-0.9.90/tailbone/views/batch/delproduct.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6215 2023-05-05 01:11:45.000000 Tailbone-0.9.90/tailbone/views/batch/handheld.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9978 2024-03-27 18:10:54.000000 Tailbone-0.9.90/tailbone/views/batch/importer.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    19323 2023-10-06 20:52:44.000000 Tailbone-0.9.90/tailbone/views/batch/inventory.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7101 2022-01-10 20:54:44.000000 Tailbone-0.9.90/tailbone/views/batch/labels.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6695 2023-08-31 01:01:47.000000 Tailbone-0.9.90/tailbone/views/batch/newproduct.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9511 2023-10-20 15:10:15.000000 Tailbone-0.9.90/tailbone/views/batch/pos.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    12439 2024-03-26 17:53:16.000000 Tailbone-0.9.90/tailbone/views/batch/pricing.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9366 2023-05-05 02:26:03.000000 Tailbone-0.9.90/tailbone/views/batch/product.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    15017 2023-05-30 18:24:14.000000 Tailbone-0.9.90/tailbone/views/batch/vendorcatalog.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6644 2022-08-14 04:58:46.000000 Tailbone-0.9.90/tailbone/views/batch/vendorinvoice.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7059 2023-10-18 23:04:31.000000 Tailbone-0.9.90/tailbone/views/bouncer.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3974 2022-07-19 19:48:52.000000 Tailbone-0.9.90/tailbone/views/brands.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3712 2022-11-23 17:57:17.000000 Tailbone-0.9.90/tailbone/views/categories.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    13198 2023-06-17 21:09:24.000000 Tailbone-0.9.90/tailbone/views/common.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6188 2023-06-17 20:49:58.000000 Tailbone-0.9.90/tailbone/views/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2502 2022-11-23 18:19:27.000000 Tailbone-0.9.90/tailbone/views/customergroups.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    32367 2023-10-25 17:19:50.000000 Tailbone-0.9.90/tailbone/views/customers.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/custorders/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1213 2020-08-02 04:53:28.000000 Tailbone-0.9.90/tailbone/views/custorders/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7676 2023-02-12 15:33:23.000000 Tailbone-0.9.90/tailbone/views/custorders/batch.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1948 2022-11-23 18:19:21.000000 Tailbone-0.9.90/tailbone/views/custorders/creating.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    26154 2023-09-12 17:39:23.000000 Tailbone-0.9.90/tailbone/views/custorders/items.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    45521 2023-10-25 19:05:36.000000 Tailbone-0.9.90/tailbone/views/custorders/orders.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    16525 2023-06-01 16:37:13.000000 Tailbone-0.9.90/tailbone/views/datasync.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7660 2023-12-22 17:40:34.000000 Tailbone-0.9.90/tailbone/views/departments.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2065 2022-11-23 18:19:03.000000 Tailbone-0.9.90/tailbone/views/depositlinks.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    19409 2023-10-30 03:22:01.000000 Tailbone-0.9.90/tailbone/views/email.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    14156 2023-10-18 22:53:40.000000 Tailbone-0.9.90/tailbone/views/employees.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2229 2023-05-05 15:39:16.000000 Tailbone-0.9.90/tailbone/views/essentials.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6163 2022-12-25 18:44:17.000000 Tailbone-0.9.90/tailbone/views/exports.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3231 2022-11-23 18:00:03.000000 Tailbone-0.9.90/tailbone/views/families.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     4000 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/views/features.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2483 2022-11-23 18:18:45.000000 Tailbone-0.9.90/tailbone/views/filemon.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1384 2023-09-10 18:50:16.000000 Tailbone-0.9.90/tailbone/views/handheld.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2778 2022-11-23 18:18:37.000000 Tailbone-0.9.90/tailbone/views/ifps.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    21962 2023-05-10 01:24:53.000000 Tailbone-0.9.90/tailbone/views/importing.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2566 2022-11-23 18:18:26.000000 Tailbone-0.9.90/tailbone/views/inventory.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/labels/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1155 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/views/labels/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1326 2023-09-10 18:50:26.000000 Tailbone-0.9.90/tailbone/views/labels/batch.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6330 2023-02-09 02:19:03.000000 Tailbone-0.9.90/tailbone/views/labels/profiles.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    11286 2023-02-03 06:49:24.000000 Tailbone-0.9.90/tailbone/views/luigi.py
+-rw-r--r--   0 lance     (1000) lance     (1000)   227934 2023-12-02 01:42:13.000000 Tailbone-0.9.90/tailbone/views/master.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    18131 2023-12-01 00:19:11.000000 Tailbone-0.9.90/tailbone/views/members.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6801 2023-02-03 06:44:00.000000 Tailbone-0.9.90/tailbone/views/menus.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    20543 2023-10-18 23:06:19.000000 Tailbone-0.9.90/tailbone/views/messages.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    76212 2024-04-01 23:03:37.000000 Tailbone-0.9.90/tailbone/views/people.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1816 2022-11-23 18:18:05.000000 Tailbone-0.9.90/tailbone/views/permissions.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/poser/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1138 2022-03-05 00:03:03.000000 Tailbone-0.9.90/tailbone/views/poser/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2470 2022-05-11 01:00:46.000000 Tailbone-0.9.90/tailbone/views/poser/master.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    10063 2022-05-11 01:00:44.000000 Tailbone-0.9.90/tailbone/views/poser/reports.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    11220 2022-07-26 17:01:09.000000 Tailbone-0.9.90/tailbone/views/poser/views.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6493 2023-10-18 22:32:13.000000 Tailbone-0.9.90/tailbone/views/principal.py
+-rw-r--r--   0 lance     (1000) lance     (1000)   102631 2024-03-26 17:53:16.000000 Tailbone-0.9.90/tailbone/views/products.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2491 2022-11-23 18:17:55.000000 Tailbone-0.9.90/tailbone/views/progress.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    15358 2023-05-20 00:45:29.000000 Tailbone-0.9.90/tailbone/views/projects.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.289865 Tailbone-0.9.90/tailbone/views/purchases/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1159 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/views/purchases/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    13572 2023-10-18 23:17:47.000000 Tailbone-0.9.90/tailbone/views/purchases/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6915 2023-09-17 23:22:43.000000 Tailbone-0.9.90/tailbone/views/purchases/credits.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tailbone/views/purchasing/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1266 2021-09-29 15:13:18.000000 Tailbone-0.9.90/tailbone/views/purchasing/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    34215 2023-10-18 23:01:26.000000 Tailbone-0.9.90/tailbone/views/purchasing/batch.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    12698 2023-06-27 23:18:35.000000 Tailbone-0.9.90/tailbone/views/purchasing/costing.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    19718 2023-10-17 20:25:52.000000 Tailbone-0.9.90/tailbone/views/purchasing/ordering.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    89420 2023-12-20 17:53:56.000000 Tailbone-0.9.90/tailbone/views/purchasing/receiving.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3197 2022-11-23 18:17:10.000000 Tailbone-0.9.90/tailbone/views/reportcodes.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    29977 2023-10-06 15:11:24.000000 Tailbone-0.9.90/tailbone/views/reports.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    20040 2023-02-03 06:30:15.000000 Tailbone-0.9.90/tailbone/views/roles.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    16700 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/views/settings.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tailbone/views/shifts/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1207 2018-03-01 00:58:49.000000 Tailbone-0.9.90/tailbone/views/shifts/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6797 2023-10-18 23:14:40.000000 Tailbone-0.9.90/tailbone/views/shifts/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    21935 2023-10-04 16:45:12.000000 Tailbone-0.9.90/tailbone/views/shifts/lib.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9975 2023-02-12 03:56:46.000000 Tailbone-0.9.90/tailbone/views/shifts/schedule.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     5387 2023-02-12 03:56:32.000000 Tailbone-0.9.90/tailbone/views/shifts/timesheet.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3726 2022-11-23 18:16:15.000000 Tailbone-0.9.90/tailbone/views/stores.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     5677 2023-02-03 22:10:08.000000 Tailbone-0.9.90/tailbone/views/subdepartments.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    16028 2023-05-13 02:22:15.000000 Tailbone-0.9.90/tailbone/views/tables.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2103 2023-10-07 02:23:35.000000 Tailbone-0.9.90/tailbone/views/taxes.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tailbone/views/tempmon/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1344 2020-04-04 20:42:25.000000 Tailbone-0.9.90/tailbone/views/tempmon/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6526 2023-01-14 02:16:48.000000 Tailbone-0.9.90/tailbone/views/tempmon/appliances.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     9593 2023-10-05 18:08:20.000000 Tailbone-0.9.90/tailbone/views/tempmon/clients.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3486 2023-04-21 17:01:56.000000 Tailbone-0.9.90/tailbone/views/tempmon/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6056 2023-02-12 15:31:40.000000 Tailbone-0.9.90/tailbone/views/tempmon/dashboard.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    11672 2023-10-18 23:08:32.000000 Tailbone-0.9.90/tailbone/views/tempmon/probes.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     4062 2023-10-18 23:16:37.000000 Tailbone-0.9.90/tailbone/views/tempmon/readings.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2076 2023-10-19 22:38:32.000000 Tailbone-0.9.90/tailbone/views/tenders.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tailbone/views/trainwreck/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1135 2023-01-19 01:57:13.000000 Tailbone-0.9.90/tailbone/views/trainwreck/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    15019 2023-09-20 23:03:33.000000 Tailbone-0.9.90/tailbone/views/trainwreck/base.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1582 2022-11-23 18:15:06.000000 Tailbone-0.9.90/tailbone/views/trainwreck/defaults.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2409 2023-10-07 01:55:59.000000 Tailbone-0.9.90/tailbone/views/typical.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     4350 2022-11-23 18:14:52.000000 Tailbone-0.9.90/tailbone/views/uoms.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    25047 2023-05-19 00:56:33.000000 Tailbone-0.9.90/tailbone/views/upgrades.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    27921 2023-05-15 13:10:42.000000 Tailbone-0.9.90/tailbone/views/users.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tailbone/views/vendors/
+-rw-r--r--   0 lance     (1000) lance     (1000)     1236 2023-02-23 01:01:50.000000 Tailbone-0.9.90/tailbone/views/vendors/__init__.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1363 2023-09-10 18:50:49.000000 Tailbone-0.9.90/tailbone/views/vendors/catalogs.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     7783 2023-10-24 22:43:48.000000 Tailbone-0.9.90/tailbone/views/vendors/core.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1363 2023-09-10 18:50:41.000000 Tailbone-0.9.90/tailbone/views/vendors/invoices.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     4738 2023-02-23 04:40:20.000000 Tailbone-0.9.90/tailbone/views/vendors/samplefiles.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     2951 2021-11-09 23:17:17.000000 Tailbone-0.9.90/tailbone/views/versions.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     6966 2023-10-18 23:16:11.000000 Tailbone-0.9.90/tailbone/views/views.py
+-rw-r--r--   0 lance     (1000) lance     (1000)    13863 2023-09-02 20:50:35.000000 Tailbone-0.9.90/tailbone/views/workorders.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     3747 2023-05-17 02:25:47.000000 Tailbone-0.9.90/tailbone/webapi.py
+-rw-r--r--   0 lance     (1000) lance     (1000)     1511 2022-08-24 23:26:54.000000 Tailbone-0.9.90/tasks.py
+drwxr-xr-x   0 lance     (1000) lance     (1000)        0 2024-04-01 23:28:51.293865 Tailbone-0.9.90/tests/
+-rw-rw-r--   0 lance     (1000) lance     (1000)     1057 2023-05-25 19:55:35.000000 Tailbone-0.9.90/tests/test_app.py
+-rw-r--r--   0 lance     (1000) lance     (1000)      191 2013-09-10 19:45:40.000000 Tailbone-0.9.90/tests/test_helpers.py
```

### filetype from file(1)

```diff
@@ -1 +1 @@
-POSIX tar archive (GNU)
+POSIX tar archive
```

### Comparing `Tailbone-0.9.9/tailbone/subscribers.py` & `Tailbone-0.9.90/tailbone/subscribers.py`

 * *Files 3% similar despite different names*

```diff
@@ -36,15 +36,15 @@
 from webhelpers2.html import tags
 
 import tailbone
 from tailbone import helpers
 from tailbone.db import Session
 from tailbone.config import csrf_header_name, should_expose_websockets
 from tailbone.menus import make_simple_menus
-from tailbone.util import get_global_search_options
+from tailbone.util import get_available_themes, get_global_search_options
 
 
 def new_request(event):
     """
     Identify the current user, and cache their current permissions.  Also adds
     the ``rattail_config`` attribute to the request.
 
@@ -58,14 +58,24 @@
 
        request.rattail_config
 
     .. note::
        This of course assumes that a Rattail ``config`` object *has* in fact
        already been placed in the application registry settings.  If this is
        not the case, this function will do nothing.
+
+    Also, attach some goodies to the request object:
+
+    * The currently logged-in user instance (if any), as ``user``.
+
+    * ``is_admin`` flag indicating whether user has the Administrator role.
+
+    * ``is_root`` flag indicating whether user is currently elevated to root.
+
+    * A shortcut method for permission checking, as ``has_perm()``.
     """
     request = event.request
     rattail_config = request.registry.settings.get('rattail_config')
     # TODO: why would this ever be null?
     if rattail_config:
         request.rattail_config = rattail_config
 
@@ -83,20 +93,35 @@
 
     # assign client IP address to the session, for sake of versioning
     Session().continuum_remote_addr = request.client_addr
 
     request.is_admin = bool(request.user) and request.user.is_admin()
     request.is_root = request.is_admin and request.session.get('is_root', False)
 
+    # TODO: why would this ever be null?
     if rattail_config:
+
         app = rattail_config.get_app()
         auth = app.get_auth_handler()
         request.tailbone_cached_permissions = auth.get_permissions(
             Session(), request.user)
 
+        def has_perm(name):
+            if name in request.tailbone_cached_permissions:
+                return True
+            return request.is_root
+        request.has_perm = has_perm
+
+        def has_any_perm(*names):
+            for name in names:
+                if has_perm(name):
+                    return True
+            return False
+        request.has_any_perm = has_any_perm
+
 
 def before_render(event):
     """
     Adds goodies to the global template renderer context.
     """
 
     request = event.get('request') or threadlocal.get_current_request()
@@ -123,21 +148,20 @@
     if 'tailbone.theme' in request.registry.settings:
         renderer_globals['theme'] = request.registry.settings['tailbone.theme']
         # note, this is just a global flag; user still needs permission to see picker
         expose_picker = request.rattail_config.getbool('tailbone', 'themes.expose_picker',
                                                        default=False)
         renderer_globals['expose_theme_picker'] = expose_picker
         if expose_picker:
-            # tailbone's config extension provides a default theme selection,
-            # so the default we specify here *probably* should not matter
-            available = request.rattail_config.getlist('tailbone', 'themes',
-                                                       default=['falafel'])
-            if 'default' not in available:
-                available.insert(0, 'default')
-            options = [tags.Option(theme) for theme in available]
+
+            # TODO: should remove 'falafel' option altogether
+            available = get_available_themes(request.rattail_config,
+                                             include=['falafel'])
+
+            options = [tags.Option(theme, value=theme) for theme in available]
             renderer_globals['theme_picker_options'] = options
 
         # heck while we're assuming the classic web app here...
         # (we don't want this to happen for the API either!)
         # TODO: just..awful *shrug*
         # note that we assume "simple" menus nowadays
         if request.rattail_config.getbool('tailbone', 'menus.simple', default=True):
@@ -202,44 +226,24 @@
                                                  .filter(model.MessageRecipient.recipient == Session.merge(request.user))\
                                                  .filter(model.MessageRecipient.status == enum.MESSAGE_STATUS_INBOX)\
                                                  .count()
 
 
 def context_found(event):
     """
-    Attach some goodies to the request object.
+    Attach some more goodies to the request object:
 
     The following is attached to the request:
 
-    * The currently logged-in user instance (if any), as ``user``.
+    * ``get_referrer()`` function
 
-    * ``is_admin`` flag indicating whether user has the Administrator role.
-
-    * ``is_root`` flag indicating whether user is currently elevated to root.
-
-    * A shortcut method for permission checking, as ``has_perm()``.
-
-    * A shortcut method for fetching the referrer, as ``get_referrer()``.
+    * ``get_session_timeout()`` function
     """
-
     request = event.request
 
-    def has_perm(name):
-        if name in request.tailbone_cached_permissions:
-            return True
-        return request.is_root
-    request.has_perm = has_perm
-
-    def has_any_perm(*names):
-        for name in names:
-            if has_perm(name):
-                return True
-        return False
-    request.has_any_perm = has_any_perm
-
     def get_referrer(default=None, **kwargs):
         if request.params.get('referrer'):
             return request.params['referrer']
         if request.session.get('referrer'):
             return request.session.pop('referrer')
         referrer = request.referrer
         if (not referrer or referrer == request.current_route_url()
```

### Comparing `Tailbone-0.9.9/tailbone/reports/ordering_worksheet.mako` & `Tailbone-0.9.90/tailbone/reports/ordering_worksheet.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/reports/inventory_worksheet.mako` & `Tailbone-0.9.90/tailbone/reports/inventory_worksheet.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/scaffolds.py` & `Tailbone-0.9.90/tailbone/scaffolds.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/grids/filters.py` & `Tailbone-0.9.90/tailbone/grids/filters.py`

 * *Files 1% similar despite different names*

```diff
@@ -23,19 +23,19 @@
 """
 Grid Filters
 """
 
 import re
 import datetime
 import logging
+from collections import OrderedDict
 
 import sqlalchemy as sa
 
 from rattail.gpc import GPC
-from rattail.util import OrderedDict
 from rattail.core import UNSPECIFIED
 from rattail.time import localtime, make_utc
 from rattail.util import prettify
 
 import colander
 from webhelpers2.html import HTML, tags
 
@@ -173,21 +173,26 @@
     def __init__(self, key, config=None, label=None, verbs=None,
                  value_enum=None, value_renderer=None,
                  default_active=False, default_verb=None, default_value=None,
                  encode_values=False, value_encoding='utf-8', **kwargs):
         self.key = key
         self.config = config
         self.label = label or prettify(key)
-        self.verbs = verbs or self.get_default_verbs()
+
         if value_renderer:
             self.set_value_renderer(value_renderer)
         elif value_enum:
             self.set_choices(value_enum)
         else:
             self.set_value_renderer(self.value_renderer_factory)
+
+        # nb. do this after setting choices, if applicable, since that
+        # could change default verbs
+        self.verbs = verbs or self.get_default_verbs()
+
         self.default_active = default_active
         self.default_verb = default_verb
         self.default_value = default_value
 
         self.encode_values = encode_values
         self.value_encoding = value_encoding
 
@@ -267,15 +272,16 @@
         and/or value is specified by the caller, the filter will use its own
         current verb/value by default.
         """
         verb = verb or self.verb
         value = self.get_value(value)
         filtr = getattr(self, 'filter_{0}'.format(verb), None)
         if not filtr:
-            raise ValueError("Unknown filter verb: {0}".format(repr(verb)))
+            log.warning("unknown filter verb: %s", verb)
+            return data
         return filtr(data, value)
 
     def get_value(self, value=UNSPECIFIED):
         return value if value is not UNSPECIFIED else self.value
 
     def encode_value(self, value):
         if self.encode_values and isinstance(value, str):
@@ -303,15 +309,15 @@
 class AlchemyGridFilter(GridFilter):
     """
     Base class for SQLAlchemy grid filters.
     """
 
     def __init__(self, *args, **kwargs):
         self.column = kwargs.pop('column')
-        super(AlchemyGridFilter, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
 
     def filter_equal(self, query, value):
         """
         Filter data with an equal ('=') query.
         """
         if value is None or value == '':
             return query
@@ -327,14 +333,46 @@
         # When saying something is 'not equal' to something else, we must also
         # include things which are nothing at all, in our result set.
         return query.filter(sa.or_(
             self.column == None,
             self.column != self.encode_value(value),
         ))
 
+    def filter_equal_any_of(self, query, value):
+        """
+        This filter expects "multiple values" separated by newline
+        character, and will add an "OR" condition with each value
+        being checked separately.  For instance if the user submits a
+        "value" like this:
+
+        .. code-block:: none
+
+           foo bar
+           baz
+
+        This will result in SQL condition like this:
+
+        .. code-block:: sql
+
+           name = 'foo bar' OR name = 'baz'
+        """
+        if not value:
+            return query
+
+        values = value.split('\n')
+        values = [value for value in values if value]
+        if not values:
+            return query
+
+        conditions = []
+        for value in values:
+            conditions.append(self.column == self.encode_value(value))
+
+        return query.filter(sa.or_(*conditions))
+
     def filter_is_null(self, query, value):
         """
         Filter data with an 'IS NULL' query.  Note that this filter does not
         use the value for anything.
         """
         return query.filter(self.column == None)
 
@@ -405,36 +443,40 @@
         This method should actually apply filter(s) to the query,
         according to the given value range.  Subclasses may override
         this logic.
         """
         if start_value:
             if self.value_invalid(start_value):
                 return query
-            query = query.filter(self.column >= start_value)
+            query = query.filter(self.column >= self.encode_value(start_value))
 
         if end_value:
             if self.value_invalid(end_value):
                 return query
-            query = query.filter(self.column <= end_value)
+            query = query.filter(self.column <= self.encode_value(end_value))
 
         return query
 
 
 class AlchemyStringFilter(AlchemyGridFilter):
     """
     String filter for SQLAlchemy.
     """
 
     def default_verbs(self):
         """
         Expose contains / does-not-contain verbs in addition to core.
         """
+
+        if self.choices:
+            return ['equal', 'not_equal', 'is_null', 'is_not_null', 'is_any']
+
         return ['contains', 'does_not_contain',
                 'contains_any_of',
-                'equal', 'not_equal',
+                'equal', 'not_equal', 'equal_any_of',
                 'is_empty', 'is_not_empty',
                 'is_null', 'is_not_null',
                 'is_empty_or_null',
                 'is_any']
 
     def filter_contains(self, query, value):
         """
@@ -492,53 +534,54 @@
             conditions.append(sa.and_(
                 *[self.column.ilike(self.encode_value('%{}%'.format(v)))
                   for v in value.split()]))
 
         return query.filter(sa.or_(*conditions))
 
     def filter_is_empty(self, query, value):
-        return query.filter(sa.func.trim(self.column) == self.encode_value(''))
+        return query.filter(sa.func.ltrim(sa.func.rtrim(self.column)) == self.encode_value(''))
 
     def filter_is_not_empty(self, query, value):
-        return query.filter(sa.func.trim(self.column) != self.encode_value(''))
+        return query.filter(sa.func.ltrim(sa.func.rtrim(self.column)) != self.encode_value(''))
 
     def filter_is_empty_or_null(self, query, value):
         return query.filter(
             sa.or_(
-                sa.func.trim(self.column) == self.encode_value(''),
+                sa.func.ltrim(sa.func.rtrim(self.column)) == self.encode_value(''),
                 self.column == None))
 
+
 class AlchemyEmptyStringFilter(AlchemyStringFilter):
     """
     String filter with special logic to treat empty string values as NULL
     """
 
     def filter_is_null(self, query, value):
         return query.filter(
             sa.or_(
                 self.column == None,
-                sa.func.trim(self.column) == self.encode_value('')))
+                sa.func.ltrim(sa.func.rtrim(self.column)) == self.encode_value('')))
 
     def filter_is_not_null(self, query, value):
         return query.filter(
             sa.and_(
                 self.column != None,
-                sa.func.trim(self.column) != self.encode_value('')))
+                sa.func.ltrim(sa.func.rtrim(self.column)) != self.encode_value('')))
 
 
 class AlchemyByteStringFilter(AlchemyStringFilter):
     """
     String filter for SQLAlchemy, which encodes value as bytestring before
     passing it along to the query.  Useful when querying certain databases
     (esp. via FreeTDS) which like to throw the occasional segfault...
     """
     value_encoding = 'utf-8'
 
     def get_value(self, value=UNSPECIFIED):
-        value = super(AlchemyByteStringFilter, self).get_value(value)
+        value = super().get_value(value)
         if isinstance(value, str):
             value = value.encode(self.value_encoding)
         return value
 
     def filter_contains(self, query, value):
         """
         Filter data with a full 'ILIKE' query.
@@ -566,18 +609,19 @@
 
 class AlchemyNumericFilter(AlchemyGridFilter):
     """
     Numeric filter for SQLAlchemy.
     """
     value_renderer_factory = NumericValueRenderer
 
-    # expose greater-than / less-than verbs in addition to core
-    default_verbs = ['equal', 'not_equal', 'greater_than', 'greater_equal',
-                     'less_than', 'less_equal', 'between',
-                     'is_null', 'is_not_null', 'is_any']
+    def default_verbs(self):
+        # expose greater-than / less-than verbs in addition to core
+        return ['equal', 'not_equal', 'greater_than', 'greater_equal',
+                'less_than', 'less_equal', 'between',
+                'is_null', 'is_not_null', 'is_any']
 
     # TODO: what follows "works" in that it prevents an error...but from the
     # user's perspective it still fails silently...need to improve on front-end
 
     # try to detect (and ignore) common mistake where user enters UPC as search
     # term for integer field...
 
@@ -590,65 +634,82 @@
             return True
 
         return bool(value and len(str(value)) > 8)
 
     def filter_equal(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_equal(query, value)
+        return super().filter_equal(query, value)
 
     def filter_not_equal(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_not_equal(query, value)
+        return super().filter_not_equal(query, value)
 
     def filter_greater_than(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_greater_than(query, value)
+        return super().filter_greater_than(query, value)
 
     def filter_greater_equal(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_greater_equal(query, value)
+        return super().filter_greater_equal(query, value)
 
     def filter_less_than(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_less_than(query, value)
+        return super().filter_less_than(query, value)
 
     def filter_less_equal(self, query, value):
         if self.value_invalid(value):
             return query
-        return super(AlchemyNumericFilter, self).filter_less_equal(query, value)
+        return super().filter_less_equal(query, value)
 
 
 class AlchemyIntegerFilter(AlchemyNumericFilter):
     """
     Integer filter for SQLAlchemy.
     """
+    bigint = False
+
+    def default_verbs(self):
+
+        # limited verbs if choices are defined
+        if self.choices:
+            return ['equal', 'not_equal', 'is_null', 'is_not_null', 'is_any']
+
+        return super().default_verbs()
 
     def value_invalid(self, value):
         if value:
             if isinstance(value, int):
                 return True
             if not value.isdigit():
                 return True
-            # TODO: this one is to avoid DataError from PG, but perhaps that
-            # isn't a good enough reason to make this global logic?
-            if int(value) > 2147483647:
+            # normal Integer columns have a max value, beyond which PG
+            # will throw an error if we try to query for larger values
+            # TODO: this seems hacky, how to better handle it?
+            if not self.bigint and int(value) > 2147483647:
                 return True
         return False
 
     def encode_value(self, value):
         # ensure we pass integer value to sqlalchemy, so it does not try to
         # encode it as a string etc.
         return int(value)
 
 
+class AlchemyBigIntegerFilter(AlchemyIntegerFilter):
+    """
+    BigInteger filter for SQLAlchemy.
+    """
+    bigint = True
+
+
 class AlchemyBooleanFilter(AlchemyGridFilter):
     """
     Boolean filter for SQLAlchemy.
     """
     default_verbs = ['is_true', 'is_false', 'is_any']
 
     def filter_is_true(self, query, value):
@@ -1129,23 +1190,23 @@
 
     def filter_contains(self, query, value):
         """
         Try to parse the value into "parts" of a phone number, then do a normal
         'ILIKE' query with those parts.
         """
         value = self.parse_value(value)
-        return super(AlchemyPhoneNumberFilter, self).filter_contains(query, value)
+        return super().filter_contains(query, value)
 
     def filter_does_not_contain(self, query, value):
         """
         Try to parse the value into "parts" of a phone number, then do a normal
         'NOT ILIKE' query with those parts.
         """
         value = self.parse_value(value)
-        return super(AlchemyPhoneNumberFilter, self).filter_does_not_contain(query, value)
+        return super().filter_does_not_contain(query, value)
 
 
 class GridFilterSet(OrderedDict):
     """
     Collection class for :class:`GridFilter` instances.
     """
 
@@ -1181,15 +1242,15 @@
         self.filters = filters
         if 'schema' not in kwargs:
             schema = colander.Schema()
             for key, filtr in self.filters.items():
                 node = colander.SchemaNode(colander.String(), name=key)
                 schema.add(node)
             kwargs['schema'] = schema
-        super(GridFiltersForm, self).__init__(**kwargs)
+        super().__init__(**kwargs)
 
     def iter_filters(self):
         return self.filters.values()
 
     def filter_verb(self, filtr):
         """
         Render the verb selection dropdown for the given filter.
```

### Comparing `Tailbone-0.9.9/tailbone/grids/core.py` & `Tailbone-0.9.90/tailbone/grids/core.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2023 Lance Edgar
+#  Copyright  2010-2024 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,24 +20,23 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Core Grid Classes
 """
 
+from urllib.parse import urlencode
 import warnings
 import logging
 
-from six.moves import urllib
 import sqlalchemy as sa
 from sqlalchemy import orm
 
 from rattail.db.types import GPCType
-from rattail.util import prettify, pretty_boolean, pretty_quantity, pretty_hours
-from rattail.time import localtime
+from rattail.util import prettify, pretty_boolean, pretty_quantity
 
 import webhelpers2_grid
 from pyramid.renderers import render
 from webhelpers2.html import HTML, tags
 from paginate_sqlalchemy import SqlalchemyOrmPage
 
 from . import filters as gridfilters
@@ -166,27 +165,42 @@
           grid = Grid(
               # ..normal constructor args here..
 
               raw_renderers={
                   'myfield': myrender,
               },
           )
+
+    .. attribute row_uuid_getter::
+
+       Optional callable to obtain the "UUID" (sic) value for each
+       data row.  The default assumption as that each row object has a
+       ``uuid`` attribute, but when that isn't the case, *and* the
+       grid needs to support checkboxes, we must "pretend" by
+       injecting some custom value to the ``uuid`` of the row data.
+
+       If necssary, set this to a callable like so::
+
+          def fake_uuid(row):
+              return row.some_custom_key
+
+          grid.row_uuid_getter = fake_uuid
     """
 
     def __init__(self, key, data, columns=None, width='auto', request=None,
                  model_class=None, model_title=None, model_title_plural=None,
                  enums={}, labels={}, assume_local_times=False, renderers={}, invisible=[],
                  raw_renderers={},
                  extra_row_class=None, linked_columns=[], url='#',
                  joiners={}, filterable=False, filters={}, use_byte_string_filters=False,
                  searchable={},
                  sortable=False, sorters={}, default_sortkey=None, default_sortdir='asc',
                  pageable=False, default_pagesize=None, default_page=1,
                  checkboxes=False, checked=None, check_handler=None, check_all_handler=None,
-                 checkable=None,
+                 checkable=None, row_uuid_getter=None,
                  clicking_row_checks_box=False, click_handlers=None,
                  main_actions=[], more_actions=[], delete_speedbump=False,
                  ajax_data_url=None, component='tailbone-grid',
                  expose_direct_link=False,
                  **kwargs):
 
         self.key = key
@@ -239,14 +253,15 @@
         self.checkboxes = checkboxes
         self.checked = checked
         if self.checked is None:
             self.checked = lambda item: False
         self.check_handler = check_handler
         self.check_all_handler = check_all_handler
         self.checkable = checkable
+        self.row_uuid_getter = row_uuid_getter
         self.clicking_row_checks_box = clicking_row_checks_box
 
         self.click_handlers = click_handlers or {}
 
         self.main_actions = main_actions or []
         self.more_actions = more_actions or []
         self.delete_speedbump = delete_speedbump
@@ -289,15 +304,15 @@
         """
         This *removes* a column from the grid, altogether.
 
         This method is deprecated; use :meth:`remove()` instead.
         """
         warnings.warn("Grid.hide_column() is deprecated; please use "
                       "Grid.remove() instead.",
-                      DeprecationWarning)
+                      DeprecationWarning, stacklevel=2)
         self.remove(key)
 
     def hide_columns(self, *keys):
         """
         This *removes* columns from the grid, altogether.
 
         This method is deprecated; use :meth:`remove()` instead.
@@ -333,15 +348,21 @@
     def set_joiner(self, key, joiner):
         if joiner is None:
             self.joiners.pop(key, None)
         else:
             self.joiners[key] = joiner
 
     def set_sorter(self, key, *args, **kwargs):
-        self.sorters[key] = self.make_sorter(*args, **kwargs)
+        if len(args) == 1 and args[0] is None:
+            self.remove_sorter(key)
+        else:
+            self.sorters[key] = self.make_sorter(*args, **kwargs)
+
+    def remove_sorter(self, key):
+        self.sorters.pop(key, None)
 
     def set_sort_defaults(self, sortkey, sortdir='asc'):
         self.default_sortkey = sortkey
         self.default_sortdir = sortdir
 
     def set_filter(self, key, *args, **kwargs):
         if len(args) == 1 and args[0] is None:
@@ -359,17 +380,17 @@
 
     def is_searchable(self, key):
         return self.searchable.get(key, False)
 
     def remove_filter(self, key):
         self.filters.pop(key, None)
 
-    def set_label(self, key, label):
+    def set_label(self, key, label, column_only=False):
         self.labels[key] = label
-        if key in self.filters:
+        if not column_only and key in self.filters:
             self.filters[key].label = label
 
     def get_label(self, key):
         """
         Returns the label text for given field key.
         """
         return self.labels.get(key, prettify(key))
@@ -452,14 +473,19 @@
     def obtain_value(self, obj, column_name):
         """
         Try to obtain and return the value from the given object, for
         the given column name.
 
         :returns: The value, or ``None`` if no value was found.
         """
+        # TODO: this seems a little hacky, is there a better way?
+        # nb. this may only be relevant for import/export batch view?
+        if isinstance(obj, sa.engine.Row):
+            return obj._mapping[column_name]
+
         try:
             return obj[column_name]
         except KeyError:
             pass
         except TypeError:
             return getattr(obj, column_name, None)
 
@@ -477,15 +503,16 @@
             return ""
         return raw_datetime(self.request.rattail_config, value)
 
     def render_datetime_local(self, obj, column_name):
         value = self.obtain_value(obj, column_name)
         if value is None:
             return ""
-        value = localtime(self.request.rattail_config, value)
+        app = self.request.rattail_config.get_app()
+        value = app.localtime(value)
         return raw_datetime(self.request.rattail_config, value)
 
     def render_enum(self, obj, column_name):
         value = self.obtain_value(obj, column_name)
         if value is None:
             return ""
         enum = self.enums.get(column_name)
@@ -515,66 +542,25 @@
         app = self.request.rattail_config.get_app()
         return app.render_duration(seconds=seconds)
 
     def render_duration_hours(self, obj, field):
         value = self.obtain_value(obj, field)
         if value is None:
             return ""
-        return pretty_hours(hours=value)
+        app = self.request.rattail_config.get_app()
+        return app.render_duration(hours=value)
 
     def set_url(self, url):
         self.url = url
 
     def make_url(self, obj, i=None):
         if callable(self.url):
             return self.url(obj)
         return self.url
 
-    def make_webhelpers_grid(self):
-        kwargs = dict(self._whgrid_kwargs)
-        kwargs['request'] = self.request
-        kwargs['url'] = self.make_url
-
-        columns = list(self.columns)
-        column_labels = kwargs.setdefault('column_labels', {})
-        column_formats = kwargs.setdefault('column_formats', {})
-
-        for key, value in self.labels.items():
-            column_labels.setdefault(key, value)
-
-        if self.checkboxes:
-            columns.insert(0, 'checkbox')
-            column_labels['checkbox'] = tags.checkbox('check-all')
-            column_formats['checkbox'] = self.checkbox_column_format
-
-        if self.renderers:
-            kwargs['renderers'] = self.renderers
-        if self.extra_row_class:
-            kwargs['extra_record_class'] = self.extra_row_class
-        if self.linked_columns:
-            kwargs['linked_columns'] = list(self.linked_columns)
-
-        if self.main_actions or self.more_actions:
-            columns.append('actions')
-            column_formats['actions'] = self.actions_column_format
-
-        # TODO: pretty sure this factory doesn't serve all use cases yet?
-        factory = CustomWebhelpersGrid
-        # factory = webhelpers2_grid.Grid
-        if self.sortable:
-            # factory = CustomWebhelpersGrid
-            kwargs['order_column'] = self.sortkey
-            kwargs['order_direction'] = 'dsc' if self.sortdir == 'desc' else 'asc'
-
-        grid = factory(self.make_visible_data(), columns, **kwargs)
-        if self.sortable:
-            grid.exclude_ordering = list([key for key in grid.exclude_ordering
-                                          if key not in self.sorters])
-        return grid
-
     def make_default_renderers(self, renderers):
         """
         Make the default set of column renderers for the grid.
 
         We honor any existing renderers which have already been set, but then
         we also try to supplement that by auto-assigning renderers based on
         underlying column type.  Note that this special logic only applies to
@@ -611,27 +597,14 @@
 
     def checkbox_column_format(self, column_number, row_number, item):
         return HTML.td(self.render_checkbox(item), class_='checkbox')
 
     def actions_column_format(self, column_number, row_number, item):
         return HTML.td(self.render_actions(item, row_number), class_='actions')
 
-    def render_grid(self, template='/grids/grid.mako', **kwargs):
-        context = kwargs
-        context['grid'] = self
-        context['request'] = self.request
-        grid_class = ''
-        if self.width == 'full':
-            grid_class = 'full'
-        elif self.width == 'half':
-            grid_class = 'half'
-        context['grid_class'] = '{} {}'.format(grid_class, context.get('grid_class', ''))
-        context.setdefault('grid_attrs', {})
-        return render(template, context)
-
     def get_default_filters(self):
         """
         Returns the default set of filters provided by the grid.
         """
         if hasattr(self, 'default_filters'):
             if callable(self.default_filters):
                 return self.default_filters()
@@ -669,23 +642,28 @@
         factory = kwargs.pop('factory', None)
         if not factory:
             factory = gridfilters.AlchemyGridFilter
             if isinstance(column.type, sa.String):
                 factory = gridfilters.AlchemyStringFilter
             elif isinstance(column.type, sa.Numeric):
                 factory = gridfilters.AlchemyNumericFilter
+            elif isinstance(column.type, sa.BigInteger):
+                factory = gridfilters.AlchemyBigIntegerFilter
             elif isinstance(column.type, sa.Integer):
                 factory = gridfilters.AlchemyIntegerFilter
             elif isinstance(column.type, sa.Boolean):
                 # TODO: check column for nullable here?
                 factory = gridfilters.AlchemyNullableBooleanFilter
             elif isinstance(column.type, sa.Date):
                 factory = gridfilters.AlchemyDateFilter
             elif isinstance(column.type, sa.DateTime):
-                factory = gridfilters.AlchemyDateTimeFilter
+                if self.assume_local_times:
+                    factory = gridfilters.AlchemyLocalDateTimeFilter
+                else:
+                    factory = gridfilters.AlchemyDateTimeFilter
             elif isinstance(column.type, GPCType):
                 factory = gridfilters.AlchemyGPCFilter
         kwargs['column'] = column
         kwargs.setdefault('config', self.request.rattail_config)
         kwargs.setdefault('encode_values', self.use_byte_string_filters)
         return factory(key, **kwargs)
 
@@ -732,14 +710,17 @@
             # TODO: this seems hacky..normally we expect a true query
             # of course, but in some cases it may be a list instead.
             # if so then we can't actually sort
             if isinstance(query, list):
                 return query
             return query.order_by(getattr(column, direction)())
 
+        sorter._class = class_
+        sorter._column = column
+
         return sorter
 
     def make_simple_sorter(self, key, foldcase=False):
         """
         Returns a function suitable for a sort map callable, with typical logic
         built in for sorting a data set comprised of dicts, on the given key.
         """
@@ -772,16 +753,20 @@
         needn't access the settings dict directly, but the more Pythonic
         instance attributes.
         """
 
         # initial default settings
         settings = {}
         if self.sortable:
-            settings['sortkey'] = self.default_sortkey
-            settings['sortdir'] = self.default_sortdir
+            if self.default_sortkey:
+                settings['sorters.length'] = 1
+                settings['sorters.1.key'] = self.default_sortkey
+                settings['sorters.1.dir'] = self.default_sortdir
+            else:
+                settings['sorters.length'] = 0
         if self.pageable:
             settings['pagesize'] = self.get_default_pagesize()
             settings['page'] = self.default_page
         if self.filterable:
             for filtr in self.iter_filters():
                 settings['filter.{}.active'.format(filtr.key)] = filtr.default_active
                 settings['filter.{}.verb'.format(filtr.key)] = filtr.default_verb
@@ -846,16 +831,20 @@
         # update ourself to reflect settings
         if self.filterable:
             for filtr in self.iter_filters():
                 filtr.active = settings['filter.{}.active'.format(filtr.key)]
                 filtr.verb = settings['filter.{}.verb'.format(filtr.key)]
                 filtr.value = settings['filter.{}.value'.format(filtr.key)]
         if self.sortable:
-            self.sortkey = settings['sortkey']
-            self.sortdir = settings['sortdir']
+            self.active_sorters = []
+            for i in range(1, settings['sorters.length'] + 1):
+                self.active_sorters.append({
+                    'field': settings[f'sorters.{i}.key'],
+                    'order': settings[f'sorters.{i}.dir'],
+                })
         if self.pageable:
             self.pagesize = settings['pagesize']
             self.page = settings['page']
 
     def user_has_defaults(self):
         """
         Check to see if the current user has default settings on file for this grid.
@@ -866,40 +855,99 @@
 
         # NOTE: we used to leverage `self.session` here, but sometimes we might
         # be showing a grid of data from another system...so always use
         # Tailbone Session now, for the settings.  hopefully that didn't break
         # anything...
         session = Session()
         if user not in session:
-            user = session.merge(user)
+            # TODO: pretty sure there is no need to *merge* here..
+            # but we shall see if any breakage happens maybe
+            #user = session.merge(user)
+            user = session.get(user.__class__, user.uuid)
 
-        # User defaults should have all or nothing, so just check one key.
-        key = 'tailbone.{}.grid.{}.sortkey'.format(user.uuid, self.key)
         app = self.request.rattail_config.get_app()
-        return app.get_setting(Session(), key) is not None
+
+        # user defaults should be all or nothing, so just check one key
+        key = f'tailbone.{user.uuid}.grid.{self.key}.sorters.length'
+        if app.get_setting(session, key) is not None:
+            return True
+
+        # TODO: this is deprecated but should work its way out of the
+        # system in a little while (?)..then can remove this entirely
+        key = f'tailbone.{user.uuid}.grid.{self.key}.sortkey'
+        if app.get_setting(session, key) is not None:
+            return True
+
+        return False
 
     def apply_user_defaults(self, settings):
         """
         Update the given settings dict with user defaults, if any exist.
         """
+        app = self.request.rattail_config.get_app()
+        session = Session()
+        prefix = f'tailbone.{self.request.user.uuid}.grid.{self.key}'
+
         def merge(key, normalize=lambda v: v):
-            skey = 'tailbone.{}.grid.{}.{}'.format(self.request.user.uuid, self.key, key)
-            app = self.request.rattail_config.get_app()
-            value = app.get_setting(Session(), skey)
+            value = app.get_setting(session, f'{prefix}.{key}')
             settings[key] = normalize(value)
 
         if self.filterable:
             for filtr in self.iter_filters():
                 merge('filter.{}.active'.format(filtr.key), lambda v: v == 'true')
                 merge('filter.{}.verb'.format(filtr.key))
                 merge('filter.{}.value'.format(filtr.key))
 
         if self.sortable:
-            merge('sortkey')
-            merge('sortdir')
+
+            # first clear existing settings for *sorting* only
+            # nb. this is because number of sort settings will vary
+            for key in list(settings):
+                if key.startswith('sorters.'):
+                    del settings[key]
+
+            # check for *deprecated* settings, and use those if present
+            # TODO: obviously should stop this, but must wait until
+            # all old settings have been flushed out.  which in the
+            # case of user-persisted settings, could be a while...
+            sortkey = app.get_setting(session, f'{prefix}.sortkey')
+            if sortkey:
+                settings['sorters.length'] = 1
+                settings['sorters.1.key'] = sortkey
+                settings['sorters.1.dir'] = app.get_setting(session, f'{prefix}.sortdir')
+
+                # nb. re-persist these user settings per new
+                # convention, so deprecated settings go away and we
+                # can remove this logic after a while..
+                app = self.request.rattail_config.get_app()
+                model = app.model
+                prefix = f'tailbone.{self.request.user.uuid}.grid.{self.key}'
+                query = Session.query(model.Setting)\
+                               .filter(sa.or_(
+                                   model.Setting.name.like(f'{prefix}.sorters.%'),
+                                   model.Setting.name == f'{prefix}.sortkey',
+                                   model.Setting.name == f'{prefix}.sortdir'))
+                for setting in query.all():
+                    Session.delete(setting)
+                Session.flush()
+
+                def persist(key):
+                    app.save_setting(Session(),
+                                     f'tailbone.{self.request.user.uuid}.grid.{self.key}.{key}',
+                                     settings[key])
+
+                persist('sorters.length')
+                persist('sorters.1.key')
+                persist('sorters.1.dir')
+
+            else: # the future
+                merge('sorters.length', int)
+                for i in range(1, settings['sorters.length'] + 1):
+                    merge(f'sorters.{i}.key')
+                    merge(f'sorters.{i}.dir')
 
         if self.pageable:
             merge('pagesize', int)
             merge('page', int)
 
     def request_has_settings(self, type_):
         """
@@ -910,35 +958,43 @@
             for filtr in self.iter_filters():
                 if filtr.key in self.request.GET:
                     return True
             if 'filter' in self.request.GET: # user may be applying empty filters
                 return True
 
         elif type_ == 'sort':
+
+            # TODO: remove this eventually, but some links in the wild
+            # may still include these params, so leave it for now
             for key in ['sortkey', 'sortdir']:
                 if key in self.request.GET:
                     return True
 
+            if 'sort1key' in self.request.GET:
+                return True
+
         elif type_ == 'page':
             for key in ['pagesize', 'page']:
                 if key in self.request.GET:
                     return True
 
         return False
 
     def session_has_settings(self):
         """
         Determine if the current session contains any settings for the grid.
         """
         # session should have all or nothing, so just check a few keys which
         # should be guaranteed present if anything has been stashed
-        for key in ['page', 'sortkey']:
-            if 'grid.{}.{}'.format(self.key, key) in self.request.session:
+        prefix = f'grid.{self.key}'
+        for key in ['page', 'sorters.length']:
+            if f'{prefix}.{key}' in self.request.session:
                 return True
-        return any([key.startswith('grid.{}.filter'.format(self.key)) for key in self.request.session])
+        return any([key.startswith(f'{prefix}.filter')
+                    for key in self.request.session])
 
     def get_setting(self, source, settings, key, normalize=lambda v: v, default=None):
         """
         Get the effective value for a particular setting, preferring ``source``
         but falling back to existing ``settings`` and finally the ``default``.
         """
         if source not in ('request', 'session'):
@@ -1015,16 +1071,54 @@
         :param settings: Dictionary of initial settings, which is to be updated.
 
         :param source: String identifying the source to consult for settings
            data.  Must be one of: ``('request', 'session')``.
         """
         if not self.sortable:
             return
-        settings['sortkey'] = self.get_setting(source, settings, 'sortkey')
-        settings['sortdir'] = self.get_setting(source, settings, 'sortdir')
+
+        if source == 'request':
+
+            # TODO: remove this eventually, but some links in the wild
+            # may still include these params, so leave it for now
+            if 'sortkey' in self.request.GET:
+                settings['sorters.length'] = 1
+                settings['sorters.1.key'] = self.get_setting(source, settings, 'sortkey')
+                settings['sorters.1.dir'] = self.get_setting(source, settings, 'sortdir')
+
+            else: # the future
+                i = 1
+                while True:
+                    skey = f'sort{i}key'
+                    if skey in self.request.GET:
+                        settings[f'sorters.{i}.key'] = self.get_setting(source, settings, skey)
+                        settings[f'sorters.{i}.dir'] = self.get_setting(source, settings, f'sort{i}dir')
+                    else:
+                        break
+                    i += 1
+                settings['sorters.length'] = i - 1
+
+        else: # session
+
+            # TODO: definitely will remove this, but leave it for now
+            # so it doesn't monkey with current user sessions when
+            # next upgrade happens.  so, remove after all are upgraded
+            sortkey = self.get_setting(source, settings, 'sortkey')
+            if sortkey:
+                settings['sorters.length'] = 1
+                settings['sorters.1.key'] = sortkey
+                settings['sorters.1.dir'] = self.get_setting(source, settings, 'sortdir')
+
+            else: # the future
+                settings['sorters.length'] = self.get_setting(source, settings,
+                                                              'sorters.length', int)
+                for i in range(1, settings['sorters.length'] + 1):
+                    for key in ('key', 'dir'):
+                        skey = f'sorters.{i}.{key}'
+                        settings[skey] = self.get_setting(source, settings, skey)
 
     def update_page_settings(self, settings):
         """
         Updates a settings dictionary according to pager settings data found in
         either the GET query string, or session storage.
 
         Note that due to how the actual pager functions, the effective settings
@@ -1071,16 +1165,48 @@
         if self.filterable:
             for filtr in self.iter_filters():
                 persist('filter.{}.active'.format(filtr.key), value=lambda k: str(settings[k]).lower())
                 persist('filter.{}.verb'.format(filtr.key))
                 persist('filter.{}.value'.format(filtr.key))
 
         if self.sortable:
-            persist('sortkey')
-            persist('sortdir')
+
+            # first clear existing settings for *sorting* only
+            # nb. this is because number of sort settings will vary
+            if to == 'defaults':
+                model = self.request.rattail_config.get_model()
+                prefix = f'tailbone.{self.request.user.uuid}.grid.{self.key}'
+                query = Session.query(model.Setting)\
+                               .filter(sa.or_(
+                                   model.Setting.name.like(f'{prefix}.sorters.%'),
+                                   # TODO: remove these eventually,
+                                   # but probably should wait until
+                                   # all nodes have been upgraded for
+                                   # (quite) a while?
+                                   model.Setting.name == f'{prefix}.sortkey',
+                                   model.Setting.name == f'{prefix}.sortdir'))
+                for setting in query.all():
+                    Session.delete(setting)
+                Session.flush()
+            else: # session
+                prefix = f'grid.{self.key}'
+                for key in list(self.request.session):
+                    if key.startswith(f'{prefix}.sorters.'):
+                        del self.request.session[key]
+                # TODO: definitely will remove these, but leave for
+                # now so they don't monkey with current user sessions
+                # when next upgrade happens.  so, remove after all are
+                # upgraded
+                self.request.session.pop(f'{prefix}.sortkey', None)
+                self.request.session.pop(f'{prefix}.sortdir', None)
+
+            persist('sorters.length')
+            for i in range(1, settings['sorters.length'] + 1):
+                persist(f'sorters.{i}.key')
+                persist(f'sorters.{i}.dir')
 
         if self.pageable:
             persist('pagesize')
             persist('page')
 
     def filter_data(self, data):
         """
@@ -1102,29 +1228,64 @@
 
         return data
 
     def sort_data(self, data):
         """
         Sort the given query according to current settings, and return the result.
         """
-        # Cannot sort unless we know which column to sort by.
-        if not self.sortkey:
+        # bail if no sort settings
+        if not self.active_sorters:
             return data
 
-        # Cannot sort unless we have a sort function.
-        sortfunc = self.sorters.get(self.sortkey)
-        if not sortfunc:
+        # TODO: is there a better way to check for SA sorting?
+        if self.model_class:
+
+            # collect actual column sorters for order_by clause
+            sorters = []
+            for sorter in self.active_sorters:
+                sortkey = sorter['field']
+                sortfunc = self.sorters.get(sortkey)
+                if not sortfunc:
+                    log.warning("unknown sorter: %s", sorter)
+                    continue
+
+                # join appropriate model if needed
+                if sortkey in self.joiners and sortkey not in self.joined:
+                    data = self.joiners[sortkey](data)
+                    self.joined.add(sortkey)
+
+                # add column/dir to collection
+                sortdir = sorter['order']
+                sorters.append(getattr(sortfunc._column, sortdir)())
+
+            # apply sorting to query
+            if sorters:
+                data = data.order_by(*sorters)
+
             return data
 
-        # We can provide a default sort direction though.
-        sortdir = getattr(self, 'sortdir', 'asc')
-        if self.sortkey in self.joiners and self.sortkey not in self.joined:
-            data = self.joiners[self.sortkey](data)
-            self.joined.add(self.sortkey)
-        return sortfunc(data, sortdir)
+        else:
+            # not a SQLAlchemy grid, custom sorter
+
+            assert len(self.active_sorters) < 2
+
+            sortkey = self.active_sorters[0]['field']
+            sortdir = self.active_sorters[0]['order'] or 'asc'
+
+            # Cannot sort unless we have a sort function.
+            sortfunc = self.sorters.get(sortkey)
+            if not sortfunc:
+                return data
+
+            # apply joins needed for this sorter
+            if sortkey in self.joiners and sortkey not in self.joined:
+                data = self.joiners[sortkey](data)
+                self.joined.add(sortkey)
+
+            return sortfunc(data, sortdir)
 
     def paginate_data(self, data):
         """
         Paginate the given data set according to current settings, and return
         the result.
         """
         # we of course assume our current page is correct, at first
@@ -1168,22 +1329,23 @@
         if self.sortable:
             data = self.sort_data(data)
         if self.pageable:
             self.pager = self.paginate_data(data)
             data = self.pager
         return data
 
-    def render_complete(self, template='/grids/complete.mako', **kwargs):
+    def render_complete(self, template='/grids/buefy.mako', **kwargs):
         """
         Render the complete grid, including filters.
         """
         context = kwargs
         context['grid'] = self
         context['request'] = self.request
         context.setdefault('allow_save_defaults', True)
+        context.setdefault('view_click_handler', self.get_view_click_handler())
         return render(template, context)
 
     def render_buefy(self, template='/grids/buefy.mako', **kwargs):
         """
         Render the Buefy grid, complete with filters.  Note that this also
         includes the context menu items and grid tools.
         """
@@ -1216,33 +1378,34 @@
         context['data_prop'] = data_prop
         context['empty_labels'] = empty_labels
         if 'grid_columns' not in context:
             context['grid_columns'] = self.get_buefy_columns()
         context.setdefault('paginated', False)
         if context['paginated']:
             context.setdefault('per_page', 20)
+        context['view_click_handler'] = self.get_view_click_handler()
+        return render(template, context)
+
+    def get_view_click_handler(self):
 
         # locate the 'view' action
         # TODO: this should be easier, and/or moved elsewhere?
         view = None
         for action in self.main_actions:
             if action.key == 'view':
                 view = action
                 break
         if not view:
             for action in self.more_actions:
                 if action.key == 'view':
                     view = action
                     break
 
-        context['view_click_handler'] = None
-        if view and view.click_handler:
-            context['view_click_handler'] = view.click_handler
-
-        return render(template, context)
+        if view:
+            return view.click_handler
 
     def set_filters_sequence(self, filters, only=False):
         """
         Explicitly set the sequence for grid filters, using the sequence
         provided.  If the grid currently has more filters than are mentioned in
         the given sequence, the sequence will come first and all others will be
         tacked on at the end.
@@ -1421,14 +1584,24 @@
                 'field': name,
                 'label': self.get_label(name),
                 'sortable': self.sortable and name in self.sorters,
                 'visible': name not in self.invisible,
             })
         return columns
 
+    def get_uuid_for_row(self, rowobj):
+
+        # use custom getter if set
+        if self.row_uuid_getter:
+            return self.row_uuid_getter(rowobj)
+
+        # otherwise fallback to normal uuid, if present
+        if hasattr(rowobj, 'uuid'):
+            return rowobj.uuid
+
     def get_buefy_data(self):
         """
         Returns a list of data rows for the grid, for use with Buefy table.
         """
         # filter / sort / paginate to get "visible" data
         raw_data = self.make_visible_data()
         data = []
@@ -1477,16 +1650,17 @@
                     value = self.obtain_value(rowobj, name)
                 if value is None:
                     value = ""
                 row[name] = str(value)
 
             # maybe add UUID for convenience
             if 'uuid' not in self.columns:
-                if hasattr(rowobj, 'uuid'):
-                    row['uuid'] = rowobj.uuid
+                uuid = self.get_uuid_for_row(rowobj)
+                if uuid:
+                    row['uuid'] = uuid
 
             # set action URL(s) for row, as needed
             self.set_action_urls(row, rowobj, i)
 
             # set extra row class if applicable
             if self.extra_row_class:
                 status = self.extra_row_class(rowobj, i)
@@ -1551,15 +1725,15 @@
     Implement column sorting links etc. for webhelpers2_grid
     """
 
     def __init__(self, itemlist, columns, **kwargs):
         self.renderers = kwargs.pop('renderers', {})
         self.linked_columns = kwargs.pop('linked_columns', [])
         self.extra_record_class = kwargs.pop('extra_record_class', None)
-        super(CustomWebhelpersGrid, self).__init__(itemlist, columns, **kwargs)
+        super().__init__(itemlist, columns, **kwargs)
 
     def generate_header_link(self, column_number, column, label_text):
 
         # display column header as simple no-op link; client-side JS takes care
         # of the rest for us
         label_text = tags.link_to(label_text, '#', data_sortkey=column)
 
@@ -1609,14 +1783,31 @@
         return HTML.tag('td', value, class_=class_name)
 
 
 class GridAction(object):
     """
     Represents an action available to a grid.  This is used to construct the
     'actions' column when rendering the grid.
+
+    :param key: Key for the action (e.g. ``'edit'``), unique within
+       the grid.
+
+    :param label: Label to be displayed for the action.  If not set,
+       will be a capitalized version of ``key``.
+
+    :param icon: Icon name for the action.
+
+    :param click_handler: Optional JS click handler for the action.
+       This value will be rendered as-is within the final grid
+       template, hence the JS string must be callable code.  Note
+       that ``props.row`` will be available in the calling context,
+       so a couple of examples:
+
+       * ``deleteThisThing(props.row)``
+       * ``$emit('do-something', props.row)``
     """
 
     def __init__(self, key, label=None, url='#', icon=None, target=None,
                  link_class=None, click_handler=None):
         self.key = key
         self.label = label or prettify(key)
         self.icon = icon
@@ -1660,9 +1851,9 @@
     def __init__(self, request):
         self.request = request
 
     def __call__(self, page):
         params = self.request.GET.copy()
         params["page"] = page
         params["partial"] = "1"
-        qs = urllib.parse.urlencode(params, True)
+        qs = urlencode(params, True)
         return '{}?{}'.format(self.request.path, qs)
```

### Comparing `Tailbone-0.9.9/tailbone/grids/__init__.py` & `Tailbone-0.9.90/tailbone/grids/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/menus.py` & `Tailbone-0.9.90/tailbone/menus.py`

 * *Files 9% similar despite different names*

```diff
@@ -25,15 +25,15 @@
 """
 
 import re
 import logging
 import warnings
 
 from rattail.app import GenericHandler
-from rattail.util import import_module_path, prettify, simple_error
+from rattail.util import prettify, simple_error
 
 from webhelpers2.html import tags, HTML
 
 from tailbone.db import Session
 
 
 log = logging.getLogger(__name__)
@@ -66,27 +66,15 @@
             request.session.flash(simple_error(error), 'error')
             request.session.flash("Menu config is invalid! Reverting to menus "
                                   "defined in code!", 'warning')
             msg = HTML.literal('Please edit your {} ASAP.'.format(
                 tags.link_to("Menu Config", request.route_url('configure_menus'))))
             request.session.flash(msg, 'warning')
 
-        # okay, no config, so menus must be built from code..
-
-        # first check for a "simple menus" module; use that if defined
-        menumod = self.config.get('tailbone', 'menus')
-        if menumod:
-            menumod = import_module_path(menumod)
-            if (not hasattr(menumod, 'simple_menus')
-                or not callable(menumod.simple_menus)):
-                raise RuntimeError("module does not have a simple_menus() "
-                                   "callable: {}".format(menumod))
-            return menumod.simple_menus(request)
-
-        # now we fallback to menu handler method
+        # okay, no config, so menus will be built from code
         return self.make_menus(request)
 
     def make_menus_from_config(self, request, **kwargs):
         """
         Try to build a complete menu set from config/settings.
 
         This will look in the DB settings table, or config file, for
@@ -329,39 +317,56 @@
             'items': [
                 {
                     'title': "Members",
                     'route': 'members',
                     'perm': 'members.list',
                 },
                 {
+                    'title': "Member Equity Payments",
+                    'route': 'member_equity_payments',
+                    'perm': 'member_equity_payments.list',
+                },
+                {
+                    'title': "Membership Types",
+                    'route': 'membership_types',
+                    'perm': 'membership_types.list',
+                },
+                {'type': 'sep'},
+                {
                     'title': "Customers",
                     'route': 'customers',
                     'perm': 'customers.list',
                 },
                 {
+                    'title': "Customer Shoppers",
+                    'route': 'customer_shoppers',
+                    'perm': 'customer_shoppers.list',
+                },
+                {
                     'title': "Customer Groups",
                     'route': 'customergroups',
                     'perm': 'customergroups.list',
                 },
                 {
+                    'title': "Pending Customers",
+                    'route': 'pending_customers',
+                    'perm': 'pending_customers.list',
+                },
+                {'type': 'sep'},
+                {
                     'title': "Employees",
                     'route': 'employees',
                     'perm': 'employees.list',
                 },
+                {'type': 'sep'},
                 {
                     'title': "All People",
                     'route': 'people',
                     'perm': 'people.list',
                 },
-                {'type': 'sep'},
-                {
-                    'title': "Pending Customers",
-                    'route': 'pending_customers',
-                    'perm': 'pending_customers.list',
-                },
             ],
         }
 
     def make_products_menu(self, request, **kwargs):
         """
         Generate a typical Products menu
         """
@@ -460,14 +465,20 @@
                 },
                 {'type': 'sep'},
                 {
                     'title': "Catalog Batches",
                     'route': 'vendorcatalogs',
                     'perm': 'vendorcatalogs.list',
                 },
+                {'type': 'sep'},
+                {
+                    'title': "Sample Files",
+                    'route': 'vendorsamplefiles',
+                    'perm': 'vendorsamplefiles.list',
+                },
             ],
         }
 
     def make_batches_menu(self, request, **kwargs):
         """
         Generate a typical Batches menu
         """
@@ -486,14 +497,19 @@
                     'perm': 'batch.inventory.list',
                 },
                 {
                     'title': "Import / Export",
                     'route': 'batch.importer',
                     'perm': 'batch.importer.list',
                 },
+                {
+                    'title': "POS",
+                    'route': 'batch.pos',
+                    'perm': 'batch.pos.list',
+                },
             ],
         }
 
     def make_reports_menu(self, request, **kwargs):
         """
         Generate a typical Reports menu
         """
@@ -593,23 +609,38 @@
 
     def make_admin_menu(self, request, **kwargs):
         """
         Generate a typical Admin menu
         """
         items = []
 
-        if kwargs.get('include_stores', True):
-            items.extend([
-                {
-                    'title': "Stores",
-                    'route': 'stores',
-                    'perm': 'stores.list',
-                },
-                {'type': 'sep'},
-            ])
+        include_stores = kwargs.get('include_stores', True)
+        include_tenders = kwargs.get('include_tenders', True)
+
+        if include_stores or include_tenders:
+
+            if include_stores:
+                items.extend([
+                    {
+                        'title': "Stores",
+                        'route': 'stores',
+                        'perm': 'stores.list',
+                    },
+                ])
+
+            if include_tenders:
+                items.extend([
+                    {
+                        'title': "Tenders",
+                        'route': 'tenders',
+                        'perm': 'tenders.list',
+                    },
+                ])
+
+            items.append({'type': 'sep'})
 
         items.extend([
             {
                 'title': "Users",
                 'route': 'users',
                 'perm': 'users.list',
             },
@@ -657,19 +688,26 @@
             },
             {'type': 'sep'},
             {
                 'title': "App Details",
                 'route': 'appinfo',
                 'perm': 'appinfo.list',
             },
-            {
-                'title': "Label Settings",
-                'route': 'labelprofiles',
-                'perm': 'labelprofiles.list',
-            },
+        ])
+
+        if kwargs.get('include_label_settings', False):
+            items.extend([
+                {
+                    'title': "Label Settings",
+                    'route': 'labelprofiles',
+                    'perm': 'labelprofiles.list',
+                },
+            ])
+
+        items.extend([
             {
                 'title': "Raw Settings",
                 'route': 'settings',
                 'perm': 'settings.list',
             },
             {
                 'title': "Upgrades",
@@ -797,15 +835,15 @@
         'is_sep': False,
     }
     if item.get('route'):
         entry['route'] = item['route']
         try:
             entry['url'] = request.route_url(entry['route'])
         except KeyError:        # happens if no such route
-            log.debug("invalid route name for menu entry: %s", entry)
+            log.warning("invalid route name for menu entry: %s", entry)
             entry['url'] = entry['route']
         entry['key'] = entry['route']
     else:
         if item.get('url'):
             entry['url'] = item['url']
         entry['key'] = make_menu_key(request.rattail_config, entry['title'])
     return entry
```

### Comparing `Tailbone-0.9.9/tailbone/cleanup.py` & `Tailbone-0.9.90/tailbone/cleanup.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/db.py` & `Tailbone-0.9.90/tailbone/db.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/generated/generate.mako` & `Tailbone-0.9.90/tailbone/templates/reports/generated/generate.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/generated/view.mako` & `Tailbone-0.9.90/tailbone/templates/reports/generated/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/generated/choose.mako` & `Tailbone-0.9.90/tailbone/templates/reports/generated/choose.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/generated/configure.mako` & `Tailbone-0.9.90/tailbone/templates/reports/generated/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/problems/view.mako` & `Tailbone-0.9.90/tailbone/templates/reports/problems/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/ordering.mako` & `Tailbone-0.9.90/tailbone/templates/reports/ordering.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/reports/inventory.mako` & `Tailbone-0.9.90/tailbone/templates/reports/inventory.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/grids/nav.mako` & `Tailbone-0.9.90/tailbone/templates/grids/nav.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/grids/buefy.mako` & `Tailbone-0.9.90/tailbone/templates/grids/buefy.mako`

 * *Files 18% similar despite different names*

```diff
@@ -176,36 +176,59 @@
        ## is only supported with buefy 0.8.13 and newer
        % if request.rattail_config.getbool('tailbone', 'sticky_headers'):
        sticky-header
        height="600px"
        % endif
 
        :checkable="checkable"
+
        % if grid.checkboxes:
        :checked-rows.sync="checkedRows"
        % if grid.clicking_row_checks_box:
        @click="rowClick"
        % endif
        % endif
+
        % if grid.check_handler:
        @check="${grid.check_handler}"
        % endif
        % if grid.check_all_handler:
        @check-all="${grid.check_all_handler}"
        % endif
-       % if isinstance(grid.checkable, six.string_types):
+
+       % if isinstance(grid.checkable, str):
        :is-row-checkable="${grid.row_checkable}"
        % elif grid.checkable:
        :is-row-checkable="row => row._checkable"
        % endif
 
        % if grid.sortable:
-       :default-sort="[sortField, sortOrder]"
-       backend-sorting
-       @sort="onSort"
+           backend-sorting
+           @sort="onSort"
+           @sorting-priority-removed="sortingPriorityRemoved"
+
+           ## TODO: there is a bug (?) which prevents the arrow from
+           ## displaying for simple default single-column sort.  so to
+           ## work around that, we *disable* multi-sort until the
+           ## component is mounted.  seems to work for now..see also
+           ## https://github.com/buefy/buefy/issues/2584
+           :sort-multiple="allowMultiSort"
+
+           ## nb. specify default sort only if single-column
+           :default-sort="backendSorters.length == 1 ? [backendSorters[0].field, backendSorters[0].order] : null"
+
+           ## nb. otherwise there may be default multi-column sort
+           :sort-multiple-data="sortingPriority"
+
+           ## user must ctrl-click column header to do multi-sort
+           sort-multiple-key="ctrlKey"
+       % endif
+
+       % if grid.click_handlers:
+       @cellclick="cellClick"
        % endif
 
        :paginated="paginated"
        :per-page="perPage"
        :current-page="currentPage"
        backend-pagination
        :total="total"
@@ -223,22 +246,24 @@
                           label="${column['label']}"
                           v-slot="props"
                           :sortable="${json.dumps(column['sortable'])}"
                           % if grid.is_searchable(column['field']):
                           searchable
                           % endif
                           cell-class="c_${column['field']}"
-                          % if grid.has_click_handler(column['field']):
-                          @click.native="${grid.click_handlers[column['field']]}"
-                          % endif
                           :visible="${json.dumps(column['visible'])}">
             % if column['field'] in grid.raw_renderers:
                 ${grid.raw_renderers[column['field']]()}
             % elif grid.is_linked(column['field']):
-                <a :href="props.row._action_url_view" v-html="props.row.${column['field']}"></a>
+                <a :href="props.row._action_url_view"
+                   % if view_click_handler:
+                   @click.prevent="${view_click_handler}"
+                   % endif
+                   v-html="props.row.${column['field']}">
+                </a>
             % else:
                 <span v-html="props.row.${column['field']}"></span>
             % endif
           </b-table-column>
       % endfor
 
       % if grid.main_actions or grid.more_actions:
@@ -250,14 +275,17 @@
             % for action in grid.main_actions + grid.more_actions:
                 <a v-if="props.row._action_url_${action.key}"
                    :href="props.row._action_url_${action.key}"
                    class="grid-action${' has-text-danger' if action.key == 'delete' else ''} ${action.link_class or ''}"
                    % if action.click_handler:
                    @click.prevent="${action.click_handler}"
                    % endif
+                   % if action.target:
+                   target="${action.target}"
+                   % endif
                    >
                   ${action.render_icon()|n}
                   ${action.render_label()|n}
                 </a>
                 &nbsp;
             % endfor
           </b-table-column>
@@ -311,24 +339,29 @@
               </b-field>
           % endif
 
         </div>
       </template>
 
     </b-table>
+
+    ## dummy input field needed for sharing links on *insecure* sites
+    % if request.scheme == 'http':
+        <b-input v-model="shareLink" ref="shareLink" v-show="shareLink"></b-input>
+    % endif
+
   </div>
 </script>
 
 <script type="text/javascript">
 
   let ${grid.component_studly}CurrentData = ${json.dumps(grid_data['data'])|n}
 
   let ${grid.component_studly}Data = {
       loading: false,
-      selectedFilter: null,
       ajaxDataUrl: ${json.dumps(grid.ajax_data_url)|n},
 
       data: ${grid.component_studly}CurrentData,
       rowStatusMap: ${json.dumps(grid_data['row_status_map'])|n},
 
       checkable: ${json.dumps(grid.checkboxes)|n},
       % if grid.checkboxes:
@@ -338,34 +371,92 @@
       paginated: ${json.dumps(grid.pageable)|n},
       total: ${len(grid_data['data']) if static_data else grid_data['total_items']},
       perPage: ${json.dumps(grid.pagesize if grid.pageable else None)|n},
       currentPage: ${json.dumps(grid.page if grid.pageable else None)|n},
       firstItem: ${json.dumps(grid_data['first_item'] if grid.pageable else None)|n},
       lastItem: ${json.dumps(grid_data['last_item'] if grid.pageable else None)|n},
 
-      sortField: ${json.dumps(grid.sortkey if grid.sortable else None)|n},
-      sortOrder: ${json.dumps(grid.sortdir if grid.sortable else None)|n},
+      % if grid.sortable:
+
+          ## TODO: there is a bug (?) which prevents the arrow from
+          ## displaying for simple default single-column sort.  so to
+          ## work around that, we *disable* multi-sort until the
+          ## component is mounted.  seems to work for now..see also
+          ## https://github.com/buefy/buefy/issues/2584
+          allowMultiSort: false,
+
+          ## nb. this contains all truly active sorters
+          backendSorters: ${json.dumps(grid.active_sorters)|n},
+
+          ## nb. whereas this will only contain multi-column sorters,
+          ## but will be *empty* for single-column sorting
+          % if len(grid.active_sorters) > 1:
+              sortingPriority: ${json.dumps(grid.active_sorters)|n},
+          % else:
+              sortingPriority: [],
+          % endif
+
+      % endif
 
       ## filterable: ${json.dumps(grid.filterable)|n},
       filters: ${json.dumps(filters_data if grid.filterable else None)|n},
       filtersSequence: ${json.dumps(filters_sequence if grid.filterable else None)|n},
-      selectedFilter: null,
+      addFilterTerm: '',
+      addFilterShow: false,
+
+      ## dummy input value needed for sharing links on *insecure* sites
+      % if request.scheme == 'http':
+      shareLink: null,
+      % endif
   }
 
   let ${grid.component_studly} = {
       template: '#${grid.component}-template',
 
       mixins: [FormPosterMixin],
 
       props: {
           csrftoken: String,
       },
 
       computed: {
 
+          addFilterChoices() {
+
+              // collect all filters, which are *not* already shown
+              let choices = []
+              for (let field of this.filtersSequence) {
+                  let filtr = this.filters[field]
+                  if (!filtr.visible) {
+                      choices.push(filtr)
+                  }
+              }
+
+              // parse list of search terms
+              let terms = []
+              for (let term of this.addFilterTerm.toLowerCase().split(' ')) {
+                  term = term.trim()
+                  if (term) {
+                      terms.push(term)
+                  }
+              }
+
+              // only filters matching all search terms are presented
+              // as choices to the user
+              return choices.filter(option => {
+                  let label = option.label.toLowerCase()
+                  for (let term of terms) {
+                      if (label.indexOf(term) < 0) {
+                          return false
+                      }
+                  }
+                  return true
+              })
+          },
+
           // note, can use this with v-model for hidden 'uuids' fields
           selected_uuids: function() {
               return this.checkedRowUUIDs().join(',')
           },
 
           // nb. this can be overridden if needed, e.g. to dynamically
           // show/hide certain records in a static data set
@@ -375,18 +466,57 @@
 
           directLink() {
               let params = new URLSearchParams(this.getAllParams())
               return `${request.current_route_url(_query=None)}?${'$'}{params}`
           },
       },
 
+      mounted() {
+          ## TODO: there is a bug (?) which prevents the arrow from
+          ## displaying for simple default single-column sort.  so to
+          ## work around that, we *disable* multi-sort until the
+          ## component is mounted.  seems to work for now..see also
+          ## https://github.com/buefy/buefy/issues/2584
+          this.allowMultiSort = true
+      },
+
       methods: {
 
+          % if grid.click_handlers:
+              cellClick(row, column, rowIndex, columnIndex) {
+                  % for key in grid.click_handlers:
+                      if (column._props.field == '${key}') {
+                          ${grid.click_handlers[key]}(row)
+                      }
+                  % endfor
+              },
+          % endif
+
           copyDirectLink() {
-              navigator.clipboard.writeText(this.directLink)
+
+              if (navigator.clipboard) {
+                  // this is the way forward, but requires HTTPS
+                  navigator.clipboard.writeText(this.directLink)
+
+              } else {
+                  // use deprecated 'copy' command, but this just
+                  // tells the browser to copy currently-selected
+                  // text..which means we first must "add" some text
+                  // to screen, and auto-select that, before copying
+                  // to clipboard
+                  this.shareLink = this.directLink
+                  this.$nextTick(() => {
+                      let input = this.$refs.shareLink.$el.firstChild
+                      input.select()
+                      document.execCommand('copy')
+                      // re-hide the dummy input
+                      this.shareLink = null
+                  })
+              }
+
               this.$buefy.toast.open({
                   message: "Link was copied to clipboard",
                   type: 'is-info',
                   duration: 2000, // 2 seconds
               })
           },
 
@@ -405,16 +535,18 @@
           getRowClass(row, index) {
               return this.rowStatusMap[index]
           },
 
           getBasicParams() {
               let params = {}
               % if grid.sortable:
-                  params.sortkey = this.sortField
-                  params.sortdir = this.sortOrder
+                  for (let i = 1; i <= this.backendSorters.length; i++) {
+                      params['sort'+i+'key'] = this.backendSorters[i-1].field
+                      params['sort'+i+'dir'] = this.backendSorters[i-1].order
+                  }
               % endif
               % if grid.pageable:
                   params.pagesize = this.perPage
                   params.page = this.currentPage
               % endif
               return params
           },
@@ -435,15 +567,18 @@
           },
 
           getAllParams() {
               return {...this.getBasicParams(),
                       ...this.getFilterParams()}
           },
 
-          loadAsyncData(params, callback) {
+          ## TODO: i noticed buefy docs show using `async` keyword here,
+          ## so now i am too.  knowing nothing at all of if/how this is
+          ## supposed to improve anything.  we shall see i guess
+          async loadAsyncData(params, success, failure) {
 
               if (params === undefined || params === null) {
                   params = new URLSearchParams(this.getBasicParams())
                   params.append('partial', true)
                   params = params.toString()
               }
 
@@ -453,22 +588,25 @@
                   this.data = ${grid.component_studly}CurrentData
                   this.rowStatusMap = data.row_status_map
                   this.total = data.total_items
                   this.firstItem = data.first_item
                   this.lastItem = data.last_item
                   this.loading = false
                   this.checkedRows = this.locateCheckedRows(data.checked_rows)
-                  if (callback) {
-                      callback()
+                  if (success) {
+                      success()
                   }
               })
               .catch((error) => {
                   this.data = []
                   this.total = 0
                   this.loading = false
+                  if (failure) {
+                      failure()
+                  }
                   throw error
               })
           },
 
           locateCheckedRows(checked) {
               let rows = []
               if (checked) {
@@ -482,34 +620,90 @@
           },
 
           onPageChange(page) {
               this.currentPage = page
               this.loadAsyncData()
           },
 
-          onSort(field, order) {
-              this.sortField = field
-              this.sortOrder = order
+          onSort(field, order, event) {
+
+              if (event.ctrlKey) {
+
+                  // engage or enhance multi-column sorting
+                  let sorter = this.backendSorters.filter(i => i.field === field)[0]
+                  if (sorter) {
+                      sorter.order = sorter.order === 'desc' ? 'asc' : 'desc'
+                  } else {
+                      this.backendSorters.push({field, order})
+                  }
+                  this.sortingPriority = this.backendSorters
+
+              } else {
+
+                  // sort by single column only
+                  this.backendSorters = [{field, order}]
+                  this.sortingPriority = []
+              }
+
               // always reset to first page when changing sort options
               // TODO: i mean..right? would we ever not want that?
               this.currentPage = 1
               this.loadAsyncData()
           },
 
+          sortingPriorityRemoved(field) {
+
+              // prune field from active sorters
+              this.backendSorters = this.backendSorters.filter(
+                  (sorter) => sorter.field !== field)
+
+              // nb. must keep active sorter list "as-is" even if
+              // there is only one sorter; buefy seems to expect it
+              this.sortingPriority = this.backendSorters
+
+              this.loadAsyncData()
+          },
+
           resetView() {
               this.loading = true
-              location.href = '?reset-to-default-filters=true'
-          },
 
-          addFilter(filter_key) {
+              // use current url proper, plus reset param
+              let url = '?reset-to-default-filters=true'
 
-              // reset dropdown so user again sees "Add Filter" placeholder
-              this.$nextTick(function() {
-                  this.selectedFilter = null
+              // add current hash, to preserve that in redirect
+              if (location.hash) {
+                  url += '&hash=' + location.hash.slice(1)
+              }
+
+              location.href = url
+          },
+
+          addFilterButton(event) {
+              this.addFilterShow = true
+              this.$nextTick(() => {
+                  this.$refs.addFilterAutocomplete.focus()
               })
+          },
+
+          addFilterKeydown(event) {
+
+              // ESC will clear searchbox
+              if (event.which == 27) {
+                  this.addFilterTerm = ''
+                  this.addFilterShow = false
+              }
+          },
+
+          addFilterSelect(filtr) {
+              this.addFilter(filtr.key)
+              this.addFilterTerm = ''
+              this.addFilterShow = false
+          },
+
+          addFilter(filter_key) {
 
               // show corresponding grid filter
               this.filters[filter_key].visible = true
               this.filters[filter_key].active = true
 
               // track down the component
               var gridFilter = null
@@ -546,16 +740,19 @@
 
               // set some explicit params
               params.partial = true
               params.filter = true
 
               params = new URLSearchParams(params)
               this.loadAsyncData(params)
+              this.appliedFiltersHook()
           },
 
+          appliedFiltersHook() {},
+
           clearFilters() {
 
               // explicitly deactivate all filters
               for (var key in this.filters) {
                   this.filters[key].active = false
               }
```

### Comparing `Tailbone-0.9.9/tailbone/templates/grids/filters.mako` & `Tailbone-0.9.90/tailbone/templates/grids/filters.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/grids/b-table.mako` & `Tailbone-0.9.90/tailbone/templates/grids/b-table.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/tables/create.mako` & `Tailbone-0.9.90/tailbone/templates/tables/create.mako`

 * *Files 10% similar despite different names*

```diff
@@ -7,16 +7,33 @@
     .label {
         white-space: nowrap;
     }
   </style>
 </%def>
 
 <%def name="render_this_page()">
+
+  ## scroll target used when navigating prev/next
+  <div ref="showme"></div>
+
+  % if not alembic_current_head:
+      <b-notification type="is-warning"
+                      :closable="false">
+        <p class="block">
+          DB is not up to date!  There are
+          ${h.link_to("pending migrations", url('{}.migrations'.format(route_prefix)))}.
+        </p>
+        <p class="block">
+          (This will be a problem if you wish to auto-generate a migration for a new table.)
+        </p>
+      </b-notification>
+  % endif
+
   <b-steps v-model="activeStep"
-           :animated="false"
+           animated
            rounded
            :has-navigation="false"
            vertical
            icon-pack="fas">
 
     <b-step-item step="1"
                  value="enter-details"
@@ -24,63 +41,70 @@
                  clickable>
       <h3 class="is-size-3 block">
         Enter Details
       </h3>
 
       <b-field label="Schema Branch"
                message="Leave this set to your custom app branch, unless you know what you're doing.">
-        <b-select v-model="alembicBranch">
+        <b-select v-model="alembicBranch"
+                  @input="dirty = true">
           <option v-for="branch in alembicBranchOptions"
                   :key="branch"
                   :value="branch">
             {{ branch }}
           </option>
         </b-select>
       </b-field>
 
       <b-field grouped>
 
         <b-field label="Table Name"
                  message="Should be singular in nature, i.e. 'widget' not 'widgets'">
-          <b-input v-model="tableName">
+          <b-input v-model="tableName"
+                   @input="dirty = true">
           </b-input>
         </b-field>
 
         <b-field label="Model/Class Name"
                  message="Should be singular in nature, i.e. 'Widget' not 'Widgets'">
-          <b-input v-model="tableModelName">
+          <b-input v-model="tableModelName"
+                   @input="dirty = true">
           </b-input>
         </b-field>
 
       </b-field>
 
       <b-field grouped>
 
         <b-field label="Model Title"
                  message="Human-friendly singular model title.">
-          <b-input v-model="tableModelTitle">
+          <b-input v-model="tableModelTitle"
+                   @input="dirty = true">
           </b-input>
         </b-field>
 
         <b-field label="Model Title Plural"
                  message="Human-friendly plural model title.">
-          <b-input v-model="tableModelTitlePlural">
+          <b-input v-model="tableModelTitlePlural"
+                   @input="dirty = true">
           </b-input>
         </b-field>
 
       </b-field>
 
       <b-field label="Description"
                message="Brief description of what a record in this table represents.">
-        <b-input v-model="tableDescription">
+        <b-input v-model="tableDescription"
+                 @input="dirty = true">
         </b-input>
       </b-field>
 
       <b-field>
-        <b-checkbox v-model="tableVersioned">
+        <b-checkbox v-model="tableVersioned"
+                    @input="dirty = true">
           Record version data for this table
         </b-checkbox>
       </b-field>
 
       <br />
 
       <div class="level-left">
@@ -179,14 +203,15 @@
                   <option value="String">String</option>
                   <option value="Boolean">Boolean</option>
                   <option value="Integer">Integer</option>
                   <option value="Numeric">Numeric</option>
                   <option value="Date">Date</option>
                   <option value="DateTime">DateTime</option>
                   <option value="Text">Text</option>
+                  <option value="LargeBinary">LargeBinary</option>
                   <option value="_fk_uuid_">FK/UUID</option>
                   <option value="_other_">Other</option>
                 </b-select>
               </b-field>
 
               <b-field v-if="editingColumnDataType == 'String'"
                        label="Length"
@@ -280,15 +305,15 @@
 
       <br />
 
       <div class="buttons">
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="check"
-                  @click="activeStep = 'write-model'">
+                  @click="showStep('write-model')">
           Details are complete
         </b-button>
       </div>
 
     </b-step-item>
 
     <b-step-item step="2"
@@ -320,27 +345,27 @@
         </b-checkbox>
       </b-field>
 
       <div class="form">
         <div class="buttons">
           <b-button icon-pack="fas"
                     icon-left="arrow-left"
-                    @click="activeStep = 'enter-details'">
+                    @click="showStep('enter-details')">
             Back
           </b-button>
           <b-button type="is-primary"
                     icon-pack="fas"
                     icon-left="save"
                     @click="writeModelFile()"
                     :disabled="writingModelFile">
             {{ writingModelFile ? "Working, please wait..." : "Write model class to file" }}
           </b-button>
           <b-button icon-pack="fas"
                     icon-left="arrow-right"
-                    @click="activeStep = 'review-model'">
+                    @click="showStep('review-model')">
             Skip
           </b-button>
         </div>
       </div>
     </b-step-item>
 
     <b-step-item step="3"
@@ -430,27 +455,27 @@
           </div>
         </div>
       </div>
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'write-model'">
+                  @click="showStep('write-model')">
           Back
         </b-button>
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="check"
-                  @click="activeStep = 'write-revision'"
+                  @click="showStep('write-revision')"
                   :disabled="!modelImported">
           Model class looks good!
         </b-button>
         <b-button icon-pack="fas"
                   icon-left="arrow-right"
-                  @click="activeStep = 'write-revision'">
+                  @click="showStep('write-revision')">
           Skip
         </b-button>
       </div>
     </b-step-item>
 
     <b-step-item step="4"
                  value="write-revision"
@@ -481,27 +506,27 @@
       </b-field>
 
       <br />
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'review-model'">
+                  @click="showStep('review-model')">
           Back
         </b-button>
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="save"
                   @click="writeRevisionScript()"
                   :disabled="writingRevisionScript">
           {{ writingRevisionScript ? "Working, please wait..." : "Generate revision script" }}
         </b-button>
         <b-button icon-pack="fas"
                   icon-left="arrow-right"
-                  @click="activeStep = 'review-revision'">
+                  @click="showStep('review-revision')">
           Skip
         </b-button>
       </div>
     </b-step-item>
 
     <b-step-item step="5"
                  value="review-revision"
@@ -521,21 +546,21 @@
       <p class="block">
         Please review that code and adjust to your liking.
       </p>
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'write-revision'">
+                  @click="showStep('write-revision')">
           Back
         </b-button>
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="check"
-                  @click="activeStep = 'upgrade-db'">
+                  @click="showStep('upgrade-db')">
           Revision script looks good!
         </b-button>
       </div>
     </b-step-item>
 
     <b-step-item step="6"
                  value="upgrade-db"
@@ -548,15 +573,15 @@
         You said the revision script looked good, so next we will use
         it to upgrade your actual database.
       </p>
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'review-revision'">
+                  @click="showStep('review-revision')">
           Back
         </b-button>
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="arrow-up"
                   @click="upgradeDB()"
                   :disabled="upgradingDB">
@@ -622,21 +647,21 @@
           </div>
         </div>
       </div>
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'upgrade-db'">
+                  @click="showStep('upgrade-db')">
           Back
         </b-button>
         <b-button type="is-primary"
                   icon-pack="fas"
                   icon-left="check"
-                  @click="activeStep = 'commit-code'"
+                  @click="showStep('commit-code')"
                   :disabled="!tableCheckAttempted || tableCheckProblem">
           DB looks good!
         </b-button>
       </div>
     </b-step-item>
 
     <b-step-item step="8"
@@ -653,15 +678,15 @@
       <p class="block">
         Don't forget to commit code changes to your source repo.
       </p>
 
       <div class="buttons">
         <b-button icon-pack="fas"
                   icon-left="arrow-left"
-                  @click="activeStep = 'review-db'">
+                  @click="showStep('review-db')">
           Back
         </b-button>
         <once-button type="is-primary"
                      tag="a" :href="tableURL"
                      icon-left="arrow-right"
                      :text="`Show me my new table: ${'$'}{tableName}`">
         </once-button>
@@ -670,14 +695,17 @@
   </b-steps>
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
+    // nb. for warning user they may lose changes if leaving page
+    ThisPageData.dirty = false
+
     ThisPageData.activeStep = null
     ThisPageData.alembicBranchOptions = ${json.dumps(branch_name_options)|n}
 
     ThisPageData.existingTables = ${json.dumps(existing_tables)|n}
 
     ThisPageData.alembicBranch = ${json.dumps(branch_name)|n}
     ThisPageData.tableName = '${rattail_app.get_table_prefix()}_widget'
@@ -708,14 +736,23 @@
     ThisPageData.editingColumnDataTypeReference = null
     ThisPageData.editingColumnDataTypeLiteral = null
     ThisPageData.editingColumnNullable = true
     ThisPageData.editingColumnDescription = null
     ThisPageData.editingColumnVersioned = true
     ThisPageData.editingColumnRelationship = null
 
+    ThisPage.methods.showStep = function(step) {
+        this.activeStep = step
+
+        // scroll so top of page is shown
+        this.$nextTick(() => {
+            this.$refs['showme'].scrollIntoView(true)
+        })
+    }
+
     ThisPage.methods.tableAddColumn = function() {
         this.editingColumn = null
         this.editingColumnName = null
         this.editingColumnDataType = null
         this.editingColumnDataTypeLength = null
         this.editingColumnDataTypePrecision = null
         this.editingColumnDataTypeScale = null
@@ -796,20 +833,22 @@
         column.data_type = dataType
 
         column.nullable = this.editingColumnNullable
         column.description = this.editingColumnDescription
         column.versioned = this.editingColumnVersioned
         column.relationship = this.editingColumnRelationship
 
+        this.dirty = true
         this.editingColumnShowDialog = false
     }
 
     ThisPage.methods.tableDeleteColumn = function(index) {
         if (confirm("Really delete this column?")) {
             this.tableColumns.splice(index, 1)
+            this.dirty = true
         }
     }
 
     ThisPageData.tableModelFile = '${model_dir}widget.py'
     ThisPageData.tableModelFileOverwrite = false
     ThisPageData.writingModelFile = false
 
@@ -924,12 +963,26 @@
             } else {
                 this.tableURL = response.data.url
             }
             this.tableCheckAttempted = true
         })
     }
 
+    // cf. https://stackoverflow.com/a/56551646
+    ThisPage.methods.beforeWindowUnload = function(e) {
+
+        // warn user if navigating away would lose changes
+        if (this.dirty) {
+            e.preventDefault()
+            e.returnValue = ''
+        }
+    }
+
+    ThisPage.created = function() {
+        window.addEventListener('beforeunload', this.beforeWindowUnload)
+    }
+
   </script>
 </%def>
 
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,14 +1,28 @@
 ## -*- coding: utf-8; -*- <%inherit file="/master/create.mako" /> <%def
 name="extra_styles()"> ${parent.extra_styles()}
-def> <%def name="render_this_page()">
-animated="false" rounded :has-navigation="false" vertical icon-pack="fas">
+def> <%def name="render_this_page()"> ## scroll target used when navigating
+prev/next
+% if not alembic_current_head:
+closable="false">
+DB is not up to date! There are ${h.link_to("pending migrations", url('
+{}.migrations'.format(route_prefix)))}.
+(This will be a problem if you wish to auto-generate a migration for a new
+table.)
+% endif
+has-navigation="false" vertical icon-pack="fas">
 ******** EEnntteerr DDeettaaiillss ********
+input="dirty = true">
 key="branch" :value="branch"> {{ branch }}
-Record version data for this table
+input="dirty = true">
+input="dirty = true">
+input="dirty = true">
+input="dirty = true">
+input="dirty = true">
+input="dirty = true"> Record version data for this table
 ****** CCoolluummnnss ******
 click="tableAddColumn()"> New
 data="tableColumns"> {{ props.row.name }} {{ formatDataType
 (props.row.data_type) }} {{ props.row.nullable ? "Yes" : "No" }}
 visible="tableVersioned" v-slot="props"> {{ props.row.versioned ? "Yes" : "No"
 }} {{ props.row.description }}
 click.prevent="tableEditColumn(props.row)"> Edit
@@ -19,83 +33,84 @@
 String
 Boolean
 Integer
 Numeric
 Date
 DateTime
 Text
+LargeBinary
 FK/UUID
 Other
 type="{'is-danger': !editingColumnDataTypeLength}" style="max-width: 6rem;">
 type="{'is-danger': !editingColumnDataTypePrecision}" style="max-width: 6rem;">
 type="{'is-danger': !editingColumnDataTypeScale}" style="max-width: 6rem;">
 type="{'is-danger': !editingColumnDataTypeReference}">
 key="table.name" :value="table.name"> {{ table.name }}
 type="{'is-danger': !editingColumnDataTypeLiteral}" expanded> {
 { editingColumnNullable }} {{ editingColumnVersioned }}
 click="editingColumnShowDialog = false"> Cancel
 click="editingColumnSave()"> Save
 
-click="activeStep = 'write-model'"> Details are complete
+click="showStep('write-model')"> Details are complete
 ******** WWrriittee MMooddeell ********
 {{ alembicBranch }} {{ tableName }} {{ tableModelName }} Overwrite file if it
 exists
-click="activeStep = 'enter-details'"> Back
+click="showStep('enter-details')"> Back
 click="writeModelFile()" :disabled="writingModelFile"> {{ writingModelFile ?
 "Working, please wait..." : "Write model class to file" }}
-click="activeStep = 'review-model'"> Skip
+click="showStep('review-model')"> Skip
 ******** RReevviieeww MMooddeell ********
 Model code was generated to file:
 {{ tableModelFile }}
 First, review that code and adjust to your liking.
 Next be sure to import the new model. Typically this is done by editing the
 file...
 ${model_dir}__init__.py
 ...and adding a line such as:
 from .{{ tableModelFileModuleName }} import {{ tableModelName }}
 Once you've done all that, the web app must be restarted. This may happen
 automatically depending on your setup. Test the model import status below.
 Model Import Status
 import not yet attempted imported okay import failed: {{ modelImportStatus }}
 click="modelImportTest()"> Refresh / Test Import
-click="activeStep = 'write-model'"> Back
-click="activeStep = 'write-revision'" :disabled="!modelImported"> Model class
+click="showStep('write-model')"> Back
+click="showStep('write-revision')" :disabled="!modelImported"> Model class
 looks good!
-click="activeStep = 'write-revision'"> Skip
+click="showStep('write-revision')"> Skip
 ******** WWrriittee RReevviissiioonn ********
 You said the model class looked good, so next we will generate a revision
 script, used to modify DB schema.
 key="branch" :value="branch"> {{ branch }}
 
-click="activeStep = 'review-model'"> Back
+click="showStep('review-model')"> Back
 click="writeRevisionScript()" :disabled="writingRevisionScript"> {
 { writingRevisionScript ? "Working, please wait..." : "Generate revision
 script" }}
-click="activeStep = 'review-revision'"> Skip
+click="showStep('review-revision')"> Skip
 ******** RReevviieeww RReevviissiioonn ********
 Revision script was generated to file:
 {{ revisionScript }}
 Please review that code and adjust to your liking.
-click="activeStep = 'write-revision'"> Back
-click="activeStep = 'upgrade-db'"> Revision script looks good!
+click="showStep('write-revision')"> Back
+click="showStep('upgrade-db')"> Revision script looks good!
 ******** UUppggrraaddee DDBB ********
 You said the revision script looked good, so next we will use it to upgrade
 your actual database.
-click="activeStep = 'review-revision'"> Back
+click="showStep('review-revision')"> Back
 click="upgradeDB()" :disabled="upgradingDB"> {{ upgradingDB ? "Working, please
 wait..." : "Upgrade database" }}
 ******** RReevviieeww DDBB ********
 At this point your new table should be present in the DB. Test below.
 Table Status
 check not yet attempted table exists! {{ tableCheckProblem }}
 click="tableCheck()"> Test for Table
-click="activeStep = 'upgrade-db'"> Back
-click="activeStep = 'commit-code'" :disabled="!tableCheckAttempted ||
+click="showStep('upgrade-db')"> Back
+click="showStep('commit-code')" :disabled="!tableCheckAttempted ||
 tableCheckProblem"> DB looks good!
 ******** CCoommmmiitt CCooddee ********
 Hope you're having a great day.
 Don't forget to commit code changes to your source repo.
-click="activeStep = 'review-db'"> Back
+click="showStep('review-db')"> Back
 href="tableURL" icon-left="arrow-right" :text="`Show me my new table: ${'$'}
 {tableName}`">
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/multi_file_upload.mako` & `Tailbone-0.9.90/tailbone/templates/multi_file_upload.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/menu.mako` & `Tailbone-0.9.90/tailbone/templates/menu.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/vendors/configure.mako` & `Tailbone-0.9.90/tailbone/templates/vendors/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/users/preferences.mako` & `Tailbone-0.9.90/tailbone/templates/users/preferences.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/labels/profiles/view.mako` & `Tailbone-0.9.90/tailbone/templates/labels/profiles/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/labels/profiles/edit.mako` & `Tailbone-0.9.90/tailbone/templates/labels/profiles/edit.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/edit_row.mako` & `Tailbone-0.9.90/tailbone/templates/master/edit_row.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/merge.mako` & `Tailbone-0.9.90/tailbone/templates/master/merge.mako`

 * *Files 5% similar despite different names*

```diff
@@ -119,26 +119,26 @@
         <div class="level-item">
           <a class="button" href="${index_url}">Whoops, nevermind</a>
         </div>
 
         <div class="level-item">
           ${h.form(request.current_route_url(), **{'@submit': 'submitSwapForm'})}
           ${h.csrf_token(request)}
-          ${h.hidden('uuids', value='{},{}'.format(object_to_keep.uuid, object_to_remove.uuid))}
+          ${h.hidden('uuids', value=f'{keeping_uuid},{removing_uuid}')}
           <b-button native-type="submit"
                     :disabled="swapFormSubmitting">
             {{ swapFormButtonText }}
           </b-button>
           ${h.end_form()}
         </div>
 
         <div class="level-item">
           ${h.form(request.current_route_url(), **{'@submit': 'submitMergeForm'})}
           ${h.csrf_token(request)}
-          ${h.hidden('uuids', value='{},{}'.format(object_to_remove.uuid, object_to_keep.uuid))}
+          ${h.hidden('uuids', value=f'{removing_uuid},{keeping_uuid}')}
           ${h.hidden('commit-merge', value='yes')}
           <b-button type="is-primary"
                     native-type="submit"
                     :disabled="mergeFormSubmitting">
             {{ mergeFormButtonText }}
           </b-button>
           ${h.end_form()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/master/form.mako` & `Tailbone-0.9.90/tailbone/templates/master/form.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/versions.mako` & `Tailbone-0.9.90/tailbone/templates/master/versions.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/delete.mako` & `Tailbone-0.9.90/tailbone/templates/master/delete.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/view_row.mako` & `Tailbone-0.9.90/tailbone/templates/master/view_row.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/index.mako` & `Tailbone-0.9.90/tailbone/templates/master/index.mako`

 * *Files 9% similar despite different names*

```diff
@@ -24,14 +24,27 @@
           <li>${h.link_to("Download {} Template".format(template['label']), template['effective_url'])}</li>
       % endfor
   % endif
 </%def>
 
 <%def name="grid_tools()">
 
+  ## grid totals
+  % if master.supports_grid_totals:
+      <b-button v-if="gridTotalsDisplay == null"
+                :disabled="gridTotalsFetching"
+                @click="gridTotalsFetch()">
+        {{ gridTotalsFetching ? "Working, please wait..." : "Show Totals" }}
+      </b-button>
+      <div v-if="gridTotalsDisplay != null"
+           class="control">
+        Totals: {{ gridTotalsDisplay }}
+      </div>
+  % endif
+
   ## download search results
   % if master.results_downloadable and master.has_perm('download_results'):
       <b-button type="is-primary"
                 icon-pack="fas"
                 icon-left="fas fa-download"
                 @click="showDownloadResultsDialog = true"
                 :disabled="!total">
@@ -317,14 +330,36 @@
   ${grid.render_buefy(tools=capture(self.grid_tools).strip(), context_menu=capture(self.context_menu_items).strip())|n}
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
+    % if master.supports_grid_totals:
+        ${grid.component_studly}Data.gridTotalsDisplay = null
+        ${grid.component_studly}Data.gridTotalsFetching = false
+
+        ${grid.component_studly}.methods.gridTotalsFetch = function() {
+            this.gridTotalsFetching = true
+
+            let url = '${url(f'{route_prefix}.fetch_grid_totals')}'
+            this.simpleGET(url, {}, response => {
+                this.gridTotalsDisplay = response.data.totals_display
+                this.gridTotalsFetching = false
+            }, response => {
+                this.gridTotalsFetching = false
+            })
+        }
+
+        ${grid.component_studly}.methods.appliedFiltersHook = function() {
+            this.gridTotalsDisplay = null
+            this.gridTotalsFetching = false
+        }
+    % endif
+
     ## maybe auto-redirect to download latest results file
     % if download_results_path:
         ThisPage.methods.downloadResultsRedirect = function() {
             location.href = '${url('{}.download_results'.format(route_prefix))}?filename=${h.os.path.basename(download_results_path)}';
         }
         ThisPage.mounted = function() {
             // we give this 1 second before attempting the redirect; otherwise
```

### Comparing `Tailbone-0.9.9/tailbone/templates/master/configure.mako` & `Tailbone-0.9.90/tailbone/templates/master/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/master/clone.mako` & `Tailbone-0.9.90/tailbone/templates/master/clone.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/page.mako` & `Tailbone-0.9.90/tailbone/templates/page.mako`

 * *Files 10% similar despite different names*

```diff
@@ -28,21 +28,26 @@
 </%def>
 
 <%def name="declare_this_page_vars()">
   <script type="text/javascript">
 
     let ThisPage = {
         template: '#this-page-template',
-        mixins: [FormPosterMixin],
+        mixins: [SimpleRequestMixin],
         props: {
             configureFieldsHelp: Boolean,
         },
         computed: {},
         watch: {},
-        methods: {},
+        methods: {
+
+            changeContentTitle(newTitle) {
+                this.$emit('change-content-title', newTitle)
+            },
+        },
     }
 
     let ThisPageData = {
         ## TODO: should find a better way to handle CSRF token
         csrftoken: ${json.dumps(request.session.get_csrf_token() or request.session.new_csrf_token())|n},
     }
```

### Comparing `Tailbone-0.9.9/tailbone/templates/purchases/credits/index.mako` & `Tailbone-0.9.90/tailbone/templates/purchases/credits/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/purchases/view.mako` & `Tailbone-0.9.90/tailbone/templates/purchases/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/purchases/receiving_worksheet.mako` & `Tailbone-0.9.90/tailbone/templates/purchases/receiving_worksheet.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/roles/create.mako` & `Tailbone-0.9.90/tailbone/templates/roles/create.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/roles/view.mako` & `Tailbone-0.9.90/tailbone/templates/roles/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/roles/edit.mako` & `Tailbone-0.9.90/tailbone/templates/roles/edit.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/custorders/create.mako` & `Tailbone-0.9.90/tailbone/templates/custorders/create.mako`

 * *Files 4% similar despite different names*

```diff
@@ -24,15 +24,15 @@
       <div class="level-item">
         <div class="buttons">
           <b-button type="is-primary"
                     @click="submitOrder()"
                     :disabled="submittingOrder"
                     icon-pack="fas"
                     icon-left="fas fa-upload">
-            {{ submitOrderButtonText }}
+            {{ submittingOrder ? "Working, please wait..." : "Submit this Order" }}
           </b-button>
           <b-button @click="startOverEntirely()"
                     icon-pack="fas"
                     icon-left="fas fa-redo">
             Start Over Entirely
           </b-button>
           <b-button @click="cancelOrder()"
@@ -527,58 +527,35 @@
                       <div v-show="productIsKnown"
                            style="padding-left: 5rem;">
 
                         <b-field grouped>
                           <p class="label control">
                             Product
                           </p>
-                          <b-field :expanded="!productUUID">
-                            <tailbone-autocomplete ref="productAutocomplete"
-                                                   v-model="productUUID"
-                                                   placeholder="Enter UPC or brand, description etc."
-                                                   :assigned-label="productDisplay"
-                                                   serviceUrl="${url('{}.product_autocomplete'.format(route_prefix))}"
-                                                   @input="productChanged">
-                            </tailbone-autocomplete>
-                          </b-field>
-
-                          <b-button type="is-primary"
-                                    v-if="!productUUID"
-                                    @click="productFullLookup()"
-                                    icon-pack="fas"
-                                    icon-left="search">
-                            Full Lookup
-                          </b-button>
-
-                          <b-button v-if="productUUID"
-                                    type="is-primary"
-                                    tag="a" target="_blank"
-                                    :href="productURL"
-                                    :disabled="!productURL"
-                                    icon-pack="fas"
-                                    icon-left="external-link-alt">
-                            View Product
-                          </b-button>
+                          <tailbone-product-lookup ref="productLookup"
+                                                   :product="selectedProduct"
+                                                   @selected="productLookupSelected"
+                                                   autocomplete-url="${url(f'{route_prefix}.product_autocomplete')}">
+                          </tailbone-product-lookup>
                         </b-field>
 
                         <div v-if="productUUID">
 
                           <div class="is-pulled-right has-text-centered">
                             <img :src="productImageURL"
                                  style="max-height: 150px; max-width: 150px; "/>
-                            ## <p>{{ productKey }}</p>
                           </div>
 
                           <b-field grouped>
                             <b-field :label="productKeyLabel">
                               <span>{{ productKey }}</span>
                             </b-field>
 
                             <b-field label="Unit Size">
-                              <span>{{ productSize }}</span>
+                              <span>{{ productSize || '' }}</span>
                             </b-field>
 
                             <b-field label="Case Size">
                               <span>{{ productCaseQuantity }}</span>
                             </b-field>
 
                             <b-field label="Reg. Price"
@@ -640,84 +617,133 @@
                       </div>
 
                       <div v-show="!productIsKnown"
                            style="padding-left: 5rem;">
 
                         <b-field grouped>
 
-                          <b-field label="Brand">
+                          <b-field label="Brand"
+                                   % if 'brand_name' in pending_product_required_fields:
+                                   :type="pendingProduct.brand_name ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.brand_name">
                             </b-input>
                           </b-field>
 
                           <b-field label="Description"
-                                   :type="pendingProduct.description ? null : 'is-danger'">
+                                   % if 'description' in pending_product_required_fields:
+                                   :type="pendingProduct.description ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.description">
                             </b-input>
                           </b-field>
 
-                          <b-field label="Unit Size">
+                          <b-field label="Unit Size"
+                                   % if 'size' in pending_product_required_fields:
+                                   :type="pendingProduct.size ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.size">
                             </b-input>
                           </b-field>
 
                         </b-field>
 
                         <b-field grouped>
 
-                          <b-field :label="productKeyLabel">
+                          <b-field :label="productKeyLabel"
+                                   % if 'key' in pending_product_required_fields:
+                                   :type="pendingProduct[productKeyField] ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct[productKeyField]">
                             </b-input>
                           </b-field>
 
-                          <b-field label="Department">
+                          <b-field label="Department"
+                                   % if 'department_uuid' in pending_product_required_fields:
+                                   :type="pendingProduct.department_uuid ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-select v-model="pendingProduct.department_uuid">
                               <option :value="null">(not known)</option>
                               <option v-for="option in departmentOptions"
                                       :key="option.value"
                                       :value="option.value">
                                 {{ option.label }}
                               </option>
                             </b-select>
                           </b-field>
 
-                          <b-field label="Unit Reg. Price">
-                            <b-input v-model="pendingProduct.regular_price_amount"
-                                     type="number" step="0.01">
-                            </b-input>
-                          </b-field>
-
                         </b-field>
 
                         <b-field grouped>
 
-                          <b-field label="Vendor">
+                          <b-field label="Vendor"
+                                   % if 'vendor_name' in pending_product_required_fields:
+                                   :type="pendingProduct.vendor_name ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.vendor_name">
                             </b-input>
                           </b-field>
 
-                          <b-field label="Vendor Item Code">
+                          <b-field label="Vendor Item Code"
+                                   % if 'vendor_item_code' in pending_product_required_fields:
+                                   :type="pendingProduct.vendor_item_code ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.vendor_item_code">
                             </b-input>
                           </b-field>
 
-                          <b-field label="Unit Cost">
+                          <b-field label="Case Size"
+                                   % if 'case_size' in pending_product_required_fields:
+                                   :type="pendingProduct.case_size ? null : 'is-danger'"
+                                   % endif
+                                   >
+                            <b-input v-model="pendingProduct.case_size"
+                                     type="number" step="0.01"
+                                     style="width: 7rem;">
+                            </b-input>
+                          </b-field>
+
+                        </b-field>
+
+                        <b-field grouped>
+
+                          <b-field label="Unit Cost"
+                                   % if 'unit_cost' in pending_product_required_fields:
+                                   :type="pendingProduct.unit_cost ? null : 'is-danger'"
+                                   % endif
+                                   >
                             <b-input v-model="pendingProduct.unit_cost"
                                      type="number" step="0.01"
                                      style="width: 10rem;">
                             </b-input>
                           </b-field>
 
-                          <b-field label="Case Size">
-                            <b-input v-model="pendingProduct.case_size"
-                                     type="number" step="0.01"
-                                     style="width: 7rem;">
+                          <b-field label="Unit Reg. Price"
+                                   % if 'regular_price_amount' in pending_product_required_fields:
+                                   :type="pendingProduct.regular_price_amount ? null : 'is-danger'"
+                                   % endif
+                                   >
+                            <b-input v-model="pendingProduct.regular_price_amount"
+                                     type="number" step="0.01">
                             </b-input>
                           </b-field>
 
+                          <b-field label="Gross Margin">
+                            <span class="control">
+                              {{ pendingProductGrossMargin }}
+                            </span>
+                          </b-field>
+
                         </b-field>
 
                         <b-field label="Notes">
                           <b-input v-model="pendingProduct.notes"
                                    type="textarea">
                           </b-input>
                         </b-field>
@@ -730,15 +756,15 @@
                         <img :src="productImageURL"
                              style="max-height: 150px; max-width: 150px; "/>
                       </div>
 
                       <b-field grouped>
                         <b-field label="Product" horizontal>
                           <span :class="productIsKnown ? null : 'has-text-success'">
-                            {{ productIsKnown ? productDisplay : pendingProduct.brand_name + ' ' + pendingProduct.description + ' ' + pendingProduct.size }}
+                            {{ productIsKnown ? productDisplay : (pendingProduct.brand_name || '') + ' ' + (pendingProduct.description || '') + ' ' + (pendingProduct.size || '') }}
                           </span>
                         </b-field>
                       </b-field>
 
                       <b-field grouped>
 
                         <b-field label="Unit Size">
@@ -757,15 +783,15 @@
                         <b-field label="Unit Price"
                                  v-if="!productSalePriceDisplay">
                           <span :class="productIsKnown ? null : 'has-text-success'"
                                 % if product_price_may_be_questionable:
                                     :class="productPriceNeedsConfirmation ? 'has-background-warning' : ''"
                                 % endif
                                 >
-                            {{ productIsKnown ? productUnitPriceDisplay : '$' + pendingProduct.regular_price_amount }}
+                            {{ productIsKnown ? productUnitPriceDisplay : (pendingProduct.regular_price_amount ? '$' + pendingProduct.regular_price_amount : '') }}
                           </span>
                         </b-field>
 
                         <b-field label="Sale Price"
                                  v-if="productSalePriceDisplay">
                           <span class="has-background-warning"
                                 :class="productIsKnown ? null : 'has-text-success'">
@@ -850,26 +876,67 @@
                       Cancel
                     </b-button>
                     <b-button type="is-primary"
                               @click="itemDialogSave()"
                               :disabled="itemDialogSaveDisabled"
                               icon-pack="fas"
                               icon-left="save">
-                      {{ itemDialogSaveButtonText }}
+                      {{ itemDialogSaving ? "Working, please wait..." : (this.editingItem ? "Update Item" : "Add Item") }}
                     </b-button>
                   </div>
 
                 </div>
               </div>
             </b-modal>
 
-            <tailbone-product-lookup ref="productLookup"
-                                     @canceled="productLookupCanceled"
-                                     @selected="productLookupSelected">
-            </tailbone-product-lookup>
+            % if unknown_product_confirm_price:
+                <b-modal has-modal-card
+                         :active.sync="confirmPriceShowDialog">
+                  <div class="modal-card">
+
+                    <header class="modal-card-head">
+                      <p class="modal-card-title">Confirm Price</p>
+                    </header>
+
+                    <section class="modal-card-body">
+                      <p class="block">
+                        Please confirm the price info before proceeding.
+                      </p>
+
+                      <div style="white-space: nowrap;">
+
+                        <b-field label="Unit Cost" horizontal>
+                          <span>{{ pendingProduct.unit_cost }}</span>
+                        </b-field>
+
+                        <b-field label="Unit Reg. Price" horizontal>
+                          <span>{{ pendingProduct.regular_price_amount }}</span>
+                        </b-field>
+
+                        <b-field label="Gross Margin" horizontal>
+                          <span>{{ pendingProductGrossMargin }}</span>
+                        </b-field>
+
+                      </div>
+                    </section>
+
+                    <footer class="modal-card-foot">
+                      <b-button type="is-primary"
+                                icon-pack="fas"
+                                icon-left="check"
+                                @click="confirmPriceSave()">
+                        Confirm
+                      </b-button>
+                      <b-button @click="confirmPriceCancel()">
+                        Cancel
+                      </b-button>
+                    </footer>
+                  </div>
+                </b-modal>
+            % endif
 
             % if allow_past_item_reorder:
             <b-modal :active.sync="pastItemsShowDialog">
               <div class="card">
                 <div class="card-content">
 
                   <b-table :data="pastItems"
@@ -1087,14 +1154,15 @@
 <%def name="make_this_page_component()">
   ${parent.make_this_page_component()}
   ${product_lookup.tailbone_product_lookup_component()}
   <script type="text/javascript">
 
     const CustomerOrderCreator = {
         template: '#customer-order-creator-template',
+        mixins: [SimpleRequestMixin],
         data() {
 
             let defaultUnitChoices = ${json.dumps(default_uom_choices)|n}
             let defaultUOM = ${json.dumps(default_uom)|n}
 
             return {
                 batchAction: null,
@@ -1158,14 +1226,15 @@
                 % if allow_past_item_reorder:
                 pastItemsShowDialog: false,
                 pastItemsLoading: false,
                 pastItems: [],
                 pastItemsSelected: null,
                 % endif
                 productIsKnown: true,
+                selectedProduct: null,
                 productUUID: null,
                 productDisplay: null,
                 productKey: null,
                 productKeyField: ${json.dumps(product_key_field)|n},
                 productKeyLabel: ${json.dumps(product_key_label)|n},
                 productSize: null,
                 productCaseQuantity: null,
@@ -1192,18 +1261,19 @@
 
                 % if allow_item_discounts:
                     productDiscountPercent: ${json.dumps(default_item_discount)|n},
                     allowDiscountsIfOnSale: ${json.dumps(allow_item_discounts_if_on_sale)|n},
                 % endif
 
                 pendingProduct: {},
+                pendingProductRequiredFields: ${json.dumps(pending_product_required_fields)|n},
                 departmentOptions: ${json.dumps(department_options)|n},
-
-                ## TODO: should find a better way to handle CSRF token
-                csrftoken: ${json.dumps(request.session.get_csrf_token() or request.session.new_csrf_token())|n},
+                % if unknown_product_confirm_price:
+                    confirmPriceShowDialog: false,
+                % endif
 
                 submittingOrder: false,
             }
         },
         computed: {
             customerPanelHeader() {
                 let text = "Customer"
@@ -1382,45 +1452,47 @@
                         }
                     }
                     return true
                 },
 
             % endif
 
+            pendingProductGrossMargin() {
+                let cost = this.pendingProduct.unit_cost
+                let price = this.pendingProduct.regular_price_amount
+                if (cost && price) {
+                    let margin = (price - cost) / price
+                    return (100 * margin).toFixed(2).toString() + " %"
+                }
+            },
+
             itemDialogSaveDisabled() {
+
                 if (this.itemDialogSaving) {
                     return true
                 }
+
                 if (this.productIsKnown) {
                     if (!this.productUUID) {
                         return true
                     }
+
                 } else {
-                    if (!this.pendingProduct.description) {
-                        return true
+                    for (let field of this.pendingProductRequiredFields) {
+                        if (!this.pendingProduct[field]) {
+                            return true
+                        }
                     }
                 }
+
                 if (!this.productUOM) {
                     return true
                 }
-                return false
-            },
-
-            itemDialogSaveButtonText() {
-                if (this.itemDialogSaving) {
-                    return "Working, please wait..."
-                }
-                return this.editingItem ? "Update Item" : "Add Item"
-            },
 
-            submitOrderButtonText() {
-                if (this.submittingOrder) {
-                    return "Working, please wait..."
-                }
-                return "Submit this Order"
+                return false
             },
         },
         mounted() {
             if (this.customerStatusType) {
                 this.customerPanelOpen = true
             }
         },
@@ -1441,14 +1513,26 @@
                 // button, i.e. `val` is false, then we want to *clear
                 // out* the existing contact selection.  this is
                 // primarily to avoid any ambiguity.
                 } else if (this.contactUUID) {
                     this.$refs.contactAutocomplete.clearSelection()
                 }
             },
+
+            productIsKnown(newval, oldval) {
+                // TODO: seems like this should be better somehow?
+                // e.g. maybe we should not be clearing *everything*
+                // in case user accidentally clicks, and then clicks
+                // "is known" again?  and if we *should* clear all,
+                // why does that require 2 steps?
+                if (!newval) {
+                    this.selectedProduct = null
+                    this.clearProduct()
+                }
+            },
         },
         methods: {
 
             startOverEntirely() {
                 let msg = "Are you sure you want to start over entirely?\n\n"
                     + "This will totally delete this order and start a new one."
                 if (!confirm(msg)) {
@@ -1496,39 +1580,19 @@
                     this.$refs.batchActionForm.submit()
                 })
             },
 
             submitBatchData(params, success, failure) {
                 let url = ${json.dumps(request.current_route_url())|n}
                 
-                let headers = {
-                    ## TODO: should find a better way to handle CSRF token
-                    'X-CSRF-TOKEN': this.csrftoken,
-                }
-
-                ## TODO: should find a better way to handle CSRF token
-                this.$http.post(url, params, {headers: headers}).then((response) => {
-                    if (response.data.error) {
-                        this.$buefy.toast.open({
-                            message: response.data.error,
-                            type: 'is-danger',
-                            duration: 2000, // 2 seconds
-                        })
-                        if (failure) {
-                            failure(response)
-                        }
-                    } else if (success) {
+                this.simplePOST(url, params, response => {
+                    if (success) {
                         success(response)
                     }
                 }, response => {
-                    this.$buefy.toast.open({
-                        message: "Unexpected error occurred",
-                        type: 'is-danger',
-                        duration: 2000, // 2 seconds
-                    })
                     if (failure) {
                         failure(response)
                     }
                 })
             },
 
             submitOrder() {
@@ -1811,28 +1875,20 @@
                         % endif
                         totalPrice = totalPrice.toFixed(2)
                         return "$" + totalPrice
                     }
                 }
             },
 
-            productFullLookup() {
-                this.showingItemDialog = false
-                let term = this.$refs.productAutocomplete.getUserInput()
-                this.$refs.productLookup.showDialog(term)
-            },
-
-            productLookupCanceled() {
-                this.showingItemDialog = true
-            },
-
             productLookupSelected(selected) {
+                // TODO: this still is a hack somehow, am sure of it.
+                // need to clean this up at some point
+                this.selectedProduct = selected
                 this.clearProduct()
-                this.productChanged(selected.uuid)
-                this.showingItemDialog = true
+                this.productChanged(selected)
             },
 
             copyPendingProductAttrs(from, to) {
                 to.upc = from.upc
                 to.item_id = from.item_id
                 to.scancode = from.scancode
                 to.brand_name = from.brand_name
@@ -1847,14 +1903,15 @@
                 to.notes = from.notes
             },
 
             showAddItemDialog() {
                 this.customerPanelOpen = false
                 this.editingItem = null
                 this.productIsKnown = true
+                this.selectedProduct = null
                 this.productUUID = null
                 this.productDisplay = null
                 this.productKey = null
                 this.productSize = null
                 this.productCaseQuantity = null
                 this.productUnitPrice = null
                 this.productUnitPriceDisplay = null
@@ -1879,15 +1936,15 @@
                 % if allow_item_discounts:
                     this.productDiscountPercent = ${json.dumps(default_item_discount)|n}
                 % endif
 
                 this.itemDialogTabIndex = 0
                 this.showingItemDialog = true
                 this.$nextTick(() => {
-                    this.$refs.productAutocomplete.focus()
+                    this.$refs.productLookup.focus()
                 })
             },
 
             % if allow_past_item_reorder:
 
             showAddPastItem() {
                 this.pastItemsSelected = null
@@ -1943,19 +2000,32 @@
             % endif
 
             showEditItemDialog(row) {
                 this.editingItem = row
 
                 this.productIsKnown = !!row.product_uuid
                 this.productUUID = row.product_uuid
-                this.pendingProduct = {}
+
+                if (row.product_uuid) {
+                    this.selectedProduct = {
+                        uuid: row.product_uuid,
+                        full_description: row.product_full_description,
+                        url: row.product_url,
+                    }
+                } else {
+                    this.selectedProduct = null
+                }
+
+                // nb. must construct new object before updating data
+                // (otherwise vue does not notice the changes?)
+                let pending = {}
                 if (row.pending_product) {
-                    this.copyPendingProductAttrs(row.pending_product,
-                                                 this.pendingProduct)
+                    this.copyPendingProductAttrs(row.pending_product, pending)
                 }
+                this.pendingProduct = pending
 
                 this.productDisplay = row.product_full_description
                 this.productKey = row.product_key
                 this.productSize = row.product_size
                 this.productCaseQuantity = row.case_quantity
                 this.productURL = row.product_url
                 this.productUnitPrice = row.unit_price
@@ -2045,27 +2115,29 @@
                     }
                 }
                 if (!found) {
                     this.productUOM = choices[0].key
                 }
             },
 
-            productChanged(uuid) {
-                if (uuid) {
+            productChanged(product) {
+                if (product) {
                     let params = {
                         action: 'get_product_info',
-                        uuid: uuid,
+                        uuid: product.uuid,
                     }
                     // nb. it is possible for the handler to "swap"
                     // the product selection, i.e. user chooses a "per
                     // LB" item but the handler only allows selling by
                     // the "case" item.  so we do not assume the uuid
                     // received above is the correct one, but just use
                     // whatever came back from handler
                     this.submitBatchData(params, response => {
+                        this.selectedProduct = response.data
+
                         this.productUUID = response.data.uuid
                         this.productKey = response.data.key
                         this.productDisplay = response.data.full_description
                         this.productSize = response.data.size
                         this.productCaseQuantity = response.data.case_quantity
                         this.productUnitPrice = response.data.unit_price
                         this.productUnitPriceDisplay = response.data.unit_price_display
@@ -2094,15 +2166,15 @@
                         this.clearProduct()
                     })
                 } else {
                     this.clearProduct()
                 }
             },
 
-            itemDialogSave() {
+            itemDialogAttemptSave() {
                 this.itemDialogSaving = true
 
                 let params = {
                     product_is_known: this.productIsKnown,
                     % if product_price_may_be_questionable:
                         price_needs_confirmation: this.productPriceNeedsConfirmation,
                     % endif
@@ -2142,16 +2214,42 @@
                     }
 
                     // also update the batch total price
                     this.batchTotalPriceDisplay = response.data.batch.total_price_display
 
                     this.itemDialogSaving = false
                     this.showingItemDialog = false
+                }, response => {
+                    this.itemDialogSaving = false
                 })
             },
+
+            itemDialogSave() {
+
+                % if unknown_product_confirm_price:
+                    if (!this.productIsKnown && !this.editingItem) {
+                        this.showingItemDialog = false
+                        this.confirmPriceShowDialog = true
+                        return
+                    }
+                % endif
+
+                this.itemDialogAttemptSave()
+            },
+
+            confirmPriceCancel() {
+                this.confirmPriceShowDialog = false
+                this.showingItemDialog = true
+            },
+
+            confirmPriceSave() {
+                this.confirmPriceShowDialog = false
+                this.showingItemDialog = true
+                this.itemDialogAttemptSave()
+            },
         },
     }
 
     Vue.component('customer-order-creator', CustomerOrderCreator)
 
   </script>
 </%def>
```

#### html2text {}

```diff
@@ -1,14 +1,15 @@
 ## -*- coding: utf-8; -*- <%inherit file="/master/create.mako" /> <%namespace
 name="product_lookup" file="/products/lookup.mako" /> <%def name="extra_styles
 ()"> ${parent.extra_styles()}
 def> <%def name="page_content()">
 def> <%def name="order_form_buttons()">
 click="submitOrder()" :disabled="submittingOrder" icon-pack="fas" icon-
-left="fas fa-upload"> {{ submitOrderButtonText }}
+left="fas fa-upload"> {{ submittingOrder ? "Working, please wait..." : "Submit
+this Order" }}
 click="startOverEntirely()" icon-pack="fas" icon-left="fas fa-redo"> Start Over
 Entirely
 click="cancelOrder()" type="is-danger" icon-pack="fas" icon-left="fas fa-
 trash"> Cancel this Order
 def> <%def name="render_this_page_template()"> $
 {parent.render_this_page_template()} $
 {product_lookup.tailbone_product_lookup_template()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/custorders/configure.mako` & `Tailbone-0.9.90/tailbone/templates/custorders/configure.mako`

 * *Files 10% similar despite different names*

```diff
@@ -75,23 +75,14 @@
                   v-model="simpleSettings['rattail.custorders.product_price_may_be_questionable']"
                   native-value="true"
                   @input="settingsNeedSaved = true">
         Allow prices to be flagged as "questionable"
       </b-checkbox>
     </b-field>
 
-    <b-field message="If set, user can enter details of an arbitrary new &quot;pending&quot; product.">
-      <b-checkbox name="rattail.custorders.allow_unknown_product"
-                  v-model="simpleSettings['rattail.custorders.allow_unknown_product']"
-                  native-value="true"
-                  @input="settingsNeedSaved = true">
-        Allow creating orders for "unknown" products
-      </b-checkbox>
-    </b-field>
-
     <b-field>
       <b-checkbox name="rattail.custorders.allow_item_discounts"
                   v-model="simpleSettings['rattail.custorders.allow_item_discounts']"
                   native-value="true"
                   @input="settingsNeedSaved = true">
         Allow per-item discounts
       </b-checkbox>
@@ -126,11 +117,56 @@
                   native-value="true"
                   @input="settingsNeedSaved = true">
         Allow re-order via past item lookup
       </b-checkbox>
     </b-field>
 
   </div>
+
+  <h3 class="block is-size-3">Unknown Products</h3>
+  <div class="block" style="padding-left: 2rem;">
+
+    <b-field message="If set, user can enter details of an arbitrary new &quot;pending&quot; product.">
+      <b-checkbox name="rattail.custorders.allow_unknown_product"
+                  v-model="simpleSettings['rattail.custorders.allow_unknown_product']"
+                  native-value="true"
+                  @input="settingsNeedSaved = true">
+        Allow creating orders for "unknown" products
+      </b-checkbox>
+    </b-field>
+
+    <div v-if="simpleSettings['rattail.custorders.allow_unknown_product']">
+
+      <p class="block">
+        Require these fields for new product:
+      </p>
+
+      <div class="block"
+           style="margin-left: 2rem;">
+        % for field in pending_product_fields:
+            <b-field>
+              <b-checkbox name="rattail.custorders.unknown_product.fields.${field}.required"
+                          v-model="simpleSettings['rattail.custorders.unknown_product.fields.${field}.required']"
+                          native-value="true"
+                          @input="settingsNeedSaved = true">
+                ${field}
+              </b-checkbox>
+            </b-field>
+        % endfor
+      </div>
+
+      <b-field message="If set, user is always prompted to confirm price when adding new product.">
+        <b-checkbox name="rattail.custorders.unknown_product.always_confirm_price"
+                    v-model="simpleSettings['rattail.custorders.unknown_product.always_confirm_price']"
+                    native-value="true"
+                    @input="settingsNeedSaved = true">
+          Require price confirmation
+        </b-checkbox>
+      </b-field>
+
+    </div>
+
+  </div>
 </%def>
 
 
 ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/custorders/items/view.mako` & `Tailbone-0.9.90/tailbone/templates/custorders/items/view.mako`

 * *Files 22% similar despite different names*

```diff
@@ -5,14 +5,15 @@
   <div class="form">
     <${form.component} ref="mainForm"
                        % if master.has_perm('confirm_price'):
                        @confirm-price="showConfirmPrice"
                        % endif
                        % if master.has_perm('change_status'):
                        @change-status="showChangeStatus"
+                       @mark-received="markReceivedInit"
                        % endif
                        % if master.has_perm('add_note'):
                        @add-note="showAddNote"
                        % endif
                        >
     </${form.component}>
   </div>
@@ -57,14 +58,75 @@
       ${h.form(master.get_action_url('confirm_price', instance), ref='confirmPriceForm')}
       ${h.csrf_token(request)}
       ${h.hidden('note', **{':value': 'confirmPriceNote'})}
       ${h.end_form()}
   % endif
 
   % if master.has_perm('change_status'):
+
+      ## TODO ##
+      <% contact = instance.order.person %>
+      <% email_address = rattail_app.get_contact_email_address(contact) %>
+
+      <b-modal has-modal-card
+               :active.sync="markReceivedShowDialog">
+        <div class="modal-card">
+
+          <header class="modal-card-head">
+            <p class="modal-card-title">Mark Received</p>
+          </header>
+
+          <section class="modal-card-body">
+            <p class="block">
+              new status will be:&nbsp;
+              <span class="has-text-weight-bold">
+                % if email_address:
+                    ${enum.CUSTORDER_ITEM_STATUS[enum.CUSTORDER_ITEM_STATUS_CONTACTED]}
+                % else:
+                    ${enum.CUSTORDER_ITEM_STATUS[enum.CUSTORDER_ITEM_STATUS_RECEIVED]}
+                % endif
+              </span>
+            </p>
+            % if email_address:
+                <p class="block">
+                  This customer has an email address on file, which
+                  means that we will automatically send them an email
+                  notification, and advance the Order Product status to
+                  "${enum.CUSTORDER_ITEM_STATUS[enum.CUSTORDER_ITEM_STATUS_CONTACTED]}".
+                </p>
+            % else:
+                <p class="block">
+                  This customer does *not* have an email address on
+                  file, which means that we will *not* automatically
+                  send them an email notification, so the Order
+                  Product status will become
+                  "${enum.CUSTORDER_ITEM_STATUS[enum.CUSTORDER_ITEM_STATUS_RECEIVED]}".
+                </p>
+            % endif
+          </section>
+
+          <footer class="modal-card-foot">
+            <b-button type="is-primary"
+                      @click="markReceivedSubmit()"
+                      :disabled="markReceivedSubmitting"
+                      icon-pack="fas"
+                      icon-left="check">
+              {{ markReceivedSubmitting ? "Working, please wait..." : "Mark Received" }}
+            </b-button>
+            <b-button @click="markReceivedShowDialog = false">
+              Cancel
+            </b-button>
+          </footer>
+        </div>
+      </b-modal>
+      ${h.form(url(f'{route_prefix}.mark_received'), ref='markReceivedForm')}
+      ${h.csrf_token(request)}
+      ${h.hidden('order_item_uuids', value=instance.uuid)}
+      ${h.end_form()}
+
       <b-modal :active.sync="showChangeStatusDialog">
         <div class="card">
           <div class="card-content">
             <div class="level">
               <div class="level-left">
 
                 <div class="level-item">
@@ -102,64 +164,58 @@
               </p>
 
               <b-table :data="changeStatusGridData"
                        checkable 
                        :checked-rows.sync="changeStatusCheckedRows"
                        narrowed 
                        class="is-size-7">
-                <b-table-column field="product_brand" label="Brand"
+                <b-table-column field="product_key" label="${rattail_app.get_product_key_label()}"
                                 v-slot="props">
-                  <span v-html="props.row.product_brand"></span>
+                  {{ props.row.product_key }}
                 </b-table-column>
-                <b-table-column field="product_description" label="Product"
+                <b-table-column field="brand_name" label="Brand"
                                 v-slot="props">
-                  <span v-html="props.row.product_description"></span>
+                  <span v-html="props.row.brand_name"></span>
                 </b-table-column>
-                <!-- <b-table-column field="quantity" label="Quantity"> -->
-                <!--   <span v-html="props.row.quantity"></span> -->
-                <!-- </b-table-column> -->
-                <b-table-column field="product_case_quantity" label="cPack"
+                <b-table-column field="product_description" label="Description"
                                 v-slot="props">
-                  <span v-html="props.row.product_case_quantity"></span>
+                  <span v-html="props.row.product_description"></span>
                 </b-table-column>
-                <b-table-column field="order_quantity" label="oQty"
+                <b-table-column field="product_size" label="Size"
                                 v-slot="props">
-                  <span v-html="props.row.order_quantity"></span>
+                  <span v-html="props.row.product_size"></span>
                 </b-table-column>
-                <b-table-column field="order_uom" label="UOM"
+                <b-table-column field="product_case_quantity" label="cPack"
                                 v-slot="props">
-                  <span v-html="props.row.order_uom"></span>
+                  <span v-html="props.row.product_case_quantity"></span>
                 </b-table-column>
                 <b-table-column field="department_name" label="Department"
                                 v-slot="props">
                   <span v-html="props.row.department_name"></span>
                 </b-table-column>
-                <b-table-column field="product_barcode" label="Product Barcode"
+                <b-table-column field="order_quantity" label="oQty"
                                 v-slot="props">
-                  <span v-html="props.row.product_barcode"></span>
+                  <span v-html="props.row.order_quantity"></span>
                 </b-table-column>
-                <b-table-column field="unit_price" label="Unit $"
+                <b-table-column field="order_uom" label="UOM"
                                 v-slot="props">
-                  <span v-html="props.row.unit_price"></span>
+                  <span v-html="props.row.order_uom"></span>
                 </b-table-column>
                 <b-table-column field="total_price" label="Total $"
                                 v-slot="props">
                   <span v-html="props.row.total_price"></span>
                 </b-table-column>
-                <b-table-column field="order_date" label="Order Date"
-                                v-slot="props">
-                  <span v-html="props.row.order_date"></span>
-                </b-table-column>
                 <b-table-column field="status_code" label="Status"
                                 v-slot="props">
                   <span v-html="props.row.status_code"></span>
                 </b-table-column>
-                <!-- <b-table-column field="flagged" label="Flagged"> -->
-                <!--   <span v-html="props.row.flagged"></span> -->
-                <!-- </b-table-column> -->
+                <b-table-column field="flagged" label="Flagged"
+                                v-slot="props">
+                  {{ props.row.flagged ? "FLAG" : "" }}
+                </b-table-column>
               </b-table>
 
               <br />
             </div>
 
             <p>
               Please provide a note<span v-if="changeStatusGridData.length">
@@ -220,30 +276,30 @@
 
           <footer class="modal-card-foot">
             <b-button type="is-primary"
                       @click="addNoteSave()"
                       :disabled="addNoteSaveDisabled"
                       icon-pack="fas"
                       icon-left="save">
-              {{ addNoteSubmitText }}
+              {{ addNoteSubmitting ? "Working, please wait..." : "Save Note" }}
             </b-button>
             <b-button @click="showAddNoteDialog = false">
               Cancel
             </b-button>
           </footer>
         </div>
       </b-modal>
   % endif
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
-    ${form.component_studly}Data.notesData = ${json.dumps(notes_data)|n}
+    ${form.component_studly}Data.eventsData = ${json.dumps(events_data)|n}
 
     % if master.has_perm('confirm_price'):
 
         ThisPageData.confirmPriceShowDialog = false
         ThisPageData.confirmPriceNote = null
         ThisPageData.confirmPriceSubmitting = false
 
@@ -274,14 +330,26 @@
             this.$refs.confirmPriceForm.submit()
         }
 
     % endif
 
     % if master.has_perm('change_status'):
 
+        ThisPageData.markReceivedShowDialog = false
+        ThisPageData.markReceivedSubmitting = false
+
+        ThisPage.methods.markReceivedInit = function() {
+            this.markReceivedShowDialog = true
+        }
+
+        ThisPage.methods.markReceivedSubmit = function() {
+            this.markReceivedSubmitting = true
+            this.$refs.markReceivedForm.submit()
+        }
+
         ThisPageData.orderItemStatuses = ${json.dumps(enum.CUSTORDER_ITEM_STATUS)|n}
         ThisPageData.orderItemStatusOptions = ${json.dumps([dict(key=k, label=v) for k, v in six.iteritems(enum.CUSTORDER_ITEM_STATUS)])|n}
 
         ThisPageData.oldStatusCode = ${instance.status_code}
 
         ThisPageData.showChangeStatusDialog = false
         ThisPageData.newStatusCode = null
@@ -320,23 +388,28 @@
             }
 
             this.changeStatusSubmitting = true
             this.changeStatusSubmitText = "Working, please wait..."
             this.$refs.changeStatusForm.submit()
         }
 
+        ${form.component_studly}Data.changeFlaggedSubmitting = false
+
+        ${form.component_studly}.methods.changeFlaggedSubmit = function() {
+            this.changeFlaggedSubmitting = true
+        }
+
     % endif
 
     % if master.has_perm('add_note'):
 
         ThisPageData.showAddNoteDialog = false
         ThisPageData.newNoteText = null
         ThisPageData.newNoteApplyAll = false
         ThisPageData.addNoteSubmitting = false
-        ThisPageData.addNoteSubmitText = "Save Note"
 
         ThisPage.computed.addNoteSaveDisabled = function() {
             if (!this.newNoteText) {
                 return true
             }
             if (this.addNoteSubmitting) {
                 return true
@@ -351,51 +424,27 @@
             this.$nextTick(() => {
                 this.$refs.newNoteTextArea.focus()
             })
         }
 
         ThisPage.methods.addNoteSave = function() {
             this.addNoteSubmitting = true
-            this.addNoteSubmitText = "Working, please wait..."
 
             let url = '${url('{}.add_note'.format(route_prefix), uuid=instance.uuid)}'
-
             let params = {
                 note: this.newNoteText,
                 apply_all: this.newNoteApplyAll,
             }
 
-            let headers = {
-                ## TODO: should find a better way to handle CSRF token
-                'X-CSRF-TOKEN': this.csrftoken,
-            }
-
-            ## TODO: should find a better way to handle CSRF token
-            this.$http.post(url, params, {headers: headers}).then(({ data }) => {
-                if (data.success) {
-                    this.$refs.mainForm.notesData = data.notes
-                    this.showAddNoteDialog = false
-                } else {
-                    this.$buefy.toast.open({
-                        message: "Save failed:  " + (data.error || "(unknown error)"),
-                        type: 'is-danger',
-                        duration: 4000, // 4 seconds
-                    })
-                }
+            this.simplePOST(url, params, response => {
+                this.$refs.mainForm.eventsData = response.data.events
+                this.showAddNoteDialog = false
                 this.addNoteSubmitting = false
-                this.addNoteSubmitText = "Save Note"
-            }).catch((error) => {
-                // TODO: should handle this better somehow..?
-                this.$buefy.toast.open({
-                    message: "Save failed:  (unknown error)",
-                    type: 'is-danger',
-                    duration: 4000, // 4 seconds
-                })
+            }, response => {
                 this.addNoteSubmitting = false
-                this.addNoteSubmitText = "Save Note"
             })
         }
 
     % endif
 
   </script>
 </%def>
```

### Comparing `Tailbone-0.9.9/tailbone/templates/receiving/declare_credit.mako` & `Tailbone-0.9.90/tailbone/templates/receiving/declare_credit.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/receiving/receive_row.mako` & `Tailbone-0.9.90/tailbone/templates/receiving/receive_row.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/receiving/view.mako` & `Tailbone-0.9.90/tailbone/templates/receiving/view.mako`

 * *Files 23% similar despite different names*

```diff
@@ -32,65 +32,113 @@
         <div class="object-helper-content">
           ${po_vs_invoice_breakdown_grid}
         </div>
       </div>
   % endif
 </%def>
 
-<%def name="render_auto_receive_helper()">
-  % if master.has_perm('auto_receive') and master.can_auto_receive(batch):
+<%def name="render_tools_helper()">
+  % if allow_confirm_all_costs or (master.has_perm('auto_receive') and master.can_auto_receive(batch)):
 
       <div class="object-helper">
         <h3>Tools</h3>
-        <div class="object-helper-content">
-          <b-button type="is-primary"
-                    @click="autoReceiveShowDialog = true"
-                    icon-pack="fas"
-                    icon-left="check">
-            Auto-Receive All Items
-          </b-button>
-        </div>
-      </div>
+        <div class="object-helper-content"
+             style="display: flex; flex-direction: column; gap: 1rem;">
+
+          % if allow_confirm_all_costs:
+              <b-button type="is-primary"
+                        icon-pack="fas"
+                        icon-left="check"
+                        @click="confirmAllCostsShowDialog = true">
+                Confirm All Costs
+              </b-button>
+              <b-modal has-modal-card
+                       :active.sync="confirmAllCostsShowDialog">
+                <div class="modal-card">
+
+                  <header class="modal-card-head">
+                    <p class="modal-card-title">Confirm All Costs</p>
+                  </header>
+
+                  <section class="modal-card-body">
+                    <p class="block">
+                      You can automatically mark all catalog and invoice
+                      cost amounts as "confirmed" if you wish.
+                    </p>
+                    <p class="block">
+                      Would you like to do this?
+                    </p>
+                  </section>
+
+                  <footer class="modal-card-foot">
+                    <b-button @click="confirmAllCostsShowDialog = false">
+                      Cancel
+                    </b-button>
+                    ${h.form(url(f'{route_prefix}.confirm_all_costs', uuid=batch.uuid), **{'@submit': 'confirmAllCostsSubmitting = true'})}
+                    ${h.csrf_token(request)}
+                    <b-button type="is-primary"
+                              native-type="submit"
+                              :disabled="confirmAllCostsSubmitting"
+                              icon-pack="fas"
+                              icon-left="check">
+                      {{ confirmAllCostsSubmitting ? "Working, please wait..." : "Confirm All" }}
+                    </b-button>
+                    ${h.end_form()}
+                  </footer>
+                </div>
+              </b-modal>
+          % endif
+
+          % if master.has_perm('auto_receive') and master.can_auto_receive(batch):
+              <b-button type="is-primary"
+                        @click="autoReceiveShowDialog = true"
+                        icon-pack="fas"
+                        icon-left="check">
+                Auto-Receive All Items
+              </b-button>
+              <b-modal has-modal-card
+                       :active.sync="autoReceiveShowDialog">
+                <div class="modal-card">
+
+                  <header class="modal-card-head">
+                    <p class="modal-card-title">Auto-Receive All Items</p>
+                  </header>
+
+                  <section class="modal-card-body">
+                    <p class="block">
+                      You can automatically set the "received" quantity to
+                      match the "shipped" quantity for all items, based on
+                      the invoice.
+                    </p>
+                    <p class="block">
+                      Would you like to do so?
+                    </p>
+                  </section>
+
+                  <footer class="modal-card-foot">
+                    <b-button @click="autoReceiveShowDialog = false">
+                      Cancel
+                    </b-button>
+                    ${h.form(url('{}.auto_receive'.format(route_prefix), uuid=batch.uuid), **{'@submit': 'autoReceiveSubmitting = true'})}
+                    ${h.csrf_token(request)}
+                    <b-button type="is-primary"
+                              native-type="submit"
+                              :disabled="autoReceiveSubmitting"
+                              icon-pack="fas"
+                              icon-left="check">
+                      {{ autoReceiveSubmitting ? "Working, please wait..." : "Auto-Receive All Items" }}
+                    </b-button>
+                    ${h.end_form()}
+                  </footer>
+                </div>
+              </b-modal>
+          % endif
 
-      <b-modal has-modal-card
-               :active.sync="autoReceiveShowDialog">
-        <div class="modal-card">
-
-          <header class="modal-card-head">
-            <p class="modal-card-title">Auto-Receive All Items</p>
-          </header>
-
-          <section class="modal-card-body">
-            <p class="block">
-              You can automatically set the "received" quantity to
-              match the "shipped" quantity for all items, based on
-              the invoice.
-            </p>
-            <p class="block">
-              Would you like to do so?
-            </p>
-          </section>
-
-          <footer class="modal-card-foot">
-            <b-button @click="autoReceiveShowDialog = false">
-              Cancel
-            </b-button>
-            ${h.form(url('{}.auto_receive'.format(route_prefix), uuid=batch.uuid), **{'@submit': 'autoReceiveSubmitting = true'})}
-            ${h.csrf_token(request)}
-            <b-button type="is-primary"
-                      native-type="submit"
-                      :disabled="autoReceiveSubmitting"
-                      icon-pack="fas"
-                      icon-left="check">
-              {{ autoReceiveSubmitting ? "Working, please wait..." : "Auto-Receive All Items" }}
-            </b-button>
-            ${h.end_form()}
-          </footer>
         </div>
-      </b-modal>
+      </div>
   % endif
 </%def>
 
 <%def name="render_this_page_template()">
   ${parent.render_this_page_template()}
 
   % if allow_edit_catalog_unit_cost or allow_edit_invoice_unit_cost:
@@ -98,33 +146,43 @@
         <div>
           <span v-show="!editing">
             {{ value }}
           </span>
           <b-input v-model="inputValue"
                    ref="input"
                    v-show="editing"
+                   size="is-small"
                    @keydown.native="inputKeyDown"
-                   @blur="inputBlur">
+                   @focus="selectAll"
+                   @blur="inputBlur"
+                   style="width: 6rem;">
           </b-input>
         </div>
       </script>
   % endif
 </%def>
 
 <%def name="object_helpers()">
   ${self.render_status_breakdown()}
   ${self.render_po_vs_invoice_helper()}
   ${self.render_execute_helper()}
-  ${self.render_auto_receive_helper()}
+  ${self.render_tools_helper()}
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
+    % if allow_confirm_all_costs:
+
+        ThisPageData.confirmAllCostsShowDialog = false
+        ThisPageData.confirmAllCostsSubmitting = false
+
+    % endif
+
     ThisPageData.autoReceiveShowDialog = false
     ThisPageData.autoReceiveSubmitting = false
 
     % if po_vs_invoice_breakdown_data is not Undefined:
         ThisPageData.poVsInvoiceBreakdownData = ${json.dumps(po_vs_invoice_breakdown_data)|n}
 
         ThisPage.methods.autoFilterPoVsInvoice = function(row) {
@@ -171,29 +229,38 @@
 
     % endif
 
     % if allow_edit_catalog_unit_cost or allow_edit_invoice_unit_cost:
 
         let ReceivingCostEditor = {
             template: '#receiving-cost-editor-template',
+            mixins: [SimpleRequestMixin],
             props: {
                 row: Object,
                 'field': String,
                 value: String,
             },
             data() {
                 return {
                     inputValue: this.value,
                     editing: false,
                 }
             },
             methods: {
 
+                selectAll() {
+                    // nb. must traverse into the <b-input> element
+                    let trueInput = this.$refs.input.$el.firstChild
+                    trueInput.select()
+                },
+
                 startEdit() {
-                    this.inputValue = this.value
+                    // nb. must strip $ sign etc. to get the real value
+                    let value = this.value.replace(/[^\-\d\.]/g, '')
+                    this.inputValue = parseFloat(value) || null
                     this.editing = true
                     this.$nextTick(() => {
                         this.$refs.input.focus()
                     })
                 },
 
                 inputKeyDown(event) {
@@ -220,49 +287,29 @@
                     this.editing = false
                     this.$emit('cancel-edit')
                 },
 
                 submitEdit() {
                     let url = '${url('{}.update_row_cost'.format(route_prefix), uuid=batch.uuid)}'
 
-                    // TODO: should get csrf token from parent component?
-                    let csrftoken = ${json.dumps(request.session.get_csrf_token() or request.session.new_csrf_token())|n}
-                    let headers = {'${csrf_header_name}': csrftoken}
-
                     let params = {
                         row_uuid: this.$props.row.uuid,
                     }
                     params[this.$props.field] = this.inputValue
 
-                    this.$http.post(url, params, {headers: headers}).then(response => {
-                        if (!response.data.error) {
+                    this.simplePOST(url, params, response => {
+
+                        // let parent know cost value has changed
+                        // (this in turn will update data in *this*
+                        // component, and display will refresh)
+                        this.$emit('input', response.data.row[this.$props.field],
+                                   this.$props.row._index)
 
-                            // let parent know cost value has changed
-                            // (this in turn will update data in *this*
-                            // component, and display will refresh)
-                            this.$emit('input', response.data.row[this.$props.field],
-                                       this.$props.row._index)
-
-                            // and hide the input box
-                            this.editing = false
-
-                        } else {
-                            this.$buefy.toast.open({
-                                message: "Submit failed:  " + response.data.error,
-                                type: 'is-warning',
-                                duration: 4000, // 4 seconds
-                            })
-                        }
-
-                    }, response => {
-                        this.$buefy.toast.open({
-                            message: "Submit failed:  (unknown error)",
-                            type: 'is-warning',
-                            duration: 4000, // 4 seconds
-                        })
+                        // and hide the input box
+                        this.editing = false
                     })
                 },
             },
         }
 
         Vue.component('receiving-cost-editor', ReceivingCostEditor)
 
@@ -277,19 +324,31 @@
         }
 
         ${rows_grid.component_studly}.methods.catalogCostConfirmed = function(amount, index) {
 
             // update display to indicate cost was confirmed
             this.addRowClass(index, 'catalog_cost_confirmed')
 
-            // start editing next row, unless there are no more
-            let nextRow = index + 1
-            if (this.data.length > nextRow) {
-                nextRow = this.data[nextRow]
-                this.$refs['catalogUnitCost_' + nextRow.uuid].startEdit()
+            // advance to next editable cost input...
+
+            // first try invoice cost within same row
+            let thisRow = this.data[index]
+            let cost = this.$refs['invoiceUnitCost_' + thisRow.uuid]
+            if (!cost) {
+
+                // or, try catalog cost from next row
+                let nextRow = this.data[index + 1]
+                if (nextRow) {
+                    cost = this.$refs['catalogUnitCost_' + nextRow.uuid]
+                }
+            }
+
+            // start editing next cost if found
+            if (cost) {
+                cost.startEdit()
             }
         }
 
     % endif
 
     % if allow_edit_invoice_unit_cost:
 
@@ -300,19 +359,32 @@
         }
 
         ${rows_grid.component_studly}.methods.invoiceCostConfirmed = function(amount, index) {
 
             // update display to indicate cost was confirmed
             this.addRowClass(index, 'invoice_cost_confirmed')
 
-            // start editing next row, unless there are no more
-            let nextRow = index + 1
-            if (this.data.length > nextRow) {
-                nextRow = this.data[nextRow]
-                this.$refs['invoiceUnitCost_' + nextRow.uuid].startEdit()
+            // advance to next editable cost input...
+
+            // nb. always advance to next row, regardless of field
+            let nextRow = this.data[index + 1]
+            if (nextRow) {
+
+                // first try catalog cost from next row
+                let cost = this.$refs['catalogUnitCost_' + nextRow.uuid]
+                if (!cost) {
+
+                    // or, try invoice cost from next row
+                    cost = this.$refs['invoiceUnitCost_' + nextRow.uuid]
+                }
+
+                // start editing next cost if found
+                if (cost) {
+                    cost.startEdit()
+                }
             }
         }
 
     % endif
 
   </script>
 </%def>
```

#### html2text {}

```diff
@@ -2,32 +2,47 @@
 name="extra_styles()"> ${parent.extra_styles()}
 def> <%def name="render_po_vs_invoice_helper()"> % if
 master.handler.has_purchase_order(batch) and master.handler.has_invoice_file
 (batch):
 ******** PPOO vvss.. IInnvvooiiccee ********
 ${po_vs_invoice_breakdown_grid}
 % endif
-def> <%def name="render_auto_receive_helper()"> % if master.has_perm
-('auto_receive') and master.can_auto_receive(batch):
+def> <%def name="render_tools_helper()"> % if allow_confirm_all_costs or
+(master.has_perm('auto_receive') and master.can_auto_receive(batch)):
 ******** TToooollss ********
+% if allow_confirm_all_costs:
+click="confirmAllCostsShowDialog = true"> Confirm All Costs
+Confirm All Costs
+You can automatically mark all catalog and invoice cost amounts as "confirmed"
+if you wish.
+Would you like to do this?
+click="confirmAllCostsShowDialog = false"> Cancel ${h.form(url(f'
+{route_prefix}.confirm_all_costs', uuid=batch.uuid), **{'@submit':
+'confirmAllCostsSubmitting = true'})} ${h.csrf_token(request)}
+disabled="confirmAllCostsSubmitting" icon-pack="fas" icon-left="check"> {
+{ confirmAllCostsSubmitting ? "Working, please wait..." : "Confirm All" }} $
+{h.end_form()}
+% endif % if master.has_perm('auto_receive') and master.can_auto_receive
+(batch):
 click="autoReceiveShowDialog = true" icon-pack="fas" icon-left="check"> Auto-
 Receive All Items
 Auto-Receive All Items
 You can automatically set the "received" quantity to match the "shipped"
 quantity for all items, based on the invoice.
 Would you like to do so?
 click="autoReceiveShowDialog = false"> Cancel ${h.form(url('
 {}.auto_receive'.format(route_prefix), uuid=batch.uuid), **{'@submit':
 'autoReceiveSubmitting = true'})} ${h.csrf_token(request)}
 disabled="autoReceiveSubmitting" icon-pack="fas" icon-left="check"> {
 { autoReceiveSubmitting ? "Working, please wait..." : "Auto-Receive All Items"
 }} ${h.end_form()}
 % endif
+% endif
 def> <%def name="render_this_page_template()"> $
 {parent.render_this_page_template()} % if allow_edit_catalog_unit_cost or
 allow_edit_invoice_unit_cost:
 % endif
 def> <%def name="object_helpers()"> ${self.render_status_breakdown()} $
 {self.render_po_vs_invoice_helper()} ${self.render_execute_helper()} $
-{self.render_auto_receive_helper()}
+{self.render_tools_helper()}
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/receiving/view_row.mako` & `Tailbone-0.9.90/tailbone/templates/receiving/view_row.mako`

 * *Files 1% similar despite different names*

```diff
@@ -440,14 +440,15 @@
     % endif
 
     % if master.batch_handler.has_invoice_file(batch):
         <nav class="panel" >
           <p class="panel-heading">Invoice</p>
           <div class="panel-block">
             <div>
+              ${form.render_field_readonly('invoice_number')}
               ${form.render_field_readonly('invoice_line_number')}
               ${form.render_field_readonly('invoice_unit_cost')}
               ${form.render_field_readonly('invoice_case_size')}
               ${form.render_field_readonly('invoice_total', label="Invoice Total")}
             </div>
           </div>
         </nav>
```

#### html2text {}

```diff
@@ -77,14 +77,14 @@
 % if master.batch_handler.has_purchase_order(batch):
 Purchase Order
 ${form.render_field_readonly('po_line_number')} ${form.render_field_readonly
 ('po_unit_cost')} ${form.render_field_readonly('po_case_size')} $
 {form.render_field_readonly('po_total')}
 % endif % if master.batch_handler.has_invoice_file(batch):
 Invoice
-${form.render_field_readonly('invoice_line_number')} $
-{form.render_field_readonly('invoice_unit_cost')} ${form.render_field_readonly
-('invoice_case_size')} ${form.render_field_readonly('invoice_total',
-label="Invoice Total")}
+${form.render_field_readonly('invoice_number')} ${form.render_field_readonly
+('invoice_line_number')} ${form.render_field_readonly('invoice_unit_cost')} $
+{form.render_field_readonly('invoice_case_size')} ${form.render_field_readonly
+('invoice_total', label="Invoice Total")}
 % endif
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/receiving/configure.mako` & `Tailbone-0.9.90/tailbone/templates/receiving/configure.mako`

 * *Files 2% similar despite different names*

```diff
@@ -147,14 +147,23 @@
                   v-model="simpleSettings['rattail.batch.purchase.receiving.allow_edit_invoice_unit_cost']"
                   native-value="true"
                   @input="settingsNeedSaved = true">
         Allow edit of Invoice Unit Cost
       </b-checkbox>
     </b-field>
 
+    <b-field>
+      <b-checkbox name="rattail.batch.purchase.receiving.auto_missing_credits"
+                  v-model="simpleSettings['rattail.batch.purchase.receiving.auto_missing_credits']"
+                  native-value="true"
+                  @input="settingsNeedSaved = true">
+        Auto-generate "missing" (DNR) credits for items not accounted for
+      </b-checkbox>
+    </b-field>
+
   </div>
 
   <h3 class="block is-size-3">Mobile Interface</h3>
   <div class="block" style="padding-left: 2rem;">
 
     <b-field message="TODO: this may also affect Ordering (?)">
       <b-checkbox name="rattail.batch.purchase.mobile_images"
```

### Comparing `Tailbone-0.9.9/tailbone/templates/messages/create.mako` & `Tailbone-0.9.90/tailbone/templates/messages/create.mako`

 * *Files 22% similar despite different names*

```diff
@@ -40,12 +40,25 @@
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
     TailboneFormData.possibleRecipients = new Map(${json.dumps(available_recipients)|n})
     TailboneFormData.recipientDisplayMap = ${json.dumps(recipient_display_map)|n}
 
+    TailboneForm.methods.subjectKeydown = function(event) {
+
+        // do not auto-submit form when user presses enter in subject field
+        if (event.which == 13) {
+            event.preventDefault()
+
+            // set focus to msg body input if possible
+            if (this.$refs.messageBody && this.$refs.messageBody.focus) {
+                this.$refs.messageBody.focus()
+            }
+        }
+    }
+
   </script>
 </%def>
 
 
 ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/messages/view.mako` & `Tailbone-0.9.90/tailbone/templates/messages/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/messages/recipients.mako` & `Tailbone-0.9.90/tailbone/templates/messages/recipients.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/messages/index.mako` & `Tailbone-0.9.90/tailbone/templates/messages/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/forms/deform_buefy.mako` & `Tailbone-0.9.90/tailbone/templates/forms/deform_buefy.mako`

 * *Files 6% similar despite different names*

```diff
@@ -7,18 +7,31 @@
   ${h.form(form.action_url, id=dform.formid, method='post', enctype='multipart/form-data', **form_kwargs)}
   ${h.csrf_token(request)}
   % endif
 
   <section>
     % if form_body is not Undefined and form_body:
         ${form_body|n}
+    % elif form.grouping:
+        % for group in form.grouping:
+            <nav class="panel">
+              <p class="panel-heading">${group}</p>
+              <div class="panel-block">
+                <div>
+                  % for field in form.grouping[group]:
+                      ${form.render_buefy_field(field)}
+                  % endfor
+                </div>
+              </div>
+            </nav>
+        % endfor
     % else:
-    % for field in form.fields:
-        ${form.render_buefy_field(field)}
-    % endfor
+        % for field in form.fields:
+            ${form.render_buefy_field(field)}
+        % endfor
     % endif
   </section>
 
   % if buttons:
       <br />
       ${buttons|n}
   % elif not form.readonly and (buttons is Undefined or (buttons is not None and buttons is not False)):
```

### Comparing `Tailbone-0.9.9/tailbone/templates/form.mako` & `Tailbone-0.9.90/tailbone/templates/form.mako`

 * *Files 25% similar despite different names*

```diff
@@ -7,20 +7,15 @@
 
 <%def name="render_form()">
   ${form.render(buttons=capture(self.render_form_buttons))|n}
 </%def>
 
 <%def name="render_buefy_form()">
   <div class="form">
-    <${form.component}
-      % if can_edit_help:
-      :configure-fields-help="configureFieldsHelp"
-      % endif
-      >
-    </${form.component}>
+    ${form.render_vuejs_component()}
   </div>
 </%def>
 
 <%def name="page_content()">
   <div class="form-wrapper">
     <br />
     ${self.render_buefy_form()}
```

#### html2text {}

```diff
@@ -1,16 +1,14 @@
 ## -*- coding: utf-8; -*- <%inherit file="/page.mako" /> <%def
 name="object_helpers()">
 def> <%def name="render_form_buttons()">
 def> <%def name="render_form()"> ${form.render(buttons=capture
 (self.render_form_buttons))|n}
 def> <%def name="render_buefy_form()">
-<${form.component} % if can_edit_help: :configure-fields-
-help="configureFieldsHelp" % endif >
-{form.component}>
+${form.render_vuejs_component()}
 def> <%def name="page_content()">
 
 ${self.render_buefy_form()}
 def> <%def name="render_this_page()">
 ${self.page_content()}
 ${before_object_helpers()}
 ${self.object_helpers()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/customers/pending/view.mako` & `Tailbone-0.9.90/tailbone/templates/customers/pending/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/autocomplete.mako` & `Tailbone-0.9.90/tailbone/templates/autocomplete.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/exception.mako` & `Tailbone-0.9.90/tailbone/templates/exception.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/luigi/index.mako` & `Tailbone-0.9.90/tailbone/templates/luigi/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/luigi/configure.mako` & `Tailbone-0.9.90/tailbone/templates/luigi/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/appinfo/index.mako` & `Tailbone-0.9.90/tailbone/templates/appinfo/index.mako`

 * *Files 3% similar despite different names*

```diff
@@ -47,15 +47,15 @@
 
         <span v-if="!props.open">
           <b-icon pack="fas"
                   icon="angle-right">
           </b-icon>
         </span>
 
-        <strong>Configuration Files</strong>
+        <span>Configuration Files (style: ${request.rattail_config._style})</span>
       </div>
     </template>
 
     <div class="panel-block">
       <div style="width: 100%;">
         <b-table :data="configFiles">
           
@@ -112,14 +112,14 @@
   </b-collapse>
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
-    ThisPageData.configFiles = ${json.dumps([dict(path=p, priority=i) for i, p in enumerate(reversed(request.rattail_config.files_read), 1)])|n}
+    ThisPageData.configFiles = ${json.dumps([dict(path=p, priority=i) for i, p in enumerate(request.rattail_config.prioritized_files, 1)])|n}
 
   </script>
 </%def>
 
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,14 +1,14 @@
 ## -*- coding: utf-8; -*- <%inherit file="/master/index.mako" /> <%def
 name="render_grid_component()">
 trigger="props">
 ## TODO: for some reason buefy will "reuse" the icon ## element in such a way
 that its display does not ## refresh. so to work around that, we use different
-## structure for the two icons, so buefy is forced to ## re-draw CCoonnffiigguurraattiioonn
-FFiilleess
+## structure for the two icons, so buefy is forced to ## re-draw Configuration
+Files (style: ${request.rattail_config._style})
 data="configFiles"> {{ props.row.priority }} {{ props.row.path }}
 open="false">
 trigger="props">
 ## TODO: for some reason buefy will "reuse" the icon ## element in such a way
 that its display does not ## refresh. so to work around that, we use different
 ## structure for the two icons, so buefy is forced to ## re-draw IInnssttaalllleedd
 PPaacckkaaggeess
```

### Comparing `Tailbone-0.9.9/tailbone/templates/appinfo/configure.mako` & `Tailbone-0.9.90/tailbone/templates/appinfo/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/ordering/view.mako` & `Tailbone-0.9.90/tailbone/templates/ordering/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/ordering/worksheet.mako` & `Tailbone-0.9.90/tailbone/templates/ordering/worksheet.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/login.mako` & `Tailbone-0.9.90/tailbone/templates/login.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/timesheet_edit.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/timesheet_edit.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/schedule_print.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/schedule_print.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/schedule_edit.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/schedule_edit.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/schedule_print_employee.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/schedule_print_employee.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/base.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/base.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/schedule.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/schedule.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/shifts/timesheet.mako` & `Tailbone-0.9.90/tailbone/templates/shifts/timesheet.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/configure-menus.mako` & `Tailbone-0.9.90/tailbone/templates/configure-menus.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/upgrades/view.mako` & `Tailbone-0.9.90/tailbone/templates/upgrades/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/upgrades/configure.mako` & `Tailbone-0.9.90/tailbone/templates/upgrades/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/views/model/create.mako` & `Tailbone-0.9.90/tailbone/templates/views/model/create.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/base.mako` & `Tailbone-0.9.90/tailbone/templates/base.mako`

 * *Files 6% similar despite different names*

```diff
@@ -335,17 +335,23 @@
                 <div class="level-item">
                   <p>DB:</p>
                 </div>
                 <div class="level-item">
                   ${h.form(url('change_db_engine'), ref='dbPickerForm')}
                   ${h.csrf_token(request)}
                   ${h.hidden('engine_type', value=master.engine_type_key)}
-                  <div class="select">
-                    ${h.select('dbkey', db_picker_selected, db_picker_options, **{'@change': 'changeDB()'})}
-                  </div>
+                  <b-select name="dbkey"
+                            value="${db_picker_selected}"
+                            @input="changeDB()">
+                    % for option in db_picker_options:
+                        <option value="${option.value}">
+                          ${option.label}
+                        </option>
+                    % endfor
+                  </b-select>
                   ${h.end_form()}
                 </div>
             % endif
 
           </div><!-- level-left -->
           <div class="level-right">
 
@@ -388,21 +394,27 @@
                 % endif
             % endif
 
             ## Theme Picker
             % if expose_theme_picker and request.has_perm('common.change_app_theme'):
                 <div class="level-item">
                   ${h.form(url('change_theme'), method="post", ref='themePickerForm')}
-                  ${h.csrf_token(request)}
-                  Theme:
-                  <div class="theme-picker">
-                    <div class="select">
-                      ${h.select('theme', theme, theme_picker_options, **{'@change': 'changeTheme()'})}
+                    ${h.csrf_token(request)}
+                    <div style="display: flex; align-items: center; gap: 0.5rem;">
+                      <span>Theme:</span>
+                      <b-select name="theme"
+                                v-model="globalTheme"
+                                @input="changeTheme()">
+                        % for option in theme_picker_options:
+                            <option value="${option.value}">
+                              ${option.label}
+                            </option>
+                        % endfor
+                      </b-select>
                     </div>
-                  </div>
                   ${h.end_form()}
                 </div>
             % endif
 
             <div class="level-item">
               <page-help
                 % if can_edit_help:
@@ -422,24 +434,30 @@
 
           </div><!-- level-right -->
         </nav><!-- level -->
       </header>
 
       ## Page Title
       % if capture(self.content_title):
-          <section id="content-title" class="hero is-primary">
-            <div class="level">
-              <div class="level-left">
-                <div class="level-item">
-                  <h1 class="title" v-html="contentTitleHTML"></h1>
-                </div>
+          <section id="content-title"
+                   class="has-background-primary">
+            <div style="display: flex; align-items: center; padding: 0.5rem;">
+
+              <h1 class="title has-text-white"
+                  v-html="contentTitleHTML">
+              </h1>
+
+              <div style="flex-grow: 1; display: flex; gap: 0.5rem;">
+                ${self.render_instance_header_title_extras()}
               </div>
-              <div class="level-right">
+
+              <div style="display: flex; gap: 0.5rem;">
                 ${self.render_instance_header_buttons()}
               </div>
+
             </div>
           </section>
       % endif
 
       <div class="content-wrapper">
 
       ## Page Body
@@ -481,14 +499,15 @@
 
       </div><!-- content-wrapper -->
     </div>
   </script>
 
   ${page_help.render_template()}
 
+  % if request.has_perm('common.feedback'):
   <script type="text/x-template" id="feedback-template">
     <div>
 
       <div class="level-item">
         <b-button type="is-primary"
                   @click="showFeedback()"
                   icon-pack="fas"
@@ -566,14 +585,15 @@
             </once-button>
           </footer>
         </div>
       </b-modal>
 
     </div>
   </script>
+  % endif
 
   ${tailbone_autocomplete_template()}
   ${multi_file_upload.render_template()}
 </%def>
 
 <%def name="render_this_page_component()">
   <this-page @change-content-title="changeContentTitle"
@@ -603,145 +623,125 @@
               ${h.link_to("Stop being root", url('stop_root'), class_='navbar-item root-user')}
           % elif request.is_admin:
               ${h.link_to("Become root", url('become_root'), class_='navbar-item root-user')}
           % endif
           % if messaging_enabled:
               ${h.link_to("Messages{}".format(" ({})".format(inbox_count) if inbox_count else ''), url('messages.inbox'), class_='navbar-item')}
           % endif
-          ${h.link_to("Change Password", url('change_password'), class_='navbar-item')}
+          % if request.is_root or not request.user.prevent_password_change:
+              ${h.link_to("Change Password", url('change_password'), class_='navbar-item')}
+          % endif
           ${h.link_to("Edit Preferences", url('my.preferences'), class_='navbar-item')}
           ${h.link_to("Logout", url('logout'), class_='navbar-item')}
         </div>
       </div>
   % else:
       ${h.link_to("Login", url('login'), class_='navbar-item')}
   % endif
 </%def>
 
+<%def name="render_instance_header_title_extras()"></%def>
+
 <%def name="render_instance_header_buttons()">
   ${self.render_crud_header_buttons()}
   ${self.render_prevnext_header_buttons()}
 </%def>
 
 <%def name="render_crud_header_buttons()">
   % if master and master.viewing:
       ## TODO: is there a better way to check if viewing parent?
       % if parent_instance is Undefined:
           % if master.editable and instance_editable and master.has_perm('edit'):
-              <div class="level-item">
-                <once-button tag="a" href="${action_url('edit', instance)}"
-                             icon-left="edit"
-                             text="Edit This">
-                </once-button>
-              </div>
+              <once-button tag="a" href="${action_url('edit', instance)}"
+                           icon-left="edit"
+                           text="Edit This">
+              </once-button>
           % endif
           % if master.cloneable and master.has_perm('clone'):
-              <div class="level-item">
-                <once-button tag="a" href="${action_url('clone', instance)}"
-                             icon-left="object-ungroup"
-                             text="Clone This">
-                </once-button>
-              </div>
+              <once-button tag="a" href="${action_url('clone', instance)}"
+                           icon-left="object-ungroup"
+                           text="Clone This">
+              </once-button>
           % endif
           % if master.deletable and instance_deletable and master.has_perm('delete'):
-              <div class="level-item">
-                <once-button tag="a" href="${action_url('delete', instance)}"
-                             type="is-danger"
-                             icon-left="trash"
-                             text="Delete This">
-                </once-button>
-              </div>
+              <once-button tag="a" href="${action_url('delete', instance)}"
+                           type="is-danger"
+                           icon-left="trash"
+                           text="Delete This">
+              </once-button>
           % endif
       % else:
           ## viewing row
           % if instance_deletable and master.has_perm('delete_row'):
-              <div class="level-item">
-                <once-button tag="a" href="${action_url('delete', instance)}"
-                             type="is-danger"
-                             icon-left="trash"
-                             text="Delete This">
-                </once-button>
-              </div>
+              <once-button tag="a" href="${action_url('delete', instance)}"
+                           type="is-danger"
+                           icon-left="trash"
+                           text="Delete This">
+              </once-button>
           % endif
       % endif
   % elif master and master.editing:
       % if master.viewable and master.has_perm('view'):
-          <div class="level-item">
-            <once-button tag="a" href="${action_url('view', instance)}"
-                         icon-left="eye"
-                         text="View This">
-            </once-button>
-          </div>
+          <once-button tag="a" href="${action_url('view', instance)}"
+                       icon-left="eye"
+                       text="View This">
+          </once-button>
       % endif
       % if master.deletable and instance_deletable and master.has_perm('delete'):
-          <div class="level-item">
-            <once-button tag="a" href="${action_url('delete', instance)}"
-                         type="is-danger"
-                         icon-left="trash"
-                         text="Delete This">
-            </once-button>
-          </div>
+          <once-button tag="a" href="${action_url('delete', instance)}"
+                       type="is-danger"
+                       icon-left="trash"
+                       text="Delete This">
+          </once-button>
       % endif
   % elif master and master.deleting:
       % if master.viewable and master.has_perm('view'):
-          <div class="level-item">
-            <once-button tag="a" href="${action_url('view', instance)}"
-                         icon-left="eye"
-                         text="View This">
-            </once-button>
-          </div>
+          <once-button tag="a" href="${action_url('view', instance)}"
+                       icon-left="eye"
+                       text="View This">
+          </once-button>
       % endif
       % if master.editable and instance_editable and master.has_perm('edit'):
-          <div class="level-item">
-            <once-button tag="a" href="${action_url('edit', instance)}"
-                         icon-left="edit"
-                         text="Edit This">
-            </once-button>
-          </div>
+          <once-button tag="a" href="${action_url('edit', instance)}"
+                       icon-left="edit"
+                       text="Edit This">
+          </once-button>
       % endif
   % endif
 </%def>
 
 <%def name="render_prevnext_header_buttons()">
   % if show_prev_next is not Undefined and show_prev_next:
       % if prev_url:
-          <div class="level-item">
-            <b-button tag="a" href="${prev_url}"
-                      icon-pack="fas"
-                      icon-left="arrow-left">
-              Older
-            </b-button>
-          </div>
+          <b-button tag="a" href="${prev_url}"
+                    icon-pack="fas"
+                    icon-left="arrow-left">
+            Older
+          </b-button>
       % else:
-          <div class="level-item">
-            <b-button tag="a" href="#"
-                      disabled
-                      icon-pack="fas"
-                      icon-left="arrow-left">
-              Older
-            </b-button>
-          </div>
+          <b-button tag="a" href="#"
+                    disabled
+                    icon-pack="fas"
+                    icon-left="arrow-left">
+            Older
+          </b-button>
       % endif
       % if next_url:
-          <div class="level-item">
-            <b-button tag="a" href="${next_url}"
-                      icon-pack="fas"
-                      icon-left="arrow-right">
-              Newer
-            </b-button>
-          </div>
+          <b-button tag="a" href="${next_url}"
+                    icon-pack="fas"
+                    icon-left="arrow-right">
+            Newer
+          </b-button>
       % else:
-          <div class="level-item">
-            <b-button tag="a" href="#"
-                      disabled
-                      icon-pack="fas"
-                      icon-left="arrow-right">
-              Newer
-            </b-button>
-          </div>
+          <b-button tag="a" href="#"
+                    disabled
+                    icon-pack="fas"
+                    icon-left="arrow-right">
+            Newer
+          </b-button>
       % endif
   % endif
 </%def>
 
 <%def name="declare_whole_page_vars()">
   ${page_help.declare_vars()}
   ${multi_file_upload.declare_vars()}
@@ -753,16 +753,35 @@
         mixins: [FormPosterMixin],
         computed: {
 
             globalSearchFilteredData() {
                 if (!this.globalSearchTerm.length) {
                     return this.globalSearchData
                 }
+
+                let terms = []
+                for (let term of this.globalSearchTerm.toLowerCase().split(' ')) {
+                    term = term.trim()
+                    if (term) {
+                        terms.push(term)
+                    }
+                }
+                if (!terms.length) {
+                    return this.globalSearchData
+                }
+
+                // all terms must match
                 return this.globalSearchData.filter((option) => {
-                    return option.label.toLowerCase().indexOf(this.globalSearchTerm.toLowerCase()) >= 0
+                    let label = option.label.toLowerCase()
+                    for (let term of terms) {
+                        if (label.indexOf(term) < 0) {
+                            return false
+                        }
+                    }
+                    return true
                 })
             },
 
         },
 
         mounted() {
             window.addEventListener('keydown', this.globalKey)
@@ -829,14 +848,18 @@
         },
     }
 
     let WholePageData = {
         contentTitleHTML: ${json.dumps(capture(self.content_title))|n},
         feedbackMessage: "",
 
+        % if expose_theme_picker and request.has_perm('common.change_app_theme'):
+            globalTheme: ${json.dumps(theme)|n},
+        % endif
+
         % if can_edit_help:
             configureFieldsHelp: false,
         % endif
 
         globalSearchActive: false,
         globalSearchTerm: '',
         globalSearchData: ${json.dumps(global_search_data)|n},
@@ -857,16 +880,14 @@
 
   </script>
 </%def>
 
 <%def name="modify_whole_page_vars()">
   <script type="text/javascript">
 
-    FeedbackFormData.referrer = location.href
-
     % if request.user:
     FeedbackFormData.userUUID = ${json.dumps(request.user.uuid)|n}
     FeedbackFormData.userName = ${json.dumps(six.text_type(request.user))|n}
     % endif
 
   </script>
 </%def>
```

#### html2text {}

```diff
@@ -60,62 +60,53 @@
 '?ver={}'.format(tailbone.__version__))}
 def> <%def name="buefy_styles()"> % if buefy_css: ## custom Buefy CSS $
 {h.stylesheet_link(buefy_css)} % else: ## upstream Buefy CSS $
 {h.stylesheet_link(h.get_liburl(request, 'buefy.css'))} % endif
 def> <%def name="extra_styles()">
 def> <%def name="head_tags()">
 def> <%def name="render_whole_page_template()">
-${page_help.render_template()}
-${tailbone_autocomplete_template()} ${multi_file_upload.render_template()}
+${page_help.render_template()} % if request.has_perm('common.feedback'):
+% endif ${tailbone_autocomplete_template()} ${multi_file_upload.render_template
+()}
 def> <%def name="render_this_page_component()">
 change-content-title="changeContentTitle" % if can_edit_help: :configure-
 fields-help="configureFieldsHelp" % endif >
 def> <%def name="render_navbar_end()">
 ${self.render_user_menu()}
 def> <%def name="render_user_menu()"> % if request.user:
 % if messaging_enabled: ${request.user}${" ({})".format(inbox_count) if
 inbox_count else ''} % else: ${request.user} % endif
 % if request.is_root: ${h.link_to("Stop being root", url('stop_root'),
 class_='navbar-item root-user')} % elif request.is_admin: ${h.link_to("Become
 root", url('become_root'), class_='navbar-item root-user')} % endif % if
 messaging_enabled: ${h.link_to("Messages{}".format(" ({})".format(inbox_count)
 if inbox_count else ''), url('messages.inbox'), class_='navbar-item')} % endif
-${h.link_to("Change Password", url('change_password'), class_='navbar-item')} $
+% if request.is_root or not request.user.prevent_password_change: ${h.link_to
+("Change Password", url('change_password'), class_='navbar-item')} % endif $
 {h.link_to("Edit Preferences", url('my.preferences'), class_='navbar-item')} $
 {h.link_to("Logout", url('logout'), class_='navbar-item')}
 % else: ${h.link_to("Login", url('login'), class_='navbar-item')} % endif
+def> <%def name="render_instance_header_title_extras()">
 def> <%def name="render_instance_header_buttons()"> $
 {self.render_crud_header_buttons()} ${self.render_prevnext_header_buttons()}
 def> <%def name="render_crud_header_buttons()"> % if master and master.viewing:
 ## TODO: is there a better way to check if viewing parent? % if parent_instance
 is Undefined: % if master.editable and instance_editable and master.has_perm
-('edit'):
-% endif % if master.cloneable and master.has_perm('clone'):
-% endif % if master.deletable and instance_deletable and master.has_perm
-('delete'):
-% endif % else: ## viewing row % if instance_deletable and master.has_perm
-('delete_row'):
-% endif % endif % elif master and master.editing: % if master.viewable and
-master.has_perm('view'):
-% endif % if master.deletable and instance_deletable and master.has_perm
-('delete'):
-% endif % elif master and master.deleting: % if master.viewable and
-master.has_perm('view'):
-% endif % if master.editable and instance_editable and master.has_perm('edit'):
-% endif % endif
+('edit'): % endif % if master.cloneable and master.has_perm('clone'): % endif %
+if master.deletable and instance_deletable and master.has_perm('delete'): %
+endif % else: ## viewing row % if instance_deletable and master.has_perm
+('delete_row'): % endif % endif % elif master and master.editing: % if
+master.viewable and master.has_perm('view'): % endif % if master.deletable and
+instance_deletable and master.has_perm('delete'): % endif % elif master and
+master.deleting: % if master.viewable and master.has_perm('view'): % endif % if
+master.editable and instance_editable and master.has_perm('edit'): % endif %
+endif
 def> <%def name="render_prevnext_header_buttons()"> % if show_prev_next is not
-Undefined and show_prev_next: % if prev_url:
-Older
-% else:
-Older
-% endif % if next_url:
-Newer
-% else:
-Newer
-% endif % endif
+Undefined and show_prev_next: % if prev_url: Older % else: Older % endif % if
+next_url: Newer % else: Newer % endif % endif
 def> <%def name="declare_whole_page_vars()"> ${page_help.declare_vars()} $
 {multi_file_upload.declare_vars()} ${h.javascript_link(request.static_url
 ('tailbone:static/js/tailbone.feedback.js') + '?ver={}'.format
 (tailbone.__version__))}
 def> <%def name="modify_whole_page_vars()">
 def> <%def name="finalize_whole_page_vars()"> ## NOTE: if you override this,
 must use
```

### Comparing `Tailbone-0.9.9/tailbone/templates/util.mako` & `Tailbone-0.9.90/tailbone/templates/util.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/email-bounces/view.mako` & `Tailbone-0.9.90/tailbone/templates/email-bounces/view.mako`

 * *Files 2% similar despite different names*

```diff
@@ -44,14 +44,12 @@
       </div>
     </div>
   </nav>
 </%def>
 
 <%def name="render_this_page()">
   ${parent.render_this_page()}
-  <pre class="email-message-body">
-    ${message}
-  </pre>
+  <pre class="email-message-body">${message}</pre>
 </%def>
 
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -5,9 +5,9 @@
 % if bounce.processed:
 This bounce was processed ${h.pretty_datetime(request.rattail_config,
 bounce.processed)} by ${bounce.processed_by}
 % if master.has_perm('unprocess'): % endif % else:
 This bounce has NOT yet been processed.
 % if master.has_perm('process'): % endif % endif
 def> <%def name="render_this_page()"> ${parent.render_this_page()}
-    ${message}
+${message}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/workorders/view.mako` & `Tailbone-0.9.90/tailbone/templates/workorders/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/formposter.mako` & `Tailbone-0.9.90/tailbone/templates/formposter.mako`

 * *Files 5% similar despite different names*

```diff
@@ -43,27 +43,27 @@
 
                 let headers = {
                     '${csrf_header_name}': csrftoken,
                 }
 
                 this.$http.post(action, params, {headers: headers}).then(response => {
 
-                    if (response.data.ok) {
-                        success(response)
-
-                    } else {
+                    if (response.data.error) {
                         this.$buefy.toast.open({
                             message: "Submit failed:  " + (response.data.error ||
                                                            "(unknown error)"),
                             type: 'is-danger',
                             duration: 4000, // 4 seconds
                         })
                         if (failure) {
                             failure(response)
                         }
+
+                    } else {
+                        success(response)
                     }
 
                 }, response => {
                     this.$buefy.toast.open({
                         message: "Submit failed!  (unknown server error)",
                         type: 'is-danger',
                         duration: 4000, // 4 seconds
```

### Comparing `Tailbone-0.9.9/tailbone/templates/people/view_profile_buefy.mako` & `Tailbone-0.9.90/tailbone/templates/people/view_profile_buefy.mako`

 * *Files 22% similar despite different names*

```diff
@@ -14,19 +14,69 @@
   </style>
 </%def>
 
 <%def name="content_title()">
   ${dynamic_content_title}
 </%def>
 
+<%def name="render_instance_header_title_extras()">
+  % if request.has_perm('people_profile.view_versions'):
+      <div class="level-item" style="margin-left: 2rem;">
+        <b-button v-if="!viewingHistory"
+                  icon-pack="fas"
+                  icon-left="history"
+                  @click="viewHistory()">
+          View History
+        </b-button>
+        <div v-if="viewingHistory"
+             class="buttons">
+          <b-button icon-pack="fas"
+                    icon-left="user"
+                    @click="viewingHistory = false">
+            View Profile
+          </b-button>
+          <b-button icon-pack="fas"
+                    icon-left="redo"
+                    @click="refreshHistory()"
+                    :disabled="gettingRevisions">
+            {{ gettingRevisions ? "Working, please wait..." : "Refresh History" }}
+          </b-button>
+        </div>
+      </div>
+  % endif
+</%def>
+
 <%def name="page_content()">
-  <profile-info @change-content-title="changeContentTitle">
+  <profile-info @change-content-title="changeContentTitle"
+                % if request.has_perm('people_profile.view_versions'):
+                :viewing-history="viewingHistory"
+                :getting-revisions="gettingRevisions"
+                :revisions="revisions"
+                :revision-version-map="revisionVersionMap"
+                % endif
+                >
   </profile-info>
 </%def>
 
+<%def name="render_this_page_component()">
+  ## TODO: should override this in a cleaner way!  too much duplicate code w/ parent template
+  <this-page @change-content-title="changeContentTitle"
+             % if can_edit_help:
+             :configure-fields-help="configureFieldsHelp"
+             % endif
+             % if request.has_perm('people_profile.view_versions'):
+             :viewing-history="viewingHistory"
+             :getting-revisions="gettingRevisions"
+             :revisions="revisions"
+             :revision-version-map="revisionVersionMap"
+             % endif
+             >
+  </this-page>
+</%def>
+
 <%def name="render_this_page()">
   ${self.page_content()}
 </%def>
 
 <%def name="render_personal_name_card()">
   <div class="card personal">
     <header class="card-header">
@@ -37,14 +87,20 @@
         <div style="display: flex; justify-content: space-between;">
           <div style="flex-grow: 1; margin-right: 1rem;">
 
             <b-field horizontal label="First Name">
               <span>{{ person.first_name }}</span>
             </b-field>
 
+            % if use_preferred_first_name:
+                <b-field horizontal label="Preferred First Name">
+                  <span>{{ person.preferred_first_name }}</span>
+                </b-field>
+            % endif
+
             <b-field horizontal label="Middle Name">
               <span>{{ person.middle_name }}</span>
             </b-field>
 
             <b-field horizontal label="Last Name">
               <span>{{ person.last_name }}</span>
             </b-field>
@@ -64,26 +120,40 @@
                 <div class="modal-card">
 
                   <header class="modal-card-head">
                     <p class="modal-card-title">Edit Name</p>
                   </header>
 
                   <section class="modal-card-body">
-                    <b-field label="First Name">
-                      <b-input v-model.trim="personFirstName"
-                               :maxlength="maxLengths.person_first_name || null">
-                      </b-input>
+
+                    <b-field grouped>
+
+                      <b-field label="First Name" expanded>
+                        <b-input v-model.trim="editNameFirst"
+                                 :maxlength="maxLengths.person_first_name || null">
+                        </b-input>
+                      </b-field>
+
+                      % if use_preferred_first_name:
+                          <b-field label="Preferred First Name" expanded>
+                            <b-input v-model.trim="editNameFirstPreferred"
+                                     :maxlength="maxLengths.person_preferred_first_name || null">
+                            </b-input>
+                          </b-field>
+                      % endif
+
                     </b-field>
+
                     <b-field label="Middle Name">
-                      <b-input v-model.trim="personMiddleName"
+                      <b-input v-model.trim="editNameMiddle"
                                :maxlength="maxLengths.person_middle_name || null">
                       </b-input>
                     </b-field>
                     <b-field label="Last Name">
-                      <b-input v-model.trim="personLastName"
+                      <b-input v-model.trim="editNameLast"
                                :maxlength="maxLengths.person_last_name || null">
                       </b-input>
                     </b-field>
                   </section>
 
                   <footer class="modal-card-foot">
                     <once-button type="is-primary"
@@ -156,46 +226,46 @@
                   <header class="modal-card-head">
                     <p class="modal-card-title">Edit Address</p>
                   </header>
 
                   <section class="modal-card-body">
 
                     <b-field label="Street 1" expanded>
-                      <b-input v-model.trim="personStreet1"
+                      <b-input v-model.trim="editAddressStreet1"
                                :maxlength="maxLengths.address_street || null">
                       </b-input>
                     </b-field>
 
                     <b-field label="Street 2" expanded>
-                      <b-input v-model.trim="personStreet2"
+                      <b-input v-model.trim="editAddressStreet2"
                                :maxlength="maxLengths.address_street2 || null">
                       </b-input>
                     </b-field>
 
                     <b-field label="Zipcode">
-                      <b-input v-model.trim="personZipcode"
+                      <b-input v-model.trim="editAddressZipcode"
                                :maxlength="maxLengths.address_zipcode || null">
                       </b-input>
                     </b-field>
 
                     <b-field grouped>
                       <b-field label="City">
-                        <b-input v-model.trim="personCity"
+                        <b-input v-model.trim="editAddressCity"
                                  :maxlength="maxLengths.address_city || null">
                         </b-input>
                       </b-field>
                       <b-field label="State">
-                        <b-input v-model.trim="personState"
+                        <b-input v-model.trim="editAddressState"
                                  :maxlength="maxLengths.address_state || null">
                         </b-input>
                       </b-field>
                     </b-field>
 
                     <b-field label="Invalid">
-                      <b-checkbox v-model="personInvalidAddress"
+                      <b-checkbox v-model="editAddressInvalid"
                                   type="is-danger">
                       </b-checkbox>
                     </b-field>
 
                   </section>
 
                   <footer class="modal-card-foot">
@@ -244,52 +314,52 @@
             </div>
             <b-modal has-modal-card
                      :active.sync="editPhoneShowDialog">
               <div class="modal-card">
 
                 <header class="modal-card-head">
                   <p class="modal-card-title">
-                    {{ phoneUUID ? "Edit Phone" : "Add Phone" }}
+                    {{ editPhoneUUID ? "Edit" : "Add" }} Phone
                   </p>
                 </header>
 
                 <section class="modal-card-body">
                   <b-field grouped>
 
                     <b-field label="Type" expanded>
-                      <b-select v-model="phoneType" expanded>
+                      <b-select v-model="editPhoneType" expanded>
                         <option v-for="option in phoneTypeOptions"
                                 :key="option.value"
                                 :value="option.value">
                           {{ option.label }}
                         </option>
                       </b-select>
                     </b-field>
 
                     <b-field label="Number" expanded>
-                      <b-input v-model.trim="phoneNumber"
+                      <b-input v-model.trim="editPhoneNumber"
                                ref="editPhoneInput">
                       </b-input>
                     </b-field>
                   </b-field>
 
                   <b-field label="Preferred?">
-                    <b-checkbox v-model="phonePreferred">
+                    <b-checkbox v-model="editPhonePreferred">
                     </b-checkbox>
                   </b-field>
 
                 </section>
 
                 <footer class="modal-card-foot">
                   <b-button type="is-primary"
                             @click="editPhoneSave()"
                             :disabled="editPhoneSaveDisabled"
                             icon-pack="fas"
                             icon-left="save">
-                    {{ editPhoneSaveText }}
+                    {{ editPhoneSaving ? "Working..." : "Save" }}
                   </b-button>
                   <b-button @click="editPhoneShowDialog = false">
                     Cancel
                   </b-button>
                 </footer>
               </div>
             </b-modal>
@@ -318,20 +388,20 @@
           % if request.has_perm('people_profile.edit_person'):
           <b-table-column label="Actions"
                           v-slot="props">
             <a href="#" @click.prevent="editPhoneInit(props.row)">
               <i class="fas fa-edit"></i>
               Edit
             </a>
-            <a href="#" @click.prevent="deletePhone(props.row)"
+            <a href="#" @click.prevent="deletePhoneInit(props.row)"
                class="has-text-danger">
               <i class="fas fa-trash"></i>
               Delete
             </a>
-            <a href="#" @click.prevent="setPreferredPhone(props.row)"
+            <a href="#" @click.prevent="preferPhoneInit(props.row)"
                v-if="!props.row.preferred">
               <i class="fas fa-star"></i>
               Set Preferred
             </a>
           </b-table-column>
           % endif
 
@@ -361,61 +431,61 @@
             </div>
             <b-modal has-modal-card
                      :active.sync="editEmailShowDialog">
               <div class="modal-card">
 
                 <header class="modal-card-head">
                   <p class="modal-card-title">
-                    {{ emailUUID ? "Edit Email" : "Add Email" }}
+                    {{ editEmailUUID ? "Edit" : "Add" }} Email
                   </p>
                 </header>
 
                 <section class="modal-card-body">
                   <b-field grouped>
 
                     <b-field label="Type" expanded>
-                      <b-select v-model="emailType" expanded>
+                      <b-select v-model="editEmailType" expanded>
                         <option v-for="option in emailTypeOptions"
                                 :key="option.value"
                                 :value="option.value">
                           {{ option.label }}
                         </option>
                       </b-select>
                     </b-field>
 
                     <b-field label="Address" expanded>
-                      <b-input v-model.trim="emailAddress"
+                      <b-input v-model.trim="editEmailAddress"
                                ref="editEmailInput">
                       </b-input>
                     </b-field>
 
                   </b-field>
 
-                  <b-field v-if="!emailUUID"
+                  <b-field v-if="!editEmailUUID"
                            label="Preferred?">
-                    <b-checkbox v-model="emailPreferred">
+                    <b-checkbox v-model="editEmailPreferred">
                     </b-checkbox>
                   </b-field>
 
-                  <b-field v-if="emailUUID"
+                  <b-field v-if="editEmailUUID"
                            label="Invalid?">
-                    <b-checkbox v-model="emailInvalid"
-                                :type="emailInvalid ? 'is-danger': null">
+                    <b-checkbox v-model="editEmailInvalid"
+                                :type="editEmailInvalid ? 'is-danger': null">
                     </b-checkbox>
                   </b-field>
 
                 </section>
 
                 <footer class="modal-card-foot">
                   <b-button type="is-primary"
                             @click="editEmailSave()"
                             :disabled="editEmailSaveDisabled"
                             icon-pack="fas"
                             icon-left="save">
-                    {{ editEmailSaveText }}
+                    {{ editEmailSaving ? "Working, please wait..." : "Save" }}
                   </b-button>
                   <b-button @click="editEmailShowDialog = false">
                     Cancel
                   </b-button>
                 </footer>
               </div>
             </b-modal>
@@ -450,20 +520,20 @@
           % if request.has_perm('people_profile.edit_person'):
               <b-table-column label="Actions"
                               v-slot="props">
                 <a href="#" @click.prevent="editEmailInit(props.row)">
                   <i class="fas fa-edit"></i>
                   Edit
                 </a>
-                <a href="#" @click.prevent="deleteEmail(props.row)"
+                <a href="#" @click.prevent="deleteEmailInit(props.row)"
                    class="has-text-danger">
                   <i class="fas fa-trash"></i>
                   Delete
                 </a>
-                <a href="#" @click.prevent="setPreferredEmail(props.row)"
+                <a href="#" @click.prevent="preferEmailInit(props.row)"
                    v-if="!props.row.preferred">
                   <i class="fas fa-star"></i>
                   Set Preferred
                 </a>
               </b-table-column>
           % endif
 
@@ -487,218 +557,358 @@
 
       <div style="flex-grow: 1; margin-right: 1rem;">
         ${self.render_personal_tab_cards()}
       </div>
 
       <div>
         % if request.has_perm('people.view'):
-            ${h.link_to("View Person", url('people.view', uuid=person.uuid), class_='button')}
+            <b-button tag="a" :href="person.view_url">
+              View Person
+            </b-button>
         % endif
       </div>
-
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
     </div>
   </script>
 </%def>
 
 <%def name="render_personal_tab()">
   <b-tab-item label="Personal"
               value="personal"
               icon-pack="fas"
-              icon="check">
-    <personal-tab :person="person"
-                  :member="member"
-                  :max-lengths="maxLengths"
+              :icon="tabchecks.personal ? 'check' : null">
+    <personal-tab ref="tab_personal"
+                  :person="person"
+                  @profile-changed="profileChanged"
                   :phone-type-options="phoneTypeOptions"
                   :email-type-options="emailTypeOptions"
-                  @person-updated="personUpdated"
-                  @change-content-title="changeContentTitle">
+                  :max-lengths="maxLengths">
     </personal-tab>
   </b-tab-item>
 </%def>
 
+<%def name="render_member_tab_template()">
+  <script type="text/x-template" id="member-tab-template">
+    <div>
+      % if max_one_member:
+          <p class="block">
+            TODO: UI not yet implemented for "max one member per person"
+          </p
+
+      % else:
+          ## nb. multiple members allowed per person
+          <div v-if="members.length">
+
+            <div style="display: flex; justify-content: space-between;">
+              <p>{{ person.display_name }} has <strong>{{ members.length }}</strong> member account{{ members.length == 1 ? '' : 's' }}</p>
+            </div>
+
+            <br />
+            <b-collapse v-for="member in members"
+                        :key="member.uuid"
+                        class="panel"
+                        :open="members.length == 1">
+
+              <div slot="trigger"
+                   slot-scope="props"
+                   class="panel-heading"
+                   role="button">
+                <b-icon pack="fas"
+                        icon="caret-right">
+                </b-icon>
+                <strong>{{ member._key }} - {{ member.display }}</strong>
+              </div>
+
+              <div class="panel-block">
+                <div style="display: flex; justify-content: space-between; width: 100%;">
+                  <div style="flex-grow: 1;">
+
+                    <b-field horizontal label="${member_key_label}">
+                      {{ member._key }}
+                    </b-field>
+
+                    <b-field horizontal label="Account Holder">
+                      <a v-if="member.person_uuid != person.uuid"
+                         :href="member.view_profile_url">
+                        {{ member.person_display_name }}
+                      </a>
+                      <span v-if="member.person_uuid == person.uuid">
+                        {{ member.person_display_name }}
+                      </span>
+                    </b-field>
+
+                    <b-field horizontal label="Membership Type">
+                      <a v-if="member.view_membership_type_url"
+                         :href="member.view_membership_type_url">
+                        {{ member.membership_type_name }}
+                      </a>
+                      <span v-if="!member.view_membership_type_url">
+                        {{ member.membership_type_name }}
+                      </span>
+                    </b-field>
+
+                    <b-field horizontal label="Active">
+                      {{ member.active ? "Yes" : "No" }}
+                    </b-field>
+
+                    <b-field horizontal label="Joined">
+                      {{ member.joined }}
+                    </b-field>
+
+                    <b-field horizontal label="Withdrew"
+                             v-if="member.withdrew">
+                      {{ member.withdrew }}
+                    </b-field>
+
+                    <b-field horizontal label="Equity Total">
+                      {{ member.equity_total_display }}
+                    </b-field>
+
+                  </div>
+                  <div class="buttons" style="align-items: start;">
+
+                    <b-button v-for="link in member.external_links"
+                              :key="link.url"
+                              type="is-primary"
+                              tag="a" :href="link.url" target="_blank"
+                              icon-pack="fas"
+                              icon-left="external-link-alt">
+                      {{ link.label }}
+                    </b-button>
+
+                    % if request.has_perm('members.view'):
+                        <b-button tag="a" :href="member.view_url">
+                          View Member
+                        </b-button>
+                    % endif
+
+                  </div>
+                </div>
+              </div>
+            </b-collapse>
+          </div>
+
+          <div v-if="!members.length">
+            <p>{{ person.display_name }} does not have a member account.</p>
+          </div>
+      % endif
+
+    <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
+    </div>
+  </script>
+</%def>
+
 <%def name="render_member_tab()">
   <b-tab-item label="Member"
               value="member"
               icon-pack="fas"
-              :icon="members.length ? 'check' : null">
-
-    <div v-if="members.length">
+              :icon="tabchecks.member ? 'check' : null">
+    <member-tab ref="tab_member"
+                :person="person"
+                @profile-changed="profileChanged"
+                :phone-type-options="phoneTypeOptions">
+    </member-tab>
+  </b-tab-item>
+</%def>
 
-      <div style="display: flex; justify-content: space-between;">
-        <p>{{ person.display_name }} is associated with <strong>{{ members.length }}</strong> member account(s)</p>
-      </div>
+<%def name="render_customer_tab_template()">
+  <script type="text/x-template" id="customer-tab-template">
+    <div>
+      <div v-if="customers.length">
 
-      <br />
-      <b-collapse v-for="member in members"
-                  :key="member.uuid"
-                  class="panel"
-                  :open="members.length == 1">
-
-        <div slot="trigger"
-             slot-scope="props"
-             class="panel-heading"
-             role="button">
-          <b-icon pack="fas"
-                  icon="caret-right">
-          </b-icon>
-          <strong>#{{ member.number }} {{ member.display }}</strong>
+        <div style="display: flex; justify-content: space-between;">
+          <p>{{ person.display_name }} has <strong>{{ customers.length }}</strong> customer account{{ customers.length == 1 ? '' : 's' }}</p>
         </div>
 
-        <div class="panel-block">
-          <div style="display: flex; justify-content: space-between; width: 100%;">
-            <div style="flex-grow: 1;">
-
-              <b-field horizontal label="Number">
-                {{ member.number }}
-              </b-field>
-
-              <b-field horizontal label="ID">
-                {{ member.id }}
-              </b-field>
-
-              <b-field horizontal label="Active">
-                {{ member.active }}
-              </b-field>
-
-              <b-field horizontal label="Joined">
-                {{ member.joined }}
-              </b-field>
-
-              <b-field horizontal label="Withdrew"
-                       v-if="member.withdrew">
-                {{ member.withdrew }}
-              </b-field>
-
-              <b-field horizontal label="Person">
-                <a v-if="member.person_uuid != person.uuid"
-                   :href="member.view_profile_url">
-                  {{ member.person_display_name }}
-                </a>
-                <span v-if="member.person_uuid == person.uuid">
-                  {{ member.person_display_name }}
-                </span>
-              </b-field>
+        <br />
+        <b-collapse v-for="customer in customers"
+                    :key="customer.uuid"
+                    class="panel"
+                    :open="customers.length == 1">
+
+          <div slot="trigger"
+               slot-scope="props"
+               class="panel-heading"
+               role="button">
+            <b-icon pack="fas"
+                    icon="caret-right">
+            </b-icon>
+            <strong>{{ customer._key }} - {{ customer.name }}</strong>
+          </div>
 
-            </div>
-            <div class="buttons" style="align-items: start;">
-              ${self.render_member_panel_buttons(member)}
+          <div class="panel-block">
+            <div style="display: flex; justify-content: space-between; width: 100%;">
+              <div style="flex-grow: 1;">
+
+                <b-field horizontal label="${customer_key_label}">
+                  {{ customer._key }}
+                </b-field>
+
+                <b-field horizontal label="Account Name">
+                  {{ customer.name }}
+                </b-field>
+
+                % if expose_customer_shoppers:
+                    <b-field horizontal label="Shoppers">
+                      <ul>
+                        <li v-for="shopper in customer.shoppers"
+                            :key="shopper.uuid">
+                          <a v-if="shopper.person_uuid != person.uuid"
+                             :href="shopper.view_profile_url">
+                            {{ shopper.display_name }}
+                          </a>
+                          <span v-if="shopper.person_uuid == person.uuid">
+                            {{ shopper.display_name }}
+                          </span>
+                        </li>
+                      </ul>
+                    </b-field>
+                % endif
+
+                % if expose_customer_people:
+                    <b-field horizontal label="People">
+                      <ul>
+                        <li v-for="p in customer.people"
+                            :key="p.uuid">
+                          <a v-if="p.uuid != person.uuid"
+                             :href="p.view_profile_url">
+                            {{ p.display_name }}
+                          </a>
+                          <span v-if="p.uuid == person.uuid">
+                            {{ p.display_name }}
+                          </span>
+                        </li>
+                      </ul>
+                    </b-field>
+                % endif
+
+                <b-field horizontal label="Address"
+                         v-for="address in customer.addresses"
+                         :key="address.uuid">
+                  {{ address.display }}
+                </b-field>
+
+              </div>
+              <div class="buttons" style="align-items: start;">
+
+                <b-button v-for="link in customer.external_links"
+                          :key="link.url"
+                          type="is-primary"
+                          tag="a" :href="link.url" target="_blank"
+                          icon-pack="fas"
+                          icon-left="external-link-alt">
+                  {{ link.label }}
+                </b-button>
+
+                % if request.has_perm('customers.view'):
+                    <b-button tag="a" :href="customer.view_url">
+                      View Customer
+                    </b-button>
+                % endif
+
+              </div>
             </div>
           </div>
-        </div>
-      </b-collapse>
-    </div>
+        </b-collapse>
+      </div>
 
-    <div v-if="!members.length">
-      <p>{{ person.display_name }} has never had a member account.</p>
+      <div v-if="!customers.length">
+        <p>{{ person.display_name }} does not have a customer account.</p>
+      </div>
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
     </div>
-
-  </b-tab-item>
-</%def>
-
-<%def name="render_member_panel_buttons(member)">
-  % for button in member_xref_buttons:
-      ${button}
-  % endfor
-  % if request.has_perm('members.view'):
-      <b-button tag="a" :href="member.view_url">
-        View Member
-      </b-button>
-  % endif
+  </script>
 </%def>
 
 <%def name="render_customer_tab()">
   <b-tab-item label="Customer"
               value="customer"
               icon-pack="fas"
-              :icon="customers.length ? 'check' : null">
-
-    <div v-if="customers.length">
+              :icon="tabchecks.customer ? 'check' : null">
+    <customer-tab ref="tab_customer"
+                  :person="person"
+                  @profile-changed="profileChanged">
+    </customer-tab>
+  </b-tab-item>
+</%def>
 
-      <div style="display: flex; justify-content: space-between;">
-        <p>{{ person.display_name }} is associated with <strong>{{ customers.length }}</strong> customer account(s)</p>
-      </div>
+<%def name="render_shopper_tab_template()">
+  <script type="text/x-template" id="shopper-tab-template">
+    <div>
+      <div v-if="shoppers.length">
 
-      <br />
-      <b-collapse v-for="customer in customers"
-                  :key="customer.uuid"
-                  class="panel"
-                  :open="customers.length == 1">
-
-        <div slot="trigger"
-             slot-scope="props"
-             class="panel-heading"
-             role="button">
-          <b-icon pack="fas"
-                  icon="caret-right">
-          </b-icon>
-          <strong>#{{ customer.number }} {{ customer.name }}</strong>
+        <div style="display: flex; justify-content: space-between;">
+          <p>{{ person.display_name }} is shopper for <strong>{{ shoppers.length }}</strong> customer account{{ shoppers.length == 1 ? '' : 's' }}</p>
         </div>
 
-        <div class="panel-block">
-          <div style="display: flex; justify-content: space-between; width: 100%;">
-            <div style="flex-grow: 1;">
-
-              <b-field horizontal label="Number">
-                {{ customer.number }}
-              </b-field>
-
-              <b-field horizontal label="ID">
-                {{ customer.id }}
-              </b-field>
-
-              <b-field horizontal label="Name">
-                {{ customer.name }}
-              </b-field>
-
-              <b-field horizontal label="People">
-                <ul>
-                  <li v-for="p in customer.people"
-                      :key="p.uuid">
-                    <a v-if="p.uuid != person.uuid"
-                       :href="p.view_profile_url">
-                      {{ p.display_name }}
-                    </a>
-                    <span v-if="p.uuid == person.uuid">
-                      {{ p.display_name }}
-                    </span>
-                  </li>
-                </ul>
-              </b-field>
-
-              <b-field horizontal label="Address"
-                       v-for="address in customer.addresses"
-                       :key="address.uuid">
-                {{ address.display }}
-              </b-field>
+        <br />
+        <b-collapse v-for="shopper in shoppers"
+                    :key="shopper.uuid"
+                    class="panel"
+                    :open="shoppers.length == 1">
+
+          <div slot="trigger"
+               slot-scope="props"
+               class="panel-heading"
+               role="button">
+            <b-icon pack="fas"
+                    icon="caret-right">
+            </b-icon>
+            <strong>{{ shopper.customer_key }} - {{ shopper.customer_name }}</strong>
+          </div>
 
-            </div>
-            <div class="buttons" style="align-items: start;">
-              ${self.render_customer_panel_buttons(customer)}
+          <div class="panel-block">
+            <div style="display: flex; justify-content: space-between; width: 100%;">
+              <div style="flex-grow: 1;">
+
+                <b-field horizontal label="${customer_key_label}">
+                  {{ shopper.customer_key }}
+                </b-field>
+
+                <b-field horizontal label="Account Name">
+                  {{ shopper.customer_name }}
+                </b-field>
+
+                <b-field horizontal label="Account Holder">
+                  <span v-if="!shopper.account_holder_view_profile_url">
+                    {{ shopper.account_holder_name }}
+                  </span>
+                  <a v-if="shopper.account_holder_view_profile_url"
+                     :href="shopper.account_holder_view_profile_url">
+                    {{ shopper.account_holder_name }}
+                  </a>
+                </b-field>
+
+              </div>
+  ##             <div class="buttons" style="align-items: start;">
+  ##               ${self.render_shopper_panel_buttons(shopper)}
+  ##             </div>
             </div>
           </div>
-        </div>
-      </b-collapse>
-    </div>
+        </b-collapse>
+      </div>
 
-    <div v-if="!customers.length">
-      <p>{{ person.display_name }} has never had a customer account.</p>
+      <div v-if="!shoppers.length">
+        <p>{{ person.display_name }} is not a shopper.</p>
+      </div>
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
     </div>
-
-  </b-tab-item> <!-- Customer -->
+  </script>
 </%def>
 
-<%def name="render_customer_panel_buttons(customer)">
-  % for button in customer_xref_buttons:
-      ${button}
-  % endfor
-  % if request.has_perm('customers.view'):
-      <b-button tag="a" :href="customer.view_url">
-        View Customer
-      </b-button>
-  % endif
+<%def name="render_shopper_tab()">
+  <b-tab-item label="Shopper"
+              value="shopper"
+              icon-pack="fas"
+              :icon="tabchecks.shopper ? 'check' : null">
+    <shopper-tab ref="tab_shopper"
+                 :person="person"
+                 @profile-changed="profileChanged">
+    </shopper-tab>
+  </b-tab-item>
 </%def>
 
 <%def name="render_employee_tab_template()">
   <script type="text/x-template" id="employee-tab-template">
     <div>
       <div style="display: flex; justify-content: space-between;">
 
@@ -713,41 +923,41 @@
                     <span>{{ employee.id }}</span>
                   </div>
                   % if request.has_perm('employees.edit'):
                       <div class="level-item">
                         <b-button type="is-primary"
                                   icon-pack="fas"
                                   icon-left="edit"
-                                  @click="initEditEmployeeID()">
+                                  @click="editEmployeeIdInit()">
                           Edit ID
                         </b-button>
                         <b-modal has-modal-card
-                                 :active.sync="showEditEmployeeIDDialog">
+                                 :active.sync="editEmployeeIdShowDialog">
                           <div class="modal-card">
 
                             <header class="modal-card-head">
                               <p class="modal-card-title">Employee ID</p>
                             </header>
 
                             <section class="modal-card-body">
                               <b-field label="Employee ID">
-                                <b-input v-model="newEmployeeID"></b-input>
+                                <b-input v-model="editEmployeeIdValue"></b-input>
                               </b-field>
                             </section>
 
                             <footer class="modal-card-foot">
-                              <b-button @click="showEditEmployeeIDDialog = false">
+                              <b-button @click="editEmployeeIdShowDialog = false">
                                 Cancel
                               </b-button>
                               <b-button type="is-primary"
                                         icon-pack="fas"
                                         icon-left="save"
-                                        :disabled="updatingEmployeeID"
-                                        @click="updateEmployeeID()">
-                                {{ editEmployeeIDSaveButtonText }}
+                                        :disabled="editEmployeeIdSaving"
+                                        @click="editEmployeeIdSave()">
+                                {{ editEmployeeIdSaving ? "Working, please wait..." : "Save" }}
                               </b-button>
                             </footer>
                           </div>
                         </b-modal>
                       </div>
                   % endif
                 </div>
@@ -784,27 +994,27 @@
                 {{ props.row.end_date }}
               </b-table-column>
 
               % if request.has_perm('people_profile.edit_employee_history'):
                   <b-table-column field="actions"
                                   label="Actions"
                                   v-slot="props">
-                    <a href="#" @click.prevent="editEmployeeHistory(props.row)">
+                    <a href="#" @click.prevent="editEmployeeHistoryInit(props.row)">
                       <i class="fas fa-edit"></i>
                       Edit
                     </a>
                   </b-table-column>
               % endif
 
             </b-table>
 
           </div>
 
           <p v-if="!employee.uuid">
-            ${person} has never been an employee.
+            ${person} is not an employee.
           </p>
 
         </div>
 
         <div>
           <div class="buttons">
 
@@ -814,108 +1024,108 @@
                           type="is-primary"
                           @click="startEmployeeInit()">
                   ${person} is now an Employee
                 </b-button>
 
                 <b-button v-if="employee.current"
                           type="is-primary"
-                          @click="showStopEmployeeDialog = true">
+                          @click="stopEmployeeInit()">
                   ${person} is no longer an Employee
                 </b-button>
 
                 <b-modal has-modal-card
                          :active.sync="startEmployeeShowDialog">
                   <div class="modal-card">
 
                     <header class="modal-card-head">
                       <p class="modal-card-title">Employee Start</p>
                     </header>
 
                     <section class="modal-card-body">
                       <b-field label="Employee Number">
-                        <b-input v-model="employeeID"></b-input>
+                        <b-input v-model="startEmployeeID"></b-input>
                       </b-field>
                       <b-field label="Start Date">
-                        <tailbone-datepicker v-model="employeeStartDate"></tailbone-datepicker>
+                        <tailbone-datepicker v-model="startEmployeeStartDate"></tailbone-datepicker>
                       </b-field>
                     </section>
 
                     <footer class="modal-card-foot">
                       <b-button @click="startEmployeeShowDialog = false">
                         Cancel
                       </b-button>
                       <once-button type="is-primary"
-                                   @click="startEmployee()"
-                                   :disabled="!employeeStartDate"
+                                   @click="startEmployeeSave()"
+                                   :disabled="!startEmployeeStartDate"
                                    text="Save">
                       </once-button>
                     </footer>
                   </div>
                 </b-modal>
 
                 <b-modal has-modal-card
-                         :active.sync="showStopEmployeeDialog">
+                         :active.sync="stopEmployeeShowDialog">
                   <div class="modal-card">
 
                     <header class="modal-card-head">
                       <p class="modal-card-title">Employee End</p>
                     </header>
 
                     <section class="modal-card-body">
                       <b-field label="End Date"
-                               :type="employeeEndDate ? null : 'is-danger'">
-                        <tailbone-datepicker v-model="employeeEndDate"></tailbone-datepicker>
+                               :type="stopEmployeeEndDate ? null : 'is-danger'">
+                        <tailbone-datepicker v-model="stopEmployeeEndDate"></tailbone-datepicker>
                       </b-field>
                       <b-field label="Revoke Internal App Access">
-                        <b-checkbox v-model="employeeRevokeAccess">
+                        <b-checkbox v-model="stopEmployeeRevokeAccess">
                         </b-checkbox>
                       </b-field>
                     </section>
 
                     <footer class="modal-card-foot">
-                      <b-button @click="showStopEmployeeDialog = false">
+                      <b-button @click="stopEmployeeShowDialog = false">
                         Cancel
                       </b-button>
                       <once-button type="is-primary"
-                                   @click="endEmployee()"
-                                   :disabled="!employeeEndDate"
+                                   @click="stopEmployeeSave()"
+                                   :disabled="!stopEmployeeEndDate"
                                    text="Save">
                       </once-button>
                     </footer>
                   </div>
                 </b-modal>
             % endif
 
             % if request.has_perm('people_profile.edit_employee_history'):
                 <b-modal has-modal-card
-                         :active.sync="showEditEmployeeHistoryDialog">
+                         :active.sync="editEmployeeHistoryShowDialog">
                   <div class="modal-card">
 
                     <header class="modal-card-head">
                       <p class="modal-card-title">Edit Employee History</p>
                     </header>
 
                     <section class="modal-card-body">
                       <b-field label="Start Date">
-                        <tailbone-datepicker v-model="employeeHistoryStartDate"></tailbone-datepicker>
+                        <tailbone-datepicker v-model="editEmployeeHistoryStartDate"></tailbone-datepicker>
                       </b-field>
                       <b-field label="End Date">
-                        <tailbone-datepicker v-model="employeeHistoryEndDate"
-                                             :disabled="!employeeHistoryEndDateRequired">
+                        <tailbone-datepicker v-model="editEmployeeHistoryEndDate"
+                                             :disabled="!editEmployeeHistoryEndDateRequired">
                         </tailbone-datepicker>
                       </b-field>
                     </section>
 
                     <footer class="modal-card-foot">
-                      <b-button @click="showEditEmployeeHistoryDialog = false">
+                      <b-button @click="editEmployeeHistoryShowDialog = false">
                         Cancel
                       </b-button>
                       <once-button type="is-primary"
-                                   @click="saveEmployeeHistory()"
-                                   :disabled="!employeeHistoryStartDate || (employeeHistoryEndDateRequired && !employeeHistoryEndDate)"
+                                   @click="editEmployeeHistorySave()"
+                                   :disabled="!editEmployeeHistoryStartDate || (editEmployeeHistoryEndDateRequired && !editEmployeeHistoryEndDate)"
                                    text="Save">
                       </once-button>
                     </footer>
                   </div>
                 </b-modal>
             % endif
 
@@ -926,473 +1136,685 @@
                 </b-button>
             % endif
 
           </div>
         </div>
 
       </div>
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
     </div>
   </script>
 </%def>
 
 <%def name="render_employee_tab()">
   <b-tab-item label="Employee"
               value="employee"
               icon-pack="fas"
-              :icon="employee.current ? 'check' : null">
-    <employee-tab :employee="employee"
-                  :employee-history="employeeHistory"
-                  @employee-updated="employeeUpdated"
-                  @employee-history-updated="employeeHistoryUpdated"
-                  @change-content-title="changeContentTitle">
+              :icon="tabchecks.employee ? 'check' : null">
+    <employee-tab ref="tab_employee"
+                  :person="person"
+                  @profile-changed="profileChanged">
     </employee-tab>
   </b-tab-item>
 </%def>
 
-<%def name="render_user_tab()">
-  <b-tab-item label="User"
-              value="user"
-              ${'icon="check" icon-pack="fas"' if person.users else ''|n}>
-    % if person.users:
-        <p>${person} is associated with <strong>${len(person.users)}</strong> user account(s)</p>
-        <br />
-        <div id="users-accordion">
-          % for user in person.users:
+<%def name="render_notes_tab_template()">
+  <script type="text/x-template" id="notes-tab-template">
+    <div>
 
-              <b-collapse class="panel"
-                          ## TODO: what's up with aria-id here?
-                          ## aria-id="contentIdForA11y2"
-                          >
+      % if request.has_perm('people_profile.add_note'):
+          <b-button type="is-primary"
+                    class="control"
+                    @click="addNoteInit()"
+                    icon-pack="fas"
+                    icon-left="plus">
+            Add Note
+          </b-button>
+      % endif
+
+      <b-table :data="notes">
+
+        <b-table-column field="note_type"
+                        label="Type"
+                        v-slot="props">
+          {{ props.row.note_type_display }}
+        </b-table-column>
+
+        <b-table-column field="subject"
+                        label="Subject"
+                        v-slot="props">
+          {{ props.row.subject }}
+        </b-table-column>
+
+        <b-table-column field="text"
+                        label="Text"
+                        v-slot="props">
+          {{ props.row.text }}
+        </b-table-column>
+
+        <b-table-column field="created"
+                        label="Created"
+                        v-slot="props">
+          <span v-html="props.row.created_display"></span>
+        </b-table-column>
+
+        <b-table-column field="created_by"
+                        label="Created By"
+                        v-slot="props">
+          {{ props.row.created_by_display }}
+        </b-table-column>
+
+        % if request.has_any_perm('people_profile.edit_note', 'people_profile.delete_note'):
+            <b-table-column label="Actions"
+                            v-slot="props">
+              % if request.has_perm('people_profile.edit_note'):
+                  <a href="#" @click.prevent="editNoteInit(props.row)">
+                    <i class="fas fa-edit"></i>
+                    Edit
+                  </a>
+              % endif
+              % if request.has_perm('people_profile.delete_note'):
+                  <a href="#" @click.prevent="deleteNoteInit(props.row)"
+                     class="has-text-danger">
+                    <i class="fas fa-trash"></i>
+                    Delete
+                  </a>
+              % endif
+            </b-table-column>
+        % endif
 
-                <div
-                   slot="trigger"
-                   class="panel-heading"
-                   role="button"
-                   ## TODO: what's up with aria-id here?
-                   ## aria-controls="contentIdForA11y2"
-                   >
-                  <strong>${user.username}</strong>
-                </div>
+      </b-table>
 
-                <div class="panel-block">
+      % if request.has_any_perm('people_profile.add_note', 'people_profile.edit_note', 'people_profile.delete_note'):
+          <b-modal :active.sync="editNoteShowDialog"
+                   has-modal-card>
+
+            <div class="modal-card">
+
+              <header class="modal-card-head">
+                <p class="modal-card-title">
+                  {{ editNoteUUID ? (editNoteDelete ? "Delete" : "Edit") : "New" }} Note
+                </p>
+              </header>
+
+              <section class="modal-card-body">
+
+                <b-field label="Type"
+                         :type="!editNoteDelete && !editNoteType ? 'is-danger' : null">
+                  <b-select v-model="editNoteType"
+                            :disabled="editNoteUUID">
+                    <option v-for="option in noteTypeOptions"
+                            :key="option.value"
+                            :value="option.value">
+                      {{ option.label }}
+                    </option>
+                  </b-select>
+                </b-field>
+
+                <b-field label="Subject">
+                  <b-input v-model.trim="editNoteSubject"
+                           :disabled="editNoteDelete">
+                  </b-input>
+                </b-field>
+
+                <b-field label="Text">
+                  <b-input v-model.trim="editNoteText"
+                           type="textarea"
+                           :disabled="editNoteDelete">
+                  </b-input>
+                </b-field>
+
+                <b-notification v-if="editNoteDelete"
+                                type="is-danger"
+                                :closable="false">
+                  Are you sure you wish to delete this note?
+                </b-notification>
+
+              </section>
+
+              <footer class="modal-card-foot">
+                <b-button :type="editNoteDelete ? 'is-danger' : 'is-primary'"
+                          @click="editNoteSave()"
+                          :disabled="editNoteSaving || (!editNoteDelete && !editNoteType)"
+                          icon-pack="fas"
+                          icon-left="save">
+                  {{ editNoteSaving ? "Working..." : (editNoteDelete ? "Delete" : "Save") }}
+                </b-button>
+                <b-button @click="editNoteShowDialog = false">
+                  Cancel
+                </b-button>
+              </footer>
 
-                  <div style="display: flex; justify-content: space-between; width: 100%;">
+            </div>
+          </b-modal>
+      % endif
 
-                    <div>
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
+    </div>
+  </script>
+</%def>
 
-                      <div class="field-wrapper id">
-                        <div class="field-row">
-                          <label>Username</label>
-                          <div class="field">
-                            ${user.username}
-                          </div>
-                        </div>
-                      </div>
+<%def name="render_notes_tab()">
+  <b-tab-item label="Notes"
+              value="notes"
+              icon-pack="fas"
+              :icon="tabchecks.notes ? 'check' : null">
+    <notes-tab ref="tab_notes"
+               :person="person"
+               @profile-changed="profileChanged">
+    </notes-tab>
+  </b-tab-item>
+</%def>
 
-                    </div>
+<%def name="render_user_tab_template()">
+  <script type="text/x-template" id="user-tab-template">
+    <div>
+      <div v-if="users.length">
 
-                    <div>
-                      % if request.has_perm('users.view'):
-                          ${h.link_to("View User", url('users.view', uuid=user.uuid), class_='button')}
-                      % endif
-                    </div>
+        <p>{{ person.display_name }} has <strong>{{ users.length }}</strong> user account{{ users.length == 1 ? '' : 's' }}</p>
+        <br />
+        <div id="users-accordion">
+
+          <b-collapse class="panel"
+                      v-for="user in users"
+                      :key="user.uuid">
+
+            <div slot="trigger"
+                 class="panel-heading"
+                 role="button">
+              <strong>{{ user.username }}</strong>
+            </div>
 
+            <div class="panel-block">
+              <div style="display: flex; justify-content: space-between; width: 100%;">
+
+                <div>
+                  <div class="field-wrapper id">
+                    <div class="field-row">
+                      <label>Username</label>
+                      <div class="field">
+                        {{ user.username }}
+                      </div>
+                    </div>
                   </div>
+                </div>
 
+                <div>
+                  % if request.has_perm('users.view'):
+                      <b-button tag="a" :href="user.view_url">
+                        View User
+                      </b-button>
+                  % endif
                 </div>
-              </b-collapse>
-          % endfor
+
+              </div>
+            </div>
+          </b-collapse>
         </div>
+      </div>
 
-    % else:
-        <p>${person} has never been a user.</p>
-    % endif
-  </b-tab-item><!-- User -->
+      <div v-if="!users.length">
+        <p>{{ person.display_name }} does not have a user account.</p>
+      </div>
+      <b-loading :active.sync="refreshingTab" :is-full-page="false"></b-loading>
+    </div>
+  </script>
+</%def>
+
+<%def name="render_user_tab()">
+  <b-tab-item label="User"
+              value="user"
+              icon-pack="fas"
+              :icon="tabchecks.user ? 'check' : null">
+    <user-tab ref="tab_user"
+              :person="person"
+              @profile-changed="profileChanged">
+    </user-tab>
+  </b-tab-item>
 </%def>
 
 <%def name="render_profile_tabs()">
   ${self.render_personal_tab()}
-  ${self.render_customer_tab()}
   ${self.render_member_tab()}
+  ${self.render_customer_tab()}
+  % if expose_customer_shoppers:
+      ${self.render_shopper_tab()}
+  % endif
   ${self.render_employee_tab()}
+  ${self.render_notes_tab()}
   ${self.render_user_tab()}
 </%def>
 
+<%def name="render_profile_info_extra_buttons()"></%def>
+
 <%def name="render_profile_info_template()">
   <script type="text/x-template" id="profile-info-template">
     <div>
+
+      ${self.render_profile_info_extra_buttons()}
+
       <b-tabs v-model="activeTab"
+              % if request.has_perm('people_profile.view_versions'):
+              v-show="!viewingHistory"
+              % endif
               type="is-boxed"
               @input="activeTabChanged">
         ${self.render_profile_tabs()}
       </b-tabs>
+
+      % if request.has_perm('people_profile.view_versions'):
+
+          ${revisions_grid.render_buefy_table_element(data_prop='revisions',
+                                                      show_footer=True,
+                                                      vshow='viewingHistory',
+                                                      loading='gettingRevisions')|n}
+
+          <b-modal :active.sync="showingRevisionDialog">
+
+            <div class="card">
+              <div class="card-content">
+
+                <div style="display: flex; justify-content: space-between;">
+
+                  <div>
+                    <b-field horizontal label="Changed">
+                      <div v-html="revision.changed"></div>
+                    </b-field>
+                    <b-field horizontal label="Changed by">
+                      <div v-html="revision.changed_by"></div>
+                    </b-field>
+                    <b-field horizontal label="IP Address">
+                      <div v-html="revision.remote_addr"></div>
+                    </b-field>
+                    <b-field horizontal label="Comment">
+                      <div v-html="revision.comment"></div>
+                    </b-field>
+                    <b-field horizontal label="TXN ID">
+                      <div v-html="revision.txnid"></div>
+                    </b-field>
+                  </div>
+
+                  <div>
+                    <div>
+                      <b-button @click="viewPrevRevision()"
+                                :disabled="!revision.prev_txnid">
+                        &laquo; Prev
+                      </b-button>
+                      <b-button @click="viewNextRevision()"
+                                :disabled="!revision.next_txnid">
+                        &raquo; Next
+                      </b-button>
+                    </div>
+                    <br />
+                    <b-button @click="toggleVersionFields()">
+                      {{ revisionShowAllFields ? "Show Diffs Only" : "Show All Fields" }}
+                    </b-button>
+                  </div>
+
+                </div>
+
+                <br />
+
+                <div v-for="version in revision.versions"
+                     :key="version.key">
+
+                  <p class="block has-text-weight-bold">
+                    {{ version.model_title }}
+                  </p>
+
+                  <table class="diff monospace is-size-7"
+                         :class="version.diff_class">
+                    <thead>
+                      <tr>
+                        <th>field name</th>
+                        <th>old value</th>
+                        <th>new value</th>
+                      </tr>
+                    </thead>
+                    <tbody>
+                      <tr v-for="field in version.fields"
+                          :key="field"
+                          :class="{diff: version.values[field].after != version.values[field].before}"
+                          v-show="revisionShowAllFields || version.values[field].after != version.values[field].before">
+                        <td class="field">{{ field }}</td>
+                        <td class="old-value" v-html="version.values[field].before"></td>
+                        <td class="new-value" v-html="version.values[field].after"></td>
+                      </tr>
+                    </tbody>
+                  </table>
+
+                  <br />
+                </div>
+
+              </div>
+            </div>
+          </b-modal>
+      % endif
+
     </div>
   </script>
 </%def>
 
 <%def name="render_this_page_template()">
   ${parent.render_this_page_template()}
   ${self.render_personal_tab_template()}
+  ${self.render_member_tab_template()}
+  ${self.render_customer_tab_template()}
+  % if expose_customer_shoppers:
+      ${self.render_shopper_tab_template()}
+  % endif
   ${self.render_employee_tab_template()}
+  ${self.render_notes_tab_template()}
+  ${self.render_user_tab_template()}
   ${self.render_profile_info_template()}
 </%def>
 
 <%def name="declare_personal_tab_vars()">
   <script type="text/javascript">
 
     let PersonalTabData = {
+        refreshTabURL: '${url('people.profile_tab_personal', uuid=person.uuid)}',
 
-        editNameShowDialog: false,
-        personFirstName: null,
-        personMiddleName: null,
-        personLastName: null,
-
-        editAddressShowDialog: false,
-        personStreet1: null,
-        personStreet2: null,
-        personCity: null,
-        personState: null,
-        personZipcode: null,
-        personInvalidAddress: false,
-
-        editPhoneShowDialog: false,
-        phoneUUID: null,
-        phoneType: null,
-        phoneNumber: null,
-        phonePreferred: false,
-        savingPhone: false,
-
-        editEmailShowDialog: false,
-        emailUUID: null,
-        emailType: null,
-        emailAddress: null,
-        emailPreferred: null,
-        emailInvalid: false,
-        editEmailSaving: false,
+        % if request.has_perm('people_profile.edit_person'):
+            editNameShowDialog: false,
+            editNameFirst: null,
+            % if use_preferred_first_name:
+                editNameFirstPreferred: null,
+            % endif
+            editNameMiddle: null,
+            editNameLast: null,
+
+            editAddressShowDialog: false,
+            editAddressStreet1: null,
+            editAddressStreet2: null,
+            editAddressCity: null,
+            editAddressState: null,
+            editAddressZipcode: null,
+            editAddressInvalid: false,
+
+            editPhoneShowDialog: false,
+            editPhoneUUID: null,
+            editPhoneType: null,
+            editPhoneNumber: null,
+            editPhonePreferred: false,
+            editPhoneSaving: false,
+
+            editEmailShowDialog: false,
+            editEmailUUID: null,
+            editEmailType: null,
+            editEmailAddress: null,
+            editEmailPreferred: null,
+            editEmailInvalid: false,
+            editEmailSaving: false,
+        % endif
     }
 
     let PersonalTab = {
         template: '#personal-tab-template',
-        mixins: [SubmitMixin],
+        mixins: [TabMixin, SimpleRequestMixin],
         props: {
             person: Object,
-            member: Object,
             phoneTypeOptions: Array,
             emailTypeOptions: Array,
             maxLengths: Object,
         },
         computed: {
+
             % if request.has_perm('people_profile.edit_person'):
-                editNameSaveDisabled: function() {
 
-                    // first and last name are required
-                    if (!this.personFirstName || !this.personLastName) {
+                editNameSaveDisabled: function() {
+                    if (!this.editNameFirst || !this.editNameLast) {
                         return true
                     }
-
-                    // otherwise don't disable; let user save
                     return false
                 },
 
                 editAddressSaveDisabled: function() {
-
                     // TODO: should require anything here?
-
-                    // otherwise don't disable; let user save
                     return false
                 },
 
-                editPhoneSaveText() {
-                    if (this.savingPhone) {
-                        return "Working..."
-                    }
-                    return "Save"
-                },
-
                 editPhoneSaveDisabled: function() {
-                    if (this.savingPhone) {
+                    if (this.editPhoneSaving) {
                         return true
                     }
-
-                    // phone type is required
-                    if (!this.phoneType) {
+                    if (!this.editPhoneType) {
                         return true
                     }
-
-                    // phone number is required
-                    if (!this.phoneNumber) {
+                    if (!this.editPhoneNumber) {
                         return true
                     }
-
-                    // otherwise don't disable; let user save
                     return false
                 },
 
-                editEmailSaveText() {
-                    if (this.editEmailSaving) {
-                        return "Working, please wait..."
-                    }
-                    return "Save"
-                },
-
                 editEmailSaveDisabled: function() {
-
-                    // disable if currently submitting form
                     if (this.editEmailSaving) {
                         return true
                     }
-
-                    // email type is required
-                    if (!this.emailType) {
+                    if (!this.editEmailType) {
                         return true
                     }
-
-                    // email address is required
-                    if (!this.emailAddress) {
+                    if (!this.editEmailAddress) {
                         return true
                     }
-
-                    // otherwise don't disable; let user save
                     return false
                 },
+
             % endif
         },
         methods: {
 
-            changeContentTitle(newTitle) {
-                this.$emit('change-content-title', newTitle)
-            },
+            // refreshTabSuccess(response) {},
 
             % if request.has_perm('people_profile.edit_person'):
 
                 editNameAllowed() {
                     return true
                 },
 
                 editNameInit() {
-                    this.personFirstName = this.person.first_name
-                    this.personMiddleName = this.person.middle_name
-                    this.personLastName = this.person.last_name
+                    this.editNameFirst = this.person.first_name
+                    % if use_preferred_first_name:
+                        this.editNameFirstPreferred = this.person.preferred_first_name
+                    % endif
+                    this.editNameMiddle = this.person.middle_name
+                    this.editNameLast = this.person.last_name
                     this.editNameShowDialog = true
                 },
 
                 editNameSave() {
                     let url = '${url('people.profile_edit_name', uuid=person.uuid)}'
-
                     let params = {
-                        first_name: this.personFirstName,
-                        middle_name: this.personMiddleName,
-                        last_name: this.personLastName,
+                        first_name: this.editNameFirst,
+                        % if use_preferred_first_name:
+                            preferred_first_name: this.editNameFirstPreferred,
+                        % endif
+                        middle_name: this.editNameMiddle,
+                        last_name: this.editNameLast,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.editNameShowDialog = false
-                        // TODO: not sure this is standard upstream, or just in bespoke?
-                        if (response.data.dynamic_content_title) {
-                            that.$emit('change-content-title', response.data.dynamic_content_title)
-                        }
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editNameShowDialog = false
+                        this.refreshTab()
                     })
                 },
 
                 editAddressInit() {
                     let address = this.person.address
-                    this.personStreet1 = address ? address.street : null
-                    this.personStreet2 = address ? address.street2 : null
-                    this.personCity = address ? address.city : null
-                    this.personState = address ? address.state : null
-                    this.personZipcode = address ? address.zipcode : null
-                    this.personInvalidAddress = address ? address.invalid : false
+                    this.editAddressStreet1 = address ? address.street : null
+                    this.editAddressStreet2 = address ? address.street2 : null
+                    this.editAddressCity = address ? address.city : null
+                    this.editAddressState = address ? address.state : null
+                    this.editAddressZipcode = address ? address.zipcode : null
+                    this.editAddressInvalid = address ? address.invalid : false
                     this.editAddressShowDialog = true
                 },
 
                 editAddressSave() {
                     let url = '${url('people.profile_edit_address', uuid=person.uuid)}'
-
                     let params = {
-                        street: this.personStreet1,
-                        street2: this.personStreet2,
-                        city: this.personCity,
-                        state: this.personState,
-                        zipcode: this.personZipcode,
-                        invalid: this.personInvalidAddress,
+                        street: this.editAddressStreet1,
+                        street2: this.editAddressStreet2,
+                        city: this.editAddressCity,
+                        state: this.editAddressState,
+                        zipcode: this.editAddressZipcode,
+                        invalid: this.editAddressInvalid,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.editAddressShowDialog = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editAddressShowDialog = false
+                        this.refreshTab()
                     })
                 },
 
                 addPhoneInit() {
                     this.editPhoneInit({
                         uuid: null,
                         type: 'Home',
                         number: null,
                         preferred: false,
                     })
                 },
 
                 editPhoneInit(phone) {
-                    this.phoneUUID = phone.uuid
-                    this.phoneType = phone.type
-                    this.phoneNumber = phone.number
-                    this.phonePreferred = phone.preferred
+                    this.editPhoneUUID = phone.uuid
+                    this.editPhoneType = phone.type
+                    this.editPhoneNumber = phone.number
+                    this.editPhonePreferred = phone.preferred
                     this.editPhoneShowDialog = true
                     this.$nextTick(function() {
                         this.$refs.editPhoneInput.focus()
                     })
                 },
 
                 editPhoneSave() {
-                    this.savingPhone = true
+                    this.editPhoneSaving = true
 
                     let url
                     let params = {
-                        phone_number: this.phoneNumber,
-                        phone_type: this.phoneType,
-                        phone_preferred: this.phonePreferred,
+                        phone_number: this.editPhoneNumber,
+                        phone_type: this.editPhoneType,
+                        phone_preferred: this.editPhonePreferred,
                     }
 
-                    if (this.phoneUUID) {
+                    // nb. create or update
+                    if (this.editPhoneUUID) {
                         url = '${url('people.profile_update_phone', uuid=person.uuid)}'
-                        params.phone_uuid = this.phoneUUID
+                        params.phone_uuid = this.editPhoneUUID
                     } else {
                         url = '${url('people.profile_add_phone', uuid=person.uuid)}'
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.editPhoneShowDialog = false
-                        that.savingPhone = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editPhoneShowDialog = false
+                        this.editPhoneSaving = false
+                        this.refreshTab()
+                    }, response => {
+                        this.editPhoneSaving = false
                     })
                 },
 
-                deletePhone(phone) {
+                deletePhoneInit(phone) {
                     let url = '${url('people.profile_delete_phone', uuid=person.uuid)}'
-
                     let params = {
                         phone_uuid: phone.uuid,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.$buefy.toast.open({
-                            message: "Phone number was deleted.",
-                            type: 'is-info',
-                            duration: 3000, // 3 seconds
-                        })
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.refreshTab()
                     })
                 },
 
-                setPreferredPhone(phone) {
+                preferPhoneInit(phone) {
                     let url = '${url('people.profile_set_preferred_phone', uuid=person.uuid)}'
-
                     let params = {
                         phone_uuid: phone.uuid,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.$buefy.toast.open({
-                            message: "Phone preference updated!",
-                            type: 'is-info',
-                            duration: 3000, // 3 seconds
-                        })
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.refreshTab()
                     })
                 },
 
                 addEmailInit() {
                     this.editEmailInit({
                         uuid: null,
                         type: 'Home',
                         address: null,
                         invalid: false,
                         preferred: false,
                     })
                 },
 
                 editEmailInit(email) {
-                    this.emailUUID = email.uuid
-                    this.emailType = email.type
-                    this.emailAddress = email.address
-                    this.emailInvalid = email.invalid
-                    this.emailPreferred = email.preferred
+                    this.editEmailUUID = email.uuid
+                    this.editEmailType = email.type
+                    this.editEmailAddress = email.address
+                    this.editEmailInvalid = email.invalid
+                    this.editEmailPreferred = email.preferred
                     this.editEmailShowDialog = true
                     this.$nextTick(function() {
                         this.$refs.editEmailInput.focus()
                     })
                 },
 
                 editEmailSave() {
                     this.editEmailSaving = true
 
                     let url = null
                     let params = {
-                        email_address: this.emailAddress,
-                        email_type: this.emailType,
+                        email_address: this.editEmailAddress,
+                        email_type: this.editEmailType,
                     }
 
-                    if (this.emailUUID) {
+                    if (this.editEmailUUID) {
                         url = '${url('people.profile_update_email', uuid=person.uuid)}'
-                        params.email_uuid = this.emailUUID
-                        params.email_invalid = this.emailInvalid
+                        params.email_uuid = this.editEmailUUID
+                        params.email_invalid = this.editEmailInvalid
                     } else {
                         url = '${url('people.profile_add_email', uuid=person.uuid)}'
-                        params.email_preferred = this.emailPreferred
+                        params.email_preferred = this.editEmailPreferred
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.editEmailShowDialog = false
-                        that.editEmailSaving = false
-                    }, function(error) {
-                        that.editEmailSaving = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editEmailShowDialog = false
+                        this.editEmailSaving = false
+                        this.refreshTab()
+                    }, response => {
+                        this.editEmailSaving = false
                     })
                 },
 
-                deleteEmail(email) {
+                deleteEmailInit(email) {
                     let url = '${url('people.profile_delete_email', uuid=person.uuid)}'
-
                     let params = {
                         email_uuid: email.uuid,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.$buefy.toast.open({
-                            message: "Email address was deleted.",
-                            type: 'is-info',
-                            duration: 3000, // 3 seconds
-                        })
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.refreshTab()
                     })
                 },
 
-                setPreferredEmail(email) {
+                preferEmailInit(email) {
                     let url = '${url('people.profile_set_preferred_email', uuid=person.uuid)}'
-
                     let params = {
                         email_uuid: email.uuid,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('person-updated', response.data.person)
-                        that.$buefy.toast.open({
-                            message: "Email preference updated!",
-                            type: 'is-info',
-                            duration: 3000, // 3 seconds
-                        })
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.refreshTab()
                     })
                 },
 
             % endif
         },
     }
 
@@ -1405,315 +1827,653 @@
 
     PersonalTab.data = function() { return PersonalTabData }
     Vue.component('personal-tab', PersonalTab)
 
   </script>
 </%def>
 
-<%def name="declare_employee_tab_vars()">
+<%def name="declare_member_tab_vars()">
   <script type="text/javascript">
 
-    let EmployeeTabData = {
+    let MemberTabData = {
+        refreshTabURL: '${url('people.profile_tab_member', uuid=person.uuid)}',
+        % if max_one_member:
+            member: {},
+        % else:
+            members: [],
+        % endif
+    }
 
-        startEmployeeShowDialog: false,
-        employeeID: null,
-        employeeStartDate: null,
-        showStopEmployeeDialog: false,
-        employeeEndDate: null,
-        employeeRevokeAccess: false,
-        showEditEmployeeHistoryDialog: false,
-        employeeHistoryUUID: null,
-        employeeHistoryStartDate: null,
-        employeeHistoryEndDate: null,
-        employeeHistoryEndDateRequired: false,
+    let MemberTab = {
+        template: '#member-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
+        props: {
+            person: Object,
+            phoneTypeOptions: Array,
+        },
+        computed: {},
+        methods: {
 
-        % if request.has_perm('employees.edit'):
-        showEditEmployeeIDDialog: false,
-        newEmployeeID: null,
-        updatingEmployeeID: false,
-        % endif
+            refreshTabSuccess(response) {
+                % if max_one_member:
+                    this.member = response.data.member
+                % else:
+                    this.members = response.data.members
+                % endif
+            },
+        },
     }
 
-    let EmployeeTab = {
-        template: '#employee-tab-template',
-        mixins: [SubmitMixin],
+  </script>
+</%def>
+
+<%def name="make_member_tab_component()">
+  ${self.declare_member_tab_vars()}
+  <script type="text/javascript">
+
+    MemberTab.data = function() { return MemberTabData }
+    Vue.component('member-tab', MemberTab)
+
+  </script>
+</%def>
+
+<%def name="declare_customer_tab_vars()">
+  <script type="text/javascript">
+
+    let CustomerTabData = {
+        refreshTabURL: '${url('people.profile_tab_customer', uuid=person.uuid)}',
+        customers: [],
+    }
+
+    let CustomerTab = {
+        template: '#customer-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
         props: {
-            employee: Object,
-            employeeHistory: Array,
+            person: Object,
         },
+        computed: {},
+        methods: {
 
-        computed: {
+            refreshTabSuccess(response) {
+                this.customers = response.data.customers
+            },
+        },
+    }
 
-            % if request.has_perm('employees.edit'):
+  </script>
+</%def>
 
-                editEmployeeIDSaveButtonText() {
-                    if (this.updatingEmployeeID) {
-                        return "Working, please wait..."
-                    }
-                    return "Save"
-                },
+<%def name="make_customer_tab_component()">
+  ${self.declare_customer_tab_vars()}
+  <script type="text/javascript">
 
-            % endif
+    CustomerTab.data = function() { return CustomerTabData }
+    Vue.component('customer-tab', CustomerTab)
+
+  </script>
+</%def>
+
+<%def name="declare_shopper_tab_vars()">
+  <script type="text/javascript">
+
+    let ShopperTabData = {
+        refreshTabURL: '${url('people.profile_tab_shopper', uuid=person.uuid)}',
+        shoppers: [],
+    }
+
+    let ShopperTab = {
+        template: '#shopper-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
+        props: {
+            person: Object,
+        },
+        computed: {},
+        methods: {
+
+            refreshTabSuccess(response) {
+                this.shoppers = response.data.shoppers
+            },
         },
+    }
+
+  </script>
+</%def>
+
+<%def name="make_shopper_tab_component()">
+  ${self.declare_shopper_tab_vars()}
+  <script type="text/javascript">
+
+    ShopperTab.data = function() { return ShopperTabData }
+    Vue.component('shopper-tab', ShopperTab)
 
+  </script>
+</%def>
+
+<%def name="declare_employee_tab_vars()">
+  <script type="text/javascript">
+
+    let EmployeeTabData = {
+        refreshTabURL: '${url('people.profile_tab_employee', uuid=person.uuid)}',
+        employee: {},
+        employeeHistory: [],
+
+        % if request.has_perm('employees.edit'):
+            editEmployeeIdShowDialog: false,
+            editEmployeeIdValue: null,
+            editEmployeeIdSaving: false,
+        % endif
+
+        % if request.has_perm('people_profile.toggle_employee'):
+            startEmployeeShowDialog: false,
+            startEmployeeID: null,
+            startEmployeeStartDate: null,
+
+            stopEmployeeShowDialog: false,
+            stopEmployeeEndDate: null,
+            stopEmployeeRevokeAccess: false,
+        % endif
+
+        % if request.has_perm('people_profile.edit_employee_history'):
+            editEmployeeHistoryShowDialog: false,
+            editEmployeeHistoryUUID: null,
+            editEmployeeHistoryStartDate: null,
+            editEmployeeHistoryEndDate: null,
+            editEmployeeHistoryEndDateRequired: false,
+        % endif
+    }
+
+    let EmployeeTab = {
+        template: '#employee-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
+        props: {
+            person: Object,
+        },
+        computed: {},
         methods: {
 
-            changeContentTitle(newTitle) {
-                this.$emit('change-content-title', newTitle)
+            refreshTabSuccess(response) {
+                this.employee = response.data.employee
+                this.employeeHistory = response.data.employee_history
             },
 
             % if request.has_perm('employees.edit'):
 
-                initEditEmployeeID() {
-                    this.newEmployeeID = this.employee.id
-                    this.updatingEmployeeID = false
-                    this.showEditEmployeeIDDialog = true
+                editEmployeeIdInit() {
+                    this.editEmployeeIdValue = this.employee.id
+                    this.editEmployeeIdShowDialog = true
                 },
 
-                updateEmployeeID() {
-                    this.updatingEmployeeID = true
-
+                editEmployeeIdSave() {
+                    this.editEmployeeIdSaving = true
                     let url = '${url('people.profile_update_employee_id', uuid=instance.uuid)}'
-
                     let params = {
-                        'employee_id': this.newEmployeeID,
+                        'employee_id': this.editEmployeeIdValue,
                     }
-
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('employee-updated', response.data.employee)
-                        that.showEditEmployeeIDDialog = false
-                        that.updatingEmployeeID = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editEmployeeIdShowDialog = false
+                        this.editEmployeeIdSaving = false
+                        this.refreshTab()
+                    }, response => {
+                        this.editEmployeeIdSaving = false
                     })
                 },
 
             % endif
 
             % if request.has_perm('people_profile.toggle_employee'):
 
                 startEmployeeInit() {
-                    this.employeeID = this.employee.id || null
+                    this.startEmployeeID = this.employee.id || null
+                    this.startEmployeeStartDate = null
                     this.startEmployeeShowDialog = true
                 },
 
-                startEmployee() {
+                startEmployeeSave() {
                     let url = '${url('people.profile_start_employee', uuid=person.uuid)}'
-
                     let params = {
-                        id: this.employeeID,
-                        start_date: this.employeeStartDate,
+                        id: this.startEmployeeID,
+                        start_date: this.startEmployeeStartDate,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.startEmployeeSuccess(response.data)
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.startEmployeeShowDialog = false
+                        this.refreshTab()
                     })
                 },
 
-                startEmployeeSuccess(data) {
-                    this.$emit('employee-updated', data.employee)
-                    this.$emit('employee-history-updated', data.employee_history_data)
-                    this.$emit('change-content-title', data.dynamic_content_title)
+                stopEmployeeInit() {
+                    this.stopEmployeeShowDialog = true
+                },
 
-                    // let derived component do more here if needed
-                    this.startEmployeeSuccessExtra(data)
+                stopEmployeeSave() {
+                    let url = '${url('people.profile_end_employee', uuid=person.uuid)}'
+                    let params = {
+                        end_date: this.stopEmployeeEndDate,
+                        revoke_access: this.stopEmployeeRevokeAccess,
+                    }
 
-                    this.startEmployeeShowDialog = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.stopEmployeeShowDialog = false
+                        this.refreshTab()
+                    })
                 },
 
-                startEmployeeSuccessExtra(data) {},
+            % endif
 
-                endEmployee() {
-                    let url = '${url('people.profile_end_employee', uuid=person.uuid)}'
+            % if request.has_perm('people_profile.edit_employee_history'):
 
+                editEmployeeHistoryInit(row) {
+                    this.editEmployeeHistoryUUID = row.uuid
+                    this.editEmployeeHistoryStartDate = row.start_date
+                    this.editEmployeeHistoryEndDate = row.end_date
+                    this.editEmployeeHistoryEndDateRequired = !!row.end_date
+                    this.editEmployeeHistoryShowDialog = true
+                },
+
+                editEmployeeHistorySave() {
+                    let url = '${url('people.profile_edit_employee_history', uuid=person.uuid)}'
                     let params = {
-                        end_date: this.employeeEndDate,
-                        revoke_access: this.employeeRevokeAccess,
+                        uuid: this.editEmployeeHistoryUUID,
+                        start_date: this.editEmployeeHistoryStartDate,
+                        end_date: this.editEmployeeHistoryEndDate,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.endEmployeeSuccess(response.data)
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editEmployeeHistoryShowDialog = false
+                        this.refreshTab()
                     })
                 },
 
-                endEmployeeSuccess(data) {
-                    this.$emit('employee-updated', data.employee)
-                    this.$emit('employee-history-updated', data.employee_history_data)
-                    this.$emit('change-content-title', data.dynamic_content_title)
+            % endif
+        },
+    }
+
+  </script>
+</%def>
+
+<%def name="make_employee_tab_component()">
+  ${self.declare_employee_tab_vars()}
+  <script type="text/javascript">
+
+    EmployeeTab.data = function() { return EmployeeTabData }
+    Vue.component('employee-tab', EmployeeTab)
+
+  </script>
+</%def>
+
+<%def name="declare_notes_tab_vars()">
+  <script type="text/javascript">
+
+    let NotesTabData = {
+        refreshTabURL: '${url('people.profile_tab_notes', uuid=person.uuid)}',
+        notes: [],
+        noteTypeOptions: [],
+
+        % if request.has_any_perm('people_profile.add_note', 'people_profile.edit_note', 'people_profile.delete_note'):
+            editNoteShowDialog: false,
+            editNoteUUID: null,
+            editNoteDelete: false,
+            editNoteType: null,
+            editNoteSubject: null,
+            editNoteText: null,
+            editNoteSaving: false,
+        % endif
+    }
+
+    let NotesTab = {
+        template: '#notes-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
+        props: {
+            person: Object,
+        },
+        computed: {},
+        methods: {
+
+            refreshTabSuccess(response) {
+                this.notes = response.data.notes
+                this.noteTypeOptions = response.data.note_types
+            },
 
-                    // let derived component do more here if needed
-                    this.startEmployeeSuccessExtra(data)
+            % if request.has_perm('people_profile.add_note'):
 
-                    this.showStopEmployeeDialog = false
+                addNoteInit() {
+                    this.editNoteUUID = null
+                    this.editNoteType = null
+                    this.editNoteSubject = null
+                    this.editNoteText = null
+                    this.editNoteDelete = false
+                    this.editNoteShowDialog = true
                 },
 
-                endEmployeeSuccessExtra(data) {},
+            % endif
+
+            % if request.has_perm('people_profile.edit_note'):
+
+                editNoteInit(note) {
+                    this.editNoteUUID = note.uuid
+                    this.editNoteType = note.note_type
+                    this.editNoteSubject = note.subject
+                    this.editNoteText = note.text
+                    this.editNoteDelete = false
+                    this.editNoteShowDialog = true
+                },
 
             % endif
 
-            % if request.has_perm('people_profile.edit_employee_history'):
+            % if request.has_perm('people_profile.delete_note'):
 
-                editEmployeeHistory(row) {
-                    this.employeeHistoryUUID = row.uuid
-                    this.employeeHistoryStartDate = row.start_date
-                    this.employeeHistoryEndDate = row.end_date
-                    this.employeeHistoryEndDateRequired = !!row.end_date
-                    this.showEditEmployeeHistoryDialog = true
+                deleteNoteInit(note) {
+                    this.editNoteUUID = note.uuid
+                    this.editNoteType = note.note_type
+                    this.editNoteSubject = note.subject
+                    this.editNoteText = note.text
+                    this.editNoteDelete = true
+                    this.editNoteShowDialog = true
                 },
 
-                saveEmployeeHistory() {
-                    let url = '${url('people.profile_edit_employee_history', uuid=person.uuid)}'
+            % endif
+
+            % if request.has_any_perm('people_profile.add_note', 'people_profile.edit_note', 'people_profile.delete_note'):
+
+                editNoteSave() {
+                    this.editNoteSaving = true
+
+                    let url = null
+                    if (!this.editNoteUUID) {
+                        url = '${master.get_action_url('profile_add_note', instance)}'
+                    } else if (this.editNoteDelete) {
+                        url = '${master.get_action_url('profile_delete_note', instance)}'
+                    } else {
+                        url = '${master.get_action_url('profile_edit_note', instance)}'
+                    }
 
                     let params = {
-                        uuid: this.employeeHistoryUUID,
-                        start_date: this.employeeHistoryStartDate,
-                        end_date: this.employeeHistoryEndDate,
+                        uuid: this.editNoteUUID,
+                        note_type: this.editNoteType,
+                        note_subject: this.editNoteSubject,
+                        note_text: this.editNoteText,
                     }
 
-                    let that = this
-                    this.submitData(url, params, function(response) {
-                        that.$emit('employee-updated', response.data.employee)
-                        that.$emit('employee-history-updated', response.data.employee_history_data)
-                        that.showEditEmployeeHistoryDialog = false
+                    this.simplePOST(url, params, response => {
+                        this.$emit('profile-changed', response.data)
+                        this.editNoteSaving = false
+                        this.editNoteShowDialog = false
+                        this.refreshTab()
+                    }, response => {
+                        this.editNoteSaving = false
                     })
                 },
 
             % endif
         },
     }
 
   </script>
 </%def>
 
-<%def name="make_employee_tab_component()">
-  ${self.declare_employee_tab_vars()}
+<%def name="make_notes_tab_component()">
+  ${self.declare_notes_tab_vars()}
   <script type="text/javascript">
 
-    EmployeeTab.data = function() { return EmployeeTabData }
-    Vue.component('employee-tab', EmployeeTab)
+    NotesTab.data = function() { return NotesTabData }
+    Vue.component('notes-tab', NotesTab)
+
+  </script>
+</%def>
+
+<%def name="declare_user_tab_vars()">
+  <script type="text/javascript">
+
+    let UserTabData = {
+        refreshTabURL: '${url('people.profile_tab_user', uuid=person.uuid)}',
+        users: [],
+    }
+
+    let UserTab = {
+        template: '#user-tab-template',
+        mixins: [TabMixin, SimpleRequestMixin],
+        props: {
+            person: Object,
+        },
+        computed: {},
+        methods: {
+
+            refreshTabSuccess(response) {
+                this.users = response.data.users
+            },
+        },
+    }
+
+  </script>
+</%def>
+
+<%def name="make_user_tab_component()">
+  ${self.declare_user_tab_vars()}
+  <script type="text/javascript">
+
+    UserTab.data = function() { return UserTabData }
+    Vue.component('user-tab', UserTab)
 
   </script>
 </%def>
 
 <%def name="declare_profile_info_vars()">
   <script type="text/javascript">
 
     let ProfileInfoData = {
         activeTab: location.hash ? location.hash.substring(1) : undefined,
+        tabchecks: ${json.dumps(tabchecks)|n},
+        today: '${rattail_app.today()}',
+        profileLastChanged: Date.now(),
         person: ${json.dumps(person_data)|n},
-        customers: ${json.dumps(customers_data)|n},
-        member: null,           // TODO
-        members: ${json.dumps(members_data)|n},
-        employee: ${json.dumps(employee_data)|n},
-        employeeHistory: ${json.dumps(employee_history_data)|n},
         phoneTypeOptions: ${json.dumps(phone_type_options)|n},
         emailTypeOptions: ${json.dumps(email_type_options)|n},
         maxLengths: ${json.dumps(max_lengths)|n},
+
+        % if request.has_perm('people_profile.view_versions'):
+            loadingRevisions: false,
+            showingRevisionDialog: false,
+            revision: {},
+            revisionShowAllFields: false,
+        % endif
     }
 
     let ProfileInfo = {
         template: '#profile-info-template',
-        mixins: [FormPosterMixin],
+        props: {
+            % if request.has_perm('people_profile.view_versions'):
+                viewingHistory: Boolean,
+                gettingRevisions: Boolean,
+                revisions: Array,
+                revisionVersionMap: null,
+            % endif
+        },
         computed: {},
-        methods: {
-
-            personUpdated(person) {
-                this.person = person
-            },
+        mounted() {
 
-            employeeUpdated(employee) {
-                this.employee = employee
-            },
-
-            employeeHistoryUpdated(employeeHistory) {
-                this.employeeHistory = employeeHistory
-            },
+            // auto-refresh whichever tab is shown first
+            ## TODO: how to not assume 'personal' is the default tab?
+            let tab = this.$refs['tab_' + (this.activeTab || 'personal')]
+            if (tab && tab.refreshTab) {
+                tab.refreshTab()
+            }
+        },
+        methods: {
 
-            changeContentTitle(newTitle) {
-                this.$emit('change-content-title', newTitle)
+            profileChanged(data) {
+                this.$emit('change-content-title', data.person.dynamic_content_title)
+                this.person = data.person
+                this.tabchecks = data.tabchecks
+                this.profileLastChanged = Date.now()
             },
 
             activeTabChanged(value) {
                 location.hash = value
+                this.refreshTabIfNeeded(value)
                 this.activeTabChangedExtra(value)
             },
 
+            refreshTabIfNeeded(key) {
+                // TODO: this is *always* refreshing, should be more selective (?)
+                let tab = this.$refs['tab_' + key]
+                if (tab && tab.refreshIfNeeded) {
+                    tab.refreshIfNeeded(this.profileLastChanged)
+                }
+            },
+
             activeTabChangedExtra(value) {},
+
+            % if request.has_perm('people_profile.view_versions'):
+
+                viewRevision(row) {
+                    this.revision = this.revisionVersionMap[row.txnid]
+                    this.showingRevisionDialog = true
+                },
+
+                viewPrevRevision() {
+                    let txnid = this.revision.prev_txnid
+                    this.revision = this.revisionVersionMap[txnid]
+                },
+
+                viewNextRevision() {
+                    let txnid = this.revision.next_txnid
+                    this.revision = this.revisionVersionMap[txnid]
+                },
+
+                toggleVersionFields() {
+                    this.revisionShowAllFields = !this.revisionShowAllFields
+                },
+
+            % endif
         },
     }
 
   </script>
 </%def>
 
 <%def name="make_profile_info_component()">
   ${self.declare_profile_info_vars()}
   <script type="text/javascript">
 
     ProfileInfo.data = function() { return ProfileInfoData }
-
     Vue.component('profile-info', ProfileInfo)
 
   </script>
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
-    ThisPage.methods.changeContentTitle = function(newTitle) {
-        this.$emit('change-content-title', newTitle)
-    }
+    % if request.has_perm('people_profile.view_versions'):
+        ThisPage.props.viewingHistory = Boolean
+        ThisPage.props.gettingRevisions = Boolean
+        ThisPage.props.revisions = Array
+        ThisPage.props.revisionVersionMap = null
+    % endif
+
+    let TabMixin = {
 
-    var SubmitMixin = {
         data() {
             return {
-                csrftoken: ${json.dumps(request.session.get_csrf_token() or request.session.new_csrf_token())|n},
+                refreshed: null,
+                refreshTabURL: null,
+                refreshingTab: false,
             }
         },
-
         methods: {
-            submitData(url, params, success, failure) {
-                let headers = {
-                    'X-CSRF-TOKEN': this.csrftoken,
+
+            refreshIfNeeded(time) {
+                if (this.refreshed && time && this.refreshed > time) {
+                    return
                 }
-                this.$http.post(url, params, {headers: headers}).then((response) => {
-                    if (response.data.success) {
-                        if (success) {
-                            success(response)
-                        }
-                    } else {
-                        this.$buefy.toast.open({
-                            message: "Save failed:  " + (response.data.error || "(unknown error)"),
-                            type: 'is-danger',
-                            duration: 4000, // 4 seconds
-                        })
-                        if (failure) {
-                            failure()
-                        }
-                    }
-                }).catch((error) => {
-                    this.$buefy.toast.open({
-                        message: "Save failed:  (unknown error)",
-                        type: 'is-danger',
-                        duration: 4000, // 4 seconds
+                this.refreshTab()
+            },
+
+            refreshTab() {
+
+                if (this.refreshTabURL) {
+                    this.refreshingTab = true
+                    this.simpleGET(this.refreshTabURL, {}, response => {
+                        this.refreshTabSuccess(response)
+                        this.refreshTabSuccessExtra(response)
+                        this.refreshed = Date.now()
+                        this.refreshingTab = false
                     })
-                    if (failure) {
-                        failure()
-                    }
-                })
+                }
             },
+
+            // nb. subclass must define this as needed
+            refreshTabSuccess(response) {},
+
+            // nb. subclass may define this if needed
+            refreshTabSuccessExtra(response) {},
         },
     }
 
   </script>
 </%def>
 
 <%def name="make_this_page_component()">
   ${parent.make_this_page_component()}
   ${self.make_personal_tab_component()}
+  ${self.make_member_tab_component()}
+  ${self.make_customer_tab_component()}
+  % if expose_customer_shoppers:
+      ${self.make_shopper_tab_component()}
+  % endif
   ${self.make_employee_tab_component()}
+  ${self.make_notes_tab_component()}
+  ${self.make_user_tab_component()}
   ${self.make_profile_info_component()}
 </%def>
 
+<%def name="modify_whole_page_vars()">
+  ${parent.modify_whole_page_vars()}
+
+  % if request.has_perm('people_profile.view_versions'):
+      <script type="text/javascript">
+
+        WholePageData.viewingHistory = false
+        WholePageData.gettingRevisions = false
+        WholePageData.gotRevisions = false
+        WholePageData.revisions = []
+        WholePageData.revisionVersionMap = null
+
+        WholePage.methods.viewHistory = function() {
+            this.viewingHistory = true
+
+            if (!this.gotRevisions && !this.gettingRevisions) {
+                this.getRevisions()
+            }
+        }
+
+        WholePage.methods.refreshHistory = function() {
+            if (!this.gettingRevisions) {
+                this.getRevisions()
+            }
+        }
+
+        WholePage.methods.getRevisions = function() {
+            this.gettingRevisions = true
+
+            let url = '${url('people.view_profile_revisions', uuid=person.uuid)}'
+            this.simpleGET(url, {}, response => {
+                this.revisions = response.data.data
+                this.revisionVersionMap = response.data.vmap
+                this.gotRevisions = true
+                this.gettingRevisions = false
+            }, response => {
+                this.gettingRevisions = false
+            })
+        }
+
+      </script>
+  % endif
+</%def>
+
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,20 +1,41 @@
 ## -*- coding: utf-8; -*- <%inherit file="/master/view.mako" /> <%def
 name="extra_styles()"> ${parent.extra_styles()}
 def> <%def name="content_title()"> ${dynamic_content_title}
+def> <%def name="render_instance_header_title_extras()"> % if request.has_perm
+('people_profile.view_versions'):
+click="viewHistory()"> View History
+click="viewingHistory = false"> View Profile
+click="refreshHistory()" :disabled="gettingRevisions"> {{ gettingRevisions ?
+"Working, please wait..." : "Refresh History" }}
+% endif
 def> <%def name="page_content()">
-change-content-title="changeContentTitle">
+change-content-title="changeContentTitle" % if request.has_perm
+('people_profile.view_versions'): :viewing-history="viewingHistory" :getting-
+revisions="gettingRevisions" :revisions="revisions" :revision-version-
+map="revisionVersionMap" % endif >
+def> <%def name="render_this_page_component()"> ## TODO: should override this
+in a cleaner way! too much duplicate code w/ parent template
+change-content-title="changeContentTitle" % if can_edit_help: :configure-
+fields-help="configureFieldsHelp" % endif % if request.has_perm
+('people_profile.view_versions'): :viewing-history="viewingHistory" :getting-
+revisions="gettingRevisions" :revisions="revisions" :revision-version-
+map="revisionVersionMap" % endif >
 def> <%def name="render_this_page()"> ${self.page_content()}
 def> <%def name="render_personal_name_card()">
 Name
-{{ person.first_name }} {{ person.middle_name }} {{ person.last_name }}
+{{ person.first_name }} % if use_preferred_first_name: {
+{ person.preferred_first_name }} % endif {{ person.middle_name }} {
+{ person.last_name }}
 % if request.has_perm('people_profile.edit_person'):
 click="editNameInit()" icon-pack="fas" icon-left="edit"> Edit Name
 Edit Name
-maxlength="maxLengths.person_first_name || null">
+maxlength="maxLengths.person_first_name || null"> % if
+use_preferred_first_name:
+maxlength="maxLengths.person_preferred_first_name || null"> % endif
 maxlength="maxLengths.person_middle_name || null">
 maxlength="maxLengths.person_last_name || null">
 click="editNameSave()" :disabled="editNameSaveDisabled" icon-left="save"
 text="Save">
 click="editNameShowDialog = false"> Cancel
 % endif
 def> <%def name="render_personal_address_card()">
@@ -36,124 +57,119 @@
 click="editAddressShowDialog = false"> Cancel
 % endif
 def> <%def name="render_personal_phone_card()">
 Phone(s)
 closable="false"> We appear to have an invalid phone number on file for this
 person. % if request.has_perm('people_profile.edit_person'):
 click="addPhoneInit()"> Add Phone
-{{ phoneUUID ? "Edit Phone" : "Add Phone" }}
+{{ editPhoneUUID ? "Edit" : "Add" }} Phone
 key="option.value" :value="option.value"> {{ option.label }}
 click="editPhoneSave()" :disabled="editPhoneSaveDisabled" icon-pack="fas" icon-
-left="save"> {{ editPhoneSaveText }}
+left="save"> {{ editPhoneSaving ? "Working..." : "Save" }}
 click="editPhoneShowDialog = false"> Cancel
 % endif
 data="person.phones"> {{ props.row.preferred ? "Yes" : "" }} {{ props.row.type
 }} {{ props.row.number }} % if request.has_perm('people_profile.edit_person'):
 click.prevent="editPhoneInit(props.row)"> Edit
-click.prevent="deletePhone(props.row)" class="has-text-danger"> Delete
-click.prevent="setPreferredPhone(props.row)" v-if="!props.row.preferred"> Set
+click.prevent="deletePhoneInit(props.row)" class="has-text-danger"> Delete
+click.prevent="preferPhoneInit(props.row)" v-if="!props.row.preferred"> Set
 Preferred
 % endif
 def> <%def name="render_personal_email_card()">
 Email(s)
 % if request.has_perm('people_profile.edit_person'):
 click="addEmailInit()"> Add Email
-{{ emailUUID ? "Edit Email" : "Add Email" }}
+{{ editEmailUUID ? "Edit" : "Add" }} Email
 key="option.value" :value="option.value"> {{ option.label }}
-type="emailInvalid ? 'is-danger': null">
+type="editEmailInvalid ? 'is-danger': null">
 click="editEmailSave()" :disabled="editEmailSaveDisabled" icon-pack="fas" icon-
-left="save"> {{ editEmailSaveText }}
+left="save"> {{ editEmailSaving ? "Working, please wait..." : "Save" }}
 click="editEmailShowDialog = false"> Cancel
 % endif
 data="person.emails"> {{ props.row.preferred ? "Yes" : "" }} {{ props.row.type
 }} {{ props.row.address }} Invalid % if request.has_perm
 ('people_profile.edit_person'):
 click.prevent="editEmailInit(props.row)"> Edit
-click.prevent="deleteEmail(props.row)" class="has-text-danger"> Delete
-click.prevent="setPreferredEmail(props.row)" v-if="!props.row.preferred"> Set
+click.prevent="deleteEmailInit(props.row)" class="has-text-danger"> Delete
+click.prevent="preferEmailInit(props.row)" v-if="!props.row.preferred"> Set
 Preferred
 % endif
 def> <%def name="render_personal_tab_cards()"> ${self.render_personal_name_card
 ()} ${self.render_personal_address_card()} ${self.render_personal_phone_card()}
 ${self.render_personal_email_card()}
 def> <%def name="render_personal_tab_template()">
 def> <%def name="render_personal_tab()">
-person="person" :member="member" :max-lengths="maxLengths" :phone-type-
-options="phoneTypeOptions" :email-type-options="emailTypeOptions" @person-
-updated="personUpdated" @change-content-title="changeContentTitle">
+icon="tabchecks.personal ? 'check' : null">
+person="person" @profile-changed="profileChanged" :phone-type-
+options="phoneTypeOptions" :email-type-options="emailTypeOptions" :max-
+lengths="maxLengths">
+def> <%def name="render_member_tab_template()">
 def> <%def name="render_member_tab()">
-icon="members.length ? 'check' : null">
-{{ person.display_name }} is associated with {{{{ mmeemmbbeerrss..lleennggtthh }}}} member
-account(s)
-
-key="member.uuid" class="panel" :open="members.length == 1">
-##{{{{ mmeemmbbeerr..nnuummbbeerr }}}} {{{{ mmeemmbbeerr..ddiissppllaayy }}}}
-{{ member.number }} {{ member.id }} {{ member.active }} {{ member.joined }} {
-{ member.withdrew }}
-href="member.view_profile_url"> {{ member.person_display_name }}
-{{ member.person_display_name }}
-${self.render_member_panel_buttons(member)}
-{{ person.display_name }} has never had a member account.
-def> <%def name="render_member_panel_buttons(member)"> % for button in
-member_xref_buttons: ${button} % endfor % if request.has_perm('members.view'):
-href="member.view_url"> View Member % endif
+icon="tabchecks.member ? 'check' : null">
+person="person" @profile-changed="profileChanged" :phone-type-
+options="phoneTypeOptions">
+def> <%def name="render_customer_tab_template()">
 def> <%def name="render_customer_tab()">
-icon="customers.length ? 'check' : null">
-{{ person.display_name }} is associated with {{{{ ccuussttoommeerrss..lleennggtthh }}}} customer
-account(s)
-
-key="customer.uuid" class="panel" :open="customers.length == 1">
-##{{{{ ccuussttoommeerr..nnuummbbeerr }}}} {{{{ ccuussttoommeerr..nnaammee }}}}
-{{ customer.number }} {{ customer.id }} {{ customer.name }}
-    * key="p.uuid">
-    * href="p.view_profile_url"> {{ p.display_name }}
-{{ p.display_name }}
-key="address.uuid"> {{ address.display }}
-${self.render_customer_panel_buttons(customer)}
-{{ person.display_name }} has never had a customer account.
-def> <%def name="render_customer_panel_buttons(customer)"> % for button in
-customer_xref_buttons: ${button} % endfor % if request.has_perm
-('customers.view'):
-href="customer.view_url"> View Customer % endif
+icon="tabchecks.customer ? 'check' : null">
+person="person" @profile-changed="profileChanged">
+def> <%def name="render_shopper_tab_template()">
+def> <%def name="render_shopper_tab()">
+icon="tabchecks.shopper ? 'check' : null">
+person="person" @profile-changed="profileChanged">
 def> <%def name="render_employee_tab_template()">
 def> <%def name="render_employee_tab()">
-icon="employee.current ? 'check' : null">
-employee="employee" :employee-history="employeeHistory" @employee-
-updated="employeeUpdated" @employee-history-updated="employeeHistoryUpdated"
-@change-content-title="changeContentTitle">
+icon="tabchecks.employee ? 'check' : null">
+person="person" @profile-changed="profileChanged">
+def> <%def name="render_notes_tab_template()">
+def> <%def name="render_notes_tab()">
+icon="tabchecks.notes ? 'check' : null">
+person="person" @profile-changed="profileChanged">
+def> <%def name="render_user_tab_template()">
 def> <%def name="render_user_tab()">
-{'icon="check" icon-pack="fas"' if person.users else ''|n}> % if person.users:
-${person} is associated with $${{lleenn((ppeerrssoonn..uusseerrss))}} user account(s)
-
-% for user in person.users:
-# TODO: what's up with aria-id here? ## aria-id="contentIdForA11y2" >
-# TODO: what's up with aria-id here? ## aria-controls="contentIdForA11y2" > $$
-{{uusseerr..uusseerrnnaammee}}
-Username
-${user.username}
-% if request.has_perm('users.view'): ${h.link_to("View User", url('users.view',
-uuid=user.uuid), class_='button')} % endif
-% endfor
-% else:
-${person} has never been a user.
-% endif
+icon="tabchecks.user ? 'check' : null">
+person="person" @profile-changed="profileChanged">
 def> <%def name="render_profile_tabs()"> ${self.render_personal_tab()} $
-{self.render_customer_tab()} ${self.render_member_tab()} $
-{self.render_employee_tab()} ${self.render_user_tab()}
+{self.render_member_tab()} ${self.render_customer_tab()} % if
+expose_customer_shoppers: ${self.render_shopper_tab()} % endif $
+{self.render_employee_tab()} ${self.render_notes_tab()} ${self.render_user_tab
+()}
+def> <%def name="render_profile_info_extra_buttons()">
 def> <%def name="render_profile_info_template()">
 def> <%def name="render_this_page_template()"> $
 {parent.render_this_page_template()} ${self.render_personal_tab_template()} $
-{self.render_employee_tab_template()} ${self.render_profile_info_template()}
+{self.render_member_tab_template()} ${self.render_customer_tab_template()} % if
+expose_customer_shoppers: ${self.render_shopper_tab_template()} % endif $
+{self.render_employee_tab_template()} ${self.render_notes_tab_template()} $
+{self.render_user_tab_template()} ${self.render_profile_info_template()}
 def> <%def name="declare_personal_tab_vars()">
 def> <%def name="make_personal_tab_component()"> $
 {self.declare_personal_tab_vars()}
+def> <%def name="declare_member_tab_vars()">
+def> <%def name="make_member_tab_component()"> ${self.declare_member_tab_vars
+()}
+def> <%def name="declare_customer_tab_vars()">
+def> <%def name="make_customer_tab_component()"> $
+{self.declare_customer_tab_vars()}
+def> <%def name="declare_shopper_tab_vars()">
+def> <%def name="make_shopper_tab_component()"> ${self.declare_shopper_tab_vars
+()}
 def> <%def name="declare_employee_tab_vars()">
 def> <%def name="make_employee_tab_component()"> $
 {self.declare_employee_tab_vars()}
+def> <%def name="declare_notes_tab_vars()">
+def> <%def name="make_notes_tab_component()"> ${self.declare_notes_tab_vars()}
+def> <%def name="declare_user_tab_vars()">
+def> <%def name="make_user_tab_component()"> ${self.declare_user_tab_vars()}
 def> <%def name="declare_profile_info_vars()">
 def> <%def name="make_profile_info_component()"> $
 {self.declare_profile_info_vars()}
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> <%def name="make_this_page_component()"> ${parent.make_this_page_component
-()} ${self.make_personal_tab_component()} ${self.make_employee_tab_component()}
-${self.make_profile_info_component()}
+()} ${self.make_personal_tab_component()} ${self.make_member_tab_component()} $
+{self.make_customer_tab_component()} % if expose_customer_shoppers: $
+{self.make_shopper_tab_component()} % endif ${self.make_employee_tab_component
+()} ${self.make_notes_tab_component()} ${self.make_user_tab_component()} $
+{self.make_profile_info_component()}
+def> <%def name="modify_whole_page_vars()"> ${parent.modify_whole_page_vars()}
+% if request.has_perm('people_profile.view_versions'):
+% endif
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/people/view.mako` & `Tailbone-0.9.90/tailbone/templates/people/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/people/merge-requests/view.mako` & `Tailbone-0.9.90/tailbone/templates/people/merge-requests/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/people/index.mako` & `Tailbone-0.9.90/tailbone/templates/people/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/home.mako` & `Tailbone-0.9.90/tailbone/templates/home.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/tempmon/dashboard.mako` & `Tailbone-0.9.90/tailbone/templates/tempmon/dashboard.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/tempmon/probes/graph.mako` & `Tailbone-0.9.90/tailbone/templates/tempmon/probes/graph.mako`

 * *Files 8% similar despite different names*

```diff
@@ -35,15 +35,21 @@
         <b-field horizontal label="Probe Location">
           <div>
             ${probe.location or ""}
           </div>
         </b-field>
 
         <b-field horizontal label="Showing">
-          ${time_range}
+          <b-select v-model="currentTimeRange"
+                    @input="timeRangeChanged">
+            <option value="last hour">Last Hour</option>
+            <option value="last 6 hours">Last 6 Hours</option>
+            <option value="last day">Last Day</option>
+            <option value="last week">Last Week</option>
+          </b-select>
         </b-field>
 
       </div>
     </div>
 
     <div style="display: flex; align-items: flex-start;">
       <div class="object-helpers">
@@ -82,15 +88,17 @@
             timeUnit = 'day'
         }
 
         if (this.chart) {
             this.chart.destroy()
         }
 
-        this.$http.get('${url('{}.graph_readings'.format(route_prefix), uuid=probe.uuid)}', {params: {'time-range': timeRange}}).then(({ data }) => {
+        let url = '${url(f'{route_prefix}.graph_readings', uuid=probe.uuid)}'
+        let params = {'time-range': timeRange}
+        this.$http.get(url, {params: params}).then(({ data }) => {
 
             this.chart = new Chart(this.$refs.tempchart, {
                 type: 'scatter',
                 data: {
                     datasets: [{
                         label: "${probe.description}",
                         data: data
```

#### html2text {}

```diff
@@ -7,12 +7,16 @@
 probe))}
 % endif % if request.has_perm('tempmon.appliances.dashboard'):
 ${h.link_to("Go to the Dashboard", url('tempmon.dashboard'))}
 % endif
 def> <%def name="render_this_page()">
 % if probe.appliance: _$_{_p_r_o_b_e_._a_p_p_l_i_a_n_c_e_} % endif
 ${probe.location or ""}
-${time_range}
+input="timeRangeChanged">
+Last Hour
+Last 6 Hours
+Last Day
+Last Week
 ${self.object_helpers()}
     * ${self.context_menu_items()}
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/tempmon/probes/view.mako` & `Tailbone-0.9.90/tailbone/templates/tempmon/probes/view.mako`

 * *Files 7% similar despite different names*

```diff
@@ -1,197 +1,172 @@
 00000000: 2323 202d 2a2d 2063 6f64 696e 673a 2075  ## -*- coding: u
 00000010: 7466 2d38 3b20 2d2a 2d0a 3c25 696e 6865  tf-8; -*-.<%inhe
 00000020: 7269 7420 6669 6c65 3d22 2f6d 6173 7465  rit file="/maste
 00000030: 722f 7669 6577 2e6d 616b 6f22 202f 3e0a  r/view.mako" />.
-00000040: 0a3c 2564 6566 206e 616d 653d 2272 656e  .<%def name="ren
-00000050: 6465 725f 666f 726d 5f63 6f6d 706c 6574  der_form_complet
-00000060: 6528 2922 3e0a 0a20 2023 2320 247b 7365  e()">..  ## ${se
-00000070: 6c66 2e72 656e 6465 725f 666f 726d 2829  lf.render_form()
-00000080: 7d0a 0a20 203c 7363 7269 7074 2074 7970  }..  <script typ
-00000090: 653d 2274 6578 742f 782d 7465 6d70 6c61  e="text/x-templa
-000000a0: 7465 2220 6964 3d22 666f 726d 2d70 6167  te" id="form-pag
-000000b0: 652d 7465 6d70 6c61 7465 223e 0a0a 2020  e-template">..  
-000000c0: 2020 3c64 6976 2073 7479 6c65 3d22 6469    <div style="di
-000000d0: 7370 6c61 793a 2066 6c65 783b 206a 7573  splay: flex; jus
-000000e0: 7469 6679 2d63 6f6e 7465 6e74 3a20 7370  tify-content: sp
-000000f0: 6163 652d 6265 7477 6565 6e3b 223e 0a0a  ace-between;">..
-00000100: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
-00000110: 3d22 666f 726d 2d77 7261 7070 6572 223e  ="form-wrapper">
-00000120: 0a0a 2020 2020 2020 2020 3c64 6976 2073  ..        <div s
-00000130: 7479 6c65 3d22 6469 7370 6c61 793a 2066  tyle="display: f
-00000140: 6c65 783b 2066 6c65 782d 6469 7265 6374  lex; flex-direct
-00000150: 696f 6e3a 2063 6f6c 756d 6e3b 223e 0a0a  ion: column;">..
-00000160: 2020 2020 2020 2020 2020 3c6e 6176 2063            <nav c
-00000170: 6c61 7373 3d22 7061 6e65 6c22 2069 643d  lass="panel" id=
-00000180: 2270 726f 6265 2d6d 6169 6e22 3e0a 2020  "probe-main">.  
-00000190: 2020 2020 2020 2020 2020 3c70 2063 6c61            <p cla
-000001a0: 7373 3d22 7061 6e65 6c2d 6865 6164 696e  ss="panel-headin
-000001b0: 6722 3e47 656e 6572 616c 3c2f 703e 0a20  g">General</p>. 
-000001c0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
-000001d0: 636c 6173 733d 2270 616e 656c 2d62 6c6f  class="panel-blo
-000001e0: 636b 223e 0a20 2020 2020 2020 2020 2020  ck">.           
-000001f0: 2020 203c 6469 763e 0a20 2020 2020 2020     <div>.       
-00000200: 2020 2020 2020 2020 2024 7b73 656c 662e           ${self.
-00000210: 7265 6e64 6572 5f6d 6169 6e5f 6669 656c  render_main_fiel
-00000220: 6473 2866 6f72 6d29 7d0a 2020 2020 2020  ds(form)}.      
-00000230: 2020 2020 2020 2020 3c2f 6469 763e 0a20          </div>. 
-00000240: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
-00000250: 3e0a 2020 2020 2020 2020 2020 3c2f 6e61  >.          </na
-00000260: 763e 0a0a 2020 2020 2020 2020 2020 3c64  v>..          <d
-00000270: 6976 2073 7479 6c65 3d22 6469 7370 6c61  iv style="displa
-00000280: 793a 2066 6c65 783b 223e 0a20 2020 2020  y: flex;">.     
-00000290: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
-000002a0: 733d 2270 616e 656c 2d77 7261 7070 6572  s="panel-wrapper
-000002b0: 223e 0a20 2020 2020 2020 2020 2020 2020  ">.             
-000002c0: 2024 7b73 656c 662e 6c65 6674 5f63 6f6c   ${self.left_col
-000002d0: 756d 6e28 297d 0a20 2020 2020 2020 2020  umn()}.         
-000002e0: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
-000002f0: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
-00000300: 3d22 7061 6e65 6c2d 7772 6170 7065 7222  ="panel-wrapper"
-00000310: 2073 7479 6c65 3d22 6d61 7267 696e 2d6c   style="margin-l
-00000320: 6566 743a 2031 656d 3b22 3e20 3c21 2d2d  eft: 1em;"> <!--
-00000330: 2072 6967 6874 2063 6f6c 756d 6e20 2d2d   right column --
-00000340: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00000350: 247b 7365 6c66 2e72 6967 6874 5f63 6f6c  ${self.right_col
-00000360: 756d 6e28 297d 0a20 2020 2020 2020 2020  umn()}.         
-00000370: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
-00000380: 2020 2020 3c2f 6469 763e 0a0a 2020 2020      </div>..    
-00000390: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
-000003a0: 203c 2f64 6976 3e0a 0a20 2020 2020 203c   </div>..      <
-000003b0: 756c 2069 643d 2263 6f6e 7465 7874 2d6d  ul id="context-m
-000003c0: 656e 7522 3e0a 2020 2020 2020 2020 247b  enu">.        ${
-000003d0: 7365 6c66 2e63 6f6e 7465 7874 5f6d 656e  self.context_men
-000003e0: 755f 6974 656d 7328 297d 0a20 2020 2020  u_items()}.     
-000003f0: 203c 2f75 6c3e 0a0a 2020 2020 3c2f 6469   </ul>..    </di
-00000400: 763e 0a20 203c 2f73 6372 6970 743e 0a0a  v>.  </script>..
-00000410: 2020 3c64 6976 2069 643d 2266 6f72 6d2d    <div id="form-
-00000420: 7061 6765 2d61 7070 223e 0a20 2020 203c  page-app">.    <
-00000430: 666f 726d 2d70 6167 653e 3c2f 666f 726d  form-page></form
-00000440: 2d70 6167 653e 0a20 203c 2f64 6976 3e0a  -page>.  </div>.
-00000450: 3c2f 2564 6566 3e0a 0a0a 2323 2323 2323  </%def>...######
-00000460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000470: 2323 2323 2323 2323 0a23 2320 7265 6e64  ########.## rend
-00000480: 6572 696e 6720 6d65 7468 6f64 730a 2323  ering methods.##
-00000490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000004a0: 2323 2323 2323 2323 2323 2323 0a0a 3c25  ############..<%
-000004b0: 6465 6620 6e61 6d65 3d22 636f 6e74 6578  def name="contex
-000004c0: 745f 6d65 6e75 5f69 7465 6d73 2829 223e  t_menu_items()">
-000004d0: 0a20 2024 7b70 6172 656e 742e 636f 6e74  .  ${parent.cont
-000004e0: 6578 745f 6d65 6e75 5f69 7465 6d73 2829  ext_menu_items()
-000004f0: 7d0a 2020 3c6c 693e 247b 682e 6c69 6e6b  }.  <li>${h.link
-00000500: 5f74 6f28 2256 6965 7720 5265 6164 696e  _to("View Readin
-00000510: 6773 2061 7320 4772 6170 6822 2c20 6163  gs as Graph", ac
-00000520: 7469 6f6e 5f75 726c 2827 6772 6170 6827  tion_url('graph'
-00000530: 2c20 696e 7374 616e 6365 2929 7d3c 2f6c  , instance))}</l
-00000540: 693e 0a20 2025 2069 6620 7265 7175 6573  i>.  % if reques
-00000550: 742e 6861 735f 7065 726d 2827 7465 6d70  t.has_perm('temp
-00000560: 6d6f 6e2e 6170 706c 6961 6e63 6573 2e64  mon.appliances.d
-00000570: 6173 6862 6f61 7264 2729 3a0a 2020 2020  ashboard'):.    
-00000580: 2020 3c6c 693e 247b 682e 6c69 6e6b 5f74    <li>${h.link_t
-00000590: 6f28 2247 6f20 746f 2074 6865 2044 6173  o("Go to the Das
-000005a0: 6862 6f61 7264 222c 2075 726c 2827 7465  hboard", url('te
-000005b0: 6d70 6d6f 6e2e 6461 7368 626f 6172 6427  mpmon.dashboard'
-000005c0: 2929 7d3c 2f6c 693e 0a20 2025 2065 6e64  ))}</li>.  % end
-000005d0: 6966 0a3c 2f25 6465 663e 0a0a 3c25 6465  if.</%def>..<%de
-000005e0: 6620 6e61 6d65 3d22 7265 6e64 6572 5f6d  f name="render_m
-000005f0: 6169 6e5f 6669 656c 6473 2866 6f72 6d29  ain_fields(form)
-00000600: 223e 0a20 2024 7b66 6f72 6d2e 7265 6e64  ">.  ${form.rend
-00000610: 6572 5f66 6965 6c64 5f72 6561 646f 6e6c  er_field_readonl
-00000620: 7928 2763 6c69 656e 7427 297d 0a20 2024  y('client')}.  $
-00000630: 7b66 6f72 6d2e 7265 6e64 6572 5f66 6965  {form.render_fie
-00000640: 6c64 5f72 6561 646f 6e6c 7928 2763 6f6e  ld_readonly('con
-00000650: 6669 675f 6b65 7927 297d 0a20 2024 7b66  fig_key')}.  ${f
-00000660: 6f72 6d2e 7265 6e64 6572 5f66 6965 6c64  orm.render_field
-00000670: 5f72 6561 646f 6e6c 7928 2761 7070 6c69  _readonly('appli
-00000680: 616e 6365 2729 7d0a 2020 247b 666f 726d  ance')}.  ${form
-00000690: 2e72 656e 6465 725f 6669 656c 645f 7265  .render_field_re
-000006a0: 6164 6f6e 6c79 2827 6170 706c 6961 6e63  adonly('applianc
-000006b0: 655f 7479 7065 2729 7d0a 2020 247b 666f  e_type')}.  ${fo
-000006c0: 726d 2e72 656e 6465 725f 6669 656c 645f  rm.render_field_
-000006d0: 7265 6164 6f6e 6c79 2827 6465 7363 7269  readonly('descri
-000006e0: 7074 696f 6e27 297d 0a20 2024 7b66 6f72  ption')}.  ${for
-000006f0: 6d2e 7265 6e64 6572 5f66 6965 6c64 5f72  m.render_field_r
-00000700: 6561 646f 6e6c 7928 276c 6f63 6174 696f  eadonly('locatio
-00000710: 6e27 297d 0a20 2024 7b66 6f72 6d2e 7265  n')}.  ${form.re
-00000720: 6e64 6572 5f66 6965 6c64 5f72 6561 646f  nder_field_reado
-00000730: 6e6c 7928 2764 6576 6963 655f 7061 7468  nly('device_path
-00000740: 2729 7d0a 2020 247b 666f 726d 2e72 656e  ')}.  ${form.ren
-00000750: 6465 725f 6669 656c 645f 7265 6164 6f6e  der_field_readon
-00000760: 6c79 2827 6e6f 7465 7327 297d 0a20 2024  ly('notes')}.  $
-00000770: 7b66 6f72 6d2e 7265 6e64 6572 5f66 6965  {form.render_fie
-00000780: 6c64 5f72 6561 646f 6e6c 7928 2765 6e61  ld_readonly('ena
-00000790: 626c 6564 2729 7d0a 2020 247b 666f 726d  bled')}.  ${form
-000007a0: 2e72 656e 6465 725f 6669 656c 645f 7265  .render_field_re
-000007b0: 6164 6f6e 6c79 2827 7374 6174 7573 2729  adonly('status')
-000007c0: 7d0a 2020 247b 666f 726d 2e72 656e 6465  }.  ${form.rende
-000007d0: 725f 6669 656c 645f 7265 6164 6f6e 6c79  r_field_readonly
-000007e0: 2827 7468 6572 6d5f 7374 6174 7573 5f74  ('therm_status_t
-000007f0: 696d 656f 7574 2729 7d0a 2020 247b 666f  imeout')}.  ${fo
-00000800: 726d 2e72 656e 6465 725f 6669 656c 645f  rm.render_field_
-00000810: 7265 6164 6f6e 6c79 2827 7374 6174 7573  readonly('status
-00000820: 5f61 6c65 7274 5f74 696d 656f 7574 2729  _alert_timeout')
-00000830: 7d0a 3c2f 2564 6566 3e0a 0a3c 2564 6566  }.</%def>..<%def
-00000840: 206e 616d 653d 226c 6566 745f 636f 6c75   name="left_colu
-00000850: 6d6e 2829 223e 0a20 203c 6e61 7620 636c  mn()">.  <nav cl
-00000860: 6173 733d 2270 616e 656c 223e 0a20 2020  ass="panel">.   
-00000870: 203c 7020 636c 6173 733d 2270 616e 656c   <p class="panel
-00000880: 2d68 6561 6469 6e67 223e 5465 6d70 6572  -heading">Temper
-00000890: 6174 7572 6573 3c2f 703e 0a20 2020 203c  atures</p>.    <
-000008a0: 6469 7620 636c 6173 733d 2270 616e 656c  div class="panel
-000008b0: 2d62 6c6f 636b 223e 0a20 2020 2020 203c  -block">.      <
-000008c0: 6469 763e 0a20 2020 2020 2020 2024 7b73  div>.        ${s
-000008d0: 656c 662e 7265 6e64 6572 5f74 656d 7065  elf.render_tempe
-000008e0: 7261 7475 7265 5f66 6965 6c64 7328 666f  rature_fields(fo
-000008f0: 726d 297d 0a20 2020 2020 203c 2f64 6976  rm)}.      </div
-00000900: 3e0a 2020 2020 3c2f 6469 763e 0a20 203c  >.    </div>.  <
-00000910: 2f6e 6176 3e0a 3c2f 2564 6566 3e0a 0a3c  /nav>.</%def>..<
-00000920: 2564 6566 206e 616d 653d 2272 6967 6874  %def name="right
-00000930: 5f63 6f6c 756d 6e28 2922 3e0a 2020 3c6e  _column()">.  <n
-00000940: 6176 2063 6c61 7373 3d22 7061 6e65 6c22  av class="panel"
-00000950: 3e0a 2020 2020 3c70 2063 6c61 7373 3d22  >.    <p class="
-00000960: 7061 6e65 6c2d 6865 6164 696e 6722 3e54  panel-heading">T
-00000970: 696d 656f 7574 733c 2f70 3e0a 2020 2020  imeouts</p>.    
-00000980: 3c64 6976 2063 6c61 7373 3d22 7061 6e65  <div class="pane
-00000990: 6c2d 626c 6f63 6b22 3e0a 2020 2020 2020  l-block">.      
-000009a0: 3c64 6976 3e0a 2020 2020 2020 2020 247b  <div>.        ${
-000009b0: 7365 6c66 2e72 656e 6465 725f 7469 6d65  self.render_time
-000009c0: 6f75 745f 6669 656c 6473 2866 6f72 6d29  out_fields(form)
-000009d0: 7d0a 2020 2020 2020 3c2f 6469 763e 0a20  }.      </div>. 
-000009e0: 2020 203c 2f64 6976 3e0a 2020 3c2f 6e61     </div>.  </na
-000009f0: 763e 0a3c 2f25 6465 663e 0a0a 3c25 6465  v>.</%def>..<%de
-00000a00: 6620 6e61 6d65 3d22 7265 6e64 6572 5f74  f name="render_t
-00000a10: 656d 7065 7261 7475 7265 5f66 6965 6c64  emperature_field
-00000a20: 7328 666f 726d 2922 3e0a 2020 247b 666f  s(form)">.  ${fo
-00000a30: 726d 2e72 656e 6465 725f 6669 656c 645f  rm.render_field_
-00000a40: 7265 6164 6f6e 6c79 2827 6372 6974 6963  readonly('critic
-00000a50: 616c 5f74 656d 705f 6d61 7827 297d 0a20  al_temp_max')}. 
-00000a60: 2024 7b66 6f72 6d2e 7265 6e64 6572 5f66   ${form.render_f
-00000a70: 6965 6c64 5f72 6561 646f 6e6c 7928 2767  ield_readonly('g
-00000a80: 6f6f 645f 7465 6d70 5f6d 6178 2729 7d0a  ood_temp_max')}.
-00000a90: 2020 247b 666f 726d 2e72 656e 6465 725f    ${form.render_
-00000aa0: 6669 656c 645f 7265 6164 6f6e 6c79 2827  field_readonly('
-00000ab0: 676f 6f64 5f74 656d 705f 6d69 6e27 297d  good_temp_min')}
-00000ac0: 0a20 2024 7b66 6f72 6d2e 7265 6e64 6572  .  ${form.render
-00000ad0: 5f66 6965 6c64 5f72 6561 646f 6e6c 7928  _field_readonly(
-00000ae0: 2763 7269 7469 6361 6c5f 7465 6d70 5f6d  'critical_temp_m
-00000af0: 696e 2729 7d0a 3c2f 2564 6566 3e0a 0a3c  in')}.</%def>..<
-00000b00: 2564 6566 206e 616d 653d 2272 656e 6465  %def name="rende
-00000b10: 725f 7469 6d65 6f75 745f 6669 656c 6473  r_timeout_fields
-00000b20: 2866 6f72 6d29 223e 0a20 2024 7b66 6f72  (form)">.  ${for
-00000b30: 6d2e 7265 6e64 6572 5f66 6965 6c64 5f72  m.render_field_r
-00000b40: 6561 646f 6e6c 7928 2763 7269 7469 6361  eadonly('critica
-00000b50: 6c5f 6d61 785f 7469 6d65 6f75 7427 297d  l_max_timeout')}
-00000b60: 0a20 2024 7b66 6f72 6d2e 7265 6e64 6572  .  ${form.render
-00000b70: 5f66 6965 6c64 5f72 6561 646f 6e6c 7928  _field_readonly(
-00000b80: 2767 6f6f 645f 6d61 785f 7469 6d65 6f75  'good_max_timeou
-00000b90: 7427 297d 0a20 2024 7b66 6f72 6d2e 7265  t')}.  ${form.re
-00000ba0: 6e64 6572 5f66 6965 6c64 5f72 6561 646f  nder_field_reado
-00000bb0: 6e6c 7928 2767 6f6f 645f 6d69 6e5f 7469  nly('good_min_ti
-00000bc0: 6d65 6f75 7427 297d 0a20 2024 7b66 6f72  meout')}.  ${for
-00000bd0: 6d2e 7265 6e64 6572 5f66 6965 6c64 5f72  m.render_field_r
-00000be0: 6561 646f 6e6c 7928 2763 7269 7469 6361  eadonly('critica
-00000bf0: 6c5f 6d69 6e5f 7469 6d65 6f75 7427 297d  l_min_timeout')}
-00000c00: 0a20 2024 7b66 6f72 6d2e 7265 6e64 6572  .  ${form.render
-00000c10: 5f66 6965 6c64 5f72 6561 646f 6e6c 7928  _field_readonly(
-00000c20: 2765 7272 6f72 5f74 696d 656f 7574 2729  'error_timeout')
-00000c30: 7d0a 3c2f 2564 6566 3e0a 0a0a 247b 7061  }.</%def>...${pa
-00000c40: 7265 6e74 2e62 6f64 7928 297d 0a         rent.body()}.
+00000040: 0a3c 2564 6566 206e 616d 653d 2270 6167  .<%def name="pag
+00000050: 655f 636f 6e74 656e 7428 2922 3e0a 2020  e_content()">.  
+00000060: 3c64 6976 2063 6c61 7373 3d22 666f 726d  <div class="form
+00000070: 2d77 7261 7070 6572 223e 0a20 2020 203c  -wrapper">.    <
+00000080: 6469 7620 7374 796c 653d 2264 6973 706c  div style="displ
+00000090: 6179 3a20 666c 6578 3b20 666c 6578 2d64  ay: flex; flex-d
+000000a0: 6972 6563 7469 6f6e 3a20 636f 6c75 6d6e  irection: column
+000000b0: 3b22 3e0a 0a20 2020 2020 203c 6e61 7620  ;">..      <nav 
+000000c0: 636c 6173 733d 2270 616e 656c 2220 6964  class="panel" id
+000000d0: 3d22 7072 6f62 652d 6d61 696e 223e 0a20  ="probe-main">. 
+000000e0: 2020 2020 2020 203c 7020 636c 6173 733d         <p class=
+000000f0: 2270 616e 656c 2d68 6561 6469 6e67 223e  "panel-heading">
+00000100: 4765 6e65 7261 6c3c 2f70 3e0a 2020 2020  General</p>.    
+00000110: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000120: 7061 6e65 6c2d 626c 6f63 6b22 3e0a 2020  panel-block">.  
+00000130: 2020 2020 2020 2020 3c64 6976 3e0a 2020          <div>.  
+00000140: 2020 2020 2020 2020 2020 247b 7365 6c66            ${self
+00000150: 2e72 656e 6465 725f 6d61 696e 5f66 6965  .render_main_fie
+00000160: 6c64 7328 666f 726d 297d 0a20 2020 2020  lds(form)}.     
+00000170: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
+00000180: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
+00000190: 203c 2f6e 6176 3e0a 0a20 2020 2020 203c   </nav>..      <
+000001a0: 6469 7620 7374 796c 653d 2264 6973 706c  div style="displ
+000001b0: 6179 3a20 666c 6578 3b22 3e0a 2020 2020  ay: flex;">.    
+000001c0: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+000001d0: 7061 6e65 6c2d 7772 6170 7065 7222 3e0a  panel-wrapper">.
+000001e0: 2020 2020 2020 2020 2020 247b 7365 6c66            ${self
+000001f0: 2e6c 6566 745f 636f 6c75 6d6e 2829 7d0a  .left_column()}.
+00000200: 2020 2020 2020 2020 3c2f 6469 763e 0a20          </div>. 
+00000210: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00000220: 733d 2270 616e 656c 2d77 7261 7070 6572  s="panel-wrapper
+00000230: 2220 7374 796c 653d 226d 6172 6769 6e2d  " style="margin-
+00000240: 6c65 6674 3a20 3165 6d3b 223e 203c 212d  left: 1em;"> <!-
+00000250: 2d20 7269 6768 7420 636f 6c75 6d6e 202d  - right column -
+00000260: 2d3e 0a20 2020 2020 2020 2020 2024 7b73  ->.          ${s
+00000270: 656c 662e 7269 6768 745f 636f 6c75 6d6e  elf.right_column
+00000280: 2829 7d0a 2020 2020 2020 2020 3c2f 6469  ()}.        </di
+00000290: 763e 0a20 2020 2020 203c 2f64 6976 3e0a  v>.      </div>.
+000002a0: 0a20 2020 203c 2f64 6976 3e0a 2020 3c2f  .    </div>.  </
+000002b0: 6469 763e 0a3c 2f25 6465 663e 0a0a 0a23  div>.</%def>...#
+000002c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000002d0: 2323 2323 2323 2323 2323 2323 230a 2323  #############.##
+000002e0: 2072 656e 6465 7269 6e67 206d 6574 686f   rendering metho
+000002f0: 6473 0a23 2323 2323 2323 2323 2323 2323  ds.#############
+00000300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000310: 230a 0a3c 2564 6566 206e 616d 653d 2263  #..<%def name="c
+00000320: 6f6e 7465 7874 5f6d 656e 755f 6974 656d  ontext_menu_item
+00000330: 7328 2922 3e0a 2020 247b 7061 7265 6e74  s()">.  ${parent
+00000340: 2e63 6f6e 7465 7874 5f6d 656e 755f 6974  .context_menu_it
+00000350: 656d 7328 297d 0a20 203c 6c69 3e24 7b68  ems()}.  <li>${h
+00000360: 2e6c 696e 6b5f 746f 2822 5669 6577 2052  .link_to("View R
+00000370: 6561 6469 6e67 7320 6173 2047 7261 7068  eadings as Graph
+00000380: 222c 2061 6374 696f 6e5f 7572 6c28 2767  ", action_url('g
+00000390: 7261 7068 272c 2069 6e73 7461 6e63 6529  raph', instance)
+000003a0: 297d 3c2f 6c69 3e0a 2020 2520 6966 2072  )}</li>.  % if r
+000003b0: 6571 7565 7374 2e68 6173 5f70 6572 6d28  equest.has_perm(
+000003c0: 2774 656d 706d 6f6e 2e61 7070 6c69 616e  'tempmon.applian
+000003d0: 6365 732e 6461 7368 626f 6172 6427 293a  ces.dashboard'):
+000003e0: 0a20 2020 2020 203c 6c69 3e24 7b68 2e6c  .      <li>${h.l
+000003f0: 696e 6b5f 746f 2822 476f 2074 6f20 7468  ink_to("Go to th
+00000400: 6520 4461 7368 626f 6172 6422 2c20 7572  e Dashboard", ur
+00000410: 6c28 2774 656d 706d 6f6e 2e64 6173 6862  l('tempmon.dashb
+00000420: 6f61 7264 2729 297d 3c2f 6c69 3e0a 2020  oard'))}</li>.  
+00000430: 2520 656e 6469 660a 3c2f 2564 6566 3e0a  % endif.</%def>.
+00000440: 0a3c 2564 6566 206e 616d 653d 2272 656e  .<%def name="ren
+00000450: 6465 725f 6d61 696e 5f66 6965 6c64 7328  der_main_fields(
+00000460: 666f 726d 2922 3e0a 2020 247b 666f 726d  form)">.  ${form
+00000470: 2e72 656e 6465 725f 6669 656c 645f 7265  .render_field_re
+00000480: 6164 6f6e 6c79 2827 636c 6965 6e74 2729  adonly('client')
+00000490: 7d0a 2020 247b 666f 726d 2e72 656e 6465  }.  ${form.rende
+000004a0: 725f 6669 656c 645f 7265 6164 6f6e 6c79  r_field_readonly
+000004b0: 2827 636f 6e66 6967 5f6b 6579 2729 7d0a  ('config_key')}.
+000004c0: 2020 247b 666f 726d 2e72 656e 6465 725f    ${form.render_
+000004d0: 6669 656c 645f 7265 6164 6f6e 6c79 2827  field_readonly('
+000004e0: 6170 706c 6961 6e63 6527 297d 0a20 2024  appliance')}.  $
+000004f0: 7b66 6f72 6d2e 7265 6e64 6572 5f66 6965  {form.render_fie
+00000500: 6c64 5f72 6561 646f 6e6c 7928 2761 7070  ld_readonly('app
+00000510: 6c69 616e 6365 5f74 7970 6527 297d 0a20  liance_type')}. 
+00000520: 2024 7b66 6f72 6d2e 7265 6e64 6572 5f66   ${form.render_f
+00000530: 6965 6c64 5f72 6561 646f 6e6c 7928 2764  ield_readonly('d
+00000540: 6573 6372 6970 7469 6f6e 2729 7d0a 2020  escription')}.  
+00000550: 247b 666f 726d 2e72 656e 6465 725f 6669  ${form.render_fi
+00000560: 656c 645f 7265 6164 6f6e 6c79 2827 6c6f  eld_readonly('lo
+00000570: 6361 7469 6f6e 2729 7d0a 2020 247b 666f  cation')}.  ${fo
+00000580: 726d 2e72 656e 6465 725f 6669 656c 645f  rm.render_field_
+00000590: 7265 6164 6f6e 6c79 2827 6465 7669 6365  readonly('device
+000005a0: 5f70 6174 6827 297d 0a20 2024 7b66 6f72  _path')}.  ${for
+000005b0: 6d2e 7265 6e64 6572 5f66 6965 6c64 5f72  m.render_field_r
+000005c0: 6561 646f 6e6c 7928 276e 6f74 6573 2729  eadonly('notes')
+000005d0: 7d0a 2020 247b 666f 726d 2e72 656e 6465  }.  ${form.rende
+000005e0: 725f 6669 656c 645f 7265 6164 6f6e 6c79  r_field_readonly
+000005f0: 2827 656e 6162 6c65 6427 297d 0a20 2024  ('enabled')}.  $
+00000600: 7b66 6f72 6d2e 7265 6e64 6572 5f66 6965  {form.render_fie
+00000610: 6c64 5f72 6561 646f 6e6c 7928 2773 7461  ld_readonly('sta
+00000620: 7475 7327 297d 0a20 2024 7b66 6f72 6d2e  tus')}.  ${form.
+00000630: 7265 6e64 6572 5f66 6965 6c64 5f72 6561  render_field_rea
+00000640: 646f 6e6c 7928 2774 6865 726d 5f73 7461  donly('therm_sta
+00000650: 7475 735f 7469 6d65 6f75 7427 297d 0a20  tus_timeout')}. 
+00000660: 2024 7b66 6f72 6d2e 7265 6e64 6572 5f66   ${form.render_f
+00000670: 6965 6c64 5f72 6561 646f 6e6c 7928 2773  ield_readonly('s
+00000680: 7461 7475 735f 616c 6572 745f 7469 6d65  tatus_alert_time
+00000690: 6f75 7427 297d 0a3c 2f25 6465 663e 0a0a  out')}.</%def>..
+000006a0: 3c25 6465 6620 6e61 6d65 3d22 6c65 6674  <%def name="left
+000006b0: 5f63 6f6c 756d 6e28 2922 3e0a 2020 3c6e  _column()">.  <n
+000006c0: 6176 2063 6c61 7373 3d22 7061 6e65 6c22  av class="panel"
+000006d0: 3e0a 2020 2020 3c70 2063 6c61 7373 3d22  >.    <p class="
+000006e0: 7061 6e65 6c2d 6865 6164 696e 6722 3e54  panel-heading">T
+000006f0: 656d 7065 7261 7475 7265 733c 2f70 3e0a  emperatures</p>.
+00000700: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000710: 7061 6e65 6c2d 626c 6f63 6b22 3e0a 2020  panel-block">.  
+00000720: 2020 2020 3c64 6976 3e0a 2020 2020 2020      <div>.      
+00000730: 2020 247b 7365 6c66 2e72 656e 6465 725f    ${self.render_
+00000740: 7465 6d70 6572 6174 7572 655f 6669 656c  temperature_fiel
+00000750: 6473 2866 6f72 6d29 7d0a 2020 2020 2020  ds(form)}.      
+00000760: 3c2f 6469 763e 0a20 2020 203c 2f64 6976  </div>.    </div
+00000770: 3e0a 2020 3c2f 6e61 763e 0a3c 2f25 6465  >.  </nav>.</%de
+00000780: 663e 0a0a 3c25 6465 6620 6e61 6d65 3d22  f>..<%def name="
+00000790: 7269 6768 745f 636f 6c75 6d6e 2829 223e  right_column()">
+000007a0: 0a20 203c 6e61 7620 636c 6173 733d 2270  .  <nav class="p
+000007b0: 616e 656c 223e 0a20 2020 203c 7020 636c  anel">.    <p cl
+000007c0: 6173 733d 2270 616e 656c 2d68 6561 6469  ass="panel-headi
+000007d0: 6e67 223e 5469 6d65 6f75 7473 3c2f 703e  ng">Timeouts</p>
+000007e0: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
+000007f0: 2270 616e 656c 2d62 6c6f 636b 223e 0a20  "panel-block">. 
+00000800: 2020 2020 203c 6469 763e 0a20 2020 2020       <div>.     
+00000810: 2020 2024 7b73 656c 662e 7265 6e64 6572     ${self.render
+00000820: 5f74 696d 656f 7574 5f66 6965 6c64 7328  _timeout_fields(
+00000830: 666f 726d 297d 0a20 2020 2020 203c 2f64  form)}.      </d
+00000840: 6976 3e0a 2020 2020 3c2f 6469 763e 0a20  iv>.    </div>. 
+00000850: 203c 2f6e 6176 3e0a 3c2f 2564 6566 3e0a   </nav>.</%def>.
+00000860: 0a3c 2564 6566 206e 616d 653d 2272 656e  .<%def name="ren
+00000870: 6465 725f 7465 6d70 6572 6174 7572 655f  der_temperature_
+00000880: 6669 656c 6473 2866 6f72 6d29 223e 0a20  fields(form)">. 
+00000890: 2024 7b66 6f72 6d2e 7265 6e64 6572 5f66   ${form.render_f
+000008a0: 6965 6c64 5f72 6561 646f 6e6c 7928 2763  ield_readonly('c
+000008b0: 7269 7469 6361 6c5f 7465 6d70 5f6d 6178  ritical_temp_max
+000008c0: 2729 7d0a 2020 247b 666f 726d 2e72 656e  ')}.  ${form.ren
+000008d0: 6465 725f 6669 656c 645f 7265 6164 6f6e  der_field_readon
+000008e0: 6c79 2827 676f 6f64 5f74 656d 705f 6d61  ly('good_temp_ma
+000008f0: 7827 297d 0a20 2024 7b66 6f72 6d2e 7265  x')}.  ${form.re
+00000900: 6e64 6572 5f66 6965 6c64 5f72 6561 646f  nder_field_reado
+00000910: 6e6c 7928 2767 6f6f 645f 7465 6d70 5f6d  nly('good_temp_m
+00000920: 696e 2729 7d0a 2020 247b 666f 726d 2e72  in')}.  ${form.r
+00000930: 656e 6465 725f 6669 656c 645f 7265 6164  ender_field_read
+00000940: 6f6e 6c79 2827 6372 6974 6963 616c 5f74  only('critical_t
+00000950: 656d 705f 6d69 6e27 297d 0a3c 2f25 6465  emp_min')}.</%de
+00000960: 663e 0a0a 3c25 6465 6620 6e61 6d65 3d22  f>..<%def name="
+00000970: 7265 6e64 6572 5f74 696d 656f 7574 5f66  render_timeout_f
+00000980: 6965 6c64 7328 666f 726d 2922 3e0a 2020  ields(form)">.  
+00000990: 247b 666f 726d 2e72 656e 6465 725f 6669  ${form.render_fi
+000009a0: 656c 645f 7265 6164 6f6e 6c79 2827 6372  eld_readonly('cr
+000009b0: 6974 6963 616c 5f6d 6178 5f74 696d 656f  itical_max_timeo
+000009c0: 7574 2729 7d0a 2020 247b 666f 726d 2e72  ut')}.  ${form.r
+000009d0: 656e 6465 725f 6669 656c 645f 7265 6164  ender_field_read
+000009e0: 6f6e 6c79 2827 676f 6f64 5f6d 6178 5f74  only('good_max_t
+000009f0: 696d 656f 7574 2729 7d0a 2020 247b 666f  imeout')}.  ${fo
+00000a00: 726d 2e72 656e 6465 725f 6669 656c 645f  rm.render_field_
+00000a10: 7265 6164 6f6e 6c79 2827 676f 6f64 5f6d  readonly('good_m
+00000a20: 696e 5f74 696d 656f 7574 2729 7d0a 2020  in_timeout')}.  
+00000a30: 247b 666f 726d 2e72 656e 6465 725f 6669  ${form.render_fi
+00000a40: 656c 645f 7265 6164 6f6e 6c79 2827 6372  eld_readonly('cr
+00000a50: 6974 6963 616c 5f6d 696e 5f74 696d 656f  itical_min_timeo
+00000a60: 7574 2729 7d0a 2020 247b 666f 726d 2e72  ut')}.  ${form.r
+00000a70: 656e 6465 725f 6669 656c 645f 7265 6164  ender_field_read
+00000a80: 6f6e 6c79 2827 6572 726f 725f 7469 6d65  only('error_time
+00000a90: 6f75 7427 297d 0a3c 2f25 6465 663e 0a0a  out')}.</%def>..
+00000aa0: 0a24 7b70 6172 656e 742e 626f 6479 2829  .${parent.body()
+00000ab0: 7d0a                                     }.
```

### Comparing `Tailbone-0.9.9/tailbone/templates/tempmon/appliances/index.mako` & `Tailbone-0.9.90/tailbone/templates/tempmon/appliances/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/tempmon/clients/view.mako` & `Tailbone-0.9.90/tailbone/templates/tempmon/clients/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/create.mako` & `Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/create.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/vendorcatalog/configure.mako` & `Tailbone-0.9.90/tailbone/templates/batch/vendorcatalog/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/inventory/desktop_form.mako` & `Tailbone-0.9.90/tailbone/templates/batch/inventory/desktop_form.mako`

 * *Files 23% similar despite different names*

```diff
@@ -1,15 +1,41 @@
 ## -*- coding: utf-8; -*-
 <%inherit file="/form.mako" />
 
 <%def name="title()">Inventory Form</%def>
 
-<%def name="context_menu_items()">
-  ${parent.context_menu_items()}
-  <li>${h.link_to("Back to Inventory Batch", url('batch.inventory.view', uuid=batch.uuid))}</li>
+<%def name="object_helpers()">
+  <nav class="panel">
+    <p class="panel-heading">Batch</p>
+    <div class="panel-block buttons">
+      <div style="display: flex; flex-direction: column;">
+
+        <once-button type="is-primary"
+                     icon-left="eye"
+                     tag="a" href="${url('batch.inventory.view', uuid=batch.uuid)}"
+                     text="View Batch">
+        </once-button>
+
+        % if not batch.executed and master.has_perm('edit'):
+            ${h.form(master.get_action_url('toggle_complete', batch), **{'@submit': 'toggleCompleteSubmitting = true'})}
+            ${h.csrf_token(request)}
+            ${h.hidden('complete', value='true')}
+            <b-button type="is-primary"
+                      native-type="submit"
+                      icon-pack="fas"
+                      icon-left="check"
+                      :disabled="toggleCompleteSubmitting">
+              {{ toggleCompleteSubmitting ? "Working, please wait..." : "Mark Complete" }}
+            </b-button>
+            ${h.end_form()}
+        % endif
+
+      </div>
+    </div>
+  </nav>
 </%def>
 
 <%def name="render_form()">
   <script type="text/x-template" id="${form.component}-template">
     <div class="product-info">
 
       ${h.form(form.action_url, **{'@submit': 'handleSubmit'})}
@@ -119,14 +145,15 @@
     </div>
   </script>
 
   <script type="text/javascript">
 
     let ${form.component_studly} = {
         template: '#${form.component}-template',
+        mixins: [SimpleRequestMixin],
 
         mounted() {
             this.$refs.productUPC.focus()
         },
 
         methods: {
 
@@ -191,23 +218,17 @@
             },
 
             productLookup() {
                 let url = '${url('batch.inventory.desktop_lookup', uuid=batch.uuid)}'
                 let params = {
                     upc: this.productUPC,
                 }
-                this.$http.get(url, {params: params}).then(response => {
-
-                    if (response.data.error) {
-                        alert(response.data.error)
-                        if (response.data.redirect) {
-                            location.href = response.data.redirect
-                        }
+                this.simpleGET(url, params, response => {
 
-                    } else if (response.data.product.uuid) {
+                    if (response.data.product.uuid) {
 
                         this.productUPC = response.data.product.upc_pretty
                         this.productInfo = response.data.product
                         this.forceUnitItem = response.data.force_unit_item
                         this.alreadyPresentInBatch = response.data.already_present_in_batch
 
                         if (this.alreadyPresentInBatch) {
@@ -234,14 +255,27 @@
                                 % endif
                             }
                         })
 
                     } else {
                         ## this.productNotFound = true
                         alert("Product not found!")
+
+                        // focus/select UPC entry
+                        this.$refs.productUPC.focus()
+                        // nb. must traverse into the <b-input> element
+                        this.$refs.productUPC.$el.firstChild.select()
+                    }
+
+                }, response => {
+                    if (response.data.error) {
+                        alert(response.data.error)
+                        if (response.data.redirect) {
+                            location.href = response.data.redirect
+                        }
                     }
                 })
             },
         },
     }
 
     let ${form.component_studly}Data = {
@@ -259,9 +293,18 @@
         alreadyPresentInBatch: false,
         forceUnitItem: false,
     }
 
   </script>
 </%def>
 
+<%def name="modify_this_page_vars()">
+  ${parent.modify_this_page_vars()}
+  <script type="text/javascript">
+
+    ThisPageData.toggleCompleteSubmitting = false
+
+  </script>
+</%def>
+
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,7 +1,13 @@
 ## -*- coding: utf-8; -*- <%inherit file="/form.mako" /> <%def name="title
 ()">Inventory Form
-def> <%def name="context_menu_items()"> ${parent.context_menu_items()}
-${h.link_to("Back to Inventory Batch", url('batch.inventory.view',
-uuid=batch.uuid))}
+def> <%def name="object_helpers()">
+Batch
+% if not batch.executed and master.has_perm('edit'): ${h.form
+(master.get_action_url('toggle_complete', batch), **{'@submit':
+'toggleCompleteSubmitting = true'})} ${h.csrf_token(request)} ${h.hidden
+('complete', value='true')}
+disabled="toggleCompleteSubmitting"> {{ toggleCompleteSubmitting ? "Working,
+please wait..." : "Mark Complete" }} ${h.end_form()} % endif
 def> <%def name="render_form()">
+def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/pricing/configure.mako` & `Tailbone-0.9.90/tailbone/templates/batch/pricing/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/importer/view_row.mako` & `Tailbone-0.9.90/tailbone/templates/batch/importer/view_row.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/view.mako` & `Tailbone-0.9.90/tailbone/templates/batch/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/batch/index.mako` & `Tailbone-0.9.90/tailbone/templates/batch/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/checked_password.pt` & `Tailbone-0.9.90/tailbone/templates/deform/checked_password.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/select.pt` & `Tailbone-0.9.90/tailbone/templates/deform/select.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/percentinput.pt` & `Tailbone-0.9.90/tailbone/templates/deform/percentinput.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/autocomplete_jquery.pt` & `Tailbone-0.9.90/tailbone/templates/deform/autocomplete_jquery.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/select_jquery.pt` & `Tailbone-0.9.90/tailbone/templates/deform/select_jquery.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/file_upload.pt` & `Tailbone-0.9.90/tailbone/templates/deform/file_upload.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/checkbox_dynamic.pt` & `Tailbone-0.9.90/tailbone/templates/deform/checkbox_dynamic.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/textinput.pt` & `Tailbone-0.9.90/tailbone/templates/deform/textinput.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/cases_units.pt` & `Tailbone-0.9.90/tailbone/templates/deform/cases_units.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/password.pt` & `Tailbone-0.9.90/tailbone/templates/deform/password.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/numberinput.pt` & `Tailbone-0.9.90/tailbone/templates/deform/numberinput.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/time_jquery.pt` & `Tailbone-0.9.90/tailbone/templates/deform/time_jquery.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/message_recipients_buefy.pt` & `Tailbone-0.9.90/tailbone/templates/deform/message_recipients_buefy.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/date_jquery.pt` & `Tailbone-0.9.90/tailbone/templates/deform/date_jquery.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/date_plain.pt` & `Tailbone-0.9.90/tailbone/templates/deform/date_plain.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/permissions.pt` & `Tailbone-0.9.90/tailbone/templates/deform/permissions.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/select_dynamic.pt` & `Tailbone-0.9.90/tailbone/templates/deform/select_dynamic.pt`

 * *Files 27% similar despite different names*

```diff
@@ -22,13 +22,13 @@
                             v-model vmodel;
                             @input input_handler;
                             attributes|field.widget.attributes|{};">
 
     <option v-for="item in ${name}_options"
             tal:attributes=":key 'item.value';
                             :value 'item.value';">
-      {{ item.label }}
+      <span v-html="item.label"></span>
     </option>
 
   </b-select>
 
 </div>
```

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/problem_report_days.pt` & `Tailbone-0.9.90/tailbone/templates/deform/problem_report_days.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/deform/select_plain.pt` & `Tailbone-0.9.90/tailbone/templates/deform/select_plain.pt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/page_help.mako` & `Tailbone-0.9.90/tailbone/templates/page_help.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/base_meta.mako` & `Tailbone-0.9.90/tailbone/templates/base_meta.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/datasync/changes/index.mako` & `Tailbone-0.9.90/tailbone/templates/datasync/changes/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/datasync/status.mako` & `Tailbone-0.9.90/tailbone/templates/datasync/status.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/datasync/configure.mako` & `Tailbone-0.9.90/tailbone/templates/datasync/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/diff.mako` & `Tailbone-0.9.90/tailbone/templates/diff.mako`

 * *Files 20% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 ## -*- coding: utf-8; -*-
-<table class="diff dirty${' monospace' if diff.monospace else ''}">
+<table class="diff ${diff.nature} ${' monospace' if diff.monospace else ''}">
   <thead>
     <tr>
       % for column in diff.columns:
           <th>${column}</th>
       % endfor
     </tr>
   </thead>
```

### Comparing `Tailbone-0.9.9/tailbone/templates/appsettings.mako` & `Tailbone-0.9.90/tailbone/templates/appsettings.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/generate_feature.mako` & `Tailbone-0.9.90/tailbone/templates/generate_feature.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/configure.mako` & `Tailbone-0.9.90/tailbone/templates/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/poser/reports/view.mako` & `Tailbone-0.9.90/tailbone/templates/poser/reports/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/poser/setup.mako` & `Tailbone-0.9.90/tailbone/templates/poser/setup.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/poser/views/configure.mako` & `Tailbone-0.9.90/tailbone/templates/poser/views/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/upgrade.mako` & `Tailbone-0.9.90/tailbone/templates/upgrade.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/importing/view.mako` & `Tailbone-0.9.90/tailbone/templates/importing/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/importing/runjob.mako` & `Tailbone-0.9.90/tailbone/templates/importing/runjob.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/importing/configure.mako` & `Tailbone-0.9.90/tailbone/templates/importing/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/settings/email/view.mako` & `Tailbone-0.9.90/tailbone/templates/settings/email/view.mako`

 * *Files 1% similar despite different names*

```diff
@@ -80,15 +80,15 @@
 
     const EmailPreviewTools = {
         template: '#email-preview-tools-template',
         data() {
             return {
                 previewFormButtonText: "Send Preview Email",
                 previewFormSubmitting: false,
-                userEmailAddress: ${json.dumps(request.user.email_address)|n},
+                userEmailAddress: ${json.dumps(user_email_address)|n},
             }
         },
         methods: {
             submitPreviewForm(event) {
                 if (!this.userEmailAddress) {
                     alert("Please provide an email address.")
                     event.preventDefault()
```

### Comparing `Tailbone-0.9.9/tailbone/templates/settings/email/index.mako` & `Tailbone-0.9.90/tailbone/templates/settings/email/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/settings/email/configure.mako` & `Tailbone-0.9.90/tailbone/templates/settings/email/configure.mako`

 * *Files 25% similar despite different names*

```diff
@@ -1,12 +1,30 @@
 ## -*- coding: utf-8; -*-
 <%inherit file="/configure.mako" />
 
 <%def name="form_content()">
 
+  <h3 class="block is-size-3">General</h3>
+  <div class="block" style="padding-left: 2rem;">
+    <b-field label="Mail Handler"
+             message="Leave blank for default handler.">
+      <b-input name="rattail.mail.handler"
+               v-model="simpleSettings['rattail.mail.handler']"
+               @input="settingsNeedSaved = true">
+      </b-input>
+    </b-field>
+    <b-field label="Template Paths"
+             message="Leave blank for default paths.">
+      <b-input name="rattail.mail.templates"
+               v-model="simpleSettings['rattail.mail.templates']"
+               @input="settingsNeedSaved = true">
+      </b-input>
+    </b-field>
+  </div>
+
   <h3 class="block is-size-3">Sending</h3>
   <div class="block" style="padding-left: 2rem;">
 
     <b-field>
       <b-checkbox name="rattail.mail.record_attempts"
                   v-model="simpleSettings['rattail.mail.record_attempts']"
                   native-value="true"
@@ -22,38 +40,80 @@
                   @input="settingsNeedSaved = true">
         When sending an email fails, send another to report the failure
       </b-checkbox>
     </b-field>
 
   </div>
 
-  % if request.has_perm('errors.bogus'):
-      <h3 class="block is-size-3">Testing</h3>
-      <div class="block" style="padding-left: 2rem;">
-
-        <b-field grouped>
-          <p class="control">
-            You can raise a "bogus" error to test if/how it generates email:
-          </p>
+  <h3 class="block is-size-3">Testing</h3>
+  <div class="block" style="padding-left: 2rem;">
+
+    <b-field grouped>
+      <b-field horizontal label="Recipient">
+        <b-input v-model="testRecipient"></b-input>
+      </b-field>
+      <b-button type="is-primary"
+                @click="sendTest()"
+                :disabled="sendingTest">
+        {{ sendingTest ? "Working, please wait..." : "Send Test Email" }}
+      </b-button>
+    </b-field>
+
+    <div class="level">
+      <div class="level-left">
+        <div class="level-item">
+          <p>You can raise a "bogus" error to test if/how that generates email:</p>
+        </div>
+        <div class="level-item">
           <b-button type="is-primary"
+                    % if request.has_perm('errors.bogus'):
                     @click="raiseBogusError()"
-                    :disabled="raisingBogusError">
+                    :disabled="raisingBogusError"
+                    % else:
+                    disabled
+                    title="your permissions do not allow this"
+                    % endif
+                    >
+            % if request.has_perm('errors.bogus'):
             {{ raisingBogusError ? "Working, please wait..." : "Raise Bogus Error" }}
+            % else:
+            Raise Bogus Error
+            % endif
           </b-button>
-        </b-field>
-
+        </div>
       </div>
-      </h3>
-  % endif
+    </div>
+
+  </div>
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
-  % if request.has_perm('errors.bogus'):
-      <script type="text/javascript">
+  <script type="text/javascript">
+
+    ThisPageData.testRecipient = ${json.dumps(user_email_address)|n}
+    ThisPageData.sendingTest = false
+
+    ThisPage.methods.sendTest = function() {
+        this.sendingTest = true
+        let url = '${url('emailprofiles.send_test')}'
+        let params = {recipient: this.testRecipient}
+        this.simplePOST(url, params, response => {
+            this.$buefy.toast.open({
+                message: "Test email was sent!",
+                type: 'is-success',
+                duration: 4000, // 4 seconds
+            })
+            this.sendingTest = false
+        }, response => {
+            this.sendingTest = false
+        })
+    }
+
+    % if request.has_perm('errors.bogus'):
 
         ThisPageData.raisingBogusError = false
 
         ThisPage.methods.raiseBogusError = function() {
             this.raisingBogusError = true
 
             let url = '${url('bogus_error')}'
@@ -70,13 +130,13 @@
                     type: 'is-success',
                     duration: 4000, // 4 seconds
                 })
                 this.raisingBogusError = false
             })
         }
 
-      </script>
-  % endif
+    % endif
+  </script>
 </%def>
 
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,16 +1,20 @@
 ## -*- coding: utf-8; -*- <%inherit file="/configure.mako" /> <%def
 name="form_content()">
+******** GGeenneerraall ********
+input="settingsNeedSaved = true">
+input="settingsNeedSaved = true">
 ******** SSeennddiinngg ********
 input="settingsNeedSaved = true"> Make record of all attempts to send email
 input="settingsNeedSaved = true"> When sending an email fails, send another to
 report the failure
-% if request.has_perm('errors.bogus'):
 ******** TTeessttiinngg ********
-You can raise a "bogus" error to test if/how it generates email:
-click="raiseBogusError()" :disabled="raisingBogusError"> {{ raisingBogusError ?
-"Working, please wait..." : "Raise Bogus Error" }}
-% endif
-def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()} %
-if request.has_perm('errors.bogus'):
-% endif
+click="sendTest()" :disabled="sendingTest"> {{ sendingTest ? "Working, please
+wait..." : "Send Test Email" }}
+You can raise a "bogus" error to test if/how that generates email:
+if request.has_perm('errors.bogus'): @click="raiseBogusError()" :
+disabled="raisingBogusError" % else: disabled title="your permissions do not
+allow this" % endif > % if request.has_perm('errors.bogus'): {
+{ raisingBogusError ? "Working, please wait..." : "Raise Bogus Error" }} %
+else: Raise Bogus Error % endif
+def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/products/batch.mako` & `Tailbone-0.9.90/tailbone/templates/products/batch.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/products/view.mako` & `Tailbone-0.9.90/tailbone/templates/products/view.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/products/lookup.mako` & `Tailbone-0.9.90/tailbone/templates/products/lookup.mako`

 * *Files 22% similar despite different names*

```diff
@@ -1,13 +1,54 @@
 ## -*- coding: utf-8; -*-
 
 <%def name="tailbone_product_lookup_template()">
   <script type="text/x-template" id="tailbone-product-lookup-template">
-    <div>
-      <b-modal :active.sync="showingDialog">
+    <div style="width: 100%;">
+
+      <b-field grouped>
+
+        <b-field :expanded="!product">
+          <b-autocomplete ref="productAutocomplete"
+                          v-if="!product"
+                          v-model="autocompleteValue"
+                          placeholder="Enter UPC or brand, description etc."
+                          :data="autocompleteOptions"
+                          field="value"
+                          :custom-formatter="option => option.label"
+                          @typing="getAutocompleteOptions"
+                          @select="autocompleteSelected"
+                          style="width: 100%;">
+          </b-autocomplete>
+          <b-button v-if="product"
+                    @click="clearSelection(true)">
+            {{ product.full_description }}
+          </b-button>
+        </b-field>
+
+        <b-button type="is-primary"
+                  v-if="!product"
+                  @click="lookupInit()"
+                  icon-pack="fas"
+                  icon-left="search">
+          Full Lookup
+        </b-button>
+
+        <b-button v-if="product"
+                  type="is-primary"
+                  tag="a" target="_blank"
+                  :href="product.url"
+                  :disabled="!product.url"
+                  icon-pack="fas"
+                  icon-left="external-link-alt">
+          View Product
+        </b-button>
+
+      </b-field>
+
+      <b-modal :active.sync="lookupShowDialog">
         <div class="card">
           <div class="card-content">
 
             <b-field grouped>
 
               <b-input v-model="searchTerm" 
                        ref="searchTermInput"
@@ -153,26 +194,39 @@
                 </div>
               </div>
             </div>
 
           </div>
         </div>
       </b-modal>
+
     </div>
   </script>
 </%def>
 
 <%def name="tailbone_product_lookup_component()">
   <script type="text/javascript">
 
     const TailboneProductLookup = {
         template: '#tailbone-product-lookup-template',
+        props: {
+            product: {
+                type: Object,
+            },
+            autocompleteUrl: {
+                type: String,
+                default: '${url('products.autocomplete')}',
+            },
+        },
         data() {
             return {
-                showingDialog: false,
+                autocompleteValue: '',
+                autocompleteOptions: [],
+
+                lookupShowDialog: false,
 
                 searchTerm: null,
                 searchTermLastUsed: null,
 
                 searchProductKey: true,
                 searchVendorItemCode: true,
                 searchProductBrand: true,
@@ -183,52 +237,86 @@
                 searchResultsLoading: false,
                 searchResultsElided: 0,
                 searchResultSelected: null,
             }
         },
         methods: {
 
-            showDialog(term) {
+            focus() {
+                if (!this.product) {
+                    this.$refs.productAutocomplete.focus()
+                }
+            },
+
+            clearSelection(focus) {
+
+                // clear data
+                this.autocompleteValue = ''
+                this.$emit('selected', null)
+
+                // maybe set focus to our (autocomplete) component
+                if (focus) {
+                    this.$nextTick(() => {
+                        this.focus()
+                    })
+                }
+            },
+
+            getAutocompleteOptions: debounce(function (entry) {
+
+                // since the `@typing` event from buefy component does not
+                // "self-regulate" in any way, we a) use `debounce` above,
+                // but also b) skip the search unless we have at least 3
+                // characters of input from user
+                if (entry.length < 3) {
+                    this.data = []
+                    return
+                }
+
+                // and perform the search
+                this.$http.get(this.autocompleteUrl + '?term=' + encodeURIComponent(entry))
+                    .then(({ data }) => {
+                        this.autocompleteOptions = data
+                    }).catch((error) => {
+                        this.autocompleteOptions = []
+                        throw error
+                    })
+            }),
+
+            autocompleteSelected(option) {
+                this.$emit('selected', {
+                    uuid: option.value,
+                    full_description: option.label,
+                    url: option.url,
+                    image_url: option.image_url,
+                })
+            },
 
+            lookupInit() {
                 this.searchResultSelected = null
+                this.lookupShowDialog = true
+
+                this.$nextTick(() => {
 
-                if (term !== undefined) {
-                    this.searchTerm = term
-                    // perform search if invoked with new term
-                    if (term != this.searchTermLastUsed) {
+                    this.searchTerm = this.autocompleteValue
+                    if (this.searchTerm != this.searchTermLastUsed) {
                         this.searchTermLastUsed = null
                         this.performSearch()
                     }
-                } else {
-                    this.searchTerm = this.searchTermLastUsed
-                }
 
-                this.showingDialog = true
-                this.$nextTick(() => {
                     this.$refs.searchTermInput.focus()
                 })
             },
 
             searchTermInputKeydown(event) {
                 if (event.which == 13) {
                     this.performSearch()
                 }
             },
 
-            cancelDialog() {
-                this.searchResultSelected = null
-                this.showingDialog = false
-                this.$emit('canceled')
-            },
-
-            selectResult() {
-                this.showingDialog = false
-                this.$emit('selected', this.searchResultSelected)
-            },
-
             performSearch() {
                 if (this.searchResultsLoading) {
                     return
                 }
 
                 if (!this.searchTerm || !this.searchTerm.length) {
                     this.$refs.searchTermInput.focus()
@@ -251,14 +339,24 @@
                 this.$http.get(url, {params: params}).then((response) => {
                     this.searchTermLastUsed = params.term
                     this.searchResults = response.data.results
                     this.searchResultsElided = response.data.elided
                     this.searchResultsLoading = false
                 })
             },
+
+            selectResult() {
+                this.lookupShowDialog = false
+                this.$emit('selected', this.searchResultSelected)
+            },
+
+            cancelDialog() {
+                this.searchResultSelected = null
+                this.lookupShowDialog = false
+            },
         },
     }
 
     Vue.component('tailbone-product-lookup', TailboneProductLookup)
 
   </script>
 </%def>
```

### Comparing `Tailbone-0.9.9/tailbone/templates/products/pending/view.mako` & `Tailbone-0.9.90/tailbone/templates/products/pending/view.mako`

 * *Files 27% similar despite different names*

```diff
@@ -1,81 +1,56 @@
 ## -*- coding: utf-8; -*-
 <%inherit file="/master/view.mako" />
+<%namespace name="product_lookup" file="/products/lookup.mako" />
 
-<%def name="object_helpers()">
-  ${parent.object_helpers()}
-  % if instance.custorder_item_records:
-      <nav class="panel">
-        <p class="panel-heading">Cross-Reference</p>
-        <div class="panel-block">
-          <div style="display: flex; flex-direction: column;">
-            <p class="block">
-              This ${model_title} is referenced by the following<br />
-              Customer Order Items:
-            </p>
-            <ul class="list">
-              % for item in instance.custorder_item_records:
-                  <li class="list-item">
-                    ${h.link_to('#{}-{}'.format(item.order.id, item.sequence), url('custorders.items.view', uuid=item.uuid))}
-                  </li>
-              % endfor
-            </ul>
-          </div>
-        </div>
-      </nav>
-  % endif
+<%def name="render_this_page_template()">
+  ${parent.render_this_page_template()}
+  ${product_lookup.tailbone_product_lookup_template()}
+</%def>
 
-  % if instance.status_code == enum.PENDING_PRODUCT_STATUS_PENDING and master.has_perm('resolve_product'):
-      <nav class="panel">
-        <p class="panel-heading">Tools</p>
-        <div class="panel-block">
-          <div style="display: flex; flex-direction: column;">
-            <div class="buttons">
-              <b-button type="is-primary"
-                        @click="resolveProductInit()"
-                        icon-pack="fas"
-                        icon-left="object-ungroup">
-                Resolve Product
-              </b-button>
-            </div>
-          </div>
-        </div>
-      </nav>
+<%def name="page_content()">
+  ${parent.page_content()}
 
+  % if master.has_perm('ignore_product') and instance.status_code in (enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY):
+      ${h.form(master.get_action_url('ignore_product', instance), ref='ignoreProductForm')}
+      ${h.csrf_token(request)}
+      ${h.end_form()}
+  % endif
+
+  % if master.has_perm('resolve_product') and instance.status_code in (enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY, enum.PENDING_PRODUCT_STATUS_IGNORED):
       <b-modal has-modal-card
                :active.sync="resolveProductShowDialog">
         <div class="modal-card">
           ${h.form(url('{}.resolve_product'.format(route_prefix), uuid=instance.uuid), ref='resolveProductForm')}
           ${h.csrf_token(request)}
 
           <header class="modal-card-head">
             <p class="modal-card-title">Resolve Product</p>
           </header>
 
           <section class="modal-card-body">
             <p class="block">
-              If this Product already exists, you can declare that by
+              If this product already exists, you can declare that by
               identifying the record below.
             </p>
             <p class="block">
               The app will take care of updating any Customer Orders
               etc.  as needed once you declare the match.
             </p>
-            <b-field grouped>
-              <b-field label="Pending">
-                <span>${instance.full_description}</span>
-              </b-field>
-              <b-field label="Actual Product" expanded>
-                <tailbone-autocomplete name="product_uuid"
-                                       v-model="resolveProductUUID"
-                                       ref="resolveProductAutocomplete"
-                                       service-url="${url('products.autocomplete')}">
-                </tailbone-autocomplete>
-              </b-field>
+            <b-field label="Pending Product">
+              <span>${instance.full_description}</span>
+            </b-field>
+            <b-field label="Actual Product" expanded>
+              <tailbone-product-lookup ref="productLookup"
+                                       autocomplete-url="${url('products.autocomplete_special', key='with_key')}"
+                                       :product="actualProduct"
+                                       @selected="productSelected">
+              </tailbone-product-lookup>
             </b-field>
+            ${h.hidden('product_uuid', **{':value': 'resolveProductUUID'})}
           </section>
 
           <footer class="modal-card-foot">
             <b-button @click="resolveProductShowDialog = false">
               Cancel
             </b-button>
             <b-button type="is-primary"
@@ -92,39 +67,67 @@
   % endif
 </%def>
 
 <%def name="modify_this_page_vars()">
   ${parent.modify_this_page_vars()}
   <script type="text/javascript">
 
-    ThisPageData.resolveProductShowDialog = false
-    ThisPageData.resolveProductUUID = null
-    ThisPageData.resolveProductSubmitting = false
-
-    ThisPage.computed.resolveProductSubmitDisabled = function() {
-        if (this.resolveProductSubmitting) {
-            return true
+    % if master.has_perm('ignore_product') and instance.status_code in (enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY):
+
+        ThisPage.methods.ignoreProductInit = function() {
+            if (!confirm("Really ignore this product?\n\n"
+                         + "This will leave it unresolved, but hidden via default filters.")) {
+                return
+            }
+            this.$refs.ignoreProductForm.submit()
+        }
+
+    % endif
+
+    % if master.has_perm('resolve_product') and instance.status_code in (enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY, enum.PENDING_PRODUCT_STATUS_IGNORED):
+
+        ThisPageData.resolveProductShowDialog = false
+        ThisPageData.resolveProductUUID = null
+        ThisPageData.resolveProductSubmitting = false
+
+        ThisPage.computed.resolveProductSubmitDisabled = function() {
+            if (this.resolveProductSubmitting) {
+                return true
+            }
+            if (!this.resolveProductUUID) {
+                return true
+            }
+            return false
         }
-        if (!this.resolveProductUUID) {
-            return true
+
+        ThisPage.methods.resolveProductInit = function() {
+            this.resolveProductUUID = null
+            this.resolveProductShowDialog = true
+            this.$nextTick(() => {
+                this.$refs.productLookup.focus()
+            })
+        }
+
+        ThisPage.methods.resolveProductSubmit = function() {
+            this.resolveProductSubmitting = true
+            this.$refs.resolveProductForm.submit()
         }
-        return false
-    }
 
-    ThisPage.methods.resolveProductInit = function() {
-        this.resolveProductUUID = null
-        this.resolveProductShowDialog = true
-        this.$nextTick(() => {
-            this.$refs.resolveProductAutocomplete.focus()
-        })
-    }
-
-    ThisPage.methods.resolveProductSubmit = function() {
-        this.resolveProductSubmitting = true
-        this.$refs.resolveProductForm.submit()
-    }
+        ThisPageData.actualProduct = null
+
+        ThisPage.methods.productSelected = function(product) {
+           this.actualProduct = product
+           this.resolveProductUUID = product ? product.uuid : null
+        }
+
+    % endif
 
   </script>
 </%def>
 
+<%def name="make_this_page_component()">
+  ${parent.make_this_page_component()}
+  ${product_lookup.tailbone_product_lookup_component()}
+</%def>
+
 
 ${parent.body()}
```

#### html2text {}

```diff
@@ -1,30 +1,31 @@
-## -*- coding: utf-8; -*- <%inherit file="/master/view.mako" /> <%def
-name="object_helpers()"> ${parent.object_helpers()} % if
-instance.custorder_item_records:
-Cross-Reference
-This ${model_title} is referenced by the following
-Customer Order Items:
-    * % for item in instance.custorder_item_records:
-    * ${h.link_to('#{}-{}'.format(item.order.id, item.sequence), url
-      ('custorders.items.view', uuid=item.uuid))}
-    * % endfor
-% endif % if instance.status_code == enum.PENDING_PRODUCT_STATUS_PENDING and
-master.has_perm('resolve_product'):
-Tools
-click="resolveProductInit()" icon-pack="fas" icon-left="object-ungroup">
-Resolve Product
+## -*- coding: utf-8; -*- <%inherit file="/master/view.mako" /> <%namespace
+name="product_lookup" file="/products/lookup.mako" /> <%def
+name="render_this_page_template()"> ${parent.render_this_page_template()} $
+{product_lookup.tailbone_product_lookup_template()}
+def> <%def name="page_content()"> ${parent.page_content()} % if master.has_perm
+('ignore_product') and instance.status_code in
+(enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY): $
+{h.form(master.get_action_url('ignore_product', instance),
+ref='ignoreProductForm')} ${h.csrf_token(request)} ${h.end_form()} % endif % if
+master.has_perm('resolve_product') and instance.status_code in
+(enum.PENDING_PRODUCT_STATUS_PENDING, enum.PENDING_PRODUCT_STATUS_READY,
+enum.PENDING_PRODUCT_STATUS_IGNORED):
 ${h.form(url('{}.resolve_product'.format(route_prefix), uuid=instance.uuid),
 ref='resolveProductForm')} ${h.csrf_token(request)}
 Resolve Product
-If this Product already exists, you can declare that by identifying the record
+If this product already exists, you can declare that by identifying the record
 below.
 The app will take care of updating any Customer Orders etc. as needed once you
 declare the match.
 ${instance.full_description}
+product="actualProduct" @selected="productSelected"> ${h.hidden('product_uuid',
+**{':value': 'resolveProductUUID'})}
 click="resolveProductShowDialog = false"> Cancel
 disabled="resolveProductSubmitDisabled" @click="resolveProductSubmit()" icon-
 pack="fas" icon-left="object-ungroup"> {{ resolveProductSubmitting ? "Working,
 please wait..." : "I declare these are the same" }} ${h.end_form()}
 % endif
 def> <%def name="modify_this_page_vars()"> ${parent.modify_this_page_vars()}
+def> <%def name="make_this_page_component()"> ${parent.make_this_page_component
+()} ${product_lookup.tailbone_product_lookup_component()}
 def> ${parent.body()}
```

### Comparing `Tailbone-0.9.9/tailbone/templates/products/index.mako` & `Tailbone-0.9.90/tailbone/templates/products/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/products/configure.mako` & `Tailbone-0.9.90/tailbone/templates/products/configure.mako`

 * *Files 1% similar despite different names*

```diff
@@ -46,15 +46,15 @@
     </b-field>
 
   </div>
 
   <h3 class="block is-size-3">Handling</h3>
   <div class="block" style="padding-left: 2rem;">
 
-    <b-field message="If set, GPC values like 002XXXXXYYYYY-Z will be converted to 002XXXXX00000-Z for lokkup">
+    <b-field message="If set, GPC values like 002XXXXXYYYYY-Z will be converted to 002XXXXX00000-Z for lookup">
       <b-checkbox name="rattail.products.convert_type2_for_gpc_lookup"
                   v-model="simpleSettings['rattail.products.convert_type2_for_gpc_lookup']"
                   native-value="true"
                   @input="settingsNeedSaved = true">
         Auto-convert Type 2 UPC for sake of lookup
       </b-checkbox>
     </b-field>
```

### Comparing `Tailbone-0.9.9/tailbone/templates/units-of-measure/index.mako` & `Tailbone-0.9.90/tailbone/templates/units-of-measure/index.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/rollover.mako` & `Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/rollover.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/trainwreck/transactions/configure.mako` & `Tailbone-0.9.90/tailbone/templates/trainwreck/transactions/configure.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/templates/progress.mako` & `Tailbone-0.9.90/tailbone/templates/progress.mako`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/handler.py` & `Tailbone-0.9.90/tailbone/handler.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/forms/receiving.py` & `Tailbone-0.9.90/tailbone/forms/receiving.py`

 * *Files 4% similar despite different names*

```diff
@@ -48,14 +48,15 @@
                               validator=valid_purchase_batch_row)
 
     mode = colander.SchemaNode(colander.String(),
                                validator=colander.OneOf([
                                    'received',
                                    'damaged',
                                    'expired',
+                                   'missing',
                                    # 'mispick',
                                ]))
 
     cases = colander.SchemaNode(colander.Decimal(),
                                 missing=colander.null)
 
     units = colander.SchemaNode(colander.Decimal(),
```

### Comparing `Tailbone-0.9.9/tailbone/forms/common.py` & `Tailbone-0.9.90/tailbone/forms/common.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/forms/widgets.py` & `Tailbone-0.9.90/tailbone/forms/widgets.py`

 * *Files 12% similar despite different names*

```diff
@@ -29,22 +29,22 @@
 import decimal
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import tags, HTML
 
 from tailbone.db import Session
-from tailbone.forms.types import ProductQuantity
 
 
 class ReadonlyWidget(dfwidget.HiddenWidget):
 
     readonly = True
 
     def serialize(self, field, cstruct, **kw):
+        """ """
         if cstruct in (colander.null, None):
             cstruct = ''
         # TODO: is this hacky?
         text = kw.get('text')
         if not text:
             text = field.parent.tailbone_form.render_field_value(field.name)
         return HTML.tag('span', text) + tags.hidden(field.name, value=cstruct, id=field.oid)
@@ -74,23 +74,25 @@
     percent value, e.g. ``0.36135`` - but the UI should represent this as a
     "human-friendly" value, e.g. ``36.135 %``.
     """
     template = 'percentinput'
     autocomplete = 'off'
 
     def serialize(self, field, cstruct, **kw):
+        """ """
         if cstruct not in (colander.null, None):
             # convert "traditional" value to "human-friendly"
             value = decimal.Decimal(cstruct) * 100
             value = value.quantize(decimal.Decimal('0.001'))
             cstruct = str(value)
-        return super(PercentInputWidget, self).serialize(field, cstruct, **kw)
+        return super().serialize(field, cstruct, **kw)
 
     def deserialize(self, field, pstruct):
-        pstruct = super(PercentInputWidget, self).deserialize(field, pstruct)
+        """ """
+        pstruct = super().deserialize(field, pstruct)
         if pstruct is colander.null:
             return colander.null
         # convert "human-friendly" value to "traditional"
         try:
             value = decimal.Decimal(pstruct)
         except decimal.InvalidOperation:
             raise colander.Invalid(field.schema, "Invalid decimal string: {}".format(pstruct))
@@ -105,24 +107,28 @@
     need to ensure user provides cases *or* units but not both.
     """
     template = 'cases_units'
     amount_required = False
     one_amount_only = False
 
     def serialize(self, field, cstruct, **kw):
+        """ """
         if cstruct in (colander.null, None):
             cstruct = ''
         readonly = kw.get('readonly', self.readonly)
         kw['cases'] = cstruct['cases'] or ''
         kw['units'] = cstruct['units'] or ''
         template = readonly and self.readonly_template or self.template
         values = self.get_template_values(field, cstruct, kw)
         return field.renderer(template, **values)
 
     def deserialize(self, field, pstruct):
+        """ """
+        from tailbone.forms.types import ProductQuantity
+
         if pstruct is colander.null:
             return colander.null
 
         schema = ProductQuantity()
         try:
             validated = schema.deserialize(pstruct)
         except colander.Invalid as exc:
@@ -161,15 +167,15 @@
 
     def set_template_values(self, **kw):
         if not hasattr(self, 'extra_template_values'):
             self.extra_template_values = {}
         self.extra_template_values.update(kw)
 
     def get_template_values(self, field, cstruct, kw):
-        values = super(CustomSelectWidget, self).get_template_values(field, cstruct, kw)
+        values = super().get_template_values(field, cstruct, kw)
         if hasattr(self, 'extra_template_values'):
             values.update(self.extra_template_values)
         return values
 
 
 class DynamicSelectWidget(CustomSelectWidget):
     """
@@ -204,14 +210,15 @@
     default_options = (
         ('changeMonth', True),
         ('changeYear', True),
         ('dateFormat', 'yy-mm-dd'),
     )
 
     def serialize(self, field, cstruct, **kw):
+        """ """
         if cstruct in (colander.null, None):
             cstruct = ''
         readonly = kw.get('readonly', self.readonly)
         template = readonly and self.readonly_template or self.template
         options = dict(
             kw.get('options') or self.options or self.default_options
         )
@@ -231,14 +238,47 @@
     type_name = 'text'
     requirements = None
     default_options = (
         ('showPeriod', True),
     )
 
 
+class FalafelDateTimeWidget(dfwidget.DateTimeInputWidget):
+    """
+    Custom widget for rattail UTC datetimes
+    """
+    template = 'datetime_falafel'
+
+    def serialize(self, field, cstruct, **kw):
+        """ """
+        readonly = kw.get('readonly', self.readonly)
+        values = self.get_template_values(field, cstruct, kw)
+        template = self.readonly_template if readonly else self.template
+        return field.renderer(template, **values)
+
+    def deserialize(self, field, pstruct):
+        """ """
+        if pstruct  == '':
+            return colander.null
+        return pstruct
+
+
+class FalafelTimeWidget(dfwidget.TimeInputWidget):
+    """
+    Custom widget for simple time fields
+    """
+    template = 'time_falafel'
+
+    def deserialize(self, field, pstruct):
+        """ """
+        if pstruct  == '':
+            return colander.null
+        return pstruct
+
+
 class JQueryAutocompleteWidget(dfwidget.AutocompleteInputWidget):
     """ 
     Uses the jQuery autocomplete plugin, instead of whatever it is deform uses
     by default.
     """
     template = 'autocomplete_jquery'
     requirements = None
@@ -253,14 +293,15 @@
 
     default_options = (
         ('autoFocus', True),
     )
     options = None
 
     def serialize(self, field, cstruct, **kw):
+        """ """
         if 'delay' in kw or getattr(self, 'delay', None):
             raise ValueError(
                 'AutocompleteWidget does not support *delay* parameter '
                 'any longer.'
             )
         if cstruct in (colander.null, None):
             cstruct = ''
@@ -288,15 +329,32 @@
 class MultiFileUploadWidget(dfwidget.FileUploadWidget):
     """
     Widget to handle multiple (arbitrary number) of file uploads.
     """
     template = 'multi_file_upload'
     requirements = ()
 
+    def serialize(self, field, cstruct, **kw):
+        """ """
+        if cstruct in (colander.null, None):
+            cstruct = []
+
+        if cstruct:
+            for fileinfo in cstruct:
+                uid = fileinfo['uid']
+                if uid not in self.tmpstore:
+                    self.tmpstore[uid] = fileinfo
+
+        readonly = kw.get("readonly", self.readonly)
+        template = readonly and self.readonly_template or self.template
+        values = self.get_template_values(field, cstruct, kw)
+        return field.renderer(template, **values)
+
     def deserialize(self, field, pstruct):
+        """ """
         if pstruct is colander.null:
             return colander.null
 
         # TODO: why is this a thing?  pstruct == [b'']
         if len(pstruct) == 1 and pstruct[0] == b'':
             return colander.null
 
@@ -309,14 +367,15 @@
 
         if not files_data:
             return colander.null
 
         return files_data
 
     def deserialize_upload(self, upload):
+        """ """
         # nb. this logic was copied from parent class and adapted
         # to allow for multiple files.  needs some more love.
 
         uid = None              # TODO?
 
         if hasattr(upload, "file"):
             # the upload control had a file selected
@@ -378,19 +437,21 @@
 
     # instantiate whichever
     return factory(request, **kwargs)
 
 
 class CustomerAutocompleteWidget(JQueryAutocompleteWidget):
     """
-    Autocomplete widget for a Customer reference field.
+    Autocomplete widget for a
+    :class:`~rattail:rattail.db.model.customers.Customer` reference
+    field.
     """
 
     def __init__(self, request, *args, **kwargs):
-        super(CustomerAutocompleteWidget, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         self.request = request
         model = self.request.rattail_config.get_model()
 
         # must figure out URL providing autocomplete service
         if 'service_url' not in kwargs:
 
             # caller can just pass 'url' instead of 'service_url'
@@ -402,49 +463,50 @@
 
         # TODO
         if 'input_callback' not in kwargs:
             if 'input_handler' in kwargs:
                 self.input_callback = input_handler
 
     def serialize(self, field, cstruct, **kw):
-
+        """ """
         # fetch customer to provide button label, if we have a value
         if cstruct:
             model = self.request.rattail_config.get_model()
             customer = Session.get(model.Customer, cstruct)
             if customer:
                 self.field_display = str(customer)
 
-        return super(CustomerAutocompleteWidget, self).serialize(
+        return super().serialize(
             field, cstruct, **kw)
 
 
 class CustomerDropdownWidget(dfwidget.SelectWidget):
     """
-    Dropdown widget for a Customer reference field.
+    Dropdown widget for a
+    :class:`~rattail:rattail.db.model.customers.Customer` reference
+    field.
     """
 
     def __init__(self, request, *args, **kwargs):
-        super(CustomerDropdownWidget, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         self.request = request
+        app = self.request.rattail_config.get_app()
 
         # must figure out dropdown values, if they weren't given
         if 'values' not in kwargs:
 
             # use what caller gave us, if they did
             if 'customers' in kwargs:
                 customers = kwargs['customers']
                 if callable(customers):
                     customers = customers()
 
             else: # default customer list
-                model = self.request.rattail_config.get_model()
-                customers = Session.query(model.Customer)\
-                                   .order_by(model.Customer.name)\
-                                   .all()
+                customers = app.get_clientele_handler()\
+                               .get_all_customers(Session())
 
             # convert customer list to option values
             self.values = [(c.uuid, c.name)
                            for c in customers]
 
 
 class DepartmentWidget(dfwidget.SelectWidget):
@@ -467,8 +529,97 @@
                                  .order_by(model.Department.number)
             values = [(dept.uuid, str(dept))
                       for dept in departments]
             if not kwargs.pop('required', True):
                 values.insert(0, ('', "(none)"))
             kwargs['values'] = values
 
-        super(DepartmentWidget, self).__init__(**kwargs)
+        super().__init__(**kwargs)
+
+
+def make_vendor_widget(request, **kwargs):
+    """
+    Make a vendor widget; will be either autocomplete or dropdown
+    depending on config.
+    """
+    # use autocomplete widget by default
+    factory = VendorAutocompleteWidget
+
+    # caller may request dropdown widget
+    if kwargs.pop('dropdown', False):
+        factory = VendorDropdownWidget
+
+    else: # or, config may say to use dropdown
+        app = request.rattail_config.get_app()
+        vendor_handler = app.get_vendor_handler()
+        if vendor_handler.choice_uses_dropdown():
+            factory = VendorDropdownWidget
+
+    # instantiate whichever
+    return factory(request, **kwargs)
+
+
+class VendorAutocompleteWidget(JQueryAutocompleteWidget):
+    """
+    Autocomplete widget for a Vendor reference field.
+    """
+
+    def __init__(self, request, *args, **kwargs):
+        super().__init__(*args, **kwargs)
+        self.request = request
+        model = self.request.rattail_config.get_model()
+
+        # must figure out URL providing autocomplete service
+        if 'service_url' not in kwargs:
+
+            # caller can just pass 'url' instead of 'service_url'
+            if 'url' in kwargs:
+                self.service_url = kwargs['url']
+
+            else: # use default url
+                self.service_url = self.request.route_url('vendors.autocomplete')
+
+        # # TODO
+        # if 'input_callback' not in kwargs:
+        #     if 'input_handler' in kwargs:
+        #         self.input_callback = input_handler
+
+    def serialize(self, field, cstruct, **kw):
+        """ """
+        # fetch vendor to provide button label, if we have a value
+        if cstruct:
+            model = self.request.rattail_config.get_model()
+            vendor = Session.get(model.Vendor, cstruct)
+            if vendor:
+                self.field_display = str(vendor)
+
+        return super().serialize(
+            field, cstruct, **kw)
+
+
+class VendorDropdownWidget(dfwidget.SelectWidget):
+    """
+    Dropdown widget for a Vendor reference field.
+    """
+
+    def __init__(self, request, *args, **kwargs):
+        super().__init__(*args, **kwargs)
+        self.request = request
+
+        # must figure out dropdown values, if they weren't given
+        if 'values' not in kwargs:
+
+            # use what caller gave us, if they did
+            if 'vendors' in kwargs:
+                vendors = kwargs['vendors']
+                if callable(vendors):
+                    vendors = vendors()
+
+            else: # default vendor list
+                model = self.request.rattail_config.get_model()
+                vendors = Session.query(model.Vendor)\
+                                   .order_by(model.Vendor.name)\
+                                   .all()
+
+            # convert vendor list to option values
+            self.values = [(c.uuid, c.name)
+                           for c in vendors]
```

### Comparing `Tailbone-0.9.9/tailbone/forms/core.py` & `Tailbone-0.9.90/tailbone/forms/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,16 +20,19 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Forms Core
 """
 
+import hashlib
 import json
 import logging
+import warnings
+from collections import OrderedDict
 
 import sqlalchemy as sa
 from sqlalchemy import orm
 from sqlalchemy.ext.associationproxy import AssociationProxy, ASSOCIATION_PROXY
 
 from rattail.time import localtime
 from rattail.util import prettify, pretty_boolean, pretty_quantity
@@ -332,24 +335,25 @@
     auto_disable_cancel = True
 
     def __init__(self, fields=None, schema=None, request=None, readonly=False, readonly_fields=[],
                  model_instance=None, model_class=None, appstruct=UNSPECIFIED, nodes={}, enums={}, labels={},
                  assume_local_times=False, renderers=None, renderer_kwargs={},
                  hidden={}, widgets={}, defaults={}, validators={}, required={}, helptext={}, focus_spec=None,
                  action_url=None, cancel_url=None, component='tailbone-form',
-                 vuejs_field_converters={},
+                 vuejs_component_kwargs=None, vuejs_field_converters={},
                  # TODO: ugh this is getting out hand!
                  can_edit_help=False, edit_help_url=None, route_prefix=None,
     ):
         self.fields = None
         if fields is not None:
             self.set_fields(fields)
         self.schema = schema
         if self.fields is None and self.schema:
             self.set_fields([f.name for f in self.schema])
+        self.grouping = None
         self.request = request
         self.readonly = readonly
         self.readonly_fields = set(readonly_fields or [])
         self.model_instance = model_instance
         self.model_class = model_class
         if self.model_instance and not self.model_class and not isinstance(self.model_instance, dict):
             self.model_class = type(self.model_instance)
@@ -367,18 +371,20 @@
         self.renderer_kwargs = renderer_kwargs or {}
         self.hidden = hidden or {}
         self.widgets = widgets or {}
         self.defaults = defaults or {}
         self.validators = validators or {}
         self.required = required or {}
         self.helptext = helptext or {}
+        self.dynamic_helptext = {}
         self.focus_spec = focus_spec
         self.action_url = action_url
         self.cancel_url = cancel_url
         self.component = component
+        self.vuejs_component_kwargs = vuejs_component_kwargs or {}
         self.vuejs_field_converters = vuejs_field_converters or {}
         self.can_edit_help = can_edit_help
         self.edit_help_url = edit_help_url
         self.route_prefix = route_prefix
 
     def __iter__(self):
         return iter(self.fields)
@@ -400,14 +406,17 @@
         """
         if not self.model_class:
             raise ValueError("Must define model_class to use make_fields()")
 
         return get_fieldnames(self.request.rattail_config, self.model_class,
                               columns=True, proxies=True, relations=True)
 
+    def set_grouping(self, items):
+        self.grouping = OrderedDict(items)
+
     def make_renderers(self):
         """
         Return a default set of field renderers, based on :attr:`model_class`.
         """
         if not self.model_class:
             raise ValueError("Must define model_class to use make_renderers()")
 
@@ -578,27 +587,42 @@
         self.nodes[key] = node
 
         # must explicitly replace node, if we already have a schema
         if self.schema:
             self.schema[key] = node
 
     def set_type(self, key, type_, **kwargs):
+
         if type_ == 'datetime':
             self.set_renderer(key, self.render_datetime)
+
+        elif type_ == 'datetime_falafel':
+            self.set_renderer(key, self.render_datetime)
+            self.set_node(key, types.FalafelDateTime(request=self.request))
+            if kwargs.get('helptext'):
+                app = self.request.rattail_config.get_app()
+                timezone = app.get_timezone()
+                self.set_helptext(key, f"NOTE: all times are local to {timezone}")
+
         elif type_ == 'datetime_local':
             self.set_renderer(key, self.render_datetime_local)
         elif type_ == 'date_plain':
             self.set_widget(key, PlainDateWidget())
         elif type_ == 'date_jquery':
             # TODO: is this safe / a good idea?
             # self.set_node(key, colander.Date())
             self.set_widget(key, JQueryDateWidget())
+
         elif type_ == 'time_jquery':
             self.set_node(key, types.JQueryTime())
             self.set_widget(key, JQueryTimeWidget())
+
+        elif type_ == 'time_falafel':
+            self.set_node(key, types.FalafelTime(request=self.request))
+
         elif type_ == 'duration':
             self.set_renderer(key, self.render_duration)
         elif type_ == 'boolean':
             self.set_renderer(key, self.render_boolean)
             self.set_widget(key, dfwidget.CheckboxWidget())
         elif type_ == 'currency':
             self.set_renderer(key, self.render_currency)
@@ -632,19 +656,33 @@
                                             name='upload')
 
             kw = {'name': key,
                   'title': self.get_label(key),
                   'widget': MultiFileUploadWidget(tmpstore)}
             # if 'required' in kwargs and not kwargs['required']:
             #     kw['missing'] = colander.null
+            if kwargs.get('validate_unique'):
+                kw['validator'] = self.validate_multiple_files_unique
             files_node = colander.SequenceSchema(file_node, **kw)
             self.set_node(key, files_node)
         else:
             raise ValueError("unknown type for '{}' field: {}".format(key, type_))
 
+    def validate_multiple_files_unique(self, node, value):
+
+        # get SHA256 hash for each file; error if duplicates encountered
+        hashes = {}
+        for fileinfo in value:
+            fp = fileinfo['fp']
+            fp.seek(0)
+            filehash = hashlib.sha256(fp.read()).hexdigest()
+            if filehash in hashes:
+                node.raise_invalid(f"Duplicate file detected: {fileinfo['filename']}")
+            hashes[filehash] = fileinfo
+
     def set_enum(self, key, enum, empty=None):
         if enum:
             self.enums[key] = enum
             self.set_type(key, 'enum')
             values = list(enum.items())
             if empty:
                 values.insert(0, empty)
@@ -700,17 +738,16 @@
         key.
 
         :param key: Normally this the name of one of the fields
            contained in the form.  It can also be ``None`` in which
            case the validator pertains to the form at large instead of
            one of the fields.
 
-           TODO: what should the validator look like?
-
-        :param validator: Callable validator for the node.
+        :param validator: Callable which accepts ``(node, value)``
+           args.
         """
         self.validators[key] = validator
 
         # we normally apply the validator when creating the schema, so
         # if this form already has a schema, then go ahead and apply
         # the validator to it
         if self.schema and key in self.schema:
@@ -724,19 +761,24 @@
 
     def set_default(self, key, value):
         """
         Set the default value for a given field.
         """
         self.defaults[key] = value
 
-    def set_helptext(self, key, value):
+    def set_helptext(self, key, value, dynamic=False):
         """
         Set the help text for a given field.
         """
-        self.helptext[key] = value
+        # nb. must avoid newlines, they cause some weird "blank page" error?!
+        self.helptext[key] = value.replace('\n', ' ')
+        if value and dynamic:
+            self.dynamic_helptext[key] = True
+        else:
+            self.dynamic_helptext.pop(key, None)
 
     def has_helptext(self, key):
         """
         Returns boolean indicating whether the given field has accompanying
         help text.
         """
         return key in self.helptext
@@ -874,14 +916,19 @@
         if isinstance(value, dfwidget.filedict):
             # TODO: we used to always/only return 'null' here but hopefully
             # this also works, to show existing filename when present
             if value and value['filename']:
                 return json.dumps({'name': value['filename']})
             return 'null'
 
+        elif isinstance(value, list) and all([isinstance(f, dfwidget.filedict)
+                                              for f in value]):
+            return json.dumps([{'name': f['filename']}
+                               for f in value])
+
         app = self.request.rattail_config.get_app()
         value = app.json_friendly(value)
         return json.dumps(value)
 
     def get_error_messages(self, field):
         if field.error:
             return field.error.messages()
@@ -898,14 +945,33 @@
         return dump
 
     def field_visible(self, field):
         if self.hidden and self.hidden.get(field):
             return False
         return True
 
+    def set_vuejs_component_kwargs(self, **kwargs):
+        self.vuejs_component_kwargs.update(kwargs)
+
+    def render_vuejs_component(self):
+        """
+        Render the Vue.js component HTML for the form.
+
+        Most typically this is something like:
+
+        .. code-block:: html
+
+           <tailbone-form :configure-fields-help="configureFieldsHelp">
+           </tailbone-form>
+        """
+        kwargs = dict(self.vuejs_component_kwargs)
+        if self.can_edit_help:
+            kwargs.setdefault(':configure-fields-help', 'configureFieldsHelp')
+        return HTML.tag(self.component, **kwargs)
+
     def render_buefy_field(self, fieldname, bfield_attrs={}):
         """
         Render the given field in a Buefy-compatible way.  Note that
         this is meant to render *editable* fields, i.e. showing a
         widget, unless the field input is hidden.  In other words it's
         not for "readonly" fields.
         """
@@ -927,44 +993,48 @@
                 ':horizontal': 'true',
             }
 
             # add some magic for file input fields
             if field and isinstance(field.schema.typ, deform.FileData):
                 attrs['class_'] = 'file'
 
-            # show helptext if present
-            # TODO: older logic did this only if field was *not*
-            # readonly, perhaps should add that back..
-            if self.has_helptext(fieldname):
-                attrs['message'] = self.render_helptext(fieldname)
+            # next we will build array of messages to display..some
+            # fields always show a "helptext" msg, and some may have
+            # validation errors..
+            field_type = None
+            messages = []
 
             # show errors if present
             error_messages = self.get_error_messages(field) if field else None
             if error_messages:
+                field_type = 'is-danger'
+                messages.extend(error_messages)
 
-                # TODO: this surely can't be what we ought to do
-                # here..?  seems like we must pass JS but not JSON,
-                # sort of, so we custom-write the JS code to ensure
-                # single instead of double quotes delimit strings
-                # within the code.
-                message = '[{}]'.format(', '.join([
-                    "'{}'".format(msg.replace("'", r"\'"))
-                    for msg in error_messages]))
+            # show helptext if present
+            # TODO: older logic did this only if field was *not*
+            # readonly, perhaps should add that back..
+            if self.has_helptext(fieldname):
+                messages.append(self.render_helptext(fieldname))
 
-                attrs.update({
-                    'type': 'is-danger',
-                    ':message': message,
-                })
+            # ..okay now we can declare the field messages and type
+            if field_type:
+                attrs['type'] = field_type
+            if messages:
+                attrs[':message'] = '[{}]'.format(', '.join([
+                    "'{}'".format(msg.replace("'", r"\'"))
+                    for msg in messages]))
 
             # merge anything caller provided
             attrs.update(bfield_attrs)
 
             # render the field widget or whatever
             if self.readonly or fieldname in self.readonly_fields:
                 html = self.render_field_value(fieldname) or HTML.tag('span')
+                if type(html) is str:
+                    html = HTML.tag('span', c=[html])
             elif field:
                 html = field.serialize(**self.get_renderer_kwargs(fieldname))
                 html = HTML.literal(html)
 
             # may need a complex label
             label_contents = [label]
 
@@ -1150,57 +1220,59 @@
                 return getattr(record, field_name, None)
 
         # TODO: is this always safe to do?
         elif self.defaults and field_name in self.defaults:
             return self.defaults[field_name]
 
     def validate(self, *args, **kwargs):
-        if kwargs.pop('newstyle', False):
-            # yay, new behavior!
-            if hasattr(self, 'validated'):
-                del self.validated
-            if self.request.method != 'POST':
-                return False
-
-            controls = get_form_data(self.request).items()
-
-            # unfortunately the normal form logic (i.e. peppercorn) is
-            # expecting all values to be strings, whereas if our data
-            # came from JSON body, may have given us some Pythonic
-            # objects.  so here we must convert them *back* to strings
-            # TODO: this seems like a hack, i must be missing something
-            # TODO: also this uses same "JSON" check as get_form_data()
-            if self.request.is_xhr and not self.request.POST:
-                controls = [[key, val] for key, val in controls]
-                for i in range(len(controls)):
-                    key, value = controls[i]
-                    if value is None:
-                        controls[i][1] = ''
-                    elif value is True:
-                        controls[i][1] = 'true'
-                    elif value is False:
-                        controls[i][1] = 'false'
-                    elif not isinstance(value, str):
-                        controls[i][1] = str(value)
+        """
+        Try to validate the form.
 
-            dform = self.make_deform_form()
-            try:
-                self.validated = dform.validate(controls)
-                return True
-            except deform.ValidationFailure:
-                return False
+        This should work whether data was submitted as classic POST
+        data, or as JSON body.
 
-        else: # legacy behavior
-            raise_error = kwargs.pop('raise_error', True)
-            dform = self.make_deform_form()
-            try:
-                return dform.validate(*args, **kwargs)
-            except deform.ValidationFailure:
-                if raise_error:
-                    raise
+        :returns: ``True`` if form data is valid, otherwise ``False``.
+        """
+        if 'newstyle' in kwargs:
+            warnings.warn("the `newstyle` kwarg is no longer used "
+                          "for Form.validate()",
+                          DeprecationWarning, stacklevel=2)
+
+        if hasattr(self, 'validated'):
+            del self.validated
+        if self.request.method != 'POST':
+            return False
+
+        controls = get_form_data(self.request).items()
+
+        # unfortunately the normal form logic (i.e. peppercorn) is
+        # expecting all values to be strings, whereas if our data
+        # came from JSON body, may have given us some Pythonic
+        # objects.  so here we must convert them *back* to strings
+        # TODO: this seems like a hack, i must be missing something
+        # TODO: also this uses same "JSON" check as get_form_data()
+        if self.request.is_xhr and not self.request.POST:
+            controls = [[key, val] for key, val in controls]
+            for i in range(len(controls)):
+                key, value = controls[i]
+                if value is None:
+                    controls[i][1] = ''
+                elif value is True:
+                    controls[i][1] = 'true'
+                elif value is False:
+                    controls[i][1] = 'false'
+                elif not isinstance(value, str):
+                    controls[i][1] = str(value)
+
+        dform = self.make_deform_form()
+        try:
+            self.validated = dform.validate(controls)
+            return True
+        except deform.ValidationFailure:
+            return False
 
 
 class FieldList(list):
     """
     Convenience wrapper for a form's field list.
     """
```

### Comparing `Tailbone-0.9.9/tailbone/forms/__init__.py` & `Tailbone-0.9.90/tailbone/api/batch/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2018 Lance Edgar
+#  Copyright  2010-2019 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,15 +17,13 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-Forms Library
+Tailbone Web API - Batches
 """
 
 from __future__ import unicode_literals, absolute_import
 
-from . import types
-from . import widgets
-from .core import Form, SimpleFileImport
+from .core import APIBatchView, APIBatchRowView, BatchAPIMasterView
```

### Comparing `Tailbone-0.9.9/tailbone/util.py` & `Tailbone-0.9.90/tailbone/util.py`

 * *Files 6% similar despite different names*

```diff
@@ -21,33 +21,43 @@
 #
 ################################################################################
 """
 Utilities
 """
 
 import datetime
-
-import pytz
-import humanize
 import logging
+import warnings
 
+import humanize
 import markdown
 
 from rattail.time import timezone, make_utc
 from rattail.files import resource_path
 
 import colander
 from pyramid.renderers import get_renderer
 from pyramid.interfaces import IRoutesMapper
 from webhelpers2.html import HTML, tags
 
 
 log = logging.getLogger(__name__)
 
 
+class SortColumn(object):
+    """
+    Generic representation of a sort column, for use with sorting grid
+    data as well as with API.
+    """
+
+    def __init__(self, field_name, model_name=None):
+        self.field_name = field_name
+        self.model_name = model_name
+
+
 def get_csrf_token(request):
     """
     Convenience function to retrieve the effective CSRF token for the given
     request.
     """
     token = request.session.get_csrf_token()
     if token is None:
@@ -192,18 +202,20 @@
 
     :param value: A ``datetime.datetime`` instance.  Note that if this instance
        is not timezone-aware, its timezone is assumed to be UTC.
     """
     if not value:
         return ''
 
+    app = config.get_app()
+
     # Make sure we're dealing with a tz-aware value.  If we're given a naive
     # value, we assume it to be local to the UTC timezone.
     if not value.tzinfo:
-        value = pytz.utc.localize(value)
+        value = app.make_utc(value, tzinfo=True)
 
     # Calculate time diff using UTC.
     time_ago = datetime.datetime.utcnow() - make_utc(value)
 
     # Convert value to local timezone.
     local = timezone(config)
     value = local.normalize(value.astimezone(local))
@@ -227,15 +239,15 @@
         return ''
 
     app = config.get_app()
 
     # Make sure we're dealing with a tz-aware value.  If we're given a naive
     # value, we assume it to be local to the UTC timezone.
     if not value.tzinfo:
-        value = pytz.utc.localize(value)
+        value = app.make_utc(value, tzinfo=True)
 
     # Calculate time diff using UTC.
     time_ago = datetime.datetime.utcnow() - make_utc(value)
 
     # Convert value to local timezone.
     local = timezone(config)
     value = local.normalize(value.astimezone(local))
@@ -318,14 +330,34 @@
     """
     theme = get_effective_theme(rattail_config, theme=theme, session=session)
     theme_path = rattail_config.get('tailbone', 'theme.{}'.format(theme),
                                     default='tailbone:templates/themes/{}'.format(theme))
     return resource_path(theme_path)
 
 
+def get_available_themes(rattail_config, include=None):
+    available = rattail_config.getlist('tailbone', 'themes.keys')
+    if not available:
+        available = rattail_config.getlist('tailbone', 'themes',
+                                           ignore_ambiguous=True)
+        if available:
+            warnings.warn(f"URGENT: instead of 'tailbone.themes', "
+                          f"you should set 'tailbone.themes.keys'",
+                          DeprecationWarning, stacklevel=2)
+        else:
+            available = []
+    if 'default' not in available:
+        available.insert(0, 'default')
+    if include is not None:
+        for theme in include:
+            if theme not in available:
+                available.append(theme)
+    return available
+
+
 def get_effective_theme(rattail_config, theme=None, session=None):
     """
     Validates and returns the "effective" theme.  If you provide a theme, that
     will be used; otherwise it is read from database setting.
     """
     app = rattail_config.get_app()
 
@@ -335,17 +367,15 @@
             session = app.make_session()
             close = True
         theme = app.get_setting(session, 'tailbone.theme') or 'default'
         if close:
             session.close()
 
     # confirm requested theme is available
-    available = rattail_config.getlist('tailbone', 'themes',
-                                       default=['bobcat'])
-    available.append('default')
+    available = get_available_themes(rattail_config)
     if theme not in available:
         raise ValueError("theme not available: {}".format(theme))
 
     return theme
 
 
 def validate_email_address(address):
```

### Comparing `Tailbone-0.9.9/tailbone/progress.py` & `Tailbone-0.9.90/tailbone/progress.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/auth.py` & `Tailbone-0.9.90/tailbone/auth.py`

 * *Files 16% similar despite different names*

```diff
@@ -21,21 +21,23 @@
 #
 ################################################################################
 """
 Authentication & Authorization
 """
 
 import logging
+import re
 
 from rattail import enum
 from rattail.util import prettify, NOTSET
 
 from zope.interface import implementer
 from pyramid.interfaces import IAuthorizationPolicy
 from pyramid.security import remember, forget, Everyone, Authenticated
+from pyramid.authentication import SessionAuthenticationPolicy
 
 from tailbone.db import Session
 
 
 log = logging.getLogger(__name__)
 
 
@@ -83,14 +85,45 @@
 def set_session_timeout(request, timeout):
     """
     Set the server-side session timeout to the given value.
     """
     request.session['_timeout'] = timeout or None
 
 
+class TailboneAuthenticationPolicy(SessionAuthenticationPolicy):
+    """
+    Custom authentication policy for Tailbone.
+
+    This is mostly Pyramid's built-in session-based policy, but adds
+    logic to accept Rattail User API Tokens in lieu of current user
+    being identified via the session.
+
+    Note that the traditional Tailbone web app does *not* use this
+    policy, only the Tailbone web API uses it by default.
+    """
+
+    def unauthenticated_userid(self, request):
+
+        # figure out userid from header token if present
+        credentials = request.headers.get('Authorization')
+        if credentials:
+            match = re.match(r'^Bearer (\S+)$', credentials)
+            if match:
+                token = match.group(1)
+                rattail_config = request.registry.settings.get('rattail_config')
+                app = rattail_config.get_app()
+                auth = app.get_auth_handler()
+                user = auth.authenticate_user_token(Session(), token)
+                if user:
+                    return user.uuid
+
+        # otherwise do normal session-based logic
+        return super(TailboneAuthenticationPolicy, self).unauthenticated_userid(request)
+
+
 @implementer(IAuthorizationPolicy)
 class TailboneAuthorizationPolicy(object):
 
     def permits(self, context, principals, permission):
         config = context.request.rattail_config
         model = config.get_model()
         app = config.get_app()
```

### Comparing `Tailbone-0.9.9/tailbone/beaker.py` & `Tailbone-0.9.90/tailbone/beaker.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/app.py` & `Tailbone-0.9.90/tailbone/app.py`

 * *Files 2% similar despite different names*

```diff
@@ -56,24 +56,27 @@
         # available for web requests later
         path = settings.get('rattail.config')
         if not path or not os.path.exists(path):
             raise ConfigurationError("Please set 'rattail.config' in [app:main] section of config "
                                      "to the path of your config file.  Lame, but necessary.")
         rattail_config = make_config(path)
         settings['rattail_config'] = rattail_config
-    rattail_config.configure_logging()
 
     # configure database sessions
     if hasattr(rattail_config, 'rattail_engine'):
         tailbone.db.Session.configure(bind=rattail_config.rattail_engine)
     if hasattr(rattail_config, 'trainwreck_engine'):
         tailbone.db.TrainwreckSession.configure(bind=rattail_config.trainwreck_engine)
     if hasattr(rattail_config, 'tempmon_engine'):
         tailbone.db.TempmonSession.configure(bind=rattail_config.tempmon_engine)
 
+    # maybe set "future" behavior for SQLAlchemy
+    if rattail_config.getbool('rattail.db', 'sqlalchemy_future_mode', usedb=False):
+        tailbone.db.Session.configure(future=True)
+
     # create session wrappers for each "extra" Trainwreck engine
     for key, engine in rattail_config.trainwreck_engines.items():
         if key != 'default':
             Session = scoped_session(sessionmaker(bind=engine))
             register(Session)
             tailbone.db.ExtraTrainwreckSessions[key] = Session
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchasing/batch.py` & `Tailbone-0.9.90/tailbone/views/purchasing/batch.py`

 * *Files 3% similar despite different names*

```diff
@@ -20,15 +20,15 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Base class for purchasing batch views
 """
 
-from rattail.db import model, api
+from rattail.db.model import PurchaseBatch, PurchaseBatchRow
 
 import colander
 from deform import widget as dfwidget
 from pyramid import httpexceptions
 from webhelpers2.html import tags, HTML
 
 from tailbone import forms, grids
@@ -36,16 +36,16 @@
 
 
 class PurchasingBatchView(BatchMasterView):
     """
     Master view base class, for purchase batches.  The views for both
     "ordering" and "receiving" batches will inherit from this.
     """
-    model_class = model.PurchaseBatch
-    model_row_class = model.PurchaseBatchRow
+    model_class = PurchaseBatch
+    model_row_class = PurchaseBatchRow
     default_handler_spec = 'rattail.batch.purchase:PurchaseBatchHandler'
     supports_new_product = False
     cloneable = True
 
     labels = {
         'po_total': "PO Total",
     }
@@ -156,28 +156,33 @@
     ]
 
     @property
     def batch_mode(self):
         raise NotImplementedError("Please define `batch_mode` for your purchasing batch view")
 
     def query(self, session):
+        model = self.model
         return session.query(model.PurchaseBatch)\
                       .filter(model.PurchaseBatch.mode == self.batch_mode)
 
     def configure_grid(self, g):
-        super(PurchasingBatchView, self).configure_grid(g)
+        super().configure_grid(g)
+        model = self.model
 
-        g.joiners['vendor'] = lambda q: q.join(model.Vendor)
-        g.filters['vendor'] = g.make_filter('vendor', model.Vendor.name,
-                                            default_active=True, default_verb='contains')
-        g.sorters['vendor'] = g.make_sorter(model.Vendor.name)
-
-        g.joiners['department'] = lambda q: q.join(model.Department)
-        g.filters['department'] = g.make_filter('department', model.Department.name)
-        g.sorters['department'] = g.make_sorter(model.Department.name)
+        # vendor
+        g.set_link('vendor')
+        g.set_joiner('vendor', lambda q: q.join(model.Vendor))
+        g.set_sorter('vendor', model.Vendor.name)
+        g.set_filter('vendor', model.Vendor.name,
+                     default_active=True, default_verb='contains')
+
+        # department
+        g.set_joiner('department', lambda q: q.join(model.Department))
+        g.set_filter('department', model.Department.name)
+        g.set_sorter('department', model.Department.name)
 
         g.set_joiner('buyer', lambda q: q.join(model.Employee).join(model.Person))
         g.set_filter('buyer', model.Person.display_name)
         g.set_sorter('buyer', model.Person.display_name)
 
         # TODO: we used to include the 'complete' filter by default, but it
         # seems to likely be confusing for newcomers, so it is no longer
@@ -204,28 +209,28 @@
 #     def make_form(self, batch, **kwargs):
 #         if self.creating:
 #             kwargs.setdefault('id', 'new-purchase-form')
 #         form = super(PurchasingBatchView, self).make_form(batch, **kwargs)
 #         return form
 
     def configure_common_form(self, f):
-        super(PurchasingBatchView, self).configure_common_form(f)
+        super().configure_common_form(f)
 
         # po_total
         if self.creating:
             f.remove_fields('po_total',
                             'po_total_calculated')
         else:
             f.set_readonly('po_total')
             f.set_type('po_total', 'currency')
             f.set_readonly('po_total_calculated')
             f.set_type('po_total_calculated', 'currency')
 
     def configure_form(self, f):
-        super(PurchasingBatchView, self).configure_form(f)
+        super().configure_form(f)
         model = self.model
         batch = f.model_instance
         app = self.get_rattail_app()
         today = app.localtime().date()
 
         # mode
         f.set_enum('mode', self.enum.PURCHASE_BATCH_MODE)
@@ -273,14 +278,15 @@
                     if self.request.POST.get('vendor_uuid'):
                         vendor = self.Session.get(model.Vendor, self.request.POST['vendor_uuid'])
                         if vendor:
                             vendor_display = str(vendor)
                 vendors_url = self.request.route_url('vendors.autocomplete')
                 f.set_widget('vendor_uuid', forms.widgets.JQueryAutocompleteWidget(
                     field_display=vendor_display, service_url=vendors_url))
+            f.set_validator('vendor_uuid', self.valid_vendor_uuid)
         elif self.editing:
             f.set_readonly('vendor')
 
         # department
         f.set_renderer('department', self.render_department)
         if self.creating:
             if 'department' in f.fields:
@@ -304,15 +310,15 @@
                 buyer_display = ""
                 if self.request.method == 'POST':
                     if self.request.POST.get('buyer_uuid'):
                         buyer = self.Session.get(model.Employee, self.request.POST['buyer_uuid'])
                         if buyer:
                             buyer_display = str(buyer)
                 elif self.creating:
-                    buyer = self.request.user.employee
+                    buyer = app.get_employee(self.request.user)
                     if buyer:
                         buyer_display = str(buyer)
                         f.set_default('buyer_uuid', buyer.uuid)
                 elif self.editing:
                     buyer_display = str(batch.buyer or '')
                 buyers_url = self.request.route_url('employees.autocomplete')
                 f.set_widget('buyer_uuid', forms.widgets.JQueryAutocompleteWidget(
@@ -391,35 +397,47 @@
                             'complete',
                             'vendor_email',
                             'vendor_fax',
                             'vendor_phone',
                             'vendor_contact',
                             'status_code')
 
-    def valid_vendor_uuid(self, node, value):
-        model = self.model
-        vendor = self.Session.get(model.Vendor, value)
-        if not vendor:
-            raise colander.Invalid(node, "Invalid vendor selection")
-
     def render_store(self, batch, field):
         store = batch.store
         if not store:
             return ""
         text = "({}) {}".format(store.id, store.name)
         url = self.request.route_url('stores.view', uuid=store.uuid)
         return tags.link_to(text, url)
 
     def render_purchase(self, batch, field):
-        purchase = batch.purchase
+        model = self.model
+
+        # default logic can only render the "normal" (built-in)
+        # purchase field; anything else must be handled by view
+        # supplement if possible
+        if field != 'purchase':
+            for supp in self.iter_view_supplements():
+                renderer = getattr(supp, f'render_purchase_{field}', None)
+                if renderer:
+                    return renderer(batch)
+
+        # nothing to render if no purchase found
+        purchase = getattr(batch, field)
         if not purchase:
-            return ""
+            return
+
+        # render link to native purchase, if possible
         text = str(purchase)
-        url = self.request.route_url('purchases.view', uuid=purchase.uuid)
-        return tags.link_to(text, url)
+        if isinstance(purchase, model.Purchase):
+            url = self.request.route_url('purchases.view', uuid=purchase.uuid)
+            return tags.link_to(text, url)
+
+        # otherwise just render purchase as-is
+        return text
 
     def render_vendor_email(self, batch, field):
         if batch.vendor.email:
             return batch.vendor.email.address
 
     def render_vendor_fax(self, batch, field):
         return self.get_vendor_fax_number(batch)
@@ -449,86 +467,61 @@
         text = str(employee)
         if self.request.has_perm('employees.view'):
             url = self.request.route_url('employees.view', uuid=employee.uuid)
             return tags.link_to(text, url)
         return text
 
     def get_store_values(self):
+        model = self.model
         stores = self.Session.query(model.Store)\
                              .order_by(model.Store.id)
         return [(s.uuid, "({}) {}".format(s.id, s.name))
                 for s in stores]
 
     def get_vendors(self):
+        model = self.model
         return self.Session.query(model.Vendor)\
                            .order_by(model.Vendor.name)
 
     def get_vendor_values(self):
         vendors = self.get_vendors()
         return [(v.uuid, "({}) {}".format(v.id, v.name))
                 for v in vendors]
 
     def get_buyers(self):
+        model = self.model
         return self.Session.query(model.Employee)\
                            .join(model.Person)\
                            .filter(model.Employee.status == self.enum.EMPLOYEE_STATUS_CURRENT)\
                            .order_by(model.Person.display_name)
 
     def get_buyer_values(self):
         buyers = self.get_buyers()
         return [(b.uuid, str(b))
                 for b in buyers]
 
     def get_department_options(self):
+        model = self.model
         departments = self.Session.query(model.Department).order_by(model.Department.number)
         return [('{} {}'.format(d.number, d.name), d.uuid) for d in departments]
 
     def get_vendor_phone_number(self, batch):
         for phone in batch.vendor.phones:
             if phone.type == 'Voice':
                 return phone.number
 
     def get_vendor_fax_number(self, batch):
         for phone in batch.vendor.phones:
             if phone.type == 'Fax':
                 return phone.number
 
-    def eligible_purchases(self, vendor_uuid=None, mode=None):
-        if not vendor_uuid:
-            vendor_uuid = self.request.GET.get('vendor_uuid')
-        vendor = self.Session.get(model.Vendor, vendor_uuid) if vendor_uuid else None
-        if not vendor:
-            return {'error': "Must specify a vendor."}
-
-        if mode is None:
-            mode = self.request.GET.get('mode')
-            mode = int(mode) if mode and mode.isdigit() else None
-        if not mode or mode not in self.enum.PURCHASE_BATCH_MODE:
-            return {'error': "Unknown mode: {}".format(mode)}
-
-        purchases = self.handler.get_eligible_purchases(vendor, mode)
-        return self.get_eligible_purchases_data(purchases)
-
-    def get_eligible_purchases_data(self, purchases):
-        return {'purchases': [{'key': p.uuid,
-                               'department_uuid': p.department_uuid or '',
-                               'display': self.render_eligible_purchase(p)}
-                              for p in purchases]}
-
-    def render_eligible_purchase(self, purchase):
-        if purchase.status == self.enum.PURCHASE_STATUS_ORDERED:
-            date = purchase.date_ordered
-            total = purchase.po_total
-        elif purchase.status == self.enum.PURCHASE_STATUS_RECEIVED:
-            date = purchase.date_received
-            total = purchase.invoice_total
-        return '{} for ${:0,.2f} ({})'.format(date, total or 0, purchase.department or purchase.buyer)
-
     def get_batch_kwargs(self, batch, **kwargs):
-        kwargs = super(PurchasingBatchView, self).get_batch_kwargs(batch, **kwargs)
+        kwargs = super().get_batch_kwargs(batch, **kwargs)
+        model = self.model
+
         kwargs['mode'] = self.batch_mode
         kwargs['truck_dump'] = batch.truck_dump
         kwargs['invoice_parser_key'] = batch.invoice_parser_key
 
         if batch.store:
             kwargs['store'] = batch.store
         elif batch.store_uuid:
@@ -566,24 +559,28 @@
             kwargs['invoice_number'] = batch.invoice_number
         elif self.batch_mode == self.enum.PURCHASE_BATCH_MODE_COSTING:
             kwargs['invoice_date'] = batch.invoice_date
             kwargs['invoice_number'] = batch.invoice_number
 
         if self.batch_mode in (self.enum.PURCHASE_BATCH_MODE_RECEIVING,
                                self.enum.PURCHASE_BATCH_MODE_COSTING):
-            purchase = batch.purchase
-            if not purchase and batch.purchase_uuid:
-                purchase = self.Session.get(model.Purchase, batch.purchase_uuid)
-                assert purchase
-            if purchase:
-                kwargs['purchase'] = purchase
-                kwargs['buyer'] = purchase.buyer
-                kwargs['buyer_uuid'] = purchase.buyer_uuid
-                kwargs['date_ordered'] = purchase.date_ordered
-                kwargs['po_total'] = purchase.po_total
+            field = self.batch_handler.get_purchase_order_fieldname()
+            if field == 'purchase':
+                purchase = batch.purchase
+                if not purchase and batch.purchase_uuid:
+                    purchase = self.Session.get(model.Purchase, batch.purchase_uuid)
+                    assert purchase
+                if purchase:
+                    kwargs['purchase'] = purchase
+                    kwargs['buyer'] = purchase.buyer
+                    kwargs['buyer_uuid'] = purchase.buyer_uuid
+                    kwargs['date_ordered'] = purchase.date_ordered
+                    kwargs['po_total'] = purchase.po_total
+            elif hasattr(batch, field):
+                kwargs[field] = getattr(batch, field)
 
         return kwargs
 
 #     def template_kwargs_view(self, **kwargs):
 #         kwargs = super(PurchasingBatchView, self).template_kwargs_view(**kwargs)
 #         vendor = kwargs['batch'].vendor
 #         kwargs['vendor_cost_count'] = Session.query(model.ProductCost)\
@@ -598,15 +595,15 @@
         return kwargs
 
 #     def get_row_data(self, batch):
 #         query = super(PurchasingBatchView, self).get_row_data(batch)
 #         return query.options(orm.joinedload(model.PurchaseBatchRow.credits))
 
     def configure_row_grid(self, g):
-        super(PurchasingBatchView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         g.set_type('upc', 'gpc')
         g.set_type('cases_ordered', 'quantity')
         g.set_type('units_ordered', 'quantity')
         g.set_type('cases_shipped', 'quantity')
         g.set_type('units_shipped', 'quantity')
         g.set_type('cases_received', 'quantity')
@@ -685,15 +682,15 @@
                                row.STATUS_ON_PO_NOT_INVOICE,
                                row.STATUS_ON_INVOICE_NOT_PO,
                                row.STATUS_COST_INCREASE,
                                row.STATUS_DID_NOT_RECEIVE):
             return 'notice'
 
     def configure_row_form(self, f):
-        super(PurchasingBatchView, self).configure_row_form(f)
+        super().configure_row_form(f)
         row = f.model_instance
         if self.creating:
             batch = self.get_instance()
         else:
             batch = self.get_parent(row)
 
         # readonly fields
@@ -827,33 +824,14 @@
         return g
 
     def render_row_credits(self, row, field):
         g = self.make_row_credits_grid(row)
         return HTML.literal(
             g.render_buefy_table_element(data_prop='rowData.credits'))
 
-#     def item_lookup(self, value, field=None):
-#         """
-#         Try to locate a single product using ``value`` as a lookup code.
-#         """
-#         batch = self.get_instance()
-#         product = api.get_product_by_vendor_code(Session(), value, vendor=batch.vendor)
-#         if product:
-#             return product.uuid
-#         if value.isdigit():
-#             product = api.get_product_by_upc(Session(), GPC(value))
-#             if not product:
-#                 product = api.get_product_by_upc(Session(), GPC(value, calc_check_digit='upc'))
-#             if product:
-#                 if not product.cost_for_vendor(batch.vendor):
-#                     raise fa.ValidationError("Product {} exists but has no cost for vendor {}".format(
-#                         product.upc.pretty(), batch.vendor))
-#                 return product.uuid
-#         raise fa.ValidationError("Product not found")
-
 #     def before_create_row(self, form):
 #         row = form.fieldset.model
 #         batch = self.get_instance()
 #         batch.add_row(row)
 #         # TODO: this seems heavy-handed but works..
 #         row.product_uuid = self.item_lookup(form.fieldset.item_lookup.value)
 
@@ -913,15 +891,15 @@
                 # first undo any totals previously in effect for the row
                 if row.invoice_total:
                     # TODO: pretty sure this should update the `_calculated` value instead?
                     # TODO: also, should update the value again after the super() call
                     batch.invoice_total -= row.invoice_total
 
             # do the "normal" save logic...
-            row = super(PurchasingBatchView, self).save_edit_row_form(form)
+            row = super().save_edit_row_form(form)
 
             # TODO: is this needed?
             # self.handler.refresh_row(row)
 
         return row
 
 #     def redirect_after_create_row(self, row):
@@ -938,34 +916,12 @@
 #         if isinstance(result, model.Purchase):
 #             return self.request.route_url('purchases.view', uuid=result.uuid)
 
 #         # otherwise just view batch again
 #         return self.get_action_url('view', batch)
 
 
-    @classmethod
-    def _purchasing_defaults(cls, config):
-        rattail_config = config.registry.settings.get('rattail_config')
-        route_prefix = cls.get_route_prefix()
-        url_prefix = cls.get_url_prefix()
-        permission_prefix = cls.get_permission_prefix()
-        model_key = cls.get_model_key()
-        model_title = cls.get_model_title()
-
-        # eligible purchases (AJAX)
-        config.add_route('{}.eligible_purchases'.format(route_prefix), '{}/eligible-purchases'.format(url_prefix))
-        config.add_view(cls, attr='eligible_purchases', route_name='{}.eligible_purchases'.format(route_prefix),
-                        renderer='json', permission='{}.view'.format(permission_prefix))
-
-
-    @classmethod
-    def defaults(cls, config):
-        cls._purchasing_defaults(config)
-        cls._batch_defaults(config)
-        cls._defaults(config)
-
-
 class NewProduct(colander.Schema):
 
     item_id = colander.SchemaNode(colander.String())
 
     description = colander.SchemaNode(colander.String())
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchasing/receiving.py` & `Tailbone-0.9.90/tailbone/views/purchasing/receiving.py`

 * *Files 3% similar despite different names*

```diff
@@ -24,23 +24,21 @@
 Views for 'receiving' (purchasing) batches
 """
 
 import os
 import re
 import decimal
 import logging
+from collections import OrderedDict
 
 import humanize
-import sqlalchemy as sa
 
 from rattail import pod
-from rattail.db import model, Session as RattailSession
 from rattail.time import localtime, make_utc
-from rattail.util import pretty_quantity, prettify, OrderedDict, simple_error
-from rattail.threads import Thread
+from rattail.util import pretty_quantity, prettify, simple_error
 
 import colander
 from deform import widget as dfwidget
 from pyramid import httpexceptions
 from webhelpers2.html import tags, HTML
 
 from tailbone import forms, grids
@@ -79,20 +77,17 @@
     bulk_deletable = True
     configurable = True
     config_title = "Receiving"
     default_help_url = 'https://rattailproject.org/docs/rattail-manual/features/purchasing/receiving/index.html'
 
     rows_editable = False
     rows_editable_but_not_directly = True
-    rows_deletable = True
 
     default_uom_is_case = True
 
-    purchase_order_fieldname = 'purchase'
-
     labels = {
         'truck_dump_batch': "Truck Dump Parent",
         'invoice_parser_key': "Invoice Parser",
     }
 
     grid_columns = [
         'id',
@@ -162,15 +157,14 @@
         'cases_ordered',
         'units_ordered',
         'cases_shipped',
         'units_shipped',
         'cases_received',
         'units_received',
         'catalog_unit_cost',
-        'po_unit_cost',
         'invoice_unit_cost',
         'invoice_total_calculated',
         'credits',
         'status_code',
         'truck_dump_status',
     ]
 
@@ -206,14 +200,15 @@
         'cases_missing',
         'units_missing',
         'catalog_unit_cost',
         'po_line_number',
         'po_unit_cost',
         'po_case_size',
         'po_total',
+        'invoice_number',
         'invoice_line_number',
         'invoice_unit_cost',
         'invoice_cost_confirmed',
         'invoice_case_size',
         'invoice_total',
         'invoice_total_calculated',
         'status_code',
@@ -233,15 +228,15 @@
     ]
 
     @property
     def batch_mode(self):
         return self.enum.PURCHASE_BATCH_MODE_RECEIVING
 
     def configure_grid(self, g):
-        super(ReceivingBatchView, self).configure_grid(g)
+        super().configure_grid(g)
 
         if not self.handler.allow_truck_dump_receiving():
             g.remove('truck_dump')
 
     def create(self, form=None, **kwargs):
         """
         Custom view for creating a new receiving batch.  We split the process
@@ -250,14 +245,15 @@
         creation is to be done, and it's much easier to keep conditional logic
         for that in the server instead of client-side etc.
 
         See also
         :meth:`tailbone.views.purchasing.costing:CostingBatchView.create()`
         which uses similar logic.
         """
+        model = self.model
         route_prefix = self.get_route_prefix()
         workflows = self.handler.supported_receiving_workflows()
         valid_workflows = [workflow['workflow_key']
                            for workflow in workflows]
 
         # if user has already identified their desired workflow, then we can
         # just farm out to the default logic.  we will of course configure our
@@ -284,22 +280,22 @@
             if not vendor:
                 self.request.session.flash("Invalid vendor selection.  "
                                            "Please choose an existing vendor.",
                                            'warning')
                 raise redirect
 
             # okay now do the normal thing, per workflow
-            return super(ReceivingBatchView, self).create(**kwargs)
+            return super().create(**kwargs)
 
         # on the other hand, if caller provided a form, that means we are in
         # the middle of some other custom workflow, e.g. "add child to truck
         # dump parent" or some such.  in which case we also defer to the normal
         # logic, so as to not interfere with that.
         if form:
-            return super(ReceivingBatchView, self).create(form=form, **kwargs)
+            return super().create(form=form, **kwargs)
 
         # okay, at this point we need the user to select a vendor and workflow
         self.creating = True
         context = {}
 
         # form to accept user choice of vendor/workflow
         schema = NewReceivingBatch().bind(valid_workflows=valid_workflows)
@@ -354,15 +350,15 @@
             form.set_default('workflow', workflows[0]['workflow_key'])
 
         form.submit_label = "Continue"
         form.cancel_url = self.get_index_url()
 
         # if form validates, that means user has chosen a creation type, so we
         # just redirect to the appropriate "new batch of type X" page
-        if form.validate(newstyle=True):
+        if form.validate():
             workflow_key = form.validated['workflow']
             vendor_uuid = form.validated['vendor']
             url = self.request.route_url('{}.create_workflow'.format(route_prefix),
                                          workflow_key=workflow_key,
                                          vendor_uuid=vendor_uuid)
             raise self.redirect(url)
 
@@ -371,46 +367,30 @@
             context['dform'] = form.make_deform_form()
         return self.render_to_response('create', context)
 
     def row_deletable(self, row):
 
         # first run it through the normal logic, if that doesn't like
         # it then we won't either
-        if not super(ReceivingBatchView, self).row_deletable(row):
+        if not super().row_deletable(row):
             return False
 
-        batch = row.batch
-
-        # can always delete rows from truck dump parent
-        if batch.is_truck_dump_parent():
-            return True
-
-        # can always delete rows from truck dump child
-        elif batch.is_truck_dump_child():
-            return True
-
-        else: # okay, normal batch
-            if batch.order_quantities_known:
-                return False
-            else: # allow delete if receiving rom scratch
-                return True
-
-        # cannot delete row by default
-        return False
+        # otherwise let handler decide
+        return self.batch_handler.is_row_deletable(row)
 
     def get_instance_title(self, batch):
-        title = super(ReceivingBatchView, self).get_instance_title(batch)
+        title = super().get_instance_title(batch)
         if batch.is_truck_dump_parent():
             title = "{} (TRUCK DUMP PARENT)".format(title)
         elif batch.is_truck_dump_child():
             title = "{} (TRUCK DUMP CHILD)".format(title)
         return title
 
     def configure_form(self, f):
-        super(ReceivingBatchView, self).configure_form(f)
+        super().configure_form(f)
         model = self.model
         batch = f.model_instance
         allow_truck_dump = self.batch_handler.allow_truck_dump_receiving()
         workflow = self.request.matchdict.get('workflow_key')
         route_prefix = self.get_route_prefix()
 
         # tweak some things if we are in "step 2" of creating new batch
@@ -510,26 +490,36 @@
             store = self.rattail_config.get_store(self.Session())
             f.set_default('store_uuid', store.uuid)
             # TODO: seems like set_hidden() should also set HiddenWidget
             f.set_hidden('store_uuid')
             f.set_widget('store_uuid', dfwidget.HiddenWidget())
 
         # purchase
-        if (self.creating and workflow in ('from_po', 'from_po_with_invoice')
-            and self.purchase_order_fieldname == 'purchase'):
-            f.replace('purchase', 'purchase_uuid')
+        field = self.batch_handler.get_purchase_order_fieldname()
+        if field == 'purchase':
+            field = 'purchase_uuid'
+        # TODO: workflow "invoice_with_po" is for costing mode, should rename?
+        if self.creating and workflow in (
+                'from_po', 'from_po_with_invoice', 'invoice_with_po'):
+            f.replace('purchase', field)
             purchases = self.batch_handler.get_eligible_purchases(
-                vendor, self.enum.PURCHASE_BATCH_MODE_RECEIVING)
-            values = [(p.uuid, self.batch_handler.render_eligible_purchase(p))
+                vendor, self.batch_mode)
+            values = [(self.batch_handler.get_eligible_purchase_key(p),
+                       self.batch_handler.render_eligible_purchase(p))
                       for p in purchases]
-            f.set_widget('purchase_uuid', dfwidget.SelectWidget(values=values))
-            f.set_label('purchase_uuid', "Purchase Order")
-            f.set_required('purchase_uuid')
-        elif self.creating or not batch.purchase:
+            f.set_widget(field, dfwidget.SelectWidget(values=values))
+            if field == 'purchase_uuid':
+                f.set_label(field, "Purchase Order")
+            f.set_required(field)
+        elif self.creating:
             f.remove_field('purchase')
+        else: # not creating
+            if field != 'purchase_uuid':
+                f.replace('purchase', field)
+            f.set_renderer(field, self.render_purchase)
 
         # department
         if self.creating:
             f.remove_field('department_uuid')
 
         # order_quantities_known
         if not self.editing:
@@ -539,14 +529,15 @@
         if (not self.creating
             and batch.get_param('receiving_workflow') == 'from_multi_invoice'):
 
             if 'invoice_files' not in f:
                 f.insert_before('invoice_file', 'invoice_files')
             f.set_renderer('invoice_files', self.render_invoice_files)
             f.set_readonly('invoice_files', True)
+            f.remove('invoice_file')
 
         # invoice totals
         f.set_label('invoice_total', "Invoice Total (Orig.)")
         f.set_label('invoice_total_calculated', "Invoice Total (Calc.)")
         if self.creating:
             f.remove('invoice_total_calculated')
 
@@ -576,15 +567,15 @@
                          'po_number',
                          'invoice_date',
                          'invoice_number')
 
             elif workflow == 'from_multi_invoice':
                 if 'invoice_files' not in f:
                     f.insert_before('invoice_file', 'invoice_files')
-                f.set_type('invoice_files', 'multi_file')
+                f.set_type('invoice_files', 'multi_file', validate_unique=True)
                 f.set_required('invoice_parser_key')
                 f.remove('truck_dump_batch_uuid',
                          'po_number',
                          'invoice_file',
                          'invoice_date',
                          'invoice_number')
 
@@ -638,36 +629,37 @@
     def render_receiving_workflow(self, batch, field):
         key = self.request.matchdict['workflow_key']
         info = self.handler.receiving_workflow_info(key)
         if info:
             return info['display']
 
     def get_visible_params(self, batch):
-        params = super(ReceivingBatchView, self).get_visible_params(batch)
+        params = super().get_visible_params(batch)
 
         # remove this since we show it separately
         params.pop('invoice_files', None)
 
         return params
 
     def template_kwargs_create(self, **kwargs):
-        kwargs = super(ReceivingBatchView, self).template_kwargs_create(**kwargs)
+        kwargs = super().template_kwargs_create(**kwargs)
+        model = self.model
         if self.handler.allow_truck_dump_receiving():
             vmap = {}
             batches = self.Session.query(model.PurchaseBatch)\
                                   .filter(model.PurchaseBatch.mode == self.enum.PURCHASE_BATCH_MODE_RECEIVING)\
                                   .filter(model.PurchaseBatch.truck_dump == True)\
                                   .filter(model.PurchaseBatch.complete == True)
             for batch in batches:
                 vmap[batch.uuid] = batch.vendor_uuid
             kwargs['batch_vendor_map'] = vmap
         return kwargs
 
     def get_batch_kwargs(self, batch, **kwargs):
-        kwargs = super(ReceivingBatchView, self).get_batch_kwargs(batch, **kwargs)
+        kwargs = super().get_batch_kwargs(batch, **kwargs)
         batch_type = self.request.POST['batch_type']
 
         # must pull vendor from URL if it was not in form data
         if 'vendor_uuid' not in kwargs and 'vendor' not in kwargs:
             if 'vendor_uuid' in self.request.matchdict:
                 kwargs['vendor_uuid'] = self.request.matchdict['vendor_uuid']
 
@@ -741,25 +733,47 @@
                     'title': label,
                     'count': len(grouped[key]),
                 })
 
         return breakdown
 
     def allow_edit_catalog_unit_cost(self, batch):
-        return (not batch.executed
-                and self.has_perm('edit_row')
-                and self.batch_handler.allow_receiving_edit_catalog_unit_cost())
+
+        # batch must not yet be frozen
+        if batch.executed or batch.complete:
+            return False
+
+        # user must have edit_row perm
+        if not self.has_perm('edit_row'):
+            return False
+
+        # config must allow this generally
+        if not self.batch_handler.allow_receiving_edit_catalog_unit_cost():
+            return False
+
+        return True
 
     def allow_edit_invoice_unit_cost(self, batch):
-        return (not batch.executed
-                and self.has_perm('edit_row')
-                and self.batch_handler.allow_receiving_edit_invoice_unit_cost())
+
+        # batch must not yet be frozen
+        if batch.executed or batch.complete:
+            return False
+
+        # user must have edit_row perm
+        if not self.has_perm('edit_row'):
+            return False
+
+        # config must allow this generally
+        if not self.batch_handler.allow_receiving_edit_invoice_unit_cost():
+            return False
+
+        return True
 
     def template_kwargs_view(self, **kwargs):
-        kwargs = super(ReceivingBatchView, self).template_kwargs_view(**kwargs)
+        kwargs = super().template_kwargs_view(**kwargs)
         batch = kwargs['instance']
 
         if self.handler.has_purchase_order(batch) and self.handler.has_invoice_file(batch):
             breakdown = self.make_po_vs_invoice_breakdown(batch)
             factory = self.get_grid_factory()
 
             g = factory('batch_po_vs_invoice_breakdown', [],
@@ -769,14 +783,21 @@
             kwargs['po_vs_invoice_breakdown_grid'] = HTML.literal(
                 g.render_buefy_table_element(data_prop='poVsInvoiceBreakdownData',
                                              empty_labels=True))
 
         kwargs['allow_edit_catalog_unit_cost'] = self.allow_edit_catalog_unit_cost(batch)
         kwargs['allow_edit_invoice_unit_cost'] = self.allow_edit_invoice_unit_cost(batch)
 
+        if (kwargs['allow_edit_catalog_unit_cost']
+            and kwargs['allow_edit_invoice_unit_cost']
+            and not batch.get_param('confirmed_all_costs')):
+            kwargs['allow_confirm_all_costs'] = True
+        else:
+            kwargs['allow_confirm_all_costs'] = False
+
         return kwargs
 
     def get_context_credits(self, row):
         app = self.get_rattail_app()
         credits_data = []
         for credit in row.credits:
             credits_data.append({
@@ -792,15 +813,15 @@
                 'mispick_brand_name': '-',
                 'mispick_description': '-',
                 'mispick_size': '-',
             })
         return credits_data
 
     def template_kwargs_view_row(self, **kwargs):
-        kwargs = super(ReceivingBatchView, self).template_kwargs_view_row(**kwargs)
+        kwargs = super().template_kwargs_view_row(**kwargs)
         app = self.get_rattail_app()
         products_handler = app.get_products_handler()
         row = kwargs['instance']
 
         kwargs['allow_cases'] = self.batch_handler.allow_cases()
 
         if row.product:
@@ -829,15 +850,15 @@
         """
         Delete all data (files etc.) for the batch.
         """
         truck_dump = batch.truck_dump_batch
         if batch.is_truck_dump_parent():
             for child in batch.truck_dump_children:
                 self.delete_instance(child)
-        super(ReceivingBatchView, self).delete_instance(batch)
+        super().delete_instance(batch)
         if truck_dump:
             self.handler.refresh(truck_dump)
 
     def render_truck_dump_batch(self, batch, field):
         truck_dump = batch.truck_dump_batch
         if not truck_dump:
             return ""
@@ -935,78 +956,62 @@
 
     def render_truck_dump_parent(self, batch, field):
         truck_dump = self.get_instance()
         text = str(truck_dump)
         url = self.request.route_url('receiving.view', uuid=truck_dump.uuid)
         return tags.link_to(text, url)
 
-    @staticmethod
-    @colander.deferred
-    def validate_purchase(node, kw):
-        session = kw['session']
-        def validate(node, value):
-            purchase = session.get(model.Purchase, value)
-            if not purchase:
-                raise colander.Invalid(node, "Purchase not found")
-            return purchase.uuid
-        return validate
+    # TODO: is this actually used?  wait to see if something breaks..
+    # @staticmethod
+    # @colander.deferred
+    # def validate_purchase(node, kw):
+    #     session = kw['session']
+    #     def validate(node, value):
+    #         purchase = session.get(model.Purchase, value)
+    #         if not purchase:
+    #             raise colander.Invalid(node, "Purchase not found")
+    #         return purchase.uuid
+    #     return validate
 
     def assign_purchase_order(self, batch, po_form):
         """
         Assign the original purchase order to the given batch.  Default
         behavior assumes a Rattail Purchase object is what we're after.
         """
+        field = self.batch_handler.get_purchase_order_fieldname()
         purchase = self.handler.assign_purchase_order(
-            batch, po_form.validated[self.purchase_order_fieldname],
+            batch, po_form.validated[field],
             session=self.Session())
 
         department = self.department_for_purchase(purchase)
         if department:
             batch.department_uuid = department.uuid
 
     def configure_row_grid(self, g):
-        super(ReceivingBatchView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
+        model = self.model
         batch = self.get_instance()
 
         # vendor_code
         g.filters['vendor_code'].default_active = True
         g.filters['vendor_code'].default_verb = 'contains'
 
         # catalog_unit_cost
-        if (self.handler.has_purchase_order(batch)
-            or self.handler.has_invoice_file(batch)):
-            g.remove('catalog_unit_cost')
-        elif self.allow_edit_catalog_unit_cost(batch):
+        g.set_renderer('catalog_unit_cost', self.render_simple_unit_cost)
+        if self.allow_edit_catalog_unit_cost(batch):
             g.set_raw_renderer('catalog_unit_cost', self.render_catalog_unit_cost)
             g.set_click_handler('catalog_unit_cost',
-                                'catalogUnitCostClicked(props.row)')
+                                'this.catalogUnitCostClicked')
 
         # invoice_unit_cost
+        g.set_renderer('invoice_unit_cost', self.render_simple_unit_cost)
         if self.allow_edit_invoice_unit_cost(batch):
             g.set_raw_renderer('invoice_unit_cost', self.render_invoice_unit_cost)
             g.set_click_handler('invoice_unit_cost',
-                                'invoiceUnitCostClicked(props.row)')
-
-        # nb. only show PO *or* invoice cost; prefer the latter unless
-        # we have a PO and no invoice
-        if (self.batch_handler.has_purchase_order(batch)
-            and not self.batch_handler.has_invoice_file(batch)):
-            g.remove('invoice_unit_cost')
-        else:
-            g.remove('po_unit_cost')
-
-        # credits
-        # note that sorting by credits involves a subquery with group by clause.
-        # seems likely there may be a better way? but this seems to work fine
-        Credits = self.Session.query(model.PurchaseBatchCredit.row_uuid,
-                                     sa.func.count().label('credit_count'))\
-                              .group_by(model.PurchaseBatchCredit.row_uuid)\
-                              .subquery()
-        g.set_joiner('credits', lambda q: q.outerjoin(Credits))
-        g.sorters['credits'] = lambda q, d: q.order_by(getattr(Credits.c.credit_count, d)())
+                                'this.invoiceUnitCostClicked')
 
         show_ordered = self.rattail_config.getbool(
             'rattail.batch', 'purchase.receiving.show_ordered_column_in_grid',
             default=False)
         if not show_ordered:
             g.remove('cases_ordered',
                      'units_ordered')
@@ -1039,14 +1044,27 @@
 
         # truck_dump_status
         if not batch.is_truck_dump_parent():
             g.remove('truck_dump_status')
         else:
             g.set_enum('truck_dump_status', model.PurchaseBatchRow.STATUS)
 
+    def render_simple_unit_cost(self, row, field):
+        value = getattr(row, field)
+        if value is None:
+            return
+
+        # TODO: if anyone ever wants to see "raw" costs displayed,
+        # should make this configurable, b/c some folks already wanted
+        # the shorter 2-decimal display
+        #return str(value)
+
+        app = self.get_rattail_app()
+        return app.render_currency(value)
+
     def render_catalog_unit_cost(self):
         return HTML.tag('receiving-cost-editor', **{
             'field': 'catalog_unit_cost',
             'v-model': 'props.row.catalog_unit_cost',
             ':ref': "'catalogUnitCost_' + props.row.uuid",
             ':row': 'props.row',
             '@input': 'catalogCostConfirmed',
@@ -1058,42 +1076,42 @@
             'v-model': 'props.row.invoice_unit_cost',
             ':ref': "'invoiceUnitCost_' + props.row.uuid",
             ':row': 'props.row',
             '@input': 'invoiceCostConfirmed',
         })
 
     def row_grid_extra_class(self, row, i):
-        css_class = super(ReceivingBatchView, self).row_grid_extra_class(row, i)
+        css_class = super().row_grid_extra_class(row, i)
 
         if row.catalog_cost_confirmed:
             css_class = '{} catalog_cost_confirmed'.format(css_class or '')
 
         if row.invoice_cost_confirmed:
             css_class = '{} invoice_cost_confirmed'.format(css_class or '')
 
         return css_class
 
     def get_row_instance_title(self, row):
         if row.product:
             return str(row.product)
         if row.upc:
             return row.upc.pretty()
-        return super(ReceivingBatchView, self).get_row_instance_title(row)
+        return super().get_row_instance_title(row)
 
     def transform_unit_url(self, row, i):
         # grid action is shown only when we return a URL here
         if self.row_editable(row):
             if row.batch.is_truck_dump_parent():
                 if row.product and row.product.is_pack_item():
                     return self.get_row_action_url('transform_unit', row)
 
     def make_row_credits_grid(self, row):
 
         # first make grid like normal
-        g = super(ReceivingBatchView, self).make_row_credits_grid(row)
+        g = super().make_row_credits_grid(row)
 
         if (self.has_perm('edit_row')
             and self.row_editable(row)):
 
             # add the Un-Declare action
             g.main_actions.append(self.make_action(
                 'remove', label="Un-Declare",
@@ -1208,15 +1226,15 @@
 
         # expiration_date
         form.set_type('expiration_date', 'date_jquery')
 
         # TODO: what is this one about again?
         form.remove_field('quick_receive')
 
-        if form.validate(newstyle=True):
+        if form.validate():
 
             # handler takes care of the row receiving logic for us
             kwargs = dict(form.validated)
             kwargs['cases'] = kwargs['quantity']['cases']
             kwargs['units'] = kwargs['quantity']['units']
             del kwargs['quantity']
             self.handler.receive_row(row, **kwargs)
@@ -1394,15 +1412,15 @@
         form.set_widget('quantity', forms.widgets.CasesUnitsWidget(
             amount_required=True, one_amount_only=True))
         form.set_vuejs_field_converter('quantity', self.vuejs_convert_quantity)
 
         # expiration_date
         form.set_type('expiration_date', 'date_jquery')
 
-        if form.validate(newstyle=True):
+        if form.validate():
 
             # handler takes care of the row receiving logic for us
             kwargs = dict(form.validated)
             kwargs['cases'] = kwargs['quantity']['cases']
             kwargs['units'] = kwargs['quantity']['units']
             del kwargs['quantity']
             try:
@@ -1472,14 +1490,15 @@
 
     def transform_unit_row(self):
         """
         View which transforms the given row, which is assumed to associate with
         a "pack" item, such that it instead associates with the "unit" item,
         with quantities adjusted accordingly.
         """
+        model = self.model
         batch = self.get_instance()
 
         row_uuid = self.request.params.get('row_uuid')
         row = self.Session.get(model.PurchaseBatchRow, row_uuid) if row_uuid else None
         if row and row.batch is batch and not row.removed:
             pass # we're good
         else:
@@ -1516,15 +1535,16 @@
         return self.render_to_response('transform_unit_row', {
             'batch': batch,
             'row': row,
             'diff': diff,
         })
 
     def configure_row_form(self, f):
-        super(ReceivingBatchView, self).configure_row_form(f)
+        super().configure_row_form(f)
+        model = self.model
         batch = self.get_instance()
 
         # when viewing a row which has no product reference, enable
         # the 'upc' field to help with troubleshooting
         # TODO: this maybe should be optional..?
         if self.viewing and 'upc' not in f:
             row = self.get_row_instance()
@@ -1589,15 +1609,15 @@
             url = self.get_row_action_url('view', parent_row)
             items.append(HTML.tag('li', c=[tags.link_to(text, url)]))
         return HTML.tag('ul', c=items)
 
     def validate_row_form(self, form):
 
         # if normal validation fails, stop there
-        if not super(ReceivingBatchView, self).validate_row_form(form):
+        if not super().validate_row_form(form):
             return False
 
         # if user is editing row from truck dump child, then we must further
         # validate the form to ensure whatever new amounts they've requested
         # would in fact fall within the bounds of what is available from the
         # truck dump parent batch...
         if self.editing:
@@ -1693,14 +1713,15 @@
                 # to the form now and then pick this up again in save()
                 form._claim_diff = claim_diff
 
         # all validation went ok
         return True
 
     def save_edit_row_form(self, form):
+        model = self.model
         batch = self.get_instance()
         row = self.objectify(form)
 
         # editing a row for truck dump child batch can be complicated...
         if batch.is_truck_dump_child():
 
             # grab the claim diff which we attached to the form during validation
@@ -1832,14 +1853,16 @@
     def redirect_after_edit_row(self, row, **kwargs):
         return self.redirect(self.get_row_action_url('view', row))
 
     def update_row_cost(self):
         """
         AJAX view for updating various cost fields in a data row.
         """
+        app = self.get_rattail_app()
+        model = self.model
         batch = self.get_instance()
         data = dict(get_form_data(self.request))
 
         # validate row
         uuid = data.get('row_uuid')
         row = self.Session.get(model.PurchaseBatchRow, uuid) if uuid else None
         if not row or row.batch is not batch:
@@ -1857,24 +1880,26 @@
                     return {'error': "Cost is not valid!"}
                 else:
                     data[field] = cost
 
         # okay, update our row
         self.handler.update_row_cost(row, **data)
 
+        self.Session.flush()
+        self.Session.refresh(row)
         return {
             'row': {
-                'catalog_unit_cost': '{:0.3f}'.format(row.catalog_unit_cost),
+                'catalog_unit_cost': self.render_simple_unit_cost(row, 'catalog_unit_cost'),
                 'catalog_cost_confirmed': row.catalog_cost_confirmed,
-                'invoice_unit_cost': '{:0.3f}'.format(row.invoice_unit_cost),
+                'invoice_unit_cost': self.render_simple_unit_cost(row, 'invoice_unit_cost'),
                 'invoice_cost_confirmed': row.invoice_cost_confirmed,
-                'invoice_total_calculated': '{:0.2f}'.format(row.invoice_total_calculated),
+                'invoice_total_calculated': app.render_currency(row.invoice_total_calculated),
             },
             'batch': {
-                'invoice_total_calculated': '{:0.2f}'.format(batch.invoice_total_calculated),
+                'invoice_total_calculated': app.render_currency(batch.invoice_total_calculated),
             },
         }
 
     def save_quick_row_form(self, form):
         batch = self.get_instance()
         entry = form.validated['quick_entry']
         row = self.handler.quick_entry(self.Session(), batch, entry)
@@ -1885,53 +1910,47 @@
             return pod.get_image_url(self.rattail_config, row.upc)
 
     def can_auto_receive(self, batch):
         return self.handler.can_auto_receive(batch)
 
     def auto_receive(self):
         """
-        View which can "auto-receive" all items in the batch.  Meant only as a
-        convenience for developers.
+        View which can "auto-receive" all items in the batch.
         """
         batch = self.get_instance()
-        key = '{}.receive_all'.format(self.get_grid_key())
-        progress = self.make_progress(key)
-        kwargs = {'progress': progress}
-        thread = Thread(target=self.auto_receive_thread, args=(batch.uuid, self.request.user.uuid), kwargs=kwargs)
-        thread.start()
-
-        return self.render_progress(progress, {
-            'instance': batch,
-            'cancel_url': self.get_action_url('view', batch),
-            'cancel_msg': "Auto-receive was canceled",
-        })
+        return self.handler_action(batch, 'auto_receive')
 
-    def auto_receive_thread(self, uuid, user_uuid, progress=None):
+    def confirm_all_costs(self):
         """
-        Thread target for receiving all items on the given batch.
+        View which can "confirm all costs" for the batch.
         """
-        session = RattailSession()
+        batch = self.get_instance()
+        return self.handler_action(batch, 'confirm_all_receiving_costs')
+
+    def confirm_all_receiving_costs_thread(self, uuid, user_uuid, progress=None):
+        app = self.get_rattail_app()
+        model = self.model
+        session = app.make_session()
+
         batch = session.get(model.PurchaseBatch, uuid)
         # user = session.query(model.User).get(user_uuid)
         try:
-            self.handler.auto_receive_all_items(batch, progress=progress)
+            self.handler.confirm_all_receiving_costs(batch, progress=progress)
 
         # if anything goes wrong, rollback and log the error etc.
         except Exception as error:
             session.rollback()
-            log.exception("auto-receive failed for: %s".format(batch))
+            log.exception("failed to confirm all costs for batch: %s", batch)
             session.close()
             if progress:
                 progress.session.load()
                 progress.session['error'] = True
-                progress.session['error_msg'] = "Auto-receive failed: {}".format(
-                    simple_error(error))
+                progress.session['error_msg'] = f"Failed to confirm costs: {simple_error(error)}"
                 progress.session.save()
 
-        # if no error, check result flag (false means user canceled)
         else:
             session.commit()
             session.refresh(batch)
             success_url = self.get_action_url('view', batch)
             session.close()
             if progress:
                 progress.session.load()
@@ -1988,14 +2007,17 @@
              'type': bool},
             {'section': 'rattail.batch',
              'option': 'purchase.receiving.allow_edit_catalog_unit_cost',
              'type': bool},
             {'section': 'rattail.batch',
              'option': 'purchase.receiving.allow_edit_invoice_unit_cost',
              'type': bool},
+            {'section': 'rattail.batch',
+             'option': 'purchase.receiving.auto_missing_credits',
+             'type': bool},
 
             # mobile interface
             {'section': 'rattail.batch',
              'option': 'purchase.mobile_images',
              'type': bool},
             {'section': 'rattail.batch',
              'option': 'purchase.mobile_quick_receive',
@@ -2004,15 +2026,14 @@
              'option': 'purchase.mobile_quick_receive_all',
              'type': bool},
         ]
 
     @classmethod
     def defaults(cls, config):
         cls._receiving_defaults(config)
-        cls._purchasing_defaults(config)
         cls._batch_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _receiving_defaults(cls, config):
         rattail_config = config.registry.settings.get('rattail_config')
         route_prefix = cls.get_route_prefix()
@@ -2057,14 +2078,22 @@
                         permission='{}.create'.format(permission_prefix))
 
         # transform TD parent row from "pack" to "unit" item
         config.add_route('{}.transform_unit_row'.format(route_prefix), '{}/transform-unit'.format(instance_url_prefix))
         config.add_view(cls, attr='transform_unit_row', route_name='{}.transform_unit_row'.format(route_prefix),
                         permission='{}.edit_row'.format(permission_prefix), renderer='json')
 
+        # confirm all costs
+        config.add_route(f'{route_prefix}.confirm_all_costs',
+                         f'{instance_url_prefix}/confirm-all-costs',
+                         request_method='POST')
+        config.add_view(cls, attr='confirm_all_costs',
+                        route_name=f'{route_prefix}.confirm_all_costs',
+                        permission=f'{permission_prefix}.edit_row')
+
         # auto-receive all items
         config.add_tailbone_permission(permission_prefix,
                                        '{}.auto_receive'.format(permission_prefix),
                                        "Auto-receive all items for a {}".format(model_title))
         config.add_route('{}.auto_receive'.format(route_prefix), '{}/auto-receive'.format(instance_url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='auto_receive', route_name='{}.auto_receive'.format(route_prefix),
@@ -2109,15 +2138,15 @@
     expiration_date = colander.SchemaNode(colander.Date(),
                                           widget=dfwidget.TextInputWidget(),
                                           missing=colander.null)
 
     quick_receive = colander.SchemaNode(colander.Boolean())
 
     def deserialize(self, *args):
-        result = super(ReceiveRowForm, self).deserialize(*args)
+        result = super().deserialize(*args)
 
         if result['mode'] == 'expired' and not result['expiration_date']:
             msg = "Expiration date is required for items with 'expired' mode."
             self.raise_invalid(msg, node=self.get('expiration_date'))
 
         return result
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchasing/ordering.py` & `Tailbone-0.9.90/tailbone/views/purchasing/ordering.py`

 * *Files 1% similar despite different names*

```diff
@@ -456,15 +456,16 @@
         batch = self.get_instance()
 
         # populate Excel worksheet
         workbook = openpyxl.Workbook()
         worksheet = workbook.active
         worksheet.title = "Purchase Order"
         worksheet.append(["Store", "Vendor", "Date ordered"])
-        worksheet.append([batch.store.name, batch.vendor.name, batch.date_ordered.strftime('%m/%d/%Y')])
+        date_ordered = batch.date_ordered.strftime('%m/%d/%Y') if batch.date_ordered else None
+        worksheet.append([batch.store.name, batch.vendor.name, date_ordered])
         worksheet.append([])
         worksheet.append(['vendor_code', 'upc', 'brand_name', 'description', 'cases_ordered', 'units_ordered'])
         for row in batch.active_rows():
             worksheet.append([row.vendor_code, str(row.upc), row.brand_name,
                               '{} {}'.format(row.description, row.size),
                               row.cases_ordered, row.units_ordered])
 
@@ -482,15 +483,14 @@
         if isinstance(result, model.Purchase):
             return self.request.route_url('purchases.view', uuid=result.uuid)
         return super(OrderingBatchView, self).get_execute_success_url(batch, result, **kwargs)
 
     @classmethod
     def defaults(cls, config):
         cls._ordering_defaults(config)
-        cls._purchasing_defaults(config)
         cls._batch_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _ordering_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         instance_url_prefix = cls.get_instance_url_prefix()
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchasing/costing.py` & `Tailbone-0.9.90/tailbone/views/purchasing/costing.py`

 * *Files 1% similar despite different names*

```diff
@@ -39,16 +39,14 @@
     url_prefix = '/invoice-costing'
     model_title = "Invoice Costing Batch"
     model_title_plural = "Invoice Costing Batches"
     index_title = "Invoice Costing"
     downloadable = True
     bulk_deletable = True
 
-    purchase_order_fieldname = 'purchase'
-
     labels = {
         'invoice_parser_key': "Invoice Parser",
     }
 
     grid_columns = [
         'id',
         'vendor',
@@ -221,15 +219,15 @@
                         dfwidget.SelectWidget(values=values))
 
         form.submit_label = "Continue"
         form.cancel_url = self.get_index_url()
 
         # if form validates, that means user has chosen a creation type, so we
         # just redirect to the appropriate "new batch of type X" page
-        if form.validate(newstyle=True):
+        if form.validate():
             workflow_key = form.validated['workflow']
             vendor_uuid = form.validated['vendor']
             url = self.request.route_url('{}.create_workflow'.format(route_prefix),
                                          workflow_key=workflow_key,
                                          vendor_uuid=vendor_uuid)
             raise self.redirect(url)
 
@@ -286,16 +284,17 @@
             f.set_widget('batch_type', dfwidget.HiddenWidget())
             f.set_default('batch_type', workflow)
             f.set_hidden('batch_type')
         else:
             f.remove_field('batch_type')
 
         # purchase
+        field = self.batch_handler.get_purchase_order_fieldname()
         if (self.creating and workflow == 'invoice_with_po'
-            and self.purchase_order_fieldname == 'purchase'):
+            and field == 'purchase'):
             f.replace('purchase', 'purchase_uuid')
             purchases = self.handler.get_eligible_purchases(
                 vendor, self.enum.PURCHASE_BATCH_MODE_COSTING)
             values = [(p.uuid, self.handler.render_eligible_purchase(p))
                       for p in purchases]
             f.set_widget('purchase_uuid', dfwidget.SelectWidget(values=values))
             f.set_label('purchase_uuid', "Purchase Order")
@@ -313,15 +312,14 @@
         g.set_label('case_quantity', "Case Qty")
         g.filters['case_quantity'].label = "Case Quantity"
         g.set_type('case_quantity', 'quantity')
 
     @classmethod
     def defaults(cls, config):
         cls._costing_defaults(config)
-        cls._purchasing_defaults(config)
         cls._batch_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _costing_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         url_prefix = cls.get_url_prefix()
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchasing/__init__.py` & `Tailbone-0.9.90/tailbone/views/purchasing/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/asgi/upgrades.py` & `Tailbone-0.9.90/tailbone/views/asgi/upgrades.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/asgi/datasync.py` & `Tailbone-0.9.90/tailbone/views/asgi/datasync.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/asgi/__init__.py` & `Tailbone-0.9.90/tailbone/views/asgi/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/products.py` & `Tailbone-0.9.90/tailbone/views/products.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,26 +22,26 @@
 ################################################################################
 """
 Product Views
 """
 
 import re
 import logging
-
+from collections import OrderedDict
 import humanize
 import sqlalchemy as sa
 from sqlalchemy import orm
 import sqlalchemy_continuum as continuum
 
 from rattail import enum, pod, sil
 from rattail.db import model, api, auth, Session as RattailSession
 from rattail.gpc import GPC
 from rattail.threads import Thread
 from rattail.exceptions import LabelPrintingError
-from rattail.util import load_object, pretty_quantity, OrderedDict, simple_error
+from rattail.util import load_object, pretty_quantity, simple_error
 from rattail.time import localtime, make_utc
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import tags, HTML
 
 from tailbone import forms, grids
@@ -75,20 +75,23 @@
     """
     Master view for the Product class.
     """
     model_class = model.Product
     has_versions = True
     results_downloadable_xlsx = True
     supports_autocomplete = True
+    bulk_deletable = True
     mergeable = True
     configurable = True
 
     labels = {
         'item_id': "Item ID",
         'upc': "UPC",
+        'vendor': "Vendor (preferred)",
+        'vendor_any': "Vendor (any)",
         'status_code': "Status",
         'tax1': "Tax 1",
         'tax2': "Tax 2",
         'tax3': "Tax 3",
         'tpr_price': "TPR Price",
         'tpr_price_ends': "TPR Price Ends",
     }
@@ -153,48 +156,32 @@
         'discontinued',
         'deleted',
         'last_sold',
         'inventory_on_hand',
         'inventory_on_order',
     ]
 
-    # These aliases enable the grid queries to filter products which may be
-    # purchased from *any* vendor, and yet sort by only the "preferred" vendor
-    # (since that's what shows up in the grid column).
-    ProductVendorCost = orm.aliased(model.ProductCost)
-    ProductVendorCostAny = orm.aliased(model.ProductCost)
-    VendorAny = orm.aliased(model.Vendor)
-
-    # same, but for prices
-    RegularPrice = orm.aliased(model.ProductPrice)
-    CurrentPrice = orm.aliased(model.ProductPrice)
-    SalePrice = orm.aliased(model.ProductPrice)
-    TPRPrice = orm.aliased(model.ProductPrice)
-
     def __init__(self, request):
-        super(ProductView, self).__init__(request)
+        super().__init__(request)
         self.expose_label_printing = self.rattail_config.getbool(
             'tailbone', 'products.print_labels', default=False)
 
         app = self.get_rattail_app()
         self.products_handler = app.get_products_handler()
         self.merge_handler = self.products_handler
         # TODO: deprecate / remove these
         self.product_handler = self.products_handler
         self.handler = self.products_handler
 
     def query(self, session):
-        query = super(ProductView, self).query(session)
+        query = super().query(session)
 
         if not self.has_perm('view_deleted'):
             query = query.filter(model.Product.deleted == False)
 
-        # TODO: surely this is not always needed
-        query = query.outerjoin(model.ProductInventory)
-
         return query
 
     def get_departments(self):
         """
         Returns the list of departments to be exposed in a drop-down.
         """
         model = self.model
@@ -202,75 +189,87 @@
                            .filter(sa.or_(
                                model.Department.product == True,
                                model.Department.product == None))\
                            .order_by(model.Department.name)\
                            .all()
 
     def configure_grid(self, g):
-        super(ProductView, self).configure_grid(g)
+        super().configure_grid(g)
         app = self.get_rattail_app()
         model = self.model
 
-        def join_vendor(q):
-            return q.outerjoin(self.ProductVendorCost,
-                               sa.and_(
-                                   self.ProductVendorCost.product_uuid == model.Product.uuid,
-                                   self.ProductVendorCost.preference == 1))\
-                    .outerjoin(model.Vendor)
-
-        def join_vendor_any(q):
-            return q.outerjoin(self.ProductVendorCostAny,
-                               self.ProductVendorCostAny.product_uuid == model.Product.uuid)\
-                    .outerjoin(self.VendorAny,
-                               self.VendorAny.uuid == self.ProductVendorCostAny.vendor_uuid)
-
         ProductCostCode = orm.aliased(model.ProductCost)
         ProductCostCodeAny = orm.aliased(model.ProductCost)
 
         def join_vendor_code(q):
             return q.outerjoin(ProductCostCode,
                                sa.and_(
                                    ProductCostCode.product_uuid == model.Product.uuid,
                                    ProductCostCode.preference == 1))
 
         def join_vendor_code_any(q):
             return q.outerjoin(ProductCostCodeAny,
                                ProductCostCodeAny.product_uuid == model.Product.uuid)
 
         # product key
-        key = self.rattail_config.product_key()
-        field = self.product_key_fields.get(key, key)
+        field = self.get_product_key_field()
         g.filters[field].default_active = True
         g.filters[field].default_verb = 'equal'
         g.set_sort_defaults(field)
         g.set_link(field)
 
         # brand
-        g.joiners['brand'] = lambda q: q.outerjoin(model.Brand)
+        g.set_joiner('brand', lambda q: q.outerjoin(model.Brand))
+        g.set_sorter('brand', model.Brand.name)
+        g.set_filter('brand', model.Brand.name,
+                     default_active=True, default_verb='contains')
 
         # department
         g.set_joiner('department', lambda q: q.outerjoin(model.Department))
         g.set_sorter('department', model.Department.name)
         departments = self.get_departments()
         department_choices = OrderedDict([('', "(any)")]
                                          + [(d.uuid, d.name) for d in departments])
         g.set_filter('department', model.Department.uuid,
                      value_enum=department_choices,
                      verbs=['equal', 'not_equal', 'is_null', 'is_not_null', 'is_any'],
                      default_active=True, default_verb='equal')
 
-        g.joiners['subdepartment'] = lambda q: q.outerjoin(model.Subdepartment,
-                                                           model.Subdepartment.uuid == model.Product.subdepartment_uuid)
+        # subdepartment
+        g.set_joiner('subdepartment', lambda q: q.outerjoin(
+            model.Subdepartment,
+            model.Subdepartment.uuid == model.Product.subdepartment_uuid))
+        g.set_sorter('subdepartment', model.Subdepartment.name)
+        g.set_filter('subdepartment', model.Subdepartment.name)
+
         g.joiners['code'] = lambda q: q.outerjoin(model.ProductCode)
-        g.joiners['vendor'] = join_vendor
-        g.joiners['vendor_any'] = join_vendor_any
 
-        g.sorters['brand'] = g.make_sorter(model.Brand.name)
-        g.sorters['subdepartment'] = g.make_sorter(model.Subdepartment.name)
-        g.sorters['vendor'] = g.make_sorter(model.Vendor.name)
+        # vendor
+        ProductVendorCost = orm.aliased(model.ProductCost)
+        def join_vendor(q):
+            return q.outerjoin(ProductVendorCost,
+                               sa.and_(
+                                   ProductVendorCost.product_uuid == model.Product.uuid,
+                                   ProductVendorCost.preference == 1))\
+                    .outerjoin(model.Vendor)
+        g.set_joiner('vendor', join_vendor)
+        g.set_sorter('vendor', model.Vendor.name)
+        g.set_filter('vendor', model.Vendor.name)
+
+        # vendor_any
+        ProductVendorCostAny = orm.aliased(model.ProductCost)
+        VendorAny = orm.aliased(model.Vendor)
+        def join_vendor_any(q):
+            return q.outerjoin(ProductVendorCostAny,
+                               ProductVendorCostAny.product_uuid == model.Product.uuid)\
+                    .outerjoin(VendorAny,
+                               VendorAny.uuid == ProductVendorCostAny.vendor_uuid)
+        g.set_joiner('vendor_any', join_vendor_any)
+        g.set_filter('vendor_any', VendorAny.name)
+                     # factory=VendorAnyFilter, joiner=join_vendor_any)
 
         ProductTrueCost = orm.aliased(model.ProductVolatile)
         ProductTrueMargin = orm.aliased(model.ProductVolatile)
 
         # true_cost
         g.set_joiner('true_cost', lambda q: q.outerjoin(ProductTrueCost))
         g.set_filter('true_cost', ProductTrueCost.true_cost)
@@ -280,30 +279,27 @@
         # true_margin
         g.set_joiner('true_margin', lambda q: q.outerjoin(ProductTrueMargin))
         g.set_filter('true_margin', ProductTrueMargin.true_margin)
         g.set_sorter('true_margin', ProductTrueMargin.true_margin)
         g.set_renderer('true_margin', self.render_true_margin)
 
         # on_hand
-        g.set_sorter('on_hand', model.ProductInventory.on_hand)
-        g.set_filter('on_hand', model.ProductInventory.on_hand)
+        InventoryOnHand = orm.aliased(model.ProductInventory)
+        g.set_joiner('on_hand', lambda q: q.outerjoin(InventoryOnHand))
+        g.set_sorter('on_hand', InventoryOnHand.on_hand)
+        g.set_filter('on_hand', InventoryOnHand.on_hand)
 
         # on_order
-        g.set_sorter('on_order', model.ProductInventory.on_order)
-        g.set_filter('on_order', model.ProductInventory.on_order)
+        InventoryOnOrder = orm.aliased(model.ProductInventory)
+        g.set_sorter('on_order', InventoryOnOrder.on_order)
+        g.set_filter('on_order', InventoryOnOrder.on_order)
 
         g.filters['description'].default_active = True
         g.filters['description'].default_verb = 'contains'
-        g.filters['brand'] = g.make_filter('brand', model.Brand.name,
-                                           default_active=True, default_verb='contains')
-        g.filters['subdepartment'] = g.make_filter('subdepartment', model.Subdepartment.name)
         g.filters['code'] = g.make_filter('code', model.ProductCode.code)
-        g.filters['vendor'] = g.make_filter('vendor', model.Vendor.name)
-        g.filters['vendor_any'] = g.make_filter('vendor_any', self.VendorAny.name)
-                                                # factory=VendorAnyFilter, joiner=join_vendor_any)
 
         # g.joiners['vendor_code_any'] = join_vendor_code_any
         # g.filters['vendor_code_any'] = g.make_filter('vendor_code_any', ProductCostCodeAny.code)
         # g.joiners['vendor_code'] = join_vendor_code
         # g.filters['vendor_code'] = g.make_filter('vendor_code', ProductCostCode.code)
 
         # vendor_code*
@@ -326,50 +322,65 @@
                                            CategoryByName.uuid == model.Product.category_uuid))
         g.set_filter('category_name', CategoryByName.name)
 
         # family
         g.set_joiner('family', lambda q: q.outerjoin(model.Family))
         g.set_filter('family', model.Family.name)
 
+        # regular_price
         g.set_label('regular_price', "Reg. Price")
+        RegularPrice = orm.aliased(model.ProductPrice)
         g.set_joiner('regular_price', lambda q: q.outerjoin(
-            self.RegularPrice, self.RegularPrice.uuid == model.Product.regular_price_uuid))
-        g.set_sorter('regular_price', self.RegularPrice.price)
-        g.set_filter('regular_price', self.RegularPrice.price, label="Regular Price")
+            RegularPrice, RegularPrice.uuid == model.Product.regular_price_uuid))
+        g.set_sorter('regular_price', RegularPrice.price)
+        g.set_filter('regular_price', RegularPrice.price, label="Regular Price")
 
+        # current_price
         g.set_label('current_price', "Cur. Price")
         g.set_renderer('current_price', self.render_current_price_for_grid)
+        CurrentPrice = orm.aliased(model.ProductPrice)
         g.set_joiner('current_price', lambda q: q.outerjoin(
-            self.CurrentPrice, self.CurrentPrice.uuid == model.Product.current_price_uuid))
-        g.set_sorter('current_price', self.CurrentPrice.price)
-        g.set_filter('current_price', self.CurrentPrice.price, label="Current Price")
+            CurrentPrice, CurrentPrice.uuid == model.Product.current_price_uuid))
+        g.set_sorter('current_price', CurrentPrice.price)
+        g.set_filter('current_price', CurrentPrice.price, label="Current Price")
 
         # tpr_price
+        TPRPrice = orm.aliased(model.ProductPrice)
         g.set_joiner('tpr_price', lambda q: q.outerjoin(
-            self.TPRPrice, self.TPRPrice.uuid == model.Product.tpr_price_uuid))
-        g.set_filter('tpr_price', self.TPRPrice.price)
+            TPRPrice, TPRPrice.uuid == model.Product.tpr_price_uuid))
+        g.set_filter('tpr_price', TPRPrice.price)
 
         # sale_price
+        SalePrice = orm.aliased(model.ProductPrice)
         g.set_joiner('sale_price', lambda q: q.outerjoin(
-            self.SalePrice, self.SalePrice.uuid == model.Product.sale_price_uuid))
-        g.set_filter('sale_price', self.SalePrice.price)
+            SalePrice, SalePrice.uuid == model.Product.sale_price_uuid))
+        g.set_filter('sale_price', SalePrice.price)
 
         # suggested_price
         g.set_renderer('suggested_price', self.render_grid_suggested_price)
 
         # (unit) cost
         g.set_joiner('cost', lambda q: q.outerjoin(model.ProductCost,
                                                    sa.and_(
                                                        model.ProductCost.product_uuid == model.Product.uuid,
                                                        model.ProductCost.preference == 1)))
         g.set_sorter('cost', model.ProductCost.unit_cost)
         g.set_filter('cost', model.ProductCost.unit_cost)
         g.set_renderer('cost', self.render_cost)
         g.set_label('cost', "Unit Cost")
 
+        # tax
+        g.set_joiner('tax', lambda q: q.outerjoin(model.Tax))
+        taxes = self.Session.query(model.Tax)\
+                            .order_by(model.Tax.code)\
+                            .all()
+        taxes = OrderedDict([(tax.uuid, tax.description)
+                             for tax in taxes])
+        g.set_filter('tax', model.Tax.uuid, value_enum=taxes)
+
         # report_code_name
         g.set_joiner('report_code_name', lambda q: q.outerjoin(model.ReportCode))
         g.set_filter('report_code_name', model.ReportCode.name)
 
         if self.expose_label_printing and self.has_perm('print_labels'):
             g.more_actions.append(self.make_action(
                 'print_label', icon='print', url='#',
@@ -378,163 +389,29 @@
         g.set_renderer('regular_price', self.render_price)
         g.set_renderer('on_hand', self.render_on_hand)
         g.set_renderer('on_order', self.render_on_order)
 
         g.set_link('item_id')
         g.set_link('description')
 
-        g.set_label('vendor', "Vendor (preferred)")
-        g.set_label('vendor_any', "Vendor (any)")
-        g.set_label('vendor', "Vendor (preferred)")
-
-    def configure_common_form(self, f):
-        super(ProductView, self).configure_common_form(f)
-        product = f.model_instance
-
-        # unit_size
-        f.set_type('unit_size', 'quantity')
-
-        # unit_of_measure
-        f.set_enum('unit_of_measure', self.enum.UNIT_OF_MEASURE)
-        f.set_label('unit_of_measure', "Unit of Measure")
-
-        # packs
-        if self.creating:
-            f.remove_field('packs')
-        elif self.viewing and product.packs:
-            f.set_renderer('packs', self.render_packs)
-            f.set_label('packs', "Pack Items")
-        else:
-            f.remove_field('packs')
-
-        # pack_size
-        if self.viewing and not product.is_pack_item():
-            f.remove_field('pack_size')
-        else:
-            f.set_type('pack_size', 'quantity')
-
-        # default_pack
-        if self.viewing and not product.is_pack_item():
-            f.remove_field('default_pack')
-
-        # unit
-        if self.creating:
-            f.remove_field('unit')
-        elif self.viewing and product.is_pack_item():
-            f.set_renderer('unit', self.render_unit)
-            f.set_label('unit', "Unit Item")
-        else:
-            f.remove_field('unit')
-
-        # suggested_price
-        if self.creating:
-            f.remove_field('suggested_price')
-        else:
-            f.set_readonly('suggested_price')
-            f.set_renderer('suggested_price', self.render_suggested_price)
-
-        # regular_price
-        if self.creating:
-            f.remove_field('regular_price')
-        else:
-            f.set_readonly('regular_price')
-            f.set_renderer('regular_price', self.render_regular_price)
-
-        # current_price
-        if self.creating:
-            f.remove_field('current_price')
-        else:
-            f.set_readonly('current_price')
-            f.set_renderer('current_price', self.render_current_price)
-
-        # current_price_ends
-        if self.creating:
-            f.remove_field('current_price_ends')
-        else:
-            f.set_readonly('current_price_ends')
-            f.set_renderer('current_price_ends', self.render_current_price_ends)
-
-        # sale_price
-        if self.creating:
-            f.remove_field('sale_price')
-        else:
-            f.set_readonly('sale_price')
-            f.set_renderer('sale_price', self.render_price)
-
-        # sale_price_ends
-        if self.creating:
-            f.remove_field('sale_price_ends')
-        else:
-            f.set_readonly('sale_price_ends')
-            f.set_renderer('sale_price_ends', self.render_sale_price_ends)
-
-        # tpr_price
-        if self.creating:
-            f.remove_field('tpr_price')
-        else:
-            f.set_readonly('tpr_price')
-            f.set_renderer('tpr_price', self.render_price)
-
-        # tpr_price_ends
-        if self.creating:
-            f.remove_field('tpr_price_ends')
-        else:
-            f.set_readonly('tpr_price_ends')
-            f.set_renderer('tpr_price_ends', self.render_tpr_price_ends)
-
-        # vendor
-        if self.creating:
-            f.remove_field('vendor')
-        else:
-            f.set_readonly('vendor')
-            f.set_label('vendor', "Preferred Vendor")
-
-        # cost
-        if self.creating:
-            f.remove_field('cost')
-        else:
-            f.set_readonly('cost')
-            f.set_label('cost', "Preferred Unit Cost")
-            f.set_renderer('cost', self.render_cost)
-
-        # last_sold
-        if self.creating:
-            f.remove_field('last_sold')
-        else:
-            f.set_readonly('last_sold')
-
-        # inventory_on_hand
-        if self.creating:
-            f.remove_field('inventory_on_hand')
-        else:
-            f.set_readonly('inventory_on_hand')
-            f.set_renderer('inventory_on_hand', self.render_inventory_on_hand)
-            f.set_label('inventory_on_hand', "On Hand")
-
-        # inventory_on_order
-        if self.creating:
-            f.remove_field('inventory_on_order')
-        else:
-            f.set_readonly('inventory_on_order')
-            f.set_renderer('inventory_on_order', self.render_inventory_on_order)
-            f.set_label('inventory_on_order', "On Order")
-
     def render_cost(self, product, field):
         cost = getattr(product, field)
         if not cost:
             return ""
         if cost.unit_cost is None:
             return ""
         return "${:0.2f}".format(cost.unit_cost)
 
     def render_price(self, product, field):
-        if not product.not_for_sale:
-            price = product[field]
-            if price:
-                return self.products_handler.render_price(price)
+        # TODO: previously this rendered null (empty string) if
+        # product was marked "not for sale" - but why? important?
+        #if not product.not_for_sale:
+        price = product[field]
+        if price:
+            return self.products_handler.render_price(price)
         
     def render_current_price_for_grid(self, product, field):
         text = self.render_price(product, field) or ""
 
         price = product.current_price
         if price:
             app = self.get_rattail_app()
@@ -654,24 +531,21 @@
     def render_on_order(self, product, column):
         inventory = product.inventory
         if not inventory:
             return ""
         return pretty_quantity(inventory.on_order)
 
     def template_kwargs_index(self, **kwargs):
-        kwargs = super(ProductView, self).template_kwargs_index(**kwargs)
+        kwargs = super().template_kwargs_index(**kwargs)
+        app = self.get_rattail_app()
+        label_handler = app.get_label_handler()
         model = self.model
 
         if self.expose_label_printing:
-
-            kwargs['label_profiles'] = self.Session.query(model.LabelProfile)\
-                                                   .filter(model.LabelProfile.visible == True)\
-                                                   .order_by(model.LabelProfile.ordinal)\
-                                                   .all()
-
+            kwargs['label_profiles'] = label_handler.get_label_profiles(self.Session())
             kwargs['quick_label_speedbump_threshold'] = self.rattail_config.getint(
                 'tailbone', 'products.quick_labels.speedbump_threshold')
 
         return kwargs
 
     def grid_extra_class(self, product, i):
         classes = []
@@ -681,15 +555,15 @@
             classes.append('discontinued')
         if product.deleted:
             classes.append('deleted')
         if classes:
             return ' '.join(classes)
 
     def get_xlsx_fields(self):
-        fields = super(ProductView, self).get_xlsx_fields()
+        fields = super().get_xlsx_fields()
 
         i = fields.index('department_uuid')
         fields.insert(i + 1, 'department_number')
         fields.insert(i + 2, 'department_name')
 
         i = fields.index('subdepartment_uuid')
         fields.insert(i + 1, 'subdepartment_number')
@@ -728,15 +602,15 @@
         fields.append('vendor_item_code')
         fields.append('unit_cost')
         fields.append('true_margin')
 
         return fields
 
     def get_xlsx_row(self, product, fields):
-        row = super(ProductView, self).get_xlsx_row(product, fields)
+        row = super().get_xlsx_row(product, fields)
 
         if 'upc' in fields and isinstance(row['upc'], GPC):
             row['upc'] = row['upc'].pretty()
 
         if 'department_number' in fields:
             row['department_number'] = product.department.number if product.department else None
         if 'department_name' in fields:
@@ -793,15 +667,15 @@
             row['true_margin'] = None
             if product.volatile and product.volatile.true_margin:
                 row['true_margin'] = product.volatile.true_margin
 
         return row
 
     def download_results_normalize(self, product, fields, **kwargs):
-        data = super(ProductView, self).download_results_normalize(
+        data = super().download_results_normalize(
             product, fields, **kwargs)
 
         if 'upc' in data:
             if isinstance(data['upc'], GPC):
                 data['upc'] = str(data['upc'])
 
         return data
@@ -813,17 +687,146 @@
             return product
         price = self.Session.get(model.ProductPrice, key)
         if price:
             return price.product
         raise self.notfound()
 
     def configure_form(self, f):
-        super(ProductView, self).configure_form(f)
+        super().configure_form(f)
         product = f.model_instance
 
+        # unit_size
+        f.set_type('unit_size', 'quantity')
+
+        # unit_of_measure
+        f.set_enum('unit_of_measure', self.enum.UNIT_OF_MEASURE)
+        f.set_renderer('unit_of_measure', self.render_unit_of_measure)
+        f.set_label('unit_of_measure', "Unit of Measure")
+
+        # packs
+        if self.creating:
+            f.remove_field('packs')
+        elif self.viewing and product.packs:
+            f.set_renderer('packs', self.render_packs)
+            f.set_label('packs', "Pack Items")
+        else:
+            f.remove_field('packs')
+
+        # pack_size
+        if self.viewing and not product.is_pack_item():
+            f.remove_field('pack_size')
+        else:
+            f.set_type('pack_size', 'quantity')
+
+        # default_pack
+        if self.viewing and not product.is_pack_item():
+            f.remove_field('default_pack')
+
+        # unit
+        if self.creating:
+            f.remove_field('unit')
+        elif self.viewing and product.is_pack_item():
+            f.set_renderer('unit', self.render_unit)
+            f.set_label('unit', "Unit Item")
+        else:
+            f.remove_field('unit')
+
+        # suggested_price
+        if self.creating:
+            f.remove_field('suggested_price')
+        else:
+            f.set_readonly('suggested_price')
+            f.set_renderer('suggested_price', self.render_suggested_price)
+
+        # regular_price
+        if self.creating:
+            f.remove_field('regular_price')
+        else:
+            f.set_readonly('regular_price')
+            f.set_renderer('regular_price', self.render_regular_price)
+
+        # current_price
+        if self.creating:
+            f.remove_field('current_price')
+        else:
+            f.set_readonly('current_price')
+            f.set_renderer('current_price', self.render_current_price)
+
+        # current_price_ends
+        if self.creating:
+            f.remove_field('current_price_ends')
+        else:
+            f.set_readonly('current_price_ends')
+            f.set_renderer('current_price_ends', self.render_current_price_ends)
+
+        # sale_price
+        if self.creating:
+            f.remove_field('sale_price')
+        else:
+            f.set_readonly('sale_price')
+            f.set_renderer('sale_price', self.render_price)
+
+        # sale_price_ends
+        if self.creating:
+            f.remove_field('sale_price_ends')
+        else:
+            f.set_readonly('sale_price_ends')
+            f.set_renderer('sale_price_ends', self.render_sale_price_ends)
+
+        # tpr_price
+        if self.creating:
+            f.remove_field('tpr_price')
+        else:
+            f.set_readonly('tpr_price')
+            f.set_renderer('tpr_price', self.render_price)
+
+        # tpr_price_ends
+        if self.creating:
+            f.remove_field('tpr_price_ends')
+        else:
+            f.set_readonly('tpr_price_ends')
+            f.set_renderer('tpr_price_ends', self.render_tpr_price_ends)
+
+        # vendor
+        if self.creating:
+            f.remove_field('vendor')
+        else:
+            f.set_readonly('vendor')
+            f.set_label('vendor', "Preferred Vendor")
+
+        # cost
+        if self.creating:
+            f.remove_field('cost')
+        else:
+            f.set_readonly('cost')
+            f.set_label('cost', "Preferred Unit Cost")
+            f.set_renderer('cost', self.render_cost)
+
+        # last_sold
+        if self.creating:
+            f.remove_field('last_sold')
+        else:
+            f.set_readonly('last_sold')
+
+        # inventory_on_hand
+        if self.creating:
+            f.remove_field('inventory_on_hand')
+        else:
+            f.set_readonly('inventory_on_hand')
+            f.set_renderer('inventory_on_hand', self.render_inventory_on_hand)
+            f.set_label('inventory_on_hand', "On Hand")
+
+        # inventory_on_order
+        if self.creating:
+            f.remove_field('inventory_on_order')
+        else:
+            f.set_readonly('inventory_on_order')
+            f.set_renderer('inventory_on_order', self.render_inventory_on_order)
+            f.set_label('inventory_on_order', "On Order")
+
         # department
         if self.creating or self.editing:
             if 'department' in f.fields:
                 f.replace('department', 'department_uuid')
                 departments = self.get_departments()
                 dept_values = [(d.uuid, "{} {}".format(d.number, d.name))
                                for d in departments]
@@ -937,15 +940,15 @@
                 require_tax = False
                 if not require_tax:
                     tax_values.insert(0, ('', "(none)"))
                 f.set_widget('tax_uuid', dfwidget.SelectWidget(values=tax_values))
                 f.set_label('tax_uuid', "Tax")
         else:
             f.set_readonly('tax')
-            # f.set_renderer('tax', self.render_tax)
+            f.set_renderer('tax', self.render_tax)
 
         # tax1/2/3
         f.set_readonly('tax1')
         f.set_readonly('tax2')
         f.set_readonly('tax3')
 
         # brand
@@ -982,22 +985,30 @@
 
         if not self.request.has_perm('products.view_deleted'):
             f.remove('deleted')
 
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
-        product = super(ProductView, self).objectify(form, data=data)
+        product = super().objectify(form, data=data)
 
         # regular_price_amount
         if (self.creating or self.editing) and 'regular_price_amount' in form.fields:
             api.set_regular_price(product, data['regular_price_amount'])
 
         return product
 
+    def render_unit_of_measure(self, product, field):
+        uom = getattr(product, field)
+        if uom is None:
+            return
+        if uom == self.enum.UNIT_OF_MEASURE_NONE:
+            return
+        return self.enum.UNIT_OF_MEASURE.get(uom, uom)
+
     def render_department(self, product, field):
         department = product.department
         if not department:
             return ""
         if department.number:
             text = '({}) {}'.format(department.number, department.name)
         else:
@@ -1157,15 +1168,15 @@
             user = history.pop('changed_by')
             history['changed_by_uuid'] = user.uuid
             history['changed_by_display'] = str(user)
             jsdata.append(history)
         return jsdata
 
     def template_kwargs_view(self, **kwargs):
-        kwargs = super(ProductView, self).template_kwargs_view(**kwargs)
+        kwargs = super().template_kwargs_view(**kwargs)
         product = kwargs['instance']
 
         kwargs['image_url'] = self.products_handler.get_image_url(product)
 
         # add price history, if user has access
         if self.rattail_config.versioning_enabled() and self.has_perm('versions'):
 
@@ -1248,16 +1259,15 @@
     def get_panel_fields(self, product):
         return {
             'main': self.get_panel_fields_main(product),
             'flag': self.get_panel_fields_flag(product),
         }
 
     def get_panel_fields_main(self, product):
-        key = self.rattail_config.product_key()
-        product_key_field = self.product_key_fields.get(key, key)
+        product_key_field = self.get_product_key_field()
         fields = [
             product_key_field,
             'brand',
             'description',
             'size',
             'unit_size',
             'unit_of_measure',
@@ -1871,14 +1881,15 @@
             'case_quantity',
             'case_price',
             'case_price_display',
             'uom_choices',
         ])
 
     # TODO: deprecate / remove this?  not sure if/where it is used
+    # (hm, still used by the old Instacart -> Configure page..)
     def search_v1(self):
         """
         Locate a product(s) by UPC.
 
         Eventually this should be more generic, or at least offer more fields for
         search.  For now it operates only on the ``Product.upc`` field.
         """
@@ -1893,15 +1904,16 @@
                 product = api.get_product_by_upc(self.Session(), upc)
             if product and (not product.deleted or self.request.has_perm('products.view_deleted')):
                 data = {
                     'uuid': product.uuid,
                     'upc': str(product.upc),
                     'upc_pretty': product.upc.pretty(),
                     'full_description': product.full_description,
-                    'image_url': pod.get_image_url(self.rattail_config, product.upc),
+                    'image_url': pod.get_image_url(self.rattail_config, product.upc,
+                                                   require=False),
                 }
                 uuid = self.request.GET.get('with_vendor_cost')
                 if uuid:
                     vendor = self.Session.get(model.Vendor, uuid)
                     if not vendor:
                         return {'error': "Vendor not found"}
                     cost = product.cost_for_vendor(vendor)
@@ -1967,28 +1979,28 @@
                 # must prefix node names with batch key, to guarantee unique
                 for node in schema:
                     node.param_name = node.name
                     node.name = '{}_{}'.format(key, node.name)
                 params_forms[key] = forms.Form(schema=schema, request=self.request)
 
         if self.request.method == 'POST':
-            if form.validate(newstyle=True):
+            if form.validate():
                 data = form.validated
                 fully_validated = True
 
                 # collect general params
                 batch_key = data['batch_type']
                 params = {
                     'description': data['description'],
                     'notes': data['notes']}
 
                 # collect batch-type-specific params
                 pform = params_forms.get(batch_key)
                 if pform:
-                    if pform.validate(newstyle=True):
+                    if pform.validate():
                         pdata = pform.validated
                         for field in pform.schema:
                             param_name = pform.schema[field.name].param_name
                             params[param_name] = pdata[field.name]
                     else:
                         fully_validated = False
 
@@ -2227,49 +2239,93 @@
         'created',
         'user',
         'status_code',
     ]
 
     form_fields = [
         '_product_key_',
+        'product',
         'brand_name',
         'brand',
         'description',
         'size',
         'department_name',
         'department',
         'vendor_name',
         'vendor',
+        'vendor_item_code',
         'unit_cost',
         'case_size',
         'regular_price_amount',
         'special_order',
         'notes',
+        'status_code',
         'created',
         'user',
+        'resolved',
+        'resolved_by',
+    ]
+
+    has_rows = True
+    model_row_class = model.CustomerOrderItem
+    rows_title = "Customer Orders"
+    # TODO: add support for this someday
+    rows_viewable = False
+
+    row_labels = {
+        'order_id': "Order ID",
+        'product_brand': "Brand",
+        'product_description': "Description",
+        'product_size': "Size",
+        'order_created': "Ordered",
+        'status_code': "Status",
+    }
+
+    row_grid_columns = [
+        'order_id',
+        'customer',
+        'person',
+        '_product_key_',
+        'product_brand',
+        'product_description',
+        'product_size',
+        'order_quantity',
+        'total_price',
+        'order_created',
         'status_code',
+        'flagged',
     ]
 
     def configure_grid(self, g):
-        super(PendingProductView, self).configure_grid(g)
+        super().configure_grid(g)
+        model = self.model
+
+        # description
+        g.set_link('description')
 
+        # status_code
         g.set_enum('status_code', self.enum.PENDING_PRODUCT_STATUS)
-        g.filters['status_code'].default_active = True
-        g.filters['status_code'].default_verb = 'not_equal'
-        g.filters['status_code'].default_value = str(self.enum.PENDING_PRODUCT_STATUS_RESOLVED)
+        g.set_filter('status_code', model.PendingProduct.status_code,
+                     value_enum=self.enum.PENDING_PRODUCT_STATUS,
+                     default_active=True,
+                     default_verb='equal',
+                     default_value=str(self.enum.PENDING_PRODUCT_STATUS_PENDING))
 
+        # created
         g.set_sort_defaults('created', 'desc')
 
-        g.set_link('description')
-
     def configure_form(self, f):
-        super(PendingProductView, self).configure_form(f)
+        super().configure_form(f)
         model = self.model
         pending = f.model_instance
 
+        # product
+        f.set_readonly('product') # TODO
+        f.set_renderer('product', self.render_product)
+
         # department
         if self.creating or self.editing:
             if 'department' in f:
                 f.remove('department_name')
                 f.replace('department', 'department_uuid')
                 f.set_widget('department_uuid', forms.widgets.DepartmentWidget(self.request, required=False))
                 f.set_label('department_uuid', "Department")
@@ -2340,38 +2396,95 @@
 
         # created
         if self.creating:
             f.remove('created')
         else:
             f.set_readonly('created')
 
+        # status_code
+        if self.creating:
+            f.remove('status_code')
+        else:
+            f.set_enum('status_code', self.enum.PENDING_PRODUCT_STATUS)
+            if self.viewing:
+                f.set_renderer('status_code', self.render_status_code)
+
+                if (self.has_perm('ignore_product')
+                    and pending.status_code in (self.enum.PENDING_PRODUCT_STATUS_PENDING,
+                                                self.enum.PENDING_PRODUCT_STATUS_READY)):
+                    f.set_vuejs_component_kwargs(**{'@ignore-product': 'ignoreProductInit'})
+
+                if (self.has_perm('resolve_product')
+                    and pending.status_code in (self.enum.PENDING_PRODUCT_STATUS_PENDING,
+                                                self.enum.PENDING_PRODUCT_STATUS_READY,
+                                                self.enum.PENDING_PRODUCT_STATUS_IGNORED)):
+                    f.set_vuejs_component_kwargs(**{'@resolve-product': 'resolveProductInit'})
+
         # user
         if self.creating:
             f.remove('user')
         else:
             f.set_readonly('user')
             f.set_renderer('user', self.render_user)
 
-        # status_code
+        # resolved*
         if self.creating:
-            f.remove('status_code')
+            f.remove('resolved', 'resolved_by')
         else:
-            # f.set_readonly('status_code')
-            f.set_enum('status_code', self.enum.PENDING_PRODUCT_STATUS)
+            if not pending.resolved:
+                f.remove('resolved', 'resolved_by')
+
+    def render_status_code(self, pending, field):
+        status = pending.status_code
+        if not status:
+            return
+
+        # will just show status text by default
+        text = self.enum.PENDING_PRODUCT_STATUS.get(status, str(status))
+        html = text
+
+        # but maybe also show buttons to change status
+        buttons = []
+
+        if (self.has_perm('ignore_product')
+            and status in (self.enum.PENDING_PRODUCT_STATUS_PENDING,
+                           self.enum.PENDING_PRODUCT_STATUS_READY)):
+            buttons.append(self.make_buefy_button("Ignore Product",
+                                                  type='is-warning',
+                                                  icon_left='ban',
+                                                  **{'@click': "$emit('ignore-product')"}))
+
+        if (self.has_perm('resolve_product')
+            and status in (self.enum.PENDING_PRODUCT_STATUS_PENDING,
+                           self.enum.PENDING_PRODUCT_STATUS_READY,
+                           self.enum.PENDING_PRODUCT_STATUS_IGNORED)):
+            buttons.append(self.make_buefy_button("Resolve Product",
+                                                  is_primary=True,
+                                                  icon_left='object-ungroup',
+                                                  **{'@click': "$emit('resolve-product')"}))
+
+        if buttons:
+            text = HTML.tag('span', class_='control', c=[text])
+            buttons = HTML.tag('div', class_='buttons', c=buttons)
+            html = HTML.tag('b-field', grouped='grouped', c=[text, buttons])
+
+        return html
 
     def editable_instance(self, pending):
+        if self.request.is_root:
+            return True
         if pending.status_code == self.enum.PENDING_PRODUCT_STATUS_RESOLVED:
             return False
         return True
 
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
 
-        pending = super(PendingProductView, self).objectify(form, data)
+        pending = super().objectify(form, data)
 
         if not pending.user:
             pending.user = self.request.user
 
         self.Session.add(pending)
         self.Session.flush()
         self.Session.refresh(pending)
@@ -2417,17 +2530,71 @@
         product = self.Session.get(model.Product, uuid)
         if not product:
             self.request.session.flash("Product not found!", 'error')
             return redirect
 
         app = self.get_rattail_app()
         products_handler = app.get_products_handler()
-        products_handler.resolve_product(pending, product, self.request.user)
+        kwargs = self.get_resolve_product_kwargs()
+        products_handler.resolve_product(pending, product, self.request.user, **kwargs)
         return redirect
 
+    def get_resolve_product_kwargs(self, **kwargs):
+        return kwargs
+
+    def ignore_product(self):
+        model = self.model
+        pending = self.get_instance()
+        pending.status_code = self.enum.PENDING_PRODUCT_STATUS_IGNORED
+        return self.redirect(self.get_action_url('view', pending))
+
+    def get_row_data(self, pending):
+        model = self.model
+        return self.Session.query(model.CustomerOrderItem)\
+                           .filter(model.CustomerOrderItem.pending_product == pending)
+
+    def get_parent(self, item):
+        return item.pending_product
+
+    def configure_row_grid(self, g):
+        super().configure_row_grid(g)
+        app = self.get_rattail_app()
+
+        # order_id
+        g.set_renderer('order_id', lambda item, field: item.order.id)
+
+        # contact
+        handler = app.get_batch_handler('custorder')
+        if handler.new_order_requires_customer():
+            g.remove('person')
+            g.set_renderer('customer', lambda item, field: item.order.customer)
+        else:
+            g.remove('customer')
+            g.set_renderer('person', lambda item, field: item.order.person)
+
+        # product_key
+        field = self.get_product_key_field()
+        if not self.rows_viewable:
+            g.set_link(field, False)
+        g.set_renderer(field, lambda item, field: getattr(item, f'product_{field}'))
+
+        # "numbers"
+        g.set_type('order_quantity', 'quantity')
+        g.set_type('total_price', 'currency')
+
+        # order_created
+        g.set_renderer('order_created',
+                       lambda item, field: raw_datetime(self.rattail_config,
+                                                        app.localtime(item.order.created,
+                                                                      from_utc=True),
+                                                        as_date=True))
+
+        # status_code
+        g.set_enum('status_code', self.enum.CUSTORDER_ITEM_STATUS)
+
     @classmethod
     def defaults(cls, config):
         cls._defaults(config)
         cls._pending_product_defaults(config)
 
     @classmethod
     def _pending_product_defaults(cls, config):
@@ -2443,14 +2610,25 @@
         config.add_route('{}.resolve_product'.format(route_prefix),
                          '{}/resolve-product'.format(instance_url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='resolve_product',
                         route_name='{}.resolve_product'.format(route_prefix),
                         permission='{}.resolve_product'.format(permission_prefix))
 
+        # ignore product
+        config.add_tailbone_permission(permission_prefix,
+                                       f'{permission_prefix}.ignore_product',
+                                       f"Mark {model_title} as ignored")
+        config.add_route(f'{route_prefix}.ignore_product',
+                         f'{instance_url_prefix}/ignore-product',
+                         request_method='POST')
+        config.add_view(cls, attr='ignore_product',
+                        route_name=f'{route_prefix}.ignore_product',
+                        permission=f'{permission_prefix}.ignore_product')
+
 
 def defaults(config, **kwargs):
     base = globals()
 
     ProductView = kwargs.get('ProductView', base['ProductView'])
     ProductView.defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/views/customers.py` & `Tailbone-0.9.90/tailbone/views/customers.py`

 * *Files 15% similar despite different names*

```diff
@@ -20,15 +20,18 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Customer Views
 """
 
+from collections import OrderedDict
+
 import sqlalchemy as sa
+from sqlalchemy import orm
 
 import colander
 from pyramid.httpexceptions import HTTPNotFound
 from webhelpers2.html import HTML, tags
 
 from tailbone import grids
 from tailbone.db import Session
@@ -51,45 +54,46 @@
     configurable = True
 
     # whether to show "view full profile" helper for customer view
     show_profiles_helper = True
 
     labels = {
         'id': "ID",
+        'name': "Account Name",
         'default_phone': "Phone Number",
         'default_email': "Email Address",
         'default_address': "Physical Address",
         'active_in_pos': "Active in POS",
         'active_in_pos_sticky': "Always Active in POS",
     }
 
     grid_columns = [
-        'id',
-        'number',
+        '_customer_key_',
         'name',
         'phone',
         'email',
     ]
 
     form_fields = [
-        'id',
-        'number',
+        '_customer_key_',
         'name',
+        'account_holder',
         'default_phone',
         'default_address',
         'address_street',
         'address_street2',
         'address_city',
         'address_state',
         'address_zipcode',
         'default_email',
         'email_preference',
         'wholesale',
         'active_in_pos',
         'active_in_pos_sticky',
+        'shoppers',
         'people',
         'groups',
         'members',
     ]
 
     mergeable = True
 
@@ -99,82 +103,152 @@
     ]
 
     merge_fields = merge_coalesce_fields + [
         'uuid',
         'name',
     ]
 
+    def should_expose_quickie_search(self):
+        if self.expose_quickie_search:
+            return True
+        app = self.get_rattail_app()
+        return app.get_people_handler().should_expose_quickie_search()
+
+    def get_quickie_perm(self):
+        return 'people.quickie'
+
+    def get_quickie_url(self):
+        return self.request.route_url('people.quickie')
+
+    def get_quickie_placeholder(self):
+        app = self.get_rattail_app()
+        return app.get_people_handler().get_quickie_search_placeholder()
+
     def get_expose_active_in_pos(self):
         if not hasattr(self, '_expose_active_in_pos'):
             self._expose_active_in_pos = self.rattail_config.getbool(
                 'rattail', 'customers.active_in_pos',
                 default=False)
         return self._expose_active_in_pos
 
+    # TODO: this is duplicated in people view module
+    def should_expose_shoppers(self):
+        return self.rattail_config.getbool('rattail',
+                                           'customers.expose_shoppers',
+                                           default=True)
+
+    # TODO: this is duplicated in people view module
+    def should_expose_people(self):
+        return self.rattail_config.getbool('rattail',
+                                           'customers.expose_people',
+                                           default=True)
+
+    def query(self, session):
+        query = super().query(session)
+        app = self.get_rattail_app()
+        model = self.model
+        query = query.outerjoin(model.Person,
+                                model.Person.uuid == model.Customer.account_holder_uuid)
+        return query
+
     def configure_grid(self, g):
-        super(CustomerView, self).configure_grid(g)
+        super().configure_grid(g)
+        app = self.get_rattail_app()
         model = self.model
+        route_prefix = self.get_route_prefix()
 
-        # number
-        g.set_link('number')
+        # customer key
+        field = self.get_customer_key_field()
+        g.filters[field].default_active = True
+        g.filters[field].default_verb = 'equal'
+        g.set_sort_defaults(field)
+        g.set_link(field)
 
         # name
         g.filters['name'].default_active = True
         g.filters['name'].default_verb = 'contains'
-        g.set_sort_defaults('name')
 
         # phone
+        g.set_label('phone', "Phone Number")
         g.set_joiner('phone', lambda q: q.outerjoin(model.CustomerPhoneNumber, sa.and_(
             model.CustomerPhoneNumber.parent_uuid == model.Customer.uuid,
             model.CustomerPhoneNumber.preference == 1)))
-        g.sorters['phone'] = lambda q, d: q.order_by(getattr(model.CustomerPhoneNumber.number, d)())
+        g.set_sorter('phone', model.CustomerPhoneNumber.number)
         g.set_filter('phone', model.CustomerPhoneNumber.number,
                      # label="Phone Number",
                      factory=grids.filters.AlchemyPhoneNumberFilter)
-        g.set_label('phone', "Phone Number")
 
         # email
+        g.set_label('email', "Email Address")
         g.set_joiner('email', lambda q: q.outerjoin(model.CustomerEmailAddress, sa.and_(
             model.CustomerEmailAddress.parent_uuid == model.Customer.uuid,
             model.CustomerEmailAddress.preference == 1)))
-        g.sorters['email'] = lambda q, d: q.order_by(getattr(model.CustomerEmailAddress.address, d)())
+        g.set_sorter('email', model.CustomerEmailAddress.address)
         g.set_filter('email', model.CustomerEmailAddress.address)#, label="Email Address")
-        g.set_label('email', "Email Address")
 
         # email_preference
         g.set_enum('email_preference', self.enum.EMAIL_PREFERENCE)
 
+        # account_holder_*_name
+        g.set_filter('account_holder_first_name', model.Person.first_name)
+        g.set_filter('account_holder_last_name', model.Person.last_name)
+
         # person
-        g.set_joiner('person', lambda q:
-                     q.outerjoin(model.CustomerPerson,
-                                 sa.and_(
-                                     model.CustomerPerson.customer_uuid == model.Customer.uuid,
-                                     model.CustomerPerson.ordinal == 1))\
-                     .outerjoin(model.Person))
-        g.set_sorter('person', model.Person.display_name)
         g.set_renderer('person', self.grid_render_person)
+        g.set_sorter('person', model.Person.display_name)
 
         # active_in_pos
         if self.get_expose_active_in_pos():
             g.filters['active_in_pos'].default_active = True
             g.filters['active_in_pos'].default_verb = 'is_true'
 
-        g.set_link('id')
+        if (self.request.has_perm('people.view_profile')
+            and self.should_link_straight_to_profile()):
+
+            # add View Raw action
+            url = lambda r, i: self.request.route_url(
+                f'{route_prefix}.view', **self.get_action_route_kwargs(r))
+            # nb. insert to slot 1, just after normal View action
+            g.main_actions.insert(1, self.make_action(
+                'view_raw', url=url, icon='eye'))
+
         g.set_link('name')
         g.set_link('person')
         g.set_link('email')
 
+    def default_view_url(self):
+        if (self.request.has_perm('people.view_profile')
+            and self.should_link_straight_to_profile()):
+            app = self.get_rattail_app()
+
+            def url(customer, i):
+                person = app.get_person(customer)
+                if person:
+                    return self.request.route_url(
+                        'people.view_profile', uuid=person.uuid,
+                        _anchor='customer')
+                return self.get_action_url('view', customer)
+
+            return url
+
+        return super().default_view_url()
+
+    def should_link_straight_to_profile(self):
+        return self.rattail_config.getbool('rattail',
+                                           'customers.straight_to_profile',
+                                           default=False)
+
     def grid_extra_class(self, customer, i):
         if self.get_expose_active_in_pos():
             if not customer.active_in_pos:
                 return 'warning'
 
     def get_instance(self):
         try:
-            instance = super(CustomerView, self).get_instance()
+            instance = super().get_instance()
         except HTTPNotFound:
             pass
         else:
             if instance:
                 return instance
 
         key = self.request.matchdict['uuid']
@@ -194,23 +268,32 @@
         # search by CustomerGroupAssignment.uuid
         instance = self.Session.get(model.CustomerGroupAssignment, key)
         if instance:
             return instance.customer
 
         raise HTTPNotFound
 
-    def configure_common_form(self, f):
-        super(CustomerView, self).configure_common_form(f)
+    def configure_form(self, f):
+        super().configure_form(f)
         customer = f.model_instance
         permission_prefix = self.get_permission_prefix()
 
+        # account_holder
+        if self.creating:
+            f.remove_field('account_holder')
+        else:
+            f.set_readonly('account_holder')
+            f.set_renderer('account_holder', self.render_person)
+
+        # default_email
         f.set_renderer('default_email', self.render_default_email)
         if not self.creating and customer.emails:
             f.set_default('default_email', customer.emails[0].address)
 
+        # default_phone
         f.set_renderer('default_phone', self.render_default_phone)
         if not self.creating and customer.phones:
             f.set_default('default_phone', customer.phones[0].number)
 
         # default_address
         if self.creating or self.editing:
             f.remove_field('default_address')
@@ -229,82 +312,130 @@
             addr = customer.addresses[0]
             f.set_default('address_street', addr.street)
             f.set_default('address_street2', addr.street2)
             f.set_default('address_city', addr.city)
             f.set_default('address_state', addr.state)
             f.set_default('address_zipcode', addr.zipcode)
 
+        # email_preference
         f.set_enum('email_preference', self.enum.EMAIL_PREFERENCE)
         preferences = list(self.enum.EMAIL_PREFERENCE.items())
         preferences.insert(0, ('', "(no preference)"))
         f.widgets['email_preference'].values = preferences
 
         # person
         if self.creating:
             f.remove_field('person')
         else:
             f.set_readonly('person')
             f.set_renderer('person', self.form_render_person)
 
+        # shoppers
+        if self.should_expose_shoppers():
+            if self.viewing:
+                f.set_renderer('shoppers', self.render_shoppers)
+            else:
+                f.remove('shoppers')
+        else:
+            f.remove('shoppers')
+
         # people
-        if self.viewing:
-            f.set_renderer('people', self.render_people_buefy)
+        if self.should_expose_people():
+            if self.viewing:
+                f.set_renderer('people', self.render_people_buefy)
+            else:
+                f.remove('people')
         else:
             f.remove('people')
 
         # groups
         if self.creating:
             f.remove_field('groups')
         else:
             f.set_renderer('groups', self.render_groups)
             f.set_readonly('groups')
 
-    def configure_form(self, f):
-        super(CustomerView, self).configure_form(f)
-        customer = f.model_instance
-        permission_prefix = self.get_permission_prefix()
-
+        # active_in_pos*
         if not self.get_expose_active_in_pos():
             f.remove('active_in_pos',
                      'active_in_pos_sticky')
 
         # members
         if self.creating:
             f.remove_field('members')
         else:
             f.set_renderer('members', self.render_members)
             f.set_readonly('members')
 
     def template_kwargs_view(self, **kwargs):
-        kwargs = super(CustomerView, self).template_kwargs_view(**kwargs)
+        kwargs = super().template_kwargs_view(**kwargs)
+        customer = kwargs['instance']
+
+        kwargs['expose_shoppers'] = self.should_expose_shoppers()
+        if kwargs['expose_shoppers']:
+            shoppers = []
+            for shopper in customer.shoppers:
+                person = shopper.person
+                active = None
+                if shopper.active is not None:
+                    active = "Yes" if shopper.active else "No"
+                data = {
+                    'uuid': shopper.uuid,
+                    'shopper_number': shopper.shopper_number,
+                    'first_name': person.first_name,
+                    'last_name': person.last_name,
+                    'full_name': person.display_name,
+                    'phone': person.first_phone_number(),
+                    'email': person.first_email_address(),
+                    'active': active,
+                }
+                shoppers.append(data)
+            kwargs['shoppers_data'] = shoppers
+
+        kwargs['expose_people'] = self.should_expose_people()
+        if kwargs['expose_people']:
+            people = []
+            for person in customer.people:
+                data = {
+                    'uuid': person.uuid,
+                    'full_name': person.display_name,
+                    'first_name': person.first_name,
+                    'last_name': person.last_name,
+                    '_action_url_view': self.request.route_url('people.view',
+                                                               uuid=person.uuid),
+                }
+                if self.editable and self.request.has_perm('people.edit'):
+                    data['_action_url_edit'] = self.request.route_url(
+                        'people.edit',
+                        uuid=person.uuid)
+                if self.people_detachable and self.has_perm('detach_person'):
+                    data['_action_url_detach'] = self.request.route_url(
+                        'customers.detach_person',
+                        uuid=customer.uuid,
+                        person_uuid=person.uuid)
+                people.append(data)
+            kwargs['people_data'] = people
 
         kwargs['show_profiles_helper'] = self.show_profiles_helper
+        if kwargs['show_profiles_helper']:
+            people = OrderedDict()
 
-        customer = kwargs['instance']
-        people = []
-        for person in customer.people:
-            data = {
-                'uuid': person.uuid,
-                'full_name': person.display_name,
-                'first_name': person.first_name,
-                'last_name': person.last_name,
-                '_action_url_view': self.request.route_url('people.view',
-                                                           uuid=person.uuid),
-            }
-            if self.editable and self.request.has_perm('people.edit'):
-                data['_action_url_edit'] = self.request.route_url(
-                    'people.edit',
-                    uuid=person.uuid)
-            if self.people_detachable and self.has_perm('detach_person'):
-                data['_action_url_detach'] = self.request.route_url(
-                    'customers.detach_person',
-                    uuid=customer.uuid,
-                    person_uuid=person.uuid)
-            people.append(data)
-        kwargs['people_data'] = people
+            if customer.account_holder:
+                person = customer.account_holder
+                people.setdefault(person.uuid, person)
+
+            for shopper in customer.shoppers:
+                if shopper.active:
+                    person = shopper.person
+                    people.setdefault(person.uuid, person)
+
+            for person in customer.people:
+                people.setdefault(person.uuid, person)
+
+            kwargs['show_profiles_people'] = list(people.values())
 
         return kwargs
 
     def unique_id(self, node, value):
         query = self.Session.query(model.Customer)\
                             .filter(model.Customer.id == value)
         if self.editing:
@@ -328,56 +459,56 @@
         if not person:
             return ""
 
         text = str(person)
         url = self.request.route_url('people.view', uuid=person.uuid)
         return tags.link_to(text, url)
 
+    # TODO: remove if no longer used
     def render_people(self, customer, field):
         people = customer.people
         if not people:
             return ""
 
         items = []
         for person in people:
             text = str(person)
             url = self.request.route_url('people.view', uuid=person.uuid)
             link = tags.link_to(text, url)
             items.append(HTML.tag('li', c=[link]))
         return HTML.tag('ul', c=items)
 
-    # TODO: remove if no longer used
-    def render_people_removable(self, customer, field):
-        people = customer.people
-        if not people:
-            return ""
-
+    def render_shoppers(self, customer, field):
         route_prefix = self.get_route_prefix()
         permission_prefix = self.get_permission_prefix()
 
-        view_url = lambda p, i: self.request.route_url('people.view', uuid=p.uuid)
-        actions = [
-            grids.GridAction('view', icon='zoomin', url=view_url),
-        ]
-        if self.people_detachable and self.request.has_perm('{}.detach_person'.format(permission_prefix)):
-            url = lambda p, i: self.request.route_url('{}.detach_person'.format(route_prefix),
-                                                      uuid=customer.uuid, person_uuid=p.uuid)
-            actions.append(
-                grids.GridAction('detach', icon='trash', url=url))
-
-        columns = ['first_name', 'last_name', 'display_name']
-        g = grids.Grid(
+        factory = self.get_grid_factory()
+        g = factory(
             key='{}.people'.format(route_prefix),
-            data=customer.people,
-            columns=columns,
-            labels={'display_name': "Full Name"},
-            url=lambda p: self.request.route_url('people.view', uuid=p.uuid),
-            linked_columns=columns,
-            main_actions=actions)
-        return HTML.literal(g.render_grid())
+            data=[],
+            columns=[
+                'shopper_number',
+                'first_name',
+                'last_name',
+                'phone',
+                'email',
+                'active',
+            ],
+            sortable=True,
+            sorters={'shopper_number': True,
+                     'first_name': True,
+                     'last_name': True,
+                     'phone': True,
+                     'email': True,
+                     'active': True},
+            labels={'shopper_number': "Shopper #"},
+        )
+
+        return HTML.literal(
+            g.render_buefy_table_element(data_prop='shoppers'))
 
     def render_people_buefy(self, customer, field):
         route_prefix = self.get_route_prefix()
         permission_prefix = self.get_permission_prefix()
 
         factory = self.get_grid_factory()
         g = factory(
@@ -423,22 +554,24 @@
         for member in members:
             text = str(member)
             url = self.request.route_url('members.view', uuid=member.uuid)
             items.append(HTML.tag('li', tags.link_to(text, url)))
         return HTML.tag('ul', HTML.literal('').join(items))
 
     def get_version_child_classes(self):
-        return [
+        classes = super().get_version_child_classes()
+        classes.extend([
             (model.CustomerGroupAssignment, 'customer_uuid'),
             (model.CustomerPhoneNumber, 'parent_uuid'),
             (model.CustomerEmailAddress, 'parent_uuid'),
             (model.CustomerMailingAddress, 'parent_uuid'),
             (model.CustomerPerson, 'customer_uuid'),
             (model.CustomerNote, 'parent_uuid'),
-        ]
+        ])
+        return classes
 
     def detach_person(self):
         customer = self.get_instance()
         person = self.Session.get(model.Person, self.request.matchdict['person_uuid'])
         if not person:
             return self.notfound()
 
@@ -482,16 +615,33 @@
         self.Session.delete(removing)
 
     def configure_get_simple_settings(self):
         return [
 
             # General
             {'section': 'rattail',
+             'option': 'customers.key_field'},
+            {'section': 'rattail',
+             'option': 'customers.key_label'},
+            {'section': 'rattail',
              'option': 'customers.choice_uses_dropdown',
              'type': bool},
+            {'section': 'rattail',
+             'option': 'customers.straight_to_profile',
+             'type': bool},
+            {'section': 'rattail',
+             'option': 'customers.expose_shoppers',
+             'type': bool,
+             'default': True},
+            {'section': 'rattail',
+             'option': 'customers.expose_people',
+             'type': bool,
+             'default': True},
+            {'section': 'rattail',
+             'option': 'clientele.handler'},
 
             # POS
             {'section': 'rattail',
              'option': 'customers.active_in_pos',
              'type': bool},
 
         ]
@@ -523,14 +673,95 @@
                              # request_method='POST',
             )
             config.add_view(cls, attr='detach_person',
                             route_name='{}.detach_person'.format(route_prefix),
                             permission='{}.detach_person'.format(permission_prefix))
 
 
+class CustomerShopperView(MasterView):
+    """
+    Master view for the CustomerShopper class.
+    """
+    model_class = model.CustomerShopper
+    route_prefix = 'customer_shoppers'
+    url_prefix = '/customer-shoppers'
+
+    grid_columns = [
+        'customer_key',
+        'customer',
+        'shopper_number',
+        'person',
+        'active',
+    ]
+
+    form_fields = [
+        'customer',
+        'shopper_number',
+        'person',
+        'active',
+    ]
+
+    def should_expose_quickie_search(self):
+        if self.expose_quickie_search:
+            return True
+        app = self.get_rattail_app()
+        return app.get_people_handler().should_expose_quickie_search()
+
+    def get_quickie_perm(self):
+        return 'people.quickie'
+
+    def get_quickie_url(self):
+        return self.request.route_url('people.quickie')
+
+    def get_quickie_placeholder(self):
+        app = self.get_rattail_app()
+        return app.get_people_handler().get_quickie_search_placeholder()
+
+    def query(self, session):
+        query = super().query(session)
+        model = self.model
+        return query.join(model.Customer)\
+                    .join(model.Person,
+                          model.Person.uuid == model.CustomerShopper.person_uuid)
+
+    def configure_grid(self, g):
+        super().configure_grid(g)
+        app = self.get_rattail_app()
+        model = self.model
+
+        # customer_key
+        key = app.get_customer_key_field()
+        label = app.get_customer_key_label()
+        g.set_label('customer_key', label)
+        g.set_renderer('customer_key',
+                       lambda shopper, field: getattr(shopper.customer, key))
+        g.set_sorter('customer_key', getattr(model.Customer, key))
+        g.set_sort_defaults('customer_key')
+        g.set_filter('customer_key', getattr(model.Customer, key),
+                     label=f"Customer {label}",
+                     default_active=True,
+                     default_verb='equal')
+
+        # customer (name)
+        g.set_sorter('customer', model.Customer.name)
+        g.set_filter('customer', model.Customer.name,
+                     label="Customer Account Name")
+
+        # person (name)
+        g.set_sorter('person', model.Person.display_name)
+        g.set_filter('person', model.Person.display_name,
+                     label="Person Name")
+
+    def configure_form(self, f):
+        super().configure_form(f)
+
+        f.set_renderer('customer', self.render_customer)
+        f.set_renderer('person', self.render_person)
+
+
 class PendingCustomerView(MasterView):
     """
     Master view for the Pending Customer class.
     """
     model_class = model.PendingCustomer
     route_prefix = 'pending_customers'
     url_prefix = '/customers/pending'
@@ -568,27 +799,27 @@
         'address_type',
         'status_code',
         'created',
         'user',
     ]
 
     def configure_grid(self, g):
-        super(PendingCustomerView, self).configure_grid(g)
+        super().configure_grid(g)
 
         g.set_enum('status_code', self.enum.PENDING_CUSTOMER_STATUS)
         g.filters['status_code'].default_active = True
         g.filters['status_code'].default_verb = 'not_equal'
         g.filters['status_code'].default_value = str(self.enum.PENDING_CUSTOMER_STATUS_RESOLVED)
 
         g.set_sort_defaults('display_name')
         g.set_link('id')
         g.set_link('display_name')
 
     def configure_form(self, f):
-        super(PendingCustomerView, self).configure_form(f)
+        super().configure_form(f)
 
         f.set_enum('status_code', self.enum.PENDING_CUSTOMER_STATUS)
 
         # created
         if self.creating:
             f.remove('created')
         else:
@@ -689,14 +920,18 @@
     config.add_view(customer_info, route_name='customer.info',
                     renderer='json', permission='customers.view')
 
     CustomerView = kwargs.get('CustomerView',
                               base['CustomerView'])
     CustomerView.defaults(config)
 
+    CustomerShopperView = kwargs.get('CustomerShopperView',
+                                     base['CustomerShopperView'])
+    CustomerShopperView.defaults(config)
+
     PendingCustomerView = kwargs.get('PendingCustomerView',
                                      base['PendingCustomerView'])
     PendingCustomerView.defaults(config)
 
 
 def includeme(config):
     defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/views/reportcodes.py` & `Tailbone-0.9.90/tailbone/views/reportcodes.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/taxes.py` & `Tailbone-0.9.90/tailbone/views/taxes.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tax Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from rattail.db import model
 
 from tailbone.views import MasterView
 
 
 class TaxView(MasterView):
     """
@@ -49,20 +47,34 @@
     form_fields = [
         'code',
         'description',
         'rate',
     ]
 
     def configure_grid(self, g):
-        super(TaxView, self).configure_grid(g)
-        g.filters['description'].default_active = True
-        g.filters['description'].default_verb = 'contains'
+        super().configure_grid(g)
+
+        # code
         g.set_sort_defaults('code')
         g.set_link('code')
+
+        # description
         g.set_link('description')
+        g.filters['description'].default_active = True
+        g.filters['description'].default_verb = 'contains'
+
+        # rate
+        g.set_type('rate', 'percent')
+
+    def configure_form(self, f):
+        super().configure_form(f)
+
+        # rate
+        f.set_type('rate', 'percent')
+
 
 # TODO: deprecate / remove this
 TaxesView = TaxView
 
 
 def defaults(config, **kwargs):
     base = globals()
```

### Comparing `Tailbone-0.9.9/tailbone/views/menus.py` & `Tailbone-0.9.90/tailbone/views/menus.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/vendors/catalogs.py` & `Tailbone-0.9.90/tailbone/views/vendors/invoices.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2019 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,22 +17,20 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-(Deprecated!) Views for maintaining vendor catalogs
+(Deprecated!) Views for maintaining vendor invoices
 
-Please use `tailbone.views.batch.vendorcatalog` instead.
+Please use `tailbone.views.batch.vendorinvoice` instead.
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import warnings
 
 
 def includeme(config):
-    warnings.warn("The `tailbone.views.vendors.catalogs` module is deprecated, "
-                  "please use `tailbone.views.batch.vendorcatalog` instead.",
-                  DeprecationWarning)
-    config.include('tailbone.views.batch.vendorcatalog')
+    warnings.warn("The `tailbone.views.vendors.invoices` module is deprecated, "
+                  "please use `tailbone.views.batch.vendorinvoice` instead.",
+                  DeprecationWarning, stacklevel=2)
+    config.include('tailbone.views.batch.vendorinvoice')
```

### Comparing `Tailbone-0.9.9/tailbone/views/vendors/invoices.py` & `Tailbone-0.9.90/tailbone/views/vendors/catalogs.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2019 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,22 +17,20 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-(Deprecated!) Views for maintaining vendor invoices
+(Deprecated!) Views for maintaining vendor catalogs
 
-Please use `tailbone.views.batch.vendorinvoice` instead.
+Please use `tailbone.views.batch.vendorcatalog` instead.
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import warnings
 
 
 def includeme(config):
-    warnings.warn("The `tailbone.views.vendors.invoices` module is deprecated, "
-                  "please use `tailbone.views.batch.vendorinvoice` instead.",
-                  DeprecationWarning)
-    config.include('tailbone.views.batch.vendorinvoice')
+    warnings.warn("The `tailbone.views.vendors.catalogs` module is deprecated, "
+                  "please use `tailbone.views.batch.vendorcatalog` instead.",
+                  DeprecationWarning, stacklevel=2)
+    config.include('tailbone.views.batch.vendorcatalog')
```

### Comparing `Tailbone-0.9.9/tailbone/views/vendors/core.py` & `Tailbone-0.9.90/tailbone/views/vendors/core.py`

 * *Files 8% similar despite different names*

```diff
@@ -74,29 +74,30 @@
         'default_email',
         'orders_email',
         'contact',
         'terms',
     ]
 
     def configure_grid(self, g):
-        super(VendorView, self).configure_grid(g)
+        super().configure_grid(g)
 
         g.filters['name'].default_active = True
         g.filters['name'].default_verb = 'contains'
         g.set_sort_defaults('name')
 
         g.set_label('phone', "Phone Number")
         g.set_label('email', "Email Address")
 
         g.set_link('id')
         g.set_link('name')
         g.set_link('abbreviation')
 
     def configure_form(self, f):
-        super(VendorView, self).configure_form(f)
+        super().configure_form(f)
+        app = self.get_rattail_app()
         vendor = f.model_instance
 
         f.set_type('lead_time_days', 'quantity')
         f.set_type('order_interval_days', 'quantity')
 
         # default_phone
         f.set_renderer('default_phone', self.render_default_phone)
@@ -107,32 +108,33 @@
         f.set_renderer('default_email', self.render_default_email)
         if not self.creating and vendor.emails:
             f.set_default('default_email', vendor.emails[0].address)
 
         # orders_email
         f.set_renderer('orders_email', self.render_orders_email)
         if not self.creating and vendor.emails:
-            f.set_default('orders_email', vendor.get_email_address(type_='Orders') or '')
+            f.set_default('orders_email', app.get_contact_email_address(vendor, type_='Orders') or '')
 
         # contact
         if self.creating:
             f.remove_field('contact')
         else:
             f.set_readonly('contact')
             f.set_renderer('contact', self.render_contact)
 
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
-        vendor = super(VendorView, self).objectify(form, data)
+        vendor = super().objectify(form, data)
         vendor = self.objectify_contact(vendor, data)
+        app = self.get_rattail_app()
 
         if 'orders_email' in data:
             address = data['orders_email']
-            email = vendor.get_email(type_='Orders')
+            email = app.get_contact_email(vendor, type_='Orders')
             if address:
                 if email:
                     if email.address != address:
                         email.address = address
                 else:
                     vendor.add_email_address(address, type='Orders')
             elif email:
@@ -141,15 +143,16 @@
         return vendor
 
     def render_default_email(self, vendor, field):
         if vendor.emails:
             return vendor.emails[0].address
 
     def render_orders_email(self, vendor, field):
-        return vendor.get_email_address(type_='Orders')
+        app = self.get_rattail_app()
+        return app.get_contact_email_address(vendor, type_='Orders')
 
     def render_default_phone(self, vendor, field):
         if vendor.phones:
             return vendor.phones[0].number
 
     def render_contact(self, vendor, field):
         person = vendor.contact
@@ -163,15 +166,15 @@
         # Remove all product costs.
         q = self.Session.query(model.ProductCost).filter(
             model.ProductCost.vendor == vendor)
         for cost in q:
             self.Session.delete(cost)
 
     def get_version_child_classes(self):
-        return super(VendorView, self).get_version_child_classes() + [
+        return super().get_version_child_classes() + [
             (model.VendorPhoneNumber, 'parent_uuid'),
             (model.VendorEmailAddress, 'parent_uuid'),
             (model.VendorContact, 'vendor_uuid'),
         ]
 
     def configure_get_simple_settings(self):
         config = self.rattail_config
@@ -180,34 +183,34 @@
             # display
             {'section': 'rattail',
              'option': 'vendors.choice_uses_dropdown',
              'type': bool},
         ]
 
     def configure_get_context(self, **kwargs):
-        context = super(VendorView, self).configure_get_context(**kwargs)
+        context = super().configure_get_context(**kwargs)
 
         context['supported_vendor_settings'] = self.configure_get_supported_vendor_settings()
 
         return context
 
     def configure_gather_settings(self, data, **kwargs):
-        settings = super(VendorView, self).configure_gather_settings(
+        settings = super().configure_gather_settings(
             data, **kwargs)
 
         supported_vendor_settings = self.configure_get_supported_vendor_settings()
         for setting in six.itervalues(supported_vendor_settings):
             name = 'rattail.vendor.{}'.format(setting['key'])
             settings.append({'name': name,
                              'value': data[name]})
 
         return settings
 
     def configure_remove_settings(self, **kwargs):
-        super(VendorView, self).configure_remove_settings(**kwargs)
+        super().configure_remove_settings(**kwargs)
         app = self.get_rattail_app()
         names = []
 
         supported_vendor_settings = self.configure_get_supported_vendor_settings()
         for setting in six.itervalues(supported_vendor_settings):
             names.append('rattail.vendor.{}'.format(setting['key']))
```

### Comparing `Tailbone-0.9.9/tailbone/views/vendors/__init__.py` & `Tailbone-0.9.90/tailbone/views/vendors/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,19 +20,18 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views pertaining to vendors
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from .core import VendorView
 
 
 def defaults(config, **kwargs):
     from .core import defaults
     return defaults(config, **kwargs)
 
 
 def includeme(config):
     config.include('tailbone.views.vendors.core')
+    config.include('tailbone.views.vendors.samplefiles')
```

### Comparing `Tailbone-0.9.9/tailbone/views/inventory.py` & `Tailbone-0.9.90/tailbone/views/inventory.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/labels/batch.py` & `Tailbone-0.9.90/tailbone/static/__init__.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2019 Lance Edgar
+#  Copyright  2010-2017 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,24 +17,16 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-(Deprecated!) Views for label batches
-
-Please use `tailbone.views.batch.labels` instead.
+Static Assets
 """
 
 from __future__ import unicode_literals, absolute_import
 
-import warnings
-
 
 def includeme(config):
-
-    warnings.warn("The `tailbone.views.labels.batch` module is deprecated, "
-                  "please use `tailbone.views.batch.labels` instead.",
-                  DeprecationWarning)
-
-    config.include('tailbone.views.batch.labels')
+    config.add_static_view('tailbone', 'tailbone:static')
+    config.add_static_view('deform', 'deform:static')
```

### Comparing `Tailbone-0.9.9/tailbone/views/labels/profiles.py` & `Tailbone-0.9.90/tailbone/views/labels/profiles.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/labels/__init__.py` & `Tailbone-0.9.90/tailbone/views/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/purchases/credits.py` & `Tailbone-0.9.90/tailbone/views/purchases/credits.py`

 * *Files 3% similar despite different names*

```diff
@@ -92,18 +92,20 @@
         'mispick_product',
         'product_discarded',
         'expiration_date',
         'status',
     ]
 
     def configure_grid(self, g):
-        super(PurchaseCreditView, self).configure_grid(g)
+        super().configure_grid(g)
 
+        # vendor
         g.set_joiner('vendor', lambda q: q.outerjoin(model.Vendor))
         g.set_sorter('vendor', model.Vendor.name)
+        g.set_filter('vendor', model.Vendor.name, label="Vendor Name")
 
         g.set_sort_defaults('date_received', 'desc')
 
         g.set_enum('status', self.enum.PURCHASE_CREDIT_STATUS)
         g.filters['status'].set_value_renderer(grids.filters.EnumValueRenderer(self.enum.PURCHASE_CREDIT_STATUS))
         g.filters['status'].default_active = True
         g.filters['status'].default_verb = 'not_equal'
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchases/core.py` & `Tailbone-0.9.90/tailbone/views/purchases/core.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,18 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for "true" purchase orders
 """
 
-from __future__ import unicode_literals, absolute_import
-
-import six
-
 from rattail.db import model
 
 from webhelpers2.html import HTML, tags
 
 from tailbone.db import Session
 from tailbone.views import MasterView
 
@@ -139,36 +135,43 @@
             if purchase.date_received:
                 return "{} (received {})".format(purchase.vendor, purchase.date_received.strftime('%Y-%m-%d'))
             return "{} (received)".format(purchase.vendor)
         elif purchase.status >= self.enum.PURCHASE_STATUS_ORDERED:
             if purchase.date_ordered:
                 return "{} (ordered {})".format(purchase.vendor, purchase.date_ordered.strftime('%Y-%m-%d'))
             return "{} (ordered)".format(purchase.vendor)
-        return six.text_type(purchase)
+        return str(purchase)
 
     def configure_grid(self, g):
-        super(PurchaseView, self).configure_grid(g)
+        super().configure_grid(g)
+        model = self.model
+
+        # store
+        g.set_joiner('store', lambda q: q.join(model.Store))
+        g.set_sorter('store', model.Store.name)
+        g.set_filter('store', model.Store.name)
+
+        # vendor
+        g.set_joiner('vendor', lambda q: q.join(model.Vendor))
+        g.set_sorter('vendor', model.Vendor.name)
+        g.set_filter('vendor', model.Vendor.name,
+                     default_active=True,
+                     default_verb='contains')
+
+        # department
+        g.set_joiner('department', lambda q: q.join(model.Department))
+        g.set_sorter('department', model.Department.name)
+        g.set_filter('department', model.Department.name)
 
-        g.joiners['store'] = lambda q: q.join(model.Store)
-        g.filters['store'] = g.make_filter('store', model.Store.name)
-        g.sorters['store'] = g.make_sorter(model.Store.name)
-
-        g.joiners['vendor'] = lambda q: q.join(model.Vendor)
-        g.filters['vendor'] = g.make_filter('vendor', model.Vendor.name,
-                                            default_active=True, default_verb='contains')
-        g.sorters['vendor'] = g.make_sorter(model.Vendor.name)
-
-        g.joiners['department'] = lambda q: q.join(model.Department)
-        g.filters['department'] = g.make_filter('department', model.Department.name)
-        g.sorters['department'] = g.make_sorter(model.Department.name)
-
-        g.joiners['buyer'] = lambda q: q.join(model.Employee).join(model.Person)
-        g.filters['buyer'] = g.make_filter('buyer', model.Person.display_name,
-                                           default_active=True, default_verb='contains')
-        g.sorters['buyer'] = g.make_sorter(model.Person.display_name)
+        # buyer
+        g.set_joiner('buyer', lambda q: q.join(model.Employee).join(model.Person))
+        g.set_sorter('buyer', model.Person.display_name)
+        g.set_filter('buyer', model.Person.display_name,
+                     default_active=True,
+                     default_verb='contains')
 
         # id
         g.set_renderer('id', self.render_id_str)
 
         # date_ordered
         g.filters['date_ordered'].default_active = True
         g.filters['date_ordered'].default_verb = 'equal'
@@ -194,15 +197,15 @@
         g.set_link('vendor')
         g.set_link('date_ordered')
         g.set_link('po_total')
         g.set_link('date_received')
         g.set_link('invoice_total')
 
     def configure_form(self, f):
-        super(PurchaseView, self).configure_form(f)
+        super().configure_form(f)
 
         # id
         f.set_renderer('id', self.render_id_str)
         f.set_readonly('id')
 
         f.set_renderer('store', self.render_store)
 
@@ -318,15 +321,15 @@
         return item.purchase
 
     def get_row_data(self, purchase):
         return Session.query(model.PurchaseItem)\
                       .filter(model.PurchaseItem.purchase == purchase)
 
     def configure_row_grid(self, g):
-        super(PurchaseView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         g.set_sort_defaults('sequence')
 
         g.set_type('cases_ordered', 'quantity')
         g.set_type('units_ordered', 'quantity')
         g.set_type('cases_received', 'quantity')
         g.set_type('units_received', 'quantity')
@@ -349,15 +352,15 @@
                      'units_received',
                      'invoice_total')
         elif purchase.status in (self.enum.PURCHASE_STATUS_RECEIVED,
                                  self.enum.PURCHASE_STATUS_COSTED):
             g.remove('po_total')
 
     def configure_row_form(self, f):
-        super(PurchaseView, self).configure_row_form(f)
+        super().configure_row_form(f)
 
         # quantity fields
         f.set_type('case_quantity', 'quantity')
         f.set_type('cases_ordered', 'quantity')
         f.set_type('units_ordered', 'quantity')
         f.set_type('cases_received', 'quantity')
         f.set_type('units_received', 'quantity')
```

### Comparing `Tailbone-0.9.9/tailbone/views/purchases/__init__.py` & `Tailbone-0.9.90/tailbone/views/purchases/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/essentials.py` & `Tailbone-0.9.90/tailbone/views/essentials.py`

 * *Files 9% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Essential views for convenient includes
 """
 
-from __future__ import unicode_literals, absolute_import
-
 
 def defaults(config, **kwargs):
     mod = lambda spec: kwargs.get(spec, spec)
 
     config.include(mod('tailbone.views.auth'))
     config.include(mod('tailbone.views.common'))
     config.include(mod('tailbone.views.datasync'))
@@ -44,10 +42,18 @@
     config.include(mod('tailbone.views.roles'))
     config.include(mod('tailbone.views.settings'))
     config.include(mod('tailbone.views.tables'))
     config.include(mod('tailbone.views.upgrades'))
     config.include(mod('tailbone.views.users'))
     config.include(mod('tailbone.views.views'))
 
+    # include project views by default, but let caller avoid that by
+    # passing False
+    projects = kwargs.get('tailbone.views.projects', True)
+    if projects:
+        if projects is True:
+            projects = 'tailbone.views.projects'
+        config.include(projects)
+
 
 def includeme(config):
     defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/views/employees.py` & `Tailbone-0.9.90/tailbone/views/employees.py`

 * *Files 11% similar despite different names*

```diff
@@ -41,14 +41,15 @@
     Master view for the Employee class.
     """
     model_class = model.Employee
     has_versions = True
     touchable = True
     supports_autocomplete = True
     results_downloadable = True
+    configurable = True
 
     labels = {
         'id': "ID",
         'display_name': "Short Name",
         'phone': "Phone Number",
     }
 
@@ -74,16 +75,32 @@
         'full_time_start',
         'id',
         'users',
         'stores',
         'departments',
     ]
 
+    def should_expose_quickie_search(self):
+        if self.expose_quickie_search:
+            return True
+        app = self.get_rattail_app()
+        return app.get_people_handler().should_expose_quickie_search()
+
+    def get_quickie_perm(self):
+        return 'people.quickie'
+
+    def get_quickie_url(self):
+        return self.request.route_url('people.quickie')
+
+    def get_quickie_placeholder(self):
+        app = self.get_rattail_app()
+        return app.get_people_handler().get_quickie_search_placeholder()
+
     def configure_grid(self, g):
-        super(EmployeeView, self).configure_grid(g)
+        super().configure_grid(g)
         route_prefix = self.get_route_prefix()
 
         # phone
         g.set_joiner('phone', lambda q: q.outerjoin(model.EmployeePhoneNumber, sa.and_(
             model.EmployeePhoneNumber.parent_uuid == model.Employee.uuid,
             model.EmployeePhoneNumber.preference == 1)))
         g.set_filter('phone', model.EmployeePhoneNumber.number,
@@ -94,17 +111,28 @@
         # email
         g.joiners['email'] = lambda q: q.outerjoin(model.EmployeeEmailAddress, sa.and_(
             model.EmployeeEmailAddress.parent_uuid == model.Employee.uuid,
             model.EmployeeEmailAddress.preference == 1))
         g.filters['email'] = g.make_filter('email', model.EmployeeEmailAddress.address,
                                            label="Email Address")
 
-        # first/last name
-        g.filters['first_name'] = g.make_filter('first_name', model.Person.first_name)
-        g.filters['last_name'] = g.make_filter('last_name', model.Person.last_name)
+        # first_name
+        g.set_link('first_name')
+        g.set_sorter('first_name', model.Person.first_name)
+        g.set_sort_defaults('first_name')
+        g.set_filter('first_name', model.Person.first_name,
+                     default_active=True,
+                     default_verb='contains')
+
+        # last_name
+        g.set_link('last_name')
+        g.set_sorter('last_name', model.Person.last_name)
+        g.set_filter('last_name', model.Person.last_name,
+                     default_active=True,
+                     default_verb='contains')
 
         # username
         if self.request.has_perm('users.view'):
             g.set_joiner('username', lambda q: q.outerjoin(model.User))
             g.set_filter('username', model.User.username)
             g.set_sorter('username', model.User.username)
             g.set_renderer('username', self.grid_render_username)
@@ -124,34 +152,52 @@
             g.filters['status'].default_active = True
             g.filters['status'].default_verb = 'equal'
             g.filters['status'].default_value = str(self.enum.EMPLOYEE_STATUS_CURRENT)
         else:
             g.remove('status')
             del g.filters['status']
 
-        g.filters['first_name'].default_active = True
-        g.filters['first_name'].default_verb = 'contains'
-
-        g.filters['last_name'].default_active = True
-        g.filters['last_name'].default_verb = 'contains'
-
-        g.sorters['first_name'] = lambda q, d: q.order_by(getattr(model.Person.first_name, d)())
-        g.sorters['last_name'] = lambda q, d: q.order_by(getattr(model.Person.last_name, d)())
-
-        g.sorters['email'] = lambda q, d: q.order_by(getattr(model.EmployeeEmailAddress.address, d)())
-
-        g.set_sort_defaults('first_name')
+        g.set_sorter('email', model.EmployeeEmailAddress.address)
 
         g.set_label('email', "Email Address")
 
-        g.set_link('first_name')
-        g.set_link('last_name')
+        if (self.request.has_perm('people.view_profile')
+            and self.should_link_straight_to_profile()):
+
+            # add View Raw action
+            url = lambda r, i: self.request.route_url(
+                f'{route_prefix}.view', **self.get_action_route_kwargs(r))
+            # nb. insert to slot 1, just after normal View action
+            g.main_actions.insert(1, self.make_action(
+                'view_raw', url=url, icon='eye'))
+
+    def default_view_url(self):
+        if (self.request.has_perm('people.view_profile')
+            and self.should_link_straight_to_profile()):
+            app = self.get_rattail_app()
+
+            def url(employee, i):
+                person = app.get_person(employee)
+                if person:
+                    return self.request.route_url(
+                        'people.view_profile', uuid=person.uuid,
+                        _anchor='employee')
+                return self.get_action_url('view', employee)
+
+            return url
+
+        return super().default_view_url()
+
+    def should_link_straight_to_profile(self):
+        return self.rattail_config.getbool('rattail',
+                                           'employees.straight_to_profile',
+                                           default=False)
 
     def query(self, session):
-        query = super(EmployeeView, self).query(session)
+        query = super().query(session)
         query = query.join(model.Person)
         if not self.has_perm('view_all'):
             query = query.filter(model.Employee.status == self.enum.EMPLOYEE_STATUS_CURRENT)
         return query
 
     def grid_render_username(self, employee, field):
         person = employee.person if employee else None
@@ -176,15 +222,15 @@
 
     def deletable_instance(self, employee):
         if self.request.is_root:
             return True
         return not self.is_employee_protected(employee)
 
     def configure_form(self, f):
-        super(EmployeeView, self).configure_form(f)
+        super().configure_form(f)
         employee = f.model_instance
 
         f.set_renderer('person', self.render_person)
 
         if self.creating or self.editing:
             f.remove('users')
         else:
@@ -230,15 +276,15 @@
 
         if not self.viewing:
             f.remove_fields('first_name', 'last_name')
 
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
-        employee = super(EmployeeView, self).objectify(form, data)
+        employee = super().objectify(form, data)
         self.update_stores(employee, data)
         self.update_departments(employee, data)
         return employee
 
     def update_stores(self, employee, data):
         if 'stores' not in data:
             return
@@ -309,14 +355,23 @@
             (model.Person, 'uuid', 'person_uuid'),
             (model.EmployeePhoneNumber, 'parent_uuid'),
             (model.EmployeeEmailAddress, 'parent_uuid'),
             (model.EmployeeStore, 'employee_uuid'),
             (model.EmployeeDepartment, 'employee_uuid'),
         ]
 
+    def configure_get_simple_settings(self):
+        return [
+
+            # General
+            {'section': 'rattail',
+             'option': 'employees.straight_to_profile',
+             'type': bool},
+        ]
+
     @classmethod
     def defaults(cls, config):
         cls._defaults(config)
         cls._employee_defaults(config)
 
     @classmethod
     def _employee_defaults(cls, config):
```

### Comparing `Tailbone-0.9.9/tailbone/views/permissions.py` & `Tailbone-0.9.90/tailbone/views/permissions.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/custorders/batch.py` & `Tailbone-0.9.90/tailbone/views/custorders/batch.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/custorders/orders.py` & `Tailbone-0.9.90/tailbone/views/custorders/orders.py`

 * *Files 4% similar despite different names*

```diff
@@ -48,24 +48,25 @@
     """
     model_class = model.CustomerOrder
     route_prefix = 'custorders'
     editable = False
     configurable = True
 
     labels = {
-        'id': "ID",
+        'id': "Order ID",
         'status_code': "Status",
     }
 
     grid_columns = [
         'id',
         'customer',
         'person',
-        'created',
         'status_code',
+        'created',
+        'created_by',
     ]
 
     form_fields = [
         'id',
         'store',
         'customer',
         'person',
@@ -84,60 +85,86 @@
 
     row_labels = {
         'order_uom': "Order UOM",
     }
 
     row_grid_columns = [
         'sequence',
+        '_product_key_',
         'product_brand',
         'product_description',
         'product_size',
         'order_quantity',
         'order_uom',
         'case_quantity',
+        'department_name',
         'total_price',
         'status_code',
+        'flagged',
+    ]
+
+    PENDING_PRODUCT_ENTRY_FIELDS = [
+        'key',
+        'department_uuid',
+        'brand_name',
+        'description',
+        'size',
+        'vendor_name',
+        'vendor_item_code',
+        'unit_cost',
+        'case_size',
+        'regular_price_amount',
     ]
 
     def __init__(self, request):
         super(CustomerOrderView, self).__init__(request)
         self.batch_handler = self.get_batch_handler()
 
     def query(self, session):
         return session.query(model.CustomerOrder)\
                       .options(orm.joinedload(model.CustomerOrder.customer))
 
     def configure_grid(self, g):
-        super(CustomerOrderView, self).configure_grid(g)
+        super().configure_grid(g)
+
+        # id
+        g.set_link('id')
+        g.filters['id'].default_active = True
+        g.filters['id'].default_verb = 'equal'
+
+        # import ipdb; ipdb.set_trace()
 
         # customer or person
         if self.batch_handler.new_order_requires_customer():
             g.remove('person')
+            g.set_link('customer')
             g.set_joiner('customer', lambda q: q.outerjoin(model.Customer))
             g.set_sorter('customer', model.Customer.name)
             g.filters['customer'] = g.make_filter('customer', model.Customer.name,
                                                   label="Customer Name",
                                                   default_active=True,
                                                   default_verb='contains')
         else:
             g.remove('customer')
+            g.set_link('person')
             g.set_joiner('person', lambda q: q.outerjoin(model.Person))
             g.set_sorter('person', model.Person.display_name)
             g.filters['person'] = g.make_filter('person', model.Person.display_name,
                                                 label="Person Name",
                                                 default_active=True,
                                                 default_verb='contains')
 
+        # status_code
         g.set_enum('status_code', self.enum.CUSTORDER_STATUS)
 
+        # created
         g.set_sort_defaults('created', 'desc')
 
-        g.set_link('id')
-        g.set_link('customer')
-        g.set_link('person')
+    def get_instance_title(self, order):
+        return f"#{order.id} for {order.customer or order.person}"
 
     def configure_form(self, f):
         super(CustomerOrderView, self).configure_form(f)
         order = f.model_instance
 
         f.set_readonly('id')
 
@@ -228,14 +255,18 @@
     def configure_row_grid(self, g):
         super(CustomerOrderView, self).configure_row_grid(g)
         app = self.get_rattail_app()
         handler = app.get_batch_handler(
             'custorder',
             default='rattail.batch.custorder:CustomerOrderBatchHandler')
 
+        # product key
+        key = self.get_product_key_field()
+        g.set_renderer(key, lambda item, field: getattr(item, f'product_{key}'))
+
         g.set_type('case_quantity', 'quantity')
         g.set_type('order_quantity', 'quantity')
         g.set_type('cases_ordered', 'quantity')
         g.set_type('units_ordered', 'quantity')
 
         if handler.product_price_may_be_questionable():
             g.set_renderer('total_price', self.render_price_with_confirmation)
@@ -337,16 +368,20 @@
             'batch': batch,
             'normalized_batch': self.normalize_batch(batch),
             'new_order_requires_customer': self.batch_handler.new_order_requires_customer(),
             'product_price_may_be_questionable': self.batch_handler.product_price_may_be_questionable(),
             'allow_contact_info_choice': self.batch_handler.allow_contact_info_choice(),
             'allow_contact_info_create': self.batch_handler.allow_contact_info_creation(),
             'order_items': items,
-            'product_key_label': self.rattail_config.product_key_title(),
-            'allow_unknown_product': self.batch_handler.allow_unknown_product(),
+            'product_key_label': app.get_product_key_label(),
+            'allow_unknown_product': (self.batch_handler.allow_unknown_product()
+                                      and self.has_perm('create_unknown_product')),
+            'pending_product_required_fields': self.get_pending_product_required_fields(),
+            'unknown_product_confirm_price': self.rattail_config.getbool(
+                'rattail.custorders', 'unknown_product.always_confirm_price'),
             'department_options': self.get_department_options(),
             'default_uom_choices': self.batch_handler.uom_choices_for_product(None),
             'default_uom': None,
             'allow_item_discounts': self.batch_handler.allow_item_discounts(),
             'allow_item_discounts_if_on_sale': self.batch_handler.allow_item_discounts_if_on_sale(),
             # nb. render quantity so that '10.0' => '10'
             'default_item_discount': app.render_quantity(
@@ -368,14 +403,25 @@
                                   .all()
         options = []
         for department in departments:
             options.append({'label': department.name,
                             'value': department.uuid})
         return options
 
+    def get_pending_product_required_fields(self):
+        required = []
+        for field in self.PENDING_PRODUCT_ENTRY_FIELDS:
+            require = self.rattail_config.getbool('rattail.custorders',
+                                                  f'unknown_product.fields.{field}.required')
+            if require is None and field == 'description':
+                require = True
+            if require:
+                required.append(field)
+        return required
+
     def get_current_batch(self):
         user = self.request.user
         if not user:
             raise RuntimeError("this feature requires a user to be logged in")
 
         try:
             # there should be at most *one* new batch per user
@@ -763,15 +809,15 @@
         case_price = self.batch_handler.get_case_price_for_row(row)
         data['case_price'] = float(case_price) if case_price is not None else None
         data['case_price_display'] = app.render_currency(case_price)
 
         if self.batch_handler.product_price_may_be_questionable():
             data['price_needs_confirmation'] = row.price_needs_confirmation
 
-        key = self.rattail_config.product_key()
+        key = app.get_product_key_field()
         if key == 'upc':
             data['product_key'] = data['product_upc_pretty']
         elif key == 'item_id':
             data['product_key'] = row.product_item_id
         elif key == 'scancode':
             data['product_key'] = row.product_scancode
         else: # TODO: this seems not useful
@@ -842,15 +888,18 @@
             pending_info = dict(data['pending_product'])
 
             if 'upc' in pending_info:
                 pending_info['upc'] = app.make_gpc(pending_info['upc'])
 
             for field in ('unit_cost', 'regular_price_amount', 'case_size'):
                 if field in pending_info:
-                    pending_info[field] = decimal.Decimal(pending_info[field])
+                    try:
+                        pending_info[field] = decimal.Decimal(pending_info[field])
+                    except decimal.InvalidOperation:
+                        return {'error': f"Invalid entry for field: {field}"}
 
             pending_info['user'] = self.request.user
 
             kwargs = {}
             if self.batch_handler.allow_item_discounts():
                 kwargs['discount_percent'] = discount_percent
 
@@ -934,14 +983,19 @@
             return {'error': "Row is not active for this batch"}
 
         self.batch_handler.do_remove_row(row)
         return {'ok': True,
                 'batch': self.normalize_batch(batch)}
 
     def submit_new_order(self, batch, data):
+
+        reason = self.batch_handler.why_not_execute(batch, user=self.request.user)
+        if reason:
+            return {'error': reason}
+
         try:
             result = self.execute_new_order_batch(batch, data)
         except Exception as error:
             log.warning("failed to execute new order batch: %s", batch,
                         exc_info=True)
             return {'error': simple_error(error)}
         else:
@@ -958,16 +1012,71 @@
 
         if isinstance(result, model.CustomerOrder):
             return self.get_action_url('view', result)
 
     def execute_new_order_batch(self, batch, data):
         return self.batch_handler.do_execute(batch, self.request.user)
 
+    def fetch_order_data(self):
+        app = self.get_rattail_app()
+        model = self.model
+
+        order = None
+        uuid = self.request.GET.get('uuid')
+        if uuid:
+            order = self.Session.get(model.CustomerOrder, uuid)
+        if not order:
+            # raise self.notfound()
+            return {'error': "Customer order not found"}
+
+        address = None
+        if self.batch_handler.new_order_requires_customer():
+            contact = order.customer
+        else:
+            contact = order.person
+        if contact and contact.address:
+            a = contact.address
+            address = {
+                'street_1': a.street,
+                'street_2': a.street2,
+                'city': a.city,
+                'state': a.state,
+                'zip': a.zipcode,
+            }
+
+        # gather all the order items
+        items = []
+        grand_total = 0
+        for item in order.items:
+            item_data = {
+                'uuid': item.uuid,
+                'special_order': False, # TODO
+                'product_description': item.product_description,
+                'order_quantity': app.render_quantity(item.order_quantity),
+                'department': item.department_name,
+                'price': app.render_currency(item.unit_price),
+                'total': app.render_currency(item.total_price),
+            }
+            items.append(item_data)
+            grand_total += item.total_price
+
+        return {
+            'uuid': order.uuid,
+            'id': order.id,
+            'created_display': app.render_datetime(app.localtime(order.created, from_utc=True)),
+            'contact_display': str(contact or ''),
+            'address': address,
+            'phone_display': str(contact.phone) if contact and contact.phone else "",
+            'email_display': str(contact.email) if contact and contact.email else "",
+            'items': items,
+            'grand_total_display': app.render_currency(grand_total),
+        }
+
     def configure_get_simple_settings(self):
-        return [
+        settings = [
 
             # customer handling
             {'section': 'rattail.custorders',
              'option': 'new_order_requires_customer',
              'type': bool},
             {'section': 'rattail.custorders',
              'option': 'new_orders.allow_contact_info_choice',
@@ -983,42 +1092,71 @@
             {'section': 'rattail.custorders',
              'option': 'allow_unit_orders',
              'type': bool},
             {'section': 'rattail.custorders',
              'option': 'product_price_may_be_questionable',
              'type': bool},
             {'section': 'rattail.custorders',
-             'option': 'allow_unknown_product',
-             'type': bool},
-            {'section': 'rattail.custorders',
              'option': 'allow_item_discounts',
              'type': bool},
             {'section': 'rattail.custorders',
              'option': 'allow_item_discounts_if_on_sale',
              'type': bool},
             {'section': 'rattail.custorders',
              'option': 'default_item_discount',
              'type': float},
             {'section': 'rattail.custorders',
              'option': 'allow_past_item_reorder',
              'type': bool},
+
+            # unknown products
+            {'section': 'rattail.custorders',
+             'option': 'allow_unknown_product',
+             'type': bool},
+            {'section': 'rattail.custorders',
+             'option': 'unknown_product.always_confirm_price',
+             'type': bool},
         ]
 
+        for field in self.PENDING_PRODUCT_ENTRY_FIELDS:
+            setting = {'section': 'rattail.custorders',
+                       'option': f'unknown_product.fields.{field}.required',
+                       'type': bool}
+            if field == 'description':
+                setting['default'] = True
+            settings.append(setting)
+
+        return settings
+
+    def configure_get_context(self, **kwargs):
+        context = super().configure_get_context(**kwargs)
+
+        context['pending_product_fields'] = self.PENDING_PRODUCT_ENTRY_FIELDS
+
+        return context
+
     @classmethod
     def defaults(cls, config):
         cls._order_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _order_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         url_prefix = cls.get_url_prefix()
         model_title = cls.get_model_title()
+        model_title_plural = cls.get_model_title_plural()
         permission_prefix = cls.get_permission_prefix()
 
+        config.add_tailbone_permission_group(permission_prefix, model_title_plural, overwrite=False)
+
+        config.add_tailbone_permission(permission_prefix,
+                                       f'{permission_prefix}.create_unknown_product',
+                                       f"Create new {model_title} for unknown product")
+
         # add pseudo-index page for creating new custorder
         # (makes it available when building menus etc.)
         config.add_tailbone_index_page('{}.create'.format(route_prefix),
                                        "New {}".format(model_title),
                                        '{}.create'.format(permission_prefix))
 
         # person autocomplete
@@ -1044,14 +1182,22 @@
                          '{}/product-autocomplete'.format(url_prefix),
                          request_method='GET')
         config.add_view(cls, attr='product_autocomplete',
                         route_name='{}.product_autocomplete'.format(route_prefix),
                         renderer='json',
                         permission='products.list')
 
+        # fetch order data
+        config.add_route(f'{route_prefix}.fetch_order_data',
+                         f'{url_prefix}/fetch-order-data')
+        config.add_view(cls, attr='fetch_order_data',
+                        route_name=f'{route_prefix}.fetch_order_data',
+                        renderer='json',
+                        permission=f'{permission_prefix}.view')
+
 
 # TODO: deprecate / remove this
 CustomerOrdersView = CustomerOrderView
 
 
 def defaults(config, **kwargs):
     base = globals()
```

### Comparing `Tailbone-0.9.9/tailbone/views/custorders/creating.py` & `Tailbone-0.9.90/tailbone/views/custorders/creating.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/custorders/__init__.py` & `Tailbone-0.9.90/tailbone/views/custorders/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/master.py` & `Tailbone-0.9.90/tailbone/views/master.py`

 * *Files 3% similar despite different names*

```diff
@@ -28,24 +28,25 @@
 import os
 import csv
 import datetime
 import getpass
 import shutil
 import tempfile
 import logging
+from collections import OrderedDict
 
 import json
 import sqlalchemy as sa
 from sqlalchemy import orm
 import sqlalchemy_continuum as continuum
 from sqlalchemy_utils.functions import get_primary_keys, get_columns
 
 from rattail.db import model, Session as RattailSession
 from rattail.db.continuum import model_transaction_query
-from rattail.util import prettify, OrderedDict, simple_error
+from rattail.util import prettify, simple_error, get_class_hierarchy
 from rattail.time import localtime
 from rattail.threads import Thread
 from rattail.csvutil import UnicodeDictWriter
 from rattail.files import temp_path
 from rattail.excel import ExcelWriter
 from rattail.gpc import GPC
 
@@ -102,14 +103,15 @@
     deletable = True
     delete_requires_progress = False
     delete_confirm = 'full'
     bulk_deletable = False
     set_deletable = False
     supports_autocomplete = False
     supports_set_enabled_toggle = False
+    supports_grid_totals = False
     populatable = False
     mergeable = False
     merge_handler = None
     downloadable = False
     cloneable = False
     touchable = False
     executable = False
@@ -158,14 +160,16 @@
 
     has_versions = False
     default_help_url = None
     help_url = None
 
     labels = {'uuid': "UUID"}
 
+    customer_key_fields = {}
+    member_key_fields = {}
     product_key_fields = {}
 
     # ROW-RELATED ATTRS FOLLOW:
 
     has_rows = False
     model_row_class = None
     rows_title = None
@@ -264,25 +268,15 @@
         hierarchy = self.get_class_hierarchy()
         for cls in hierarchy:
             if hasattr(cls, 'labels'):
                 labels.update(cls.labels)
         return labels
 
     def get_class_hierarchy(self):
-        hierarchy = []
-
-        def traverse(cls):
-            if cls is not object:
-                hierarchy.append(cls)
-                for parent in cls.__bases__:
-                    traverse(parent)
-
-        traverse(self.__class__)
-        hierarchy.reverse()
-        return hierarchy
+        return get_class_hierarchy(self.__class__)
 
     def set_row_labels(self, obj):
         labels = self.collect_row_labels()
         for key, label in labels.items():
             obj.set_label(key, label)
 
     def collect_row_labels(self):
@@ -332,25 +326,27 @@
         """
         self.listing = True
         grid = self.make_grid()
 
         # If user just refreshed the page with a reset instruction, issue a
         # redirect in order to clear out the query string.
         if self.request.GET.get('reset-to-default-filters') == 'true':
-            return self.redirect(self.request.current_route_url(_query=None))
+            kw = {'_query': None}
+            hash_ = self.request.GET.get('hash')
+            if hash_:
+                kw['_anchor'] = hash_
+            return self.redirect(self.request.current_route_url(**kw))
 
         # Stash some grid stats, for possible use when generating URLs.
         if grid.pageable and hasattr(grid, 'pager'):
             self.first_visible_grid_index = grid.pager.first_item
 
-        # return grid only, if partial page was requested
+        # return grid data only, if partial page was requested
         if self.request.params.get('partial'):
-            # render grid data only, as JSON
-            return render_to_response('json', grid.get_buefy_data(),
-                                      request=self.request)
+            return self.json_response(grid.get_buefy_data())
 
         context = {
             'grid': grid,
         }
 
         if self.results_downloadable and self.has_perm('download_results'):
             route_prefix = self.get_route_prefix()
@@ -444,63 +440,97 @@
             'extra_row_class': self.grid_extra_class,
             'url': lambda obj: self.get_action_url('view', obj),
             'checkboxes': checkboxes,
             'checked': self.checked,
             'checkable': self.checkbox,
             'clicking_row_checks_box': self.clicking_row_checks_box,
             'assume_local_times': self.has_local_times,
+            'row_uuid_getter': self.get_uuid_for_grid_row,
         }
 
         if self.sortable or self.pageable or self.filterable:
             defaults['expose_direct_link'] = True
 
         if 'main_actions' not in kwargs and 'more_actions' not in kwargs:
             main, more = self.get_grid_actions()
             defaults['main_actions'] = main
             defaults['more_actions'] = more
         defaults.update(kwargs)
         return defaults
 
+    def get_uuid_for_grid_row(self, obj):
+        """
+        If possible, this should return a "UUID" value to uniquely
+        identify the given object.  Default of course is to use the
+        actual ``uuid`` attribute of the object, if present.  This
+        value is needed by grids when checkboxes are used.
+        """
+        if hasattr(obj, 'uuid'):
+            return obj.uuid
+
     def configure_grid(self, grid):
         """
         Perform "final" configuration for the main data grid.
         """
         self.set_labels(grid)
 
         # hide "local only" grid filter, unless global access allowed
         if self.secure_global_objects:
             if not self.has_perm('view_global'):
                 grid.remove('local_only')
                 grid.remove_filter('local_only')
 
+        self.configure_column_customer_key(grid)
+        self.configure_column_member_key(grid)
         self.configure_column_product_key(grid)
 
         for supp in self.iter_view_supplements():
             supp.configure_grid(grid)
 
     def grid_extra_class(self, obj, i):
         """
         Returns string of extra class(es) for the table row corresponding to
         the given object, or ``None``.
         """
 
-    def quickie(self):
-        raise NotImplementedError
-
     def get_quickie_url(self):
         route_prefix = self.get_route_prefix()
         return self.request.route_url('{}.quickie'.format(route_prefix))
 
     def get_quickie_perm(self):
         permission_prefix = self.get_permission_prefix()
         return '{}.quickie'.format(permission_prefix)
 
     def get_quickie_placeholder(self):
         pass
 
+    def quickie(self):
+        """
+        Quickie search - tries to do a simple lookup based on a key
+        value.  If a record is found, user is redirected to its view.
+        """
+        entry = self.request.params.get('entry', '').strip()
+        if not entry:
+            self.request.session.flash("No search criteria specified", 'error')
+            return self.redirect(self.request.get_referrer())
+
+        obj = self.do_quickie_lookup(entry)
+        if not obj:
+            model_title = self.get_model_title()
+            self.request.session.flash(f"{model_title} not found: {entry}", 'error')
+            return self.redirect(self.request.get_referrer())
+
+        return self.redirect(self.get_quickie_result_url(obj))
+
+    def do_quickie_lookup(self, entry):
+        pass
+
+    def get_quickie_result_url(self, obj):
+        return self.get_action_url('view', obj)
+
     def make_row_grid(self, factory=None, key=None, data=None, columns=None, **kwargs):
         """
         Make and return a new (configured) rows grid instance.
         """
         instance = kwargs.pop('instance', None)
         if not instance:
             instance = self.get_instance()
@@ -563,17 +593,18 @@
 
             defaults['main_actions'] = actions
 
         defaults.update(kwargs)
         return defaults
 
     def configure_row_grid(self, grid):
-        # super(MasterView, self).configure_row_grid(grid)
         self.set_row_labels(grid)
 
+        self.configure_column_customer_key(grid)
+        self.configure_column_member_key(grid)
         self.configure_column_product_key(grid)
 
     def row_grid_extra_class(self, obj, i):
         """
         Returns string of extra class(es) for the table row corresponding to
         the given row object, or ``None``.
         """
@@ -728,15 +759,15 @@
         handler = handler_factory(self.rattail_config)
 
         if not schema:
             schema = forms.SimpleFileImport().bind(request=self.request)
         form = forms.Form(schema=schema, request=self.request)
         form.save_label = "Upload"
         form.cancel_url = self.get_index_url()
-        if form.validate(newstyle=True):
+        if form.validate():
 
             uploads = self.normalize_uploads(form)
             filepath = uploads['filename']['temp_path']
             batches = handler.make_batches(model_name,
                                            delete=delete,
                                            # tdc_input_path=filepath,
                                            # source_csv_path=filepath,
@@ -823,14 +854,37 @@
     def render_store(self, obj, field):
         store = getattr(obj, field)
         if store:
             text = "({}) {}".format(store.id, store.name)
             url = self.request.route_url('stores.view', uuid=store.uuid)
             return tags.link_to(text, url)
 
+    def render_tax(self, obj, field):
+        tax = getattr(obj, field)
+        if not tax:
+            return
+        text = str(tax)
+        url = self.request.route_url('taxes.view', uuid=tax.uuid)
+        return tags.link_to(text, url)
+
+    def render_tender(self, obj, field):
+        tender = getattr(obj, field)
+        if not tender:
+            return
+        text = str(tender)
+        url = self.request.route_url('tenders.view', uuid=tender.uuid)
+        return tags.link_to(text, url)
+
+    def valid_employee_uuid(self, node, value):
+        if value:
+            model = self.model
+            employee = self.Session.get(model.Employee, value)
+            if not employee:
+                node.raise_invalid("Employee not found")
+
     def render_product(self, obj, field):
         product = getattr(obj, field)
         if not product:
             return ""
         text = str(product)
         url = self.request.route_url('products.view', uuid=product.uuid)
         return tags.link_to(text, url)
@@ -852,14 +906,29 @@
         if short:
             text = "({}) {}".format(short, vendor.name)
         else:
             text = str(vendor)
         url = self.request.route_url('vendors.view', uuid=vendor.uuid)
         return tags.link_to(text, url)
 
+    def valid_vendor_uuid(self, node, value):
+        if value:
+            model = self.model
+            vendor = self.Session.get(model.Vendor, value)
+            if not vendor:
+                node.raise_invalid("Vendor not found")
+
+    def render_tax(self, obj, field):
+        tax = getattr(obj, field)
+        if not tax:
+            return
+        text = str(tax)
+        url = self.request.route_url('taxes.view', uuid=tax.uuid)
+        return tags.link_to(text, url)
+
     def render_department(self, obj, field):
         department = getattr(obj, field)
         if not department:
             return ""
         text = "({}) {}".format(department.number, department.name)
         url = self.request.route_url('departments.view', uuid=department.uuid)
         return tags.link_to(text, url)
@@ -936,22 +1005,38 @@
         items = []
         for user in users:
             text = user.username
             url = self.request.route_url('users.view', uuid=user.uuid)
             items.append(HTML.tag('li', c=[tags.link_to(text, url)]))
         return HTML.tag('ul', c=items)
 
+    def render_employee(self, obj, field):
+        employee = getattr(obj, field)
+        if not employee:
+            return ""
+        text = str(employee)
+        url = self.request.route_url('employees.view', uuid=employee.uuid)
+        return tags.link_to(text, url)
+
     def render_customer(self, obj, field):
         customer = getattr(obj, field)
         if not customer:
             return ""
         text = str(customer)
         url = self.request.route_url('customers.view', uuid=customer.uuid)
         return tags.link_to(text, url)
 
+    def render_member(self, obj, field):
+        member = getattr(obj, field)
+        if not member:
+            return
+        text = str(member)
+        url = self.request.route_url('members.view', uuid=member.uuid)
+        return tags.link_to(text, url)
+
     def render_email_key(self, obj, field):
         if hasattr(obj, field):
             email_key = getattr(obj, field)
         else:
             email_key = obj[field]
         if not email_key:
             return
@@ -1071,21 +1156,24 @@
             # grid will detect the filter reset request and store defaults in
             # the session, that way redirect will then show The Right Thing
             grid = self.make_row_grid(instance=instance)
 
             # If user just refreshed the page with a reset instruction, issue a
             # redirect in order to clear out the query string.
             if self.request.GET.get('reset-to-default-filters') == 'true':
-                return self.redirect(self.request.current_route_url(_query=None))
+                kw = {'_query': None}
+                hash_ = self.request.GET.get('hash')
+                if hash_:
+                    kw['_anchor'] = hash_
+                return self.redirect(self.request.current_route_url(**kw))
 
             # return grid only, if partial page was requested
             if self.request.params.get('partial'):
                 # render grid data only, as JSON
-                return render_to_response('json', grid.get_buefy_data(),
-                                          request=self.request)
+                return self.json_response(grid.get_buefy_data())
 
         context = {
             'instance': instance,
             'instance_title': self.get_instance_title(instance),
             'instance_editable': self.editable_instance(instance),
             'instance_deletable': self.deletable_instance(instance),
             'form': form,
@@ -1095,14 +1183,20 @@
         if hasattr(form, 'make_deform_form'):
             context['dform'] = form.make_deform_form()
 
         if self.has_rows:
             context['rows_grid'] = grid
             context['rows_grid_tools'] = HTML(self.make_row_grid_tools(instance) or '').strip()
 
+        context['expose_versions'] = (self.has_versions
+                                      and self.request.rattail_config.versioning_enabled()
+                                      and self.has_perm('versions'))
+        if context['expose_versions']:
+            context['versions_grid'] = self.make_revisions_grid(instance, empty_data=True)
+
         return self.render_to_response('view', context)
 
     def image(self):
         """
         View which renders the object's image as a response.
         """
         obj = self.get_instance()
@@ -1204,16 +1298,15 @@
         instance = self.get_instance()
         instance_title = self.get_instance_title(instance)
         grid = self.make_version_grid(instance=instance)
 
         # return grid only, if partial page was requested
         if self.request.params.get('partial'):
             # render grid data only, as JSON
-            return render_to_response('json', grid.get_buefy_data(),
-                                      request=self.request)
+            return self.json_response(grid.get_buefy_data())
 
         return self.render_to_response('versions', {
             'instance': instance,
             'instance_title': instance_title,
             'instance_url': self.get_action_url('view', instance),
             'grid': grid,
         })
@@ -1224,23 +1317,25 @@
         Returns the unique key to be used for the version grid, for caching
         sort/filter options etc.
         """
         if hasattr(cls, 'version_grid_key'):
             return cls.version_grid_key
         return '{}.history'.format(cls.get_route_prefix())
 
-    def get_version_data(self, instance):
+    def get_version_data(self, instance, order_by=True):
         """
         Generate the base data set for the version grid.
         """
         model_class = self.get_model_class()
         transaction_class = continuum.transaction_class(model_class)
         query = model_transaction_query(self.Session(), instance, model_class,
                                         child_classes=self.normalize_version_child_classes())
-        return query.order_by(transaction_class.issued_at.desc())
+        if order_by:
+            query = query.order_by(transaction_class.issued_at.desc())
+        return query
 
     def get_version_child_classes(self):
         """
         If applicable, should return a list of child classes which should be
         considered when querying for version history of an object.
         """
         classes = []
@@ -1254,14 +1349,122 @@
             if not isinstance(cls, tuple):
                 cls = (cls, 'uuid', 'uuid')
             elif len(cls) == 2:
                 cls = tuple([cls[0], cls[1], 'uuid'])
             classes.append(cls)
         return classes
 
+    def make_revisions_grid(self, obj, empty_data=False):
+        route_prefix = self.get_route_prefix()
+        row_url = lambda txn, i: self.request.route_url(f'{route_prefix}.version',
+                                                        uuid=obj.uuid,
+                                                        txnid=txn.id)
+
+        kwargs = {
+            'component': 'versions-grid',
+            'ajax_data_url': self.get_action_url('revisions_data', obj),
+            'sortable': True,
+            'default_sortkey': 'changed',
+            'default_sortdir': 'desc',
+            'main_actions': [
+                self.make_action('view', icon='eye', url='#',
+                                 click_handler='viewRevision(props.row)'),
+                self.make_action('view_separate', url=row_url, target='_blank',
+                                 icon='external-link-alt', ),
+            ],
+        }
+
+        if empty_data:
+
+            # TODO: surely there is a better way to have empty initial
+            # data..?  but so much logic depends on a query, can't
+            # just pass empty list here
+            txn_class = continuum.transaction_class(self.get_model_class())
+            meta_class = continuum.versioning_manager.transaction_meta_cls
+            kwargs['data'] = self.Session.query(txn_class)\
+                                         .outerjoin(meta_class,
+                                                    meta_class.transaction_id == txn_class.id)\
+                                         .filter(txn_class.id == -1)
+
+        else:
+            kwargs['data'] = self.get_version_data(obj, order_by=False)
+
+        grid = self.make_version_grid(**kwargs)
+
+        grid.set_joiner('user', lambda q: q.outerjoin(self.model.User))
+        grid.set_sorter('user', self.model.User.username)
+
+        grid.set_link('remote_addr')
+
+        grid.append('id')
+        grid.set_label('id', "TXN ID")
+        grid.set_link('id')
+
+        return grid
+
+    def revisions_data(self):
+        """
+        AJAX view to fetch revision data for current instance.
+        """
+        txnid = self.request.GET.get('txnid')
+        if txnid:
+            # return single txn data
+
+            app = self.get_rattail_app()
+            obj = self.get_instance()
+            cls = self.get_model_class()
+            txn_cls = continuum.transaction_class(cls)
+            route_prefix = self.get_route_prefix()
+
+            transactions = model_transaction_query(
+                self.Session(), obj, cls,
+                child_classes=self.normalize_version_child_classes())
+
+            txn = transactions.filter(txn_cls.id == txnid).first()
+            if not txn:
+                return self.notfound()
+
+            older = transactions.filter(txn_cls.issued_at <= txn.issued_at)\
+                                .filter(txn_cls.id != txnid)\
+                                .order_by(txn_cls.issued_at.desc())\
+                                .first()
+            newer = transactions.filter(txn_cls.issued_at >= txn.issued_at)\
+                                .filter(txn_cls.id != txnid)\
+                                .order_by(txn_cls.issued_at)\
+                                .first()
+
+            version_diffs = []
+            for version in self.get_relevant_versions(txn, obj):
+                diff = self.make_version_diff(version)
+                version_diffs.append(diff.as_struct())
+
+            changed_raw = app.render_datetime(app.localtime(txn.issued_at, from_utc=True))
+            changed_ago = app.render_time_ago(app.make_utc() - txn.issued_at)
+
+            changed_by = str(txn.user or '')
+            if self.request.has_perm('users.view') and txn.user:
+                changed_by = tags.link_to(changed_by, self.request.route_url('users.view', uuid=txn.user.uuid))
+
+            return {
+                'txnid': txn.id,
+                'changed': f"{changed_raw} ({changed_ago})",
+                'changed_by': changed_by,
+                'remote_addr': txn.remote_addr,
+                'comment': txn.meta.get('comment'),
+                'versions': version_diffs,
+                'url': self.request.route_url(f'{route_prefix}.version', uuid=obj.uuid, txnid=txnid),
+                'prev_txnid': older.id if older else None,
+                'next_txnid': newer.id if newer else None,
+            }
+
+        else: # no txnid, return grid data
+            obj = self.get_instance()
+            grid = self.make_revisions_grid(obj)
+            return grid.get_buefy_data()
+
     def view_version(self):
         """
         View showing diff details of a particular object version.
         """
         instance = self.get_instance()
         model_class = self.get_model_class()
         route_prefix = self.get_route_prefix()
@@ -1285,35 +1488,58 @@
 
         prev_url = next_url = None
         if older:
             prev_url = self.request.route_url('{}.version'.format(route_prefix), uuid=instance.uuid, txnid=older.id)
         if newer:
             next_url = self.request.route_url('{}.version'.format(route_prefix), uuid=instance.uuid, txnid=newer.id)
 
+        version_diffs = []
+        versions = self.get_relevant_versions(transaction, instance)
+        for version in versions:
+
+            old_data = {}
+            new_data = {}
+            fields = self.fields_for_version(version)
+            for field in fields:
+                if version.previous:
+                    old_data[field] = getattr(version.previous, field)
+                new_data[field] = getattr(version, field)
+            diff = self.make_version_diff(version, old_data, new_data, fields=fields)
+            version_diffs.append(diff)
+
         return self.render_to_response('view_version', {
             'instance': instance,
             'instance_title': "{} (history)".format(instance_title),
             'instance_title_normal': instance_title,
             'instance_url': self.get_action_url('versions', instance),
             'transaction': transaction,
             'changed': localtime(self.rattail_config, transaction.issued_at, from_utc=True),
-            'versions': self.get_relevant_versions(transaction, instance),
+            'version_diffs': version_diffs,
             'show_prev_next': True,
             'prev_url': prev_url,
             'next_url': next_url,
             'previous_transaction': older,
             'next_transaction': newer,
             'title_for_version': self.title_for_version,
             'fields_for_version': self.fields_for_version,
             'continuum': continuum,
             'render_old_value': self.render_version_old_field_value,
             'render_new_value': self.render_version_new_field_value,
         })
 
     def title_for_version(self, version):
+        """
+        Must return the title text for the given version.  By default
+        this will be the :term:`rattail:model title` for the version's
+        data class.
+
+        :param version: Reference to a Continuum version object.
+
+        :returns: Title text for the version, as string.
+        """
         cls = continuum.parent_class(version.__class__)
         return cls.get_model_title()
 
     def fields_for_version(self, version):
         mapper = orm.class_mapper(version.__class__)
         fields = sorted(mapper.columns.keys())
         fields.remove('transaction_id')
@@ -1413,15 +1639,15 @@
         defaults.update(kwargs)
         return defaults
 
     def configure_quick_row_form(self, form, **kwargs):
         pass
 
     def validate_quick_row_form(self, form):
-        return form.validate(newstyle=True)
+        return form.validate()
 
     def make_default_row_grid_tools(self, obj):
         if self.rows_creatable:
             link = tags.link_to("Create a new {}".format(self.get_row_model_title()),
                                 self.get_action_url('create_row', obj))
             return HTML.tag('p', c=[link])
 
@@ -1530,17 +1756,17 @@
 
     def download(self):
         """
         View for downloading a data file.
         """
         obj = self.get_instance()
         filename = self.request.GET.get('filename', None)
-        if not filename:
-            raise self.notfound()
         path = self.download_path(obj, filename)
+        if not path or not os.path.exists(path):
+            raise self.notfound()
         response = FileResponse(path, request=self.request)
         response.content_length = os.path.getsize(path)
         content_type = self.download_content_type(path, filename)
         if content_type:
             response.content_type = content_type
 
         # content-disposition
@@ -1673,15 +1899,16 @@
             'cancel_url': self.get_index_url(),
             'cancel_msg': "Bulk deletion was canceled",
         })
 
     def bulk_delete_objects(self, session, objects, progress=None):
 
         def delete(obj, i):
-            self.delete_instance(obj)
+            if self.deletable_instance(obj):
+                self.delete_instance(obj)
             if i % 1000 == 0:
                 session.flush()
 
         self.progress_loop(delete, objects, progress,
                            message="Deleting objects")
 
     def get_bulk_delete_session(self):
@@ -1773,29 +2000,43 @@
         if objects:
             for obj in objects:
                 self.delete_instance(obj)
             model_title_plural = self.get_model_title_plural()
             self.request.session.flash("Deleted {} {}".format(len(objects), model_title_plural))
         return self.redirect(self.get_index_url())
 
-    def oneoff_import(self, importer, host_object=None):
+    def fetch_grid_totals(self):
+        return {'totals_display': "TODO: totals go here"}
+
+    def oneoff_import(self, importer, host_object=None, local_object=None):
         """
         Basic helper method, to do a one-off import (or export, depending on
         perspective) of the "current instance" object.  Where the data "goes"
         depends on the importer you provide.
         """
-        if not host_object:
+        if host_object is None and local_object is None:
             host_object = self.get_instance()
 
-        host_data = importer.normalize_host_object(host_object)
-        if not host_data:
-            return
+        if host_object is None:
+            local_data = importer.normalize_local_object(local_object)
+            key = importer.get_key(local_data)
+            host_object = importer.get_single_host_object(key)
+            if not host_object:
+                return
+            host_data = importer.normalize_host_object(host_object)
+            if not host_data:
+                return
+
+        else:
+            host_data = importer.normalize_host_object(host_object)
+            if not host_data:
+                return
+            key = importer.get_key(host_data)
+            local_object = importer.get_local_object(key)
 
-        key = importer.get_key(host_data)
-        local_object = importer.get_local_object(key)
         if local_object:
             if importer.allow_update:
                 local_data = importer.normalize_local_object(local_object)
                 if importer.data_diffs(local_data, host_data) and importer.allow_update:
                     local_object = importer.update_object(local_object, host_data, local_data)
             return local_object
         elif importer.allow_create:
@@ -2009,25 +2250,39 @@
         if self.merge_handler:
             fields = self.merge_handler.get_merge_preview_fields()
             return [field['name'] for field in fields
                     if field.get('additive')]
 
         return []
 
+    def get_merge_objects(self):
+        """
+        Must return 2 objects, obtained somehow from the request,
+        which are to be (potentially) merged.
+
+        :returns: 2-tuple of ``(object_to_remove, object_to_keep)``,
+           or ``None``.
+        """
+        uuids = self.request.POST.get('uuids', '').split(',')
+        if len(uuids) == 2:
+            cls = self.get_model_class()
+            object_to_remove = self.Session.get(cls, uuids[0])
+            object_to_keep = self.Session.get(cls, uuids[1])
+            if object_to_remove and object_to_keep:
+                return object_to_remove, object_to_keep
+
     def merge(self):
         """
         Preview and execute a merge of two records.
         """
         object_to_remove = object_to_keep = None
         if self.request.method == 'POST':
-            uuids = self.request.POST.get('uuids', '').split(',')
-            if len(uuids) == 2:
-                object_to_remove = self.Session.get(self.get_model_class(), uuids[0])
-                object_to_keep = self.Session.get(self.get_model_class(), uuids[1])
-
+            objects = self.get_merge_objects()
+            if objects:
+                object_to_remove, object_to_keep = objects
                 if object_to_remove and object_to_keep and self.request.POST.get('commit-merge') == 'yes':
                     msg = str(object_to_remove)
                     try:
                         self.validate_merge(object_to_remove, object_to_keep)
                     except Exception as error:
                         self.request.session.flash("Requested merge cannot proceed (maybe swap kept/removed and try again?): {}".format(error), 'error')
                     else:
@@ -2036,21 +2291,25 @@
                         return self.redirect(self.get_action_url('view', object_to_keep))
 
         if not object_to_remove or not object_to_keep or object_to_remove is object_to_keep:
             return self.redirect(self.get_index_url())
 
         remove = self.get_merge_data(object_to_remove)
         keep = self.get_merge_data(object_to_keep)
-        return self.render_to_response('merge', {'object_to_remove': object_to_remove,
-                                                 'object_to_keep': object_to_keep,
-                                                 'view_url': lambda obj: self.get_action_url('view', obj),
-                                                 'merge_fields': self.get_merge_fields(),
-                                                 'remove_data': remove,
-                                                 'keep_data': keep,
-                                                 'resulting_data': self.get_merge_resulting_data(remove, keep)})
+        return self.render_to_response('merge', {
+            'object_to_remove': object_to_remove,
+            'object_to_keep': object_to_keep,
+            'removing_uuid': self.get_uuid_for_grid_row(object_to_remove),
+            'keeping_uuid': self.get_uuid_for_grid_row(object_to_keep),
+            'view_url': lambda obj: self.get_action_url('view', obj),
+            'merge_fields': self.get_merge_fields(),
+            'remove_data': remove,
+            'keep_data': keep,
+            'resulting_data': self.get_merge_resulting_data(remove, keep),
+        })
 
     def validate_merge(self, removing, keeping):
         """
         If applicable, your view should override this in order to confirm that
         the requested merge is valid, in your context.  If it is not - for *any
         reason* - you should raise an exception; the type does not matter.
         """
@@ -2059,15 +2318,15 @@
             if reason:
                 raise Exception(reason)
 
     def get_merge_data(self, obj):
         if self.merge_handler:
             return self.merge_handler.get_merge_preview_data(obj)
 
-        return dict([(f, getattr(obj, f))
+        return dict([(f, getattr(obj, f, None))
                      for f in self.get_merge_fields()])
 
     def get_merge_resulting_data(self, remove, keep):
         result = dict(keep)
         for field in self.get_merge_coalesce_fields():
             if remove[field] is not None and keep[field] is None:
                 result[field] = remove[field]
@@ -2124,18 +2383,38 @@
         if hasattr(cls, 'normalized_model_name'):
             return cls.normalized_model_name
         return cls.get_model_class().__name__.lower()
 
     @classmethod
     def get_model_key(cls, as_tuple=False):
         """
-        Returns the primary key(s) for the model class.  Note that this will
-        return a *string* value unless a tuple is requested.  If the model has
-        a composite key then the string result would be a comma-delimited list
-        of names, e.g. ``foo_id,bar_id``.
+        Returns the primary model key(s) for the master view.
+
+        Internally, model keys are a sequence of one or more keys.
+        Most typically it's just one, so e.g. ``('uuid',)``, but
+        composite keys are possible too, e.g. ``('parent_id',
+        'child_id')``.
+
+        Despite that, this method will return a *string*
+        representation of the keys, unless ``as_tuple=True`` in which
+        case it returns a tuple.  For example::
+
+           # for model keys: ('uuid',)
+
+           cls.get_model_key()                  # => 'uuid'
+           cls.get_model_key(as_tuple=True)     # => ('uuid',)
+
+           # for model keys: ('parent_id', 'child_id')
+
+           cls.get_model_key()                  # => 'parent_id,child_id'
+           cls.get_model_key(as_tuple=True)     # => ('parent_id', 'child_id')
+
+        :param as_tuple: Whether to return a tuple instead of string.
+
+        :returns: Either a string or tuple of model keys.
         """
         if hasattr(cls, 'model_key'):
             keys = cls.model_key
             if isinstance(keys, str):
                 keys = [keys]
         else:
             keys = get_primary_keys(cls.get_model_class())
@@ -2211,16 +2490,17 @@
         """
         return getattr(cls, 'permission_prefix', cls.get_route_prefix())
 
     def get_index_url(self, **kwargs):
         """
         Returns the master view's index URL.
         """
-        route = self.get_route_prefix()
-        return self.request.route_url(route, **kwargs)
+        if self.listable:
+            route = self.get_route_prefix()
+            return self.request.route_url(route, **kwargs)
 
     # TODO: this should not be class method, if possible
     # (pretty sure overriding as instance method works fine)
     @classmethod
     def get_index_title(cls):
         """
         Returns the title for the index page.
@@ -2286,17 +2566,23 @@
         # nb. self.Session may differ, so use tailbone.db.Session
         info = Session.query(model.TailbonePageHelp)\
                       .filter(model.TailbonePageHelp.route_prefix == route_prefix)\
                       .first()
         if info and info.markdown_text:
             return info.markdown_text
 
+    def can_edit_help(self):
+        if self.has_perm('edit_help'):
+            return True
+        if self.request.has_perm('common.edit_help'):
+            return True
+        return False
+
     def edit_help(self):
-        if (not self.has_perm('edit_help')
-            and not self.request.has_perm('common.edit_help')):
+        if not self.can_edit_help():
             raise self.forbidden()
 
         model = self.model
         route_prefix = self.get_route_prefix()
         schema = colander.Schema()
 
         schema.add(colander.SchemaNode(colander.String(),
@@ -2305,15 +2591,15 @@
 
         schema.add(colander.SchemaNode(colander.String(),
                                        name='markdown_text',
                                        missing=None))
 
         factory = self.get_form_factory()
         form = factory(schema=schema, request=self.request)
-        if not form.validate(newstyle=True):
+        if not form.validate():
             return {'error': "Form did not validate"}
 
         # nb. self.Session may differ, so use tailbone.db.Session
         info = Session.query(model.TailbonePageHelp)\
                       .filter(model.TailbonePageHelp.route_prefix == route_prefix)\
                       .first()
         if not info:
@@ -2321,16 +2607,15 @@
             Session.add(info)
 
         info.help_url = form.validated['help_url']
         info.markdown_text = form.validated['markdown_text']
         return {'ok': True}
 
     def edit_field_help(self):
-        if (not self.has_perm('edit_help')
-            and not self.request.has_perm('common.edit_help')):
+        if not self.can_edit_help():
             raise self.forbidden()
 
         model = self.model
         route_prefix = self.get_route_prefix()
         schema = colander.Schema()
 
         schema.add(colander.SchemaNode(colander.String(),
@@ -2338,15 +2623,15 @@
 
         schema.add(colander.SchemaNode(colander.String(),
                                        name='markdown_text',
                                        missing=None))
 
         factory = self.get_form_factory()
         form = factory(schema=schema, request=self.request)
-        if not form.validate(newstyle=True):
+        if not form.validate():
             return {'error': "Form did not validate"}
 
         # nb. self.Session may differ, so use tailbone.db.Session
         info = Session.query(model.TailboneFieldInfo)\
                       .filter(model.TailboneFieldInfo.route_prefix == route_prefix)\
                       .filter(model.TailboneFieldInfo.field_name == form.validated['field_name'])\
                       .first()
@@ -2375,23 +2660,28 @@
             'index_title': self.get_index_title(),
             'index_url': self.get_index_url(),
             'config_title': self.get_config_title(),
             'action_url': self.get_action_url,
             'grid_index': self.grid_index,
             'help_url': self.get_help_url(),
             'help_markdown': self.get_help_markdown(),
-            'can_edit_help': (self.has_perm('edit_help')
-                              or self.request.has_perm('common.edit_help')),
+            'can_edit_help': self.can_edit_help(),
             'quickie': None,
         }
 
-        key = self.rattail_config.product_key()
-        context['product_key_field'] = self.product_key_fields.get(key, key)
+        context['customer_key_field'] = self.get_customer_key_field()
+        context['customer_key_label'] = self.get_customer_key_label()
+
+        context['member_key_field'] = self.get_member_key_field()
+        context['member_key_label'] = self.get_member_key_label()
 
-        if self.expose_quickie_search:
+        context['product_key_field'] = self.get_product_key_field()
+        context['product_key_label'] = self.get_product_key_label()
+
+        if self.should_expose_quickie_search():
             context['quickie'] = self.get_quickie_context()
 
         if self.grid_index:
             context['grid_count'] = self.grid_count
 
         if self.has_rows:
             context['rows_title'] = self.get_rows_title()
@@ -2497,15 +2787,15 @@
                 if len(engines) > 1:
 
                     # user session determines "current" db engine *of this type*
                     # (note that many master views may declare the same type, and
                     # would therefore share the "current" engine)
                     selected = self.get_current_engine_dbkey()
                     kwargs['expose_db_picker'] = True
-                    kwargs['db_picker_options'] = [tags.Option(k) for k in engines]
+                    kwargs['db_picker_options'] = [tags.Option(k, value=k) for k in engines]
                     kwargs['db_picker_selected'] = selected
 
         # add info for downloadable input file templates, if any
         if self.has_input_file_templates:
             templates = self.normalize_input_file_templates()
             kwargs['input_file_templates'] = OrderedDict([(tmpl['key'], tmpl)
                                                           for tmpl in templates])
@@ -2642,24 +2932,24 @@
         btn_kw.setdefault('icon_pack', 'fas')
 
         if type:
             btn_kw['type'] = type
         elif is_primary:
             btn_kw['type'] = 'is-primary'
 
+        if icon_left:
+            btn_kw['icon_left'] = icon_left
+        elif is_external:
+            btn_kw['icon_left'] = 'external-link-alt'
+        elif url:
+            btn_kw['icon_left'] = 'eye'
+
         if url:
             btn_kw['href'] = url
 
-            if icon_left:
-                btn_kw['icon_left'] = icon_left
-            elif is_external:
-                btn_kw['icon_left'] = 'external-link-alt'
-            else:
-                btn_kw['icon_left'] = 'eye'
-
             if target:
                 btn_kw['target'] = target
             elif is_external:
                 btn_kw['target'] = '_blank'
 
         button = HTML.tag('b-button', **btn_kw)
 
@@ -2843,18 +3133,31 @@
 
     def make_grid_action_delete(self):
         kwargs = {}
         if self.delete_confirm == 'simple':
             kwargs['click_handler'] = 'deleteObject'
         return self.make_action('delete', icon='trash', url=self.default_delete_url, **kwargs)
 
-    def default_edit_url(self, row, i=None):
-        if self.editable_instance(row):
+    def default_edit_url(self, obj, i=None):
+        """
+        Return the default "edit" URL for the given object, if
+        applicable.  This first checks :meth:`editable_instance()` for
+        the object, and will only return a URL if the object is deemed
+        editable.
+
+        :param obj: A top-level record/object, of the type normally
+           handled by this master view.
+
+        :param i: Optional row index within a grid.
+
+        :returns: The "edit object" URL as string, or ``None``.
+        """
+        if self.editable_instance(obj):
             return self.request.route_url('{}.edit'.format(self.get_route_prefix()),
-                                          **self.get_action_route_kwargs(row))
+                                          **self.get_action_route_kwargs(obj))
 
     def default_clone_url(self, row, i=None):
         return self.request.route_url('{}.clone'.format(self.get_route_prefix()),
                                       **self.get_action_route_kwargs(row))
 
     def default_delete_url(self, row, i=None):
         if self.deletable_instance(row):
@@ -2868,32 +3171,69 @@
         if url is None:
             route = '{}.{}'.format(self.get_route_prefix(), key)
             url = lambda r, i: self.request.route_url(route, **self.get_action_route_kwargs(r))
         if not factory:
             factory = grids.GridAction
         return factory(key, url=url, **kwargs)
 
-    def get_action_route_kwargs(self, row):
+    def get_action_route_kwargs(self, obj):
         """
-        Hopefully generic kwarg generator for basic action routes.
+        Get a dict of route kwargs for the given object.
+
+        This is called from various other "convenience" URL
+        generators, e.g. :meth:`default_edit_url()`.
+
+        It inspects the given object, as well as the "model key" (as
+        returned by :meth:`get_model_key()`), and returns a dict of
+        appropriate route kwargs for the object.
+
+        Most typically, the model key is just ``uuid`` and so this
+        would effectively return ``{'uuid': obj.uuid}``.
+
+        But composite model keys are supported too, so if the model
+        key is ``(parent_id, child_id)`` this might instead return
+        ``{'parent_id': obj.parent_id, 'child_id': obj.child_id}``.
+
+        Such kwargs would then be fed into ``route_url()`` as needed,
+        for example to get a "view product URL"::
+
+           kw = self.get_action_route_kwargs(product)
+           url = self.request.route_url('products.view', **kw)
+
+        :param obj: A top-level record/object, of the type normally
+           handled by this master view.
+
+        :returns: A dict of route kwargs for the object.
         """
+        keys = self.get_model_key(as_tuple=True)
+        if keys:
+            try:
+                return dict([(key, obj[key])
+                             for key in keys])
+            except TypeError:
+                return dict([(key, getattr(obj, key))
+                             for key in keys])
+
+        # TODO: sanity check, is the above all we need..?
+        log.warning("yes we still do the code below sometimes")
+
         try:
-            mapper = orm.object_mapper(row)
+            mapper = orm.object_mapper(obj)
         except orm.exc.UnmappedInstanceError:
             try:
                 if isinstance(self.model_key, str):
-                    return {self.model_key: row[self.model_key]}
-                return dict([(key, row[key])
+                    return {self.model_key: obj[self.model_key]}
+                return dict([(key, obj[key])
                              for key in self.model_key])
             except TypeError:
-                return {self.model_key: getattr(row, self.model_key)}
+                return {self.model_key: getattr(obj, self.model_key)}
         else:
-            pkeys = get_primary_keys(row)
+            pkeys = get_primary_keys(obj)
             keys = list(pkeys)
-            values = [getattr(row, k) for k in keys]
+            values = [getattr(obj, k) for k in keys]
             return dict(zip(keys, values))
 
     def get_data(self, session=None):
         """
         Generate the base data set for the grid.  This typically will be a
         SQLAlchemy query against the view's model class, but subclasses may
         override this to support arbitrary data sets.
@@ -4021,16 +4361,15 @@
         defaults = {
             'request': self.request,
             'readonly': self.viewing,
             'model_class': getattr(self, 'model_class', None),
             'action_url': self.request.current_route_url(_query=None),
             'assume_local_times': self.has_local_times,
             'route_prefix': route_prefix,
-            'can_edit_help': (self.has_perm('edit_help')
-                              or self.request.has_perm('common.edit_help')),
+            'can_edit_help': self.can_edit_help(),
         }
 
         if defaults['can_edit_help']:
             defaults['edit_help_url'] = self.request.route_url(
                 '{}.edit_field_help'.format(route_prefix))
 
         if self.creating:
@@ -4055,21 +4394,23 @@
 
     def configure_form(self, form):
         """
         Configure the main "desktop" form for the view's data model.
         """
         self.configure_common_form(form)
 
+        self.configure_field_customer_key(form)
+        self.configure_field_member_key(form)
         self.configure_field_product_key(form)
 
         for supp in self.iter_view_supplements():
             supp.configure_form(form)
 
     def validate_form(self, form):
-        if form.validate(newstyle=True):
+        if form.validate():
             self.form_deserialized = form.validated
             return True
         return False
 
     def objectify(self, form, data=None):
         """
         Create and/or update the model instance from the given form, and return
@@ -4154,19 +4495,24 @@
         """
 
     def after_create(self, instance):
         """
         Event hook, called just after a new instance is saved.
         """
 
-    def editable_instance(self, instance):
+    def editable_instance(self, obj):
         """
-        Returns boolean indicating whether or not the given instance can be
-        considered "editable".  Returns ``True`` by default; override as
-        necessary.
+        Returns boolean indicating whether or not the given object
+        should be considered "editable".  Returns ``True`` by default;
+        override as necessary.
+
+        :param obj: A top-level record/object, of the type normally
+           handled by this master view.
+
+        :returns: ``True`` if object is editable, else ``False``.
         """
         return True
 
     def after_edit(self, instance):
         """
         Event hook, called just after an existing instance is saved.
         """
@@ -4515,39 +4861,95 @@
         #                 if field == key.name:
         #                     form.set_readonly(field)
         #                     break
         # form.remove_field('uuid')
 
         self.set_row_labels(form)
 
+        self.configure_field_customer_key(form)
+        self.configure_field_member_key(form)
         self.configure_field_product_key(form)
 
     def validate_row_form(self, form):
-        if form.validate(newstyle=True):
+        if form.validate():
             self.form_deserialized = form.validated
             return True
         return False
 
+    def get_customer_key_field(self):
+        app = self.get_rattail_app()
+        key = app.get_customer_key_field()
+        return self.customer_key_fields.get(key, key)
+
+    def get_customer_key_label(self):
+        app = self.get_rattail_app()
+        field = self.get_customer_key_field()
+        return app.get_customer_key_label(field=field)
+
+    def configure_column_customer_key(self, g):
+        if '_customer_key_' in g.columns:
+            field = self.get_customer_key_field()
+            g.replace('_customer_key_', field)
+            g.set_label(field, self.get_customer_key_label())
+            g.set_link(field)
+
+    def configure_field_customer_key(self, f):
+        if '_customer_key_' in f:
+            field = self.get_customer_key_field()
+            f.replace('_customer_key_', field)
+            f.set_label(field, self.get_customer_key_label())
+
+    def get_member_key_field(self):
+        app = self.get_rattail_app()
+        key = app.get_member_key_field()
+        return self.member_key_fields.get(key, key)
+
+    def get_member_key_label(self):
+        app = self.get_rattail_app()
+        field = self.get_member_key_field()
+        return app.get_member_key_label(field=field)
+
+    def configure_column_member_key(self, g):
+        if '_member_key_' in g.columns:
+            field = self.get_member_key_field()
+            g.replace('_member_key_', field)
+            g.set_label(field, self.get_member_key_label())
+            g.set_link(field)
+
+    def configure_field_member_key(self, f):
+        if '_member_key_' in f:
+            field = self.get_member_key_field()
+            f.replace('_member_key_', field)
+            f.set_label(field, self.get_member_key_label())
+
+    def get_product_key_field(self):
+        app = self.get_rattail_app()
+        key = app.get_product_key_field()
+        return self.product_key_fields.get(key, key)
+
+    def get_product_key_label(self):
+        app = self.get_rattail_app()
+        field = self.get_product_key_field()
+        return app.get_product_key_label(field=field)
+
     def configure_column_product_key(self, g):
         if '_product_key_' in g.columns:
-            key = self.rattail_config.product_key()
-            field = self.product_key_fields.get(key, key)
+            field = self.get_product_key_field()
             g.replace('_product_key_', field)
-            g.set_label(field, self.rattail_config.product_key_title(key))
+            g.set_label(field, self.get_product_key_label())
             g.set_link(field)
-            if key == 'upc':
+            if field == 'upc':
                 g.set_renderer(field, self.render_upc)
 
     def configure_field_product_key(self, f):
         if '_product_key_' in f:
-            key = self.rattail_config.product_key()
-            field = self.product_key_fields.get(key, key)
+            field = self.get_product_key_field()
             f.replace('_product_key_', field)
-            f.set_label(field, self.rattail_config.product_key_title(key))
-            if key == 'upc':
+            f.set_label(field, self.get_product_key_label())
+            if field == 'upc':
                 f.set_renderer(field, self.render_upc)
 
     def get_row_action_url(self, action, row, **kwargs):
         """
         Generate a URL for the given action on the given row.
         """
         route_name = '{}.{}_row'.format(self.get_route_prefix(), action)
@@ -4563,14 +4965,64 @@
             'uuid': parent.uuid,
             'row_uuid': row.uuid,
         }
 
     def make_diff(self, old_data, new_data, **kwargs):
         return diffs.Diff(old_data, new_data, **kwargs)
 
+    def get_version_diff_factory(self, **kwargs):
+        """
+        Must return the factory to be used when creating version diff
+        objects.
+
+        By default this returns the
+        :class:`tailbone.diffs.VersionDiff` class, unless
+        :attr:`version_diff_factory` is set, in which case that is
+        returned as-is.
+
+        :returns: A factory which can produce
+           :class:`~tailbone.diffs.VersionDiff` objects.
+        """
+        if hasattr(self, 'version_diff_factory'):
+            return self.version_diff_factory
+        return diffs.VersionDiff
+
+    def get_version_diff_enums(self, version):
+        """
+        This can optionally return a dict of field enums, to be passed
+        to the version diff factory.  This method is called as part of
+        :meth:`make_version_diff()`.
+        """
+
+    def make_version_diff(self, version, *args, **kwargs):
+        """
+        Make a version diff object, using the factory returned by
+        :meth:`get_version_diff_factory()`.
+
+        :param version: Reference to a Continuum version object.
+
+        :param title: If specified, must be as a kwarg.  Optional
+           override for the version title text.  If not specified,
+           :meth:`title_for_version()` is called for the title.
+
+        :param \*args: Additional args to pass to the factory.
+
+        :param \*\*kwargs: Additional kwargs to pass to the factory.
+
+        :returns: A :class:`~tailbone.diffs.VersionDiff` object.
+        """
+        if 'title' not in kwargs:
+            kwargs['title'] = self.title_for_version(version)
+
+        if 'enums' not in kwargs:
+            kwargs['enums'] = self.get_version_diff_enums(version)
+
+        factory = self.get_version_diff_factory()
+        return factory(version, *args, **kwargs)
+
     ##############################
     # Configuration Views
     ##############################
 
     def configure(self):
         """
         Generic view for configuring some aspect of the software.
@@ -4727,15 +5179,15 @@
                 name = self.configure_get_name_for_simple_setting(simple)
 
                 if 'value' in simple:
                     value = simple['value']
                 elif simple.get('type') is bool:
                     value = config.getbool(simple['section'],
                                            simple['option'],
-                                           default=False)
+                                           default=simple.get('default', False))
                 else:
                     value = config.get(simple['section'],
                                        simple['option'])
 
                 settings[name] = value
 
             context['simple_settings'] = settings
@@ -4973,14 +5425,23 @@
             if cls.has_rows and cls.results_rows_downloadable:
                 config.add_tailbone_permission(permission_prefix, '{}.download_results_rows'.format(permission_prefix),
                                                "Download *rows* for {} search results".format(model_title))
                 config.add_route('{}.download_results_rows'.format(route_prefix), '{}/download-rows-for-results'.format(url_prefix))
                 config.add_view(cls, attr='download_results_rows', route_name='{}.download_results_rows'.format(route_prefix),
                                 permission='{}.download_results_rows'.format(permission_prefix))
 
+            # fetch total hours
+            if cls.supports_grid_totals:
+                config.add_route(f'{route_prefix}.fetch_grid_totals',
+                                 f'{url_prefix}/fetch-grid-totals')
+                config.add_view(cls, attr='fetch_grid_totals',
+                                route_name=f'{route_prefix}.fetch_grid_totals',
+                                permission=f'{permission_prefix}.list',
+                                renderer='json')
+
         # configure
         if cls.configurable:
             config.add_tailbone_permission(permission_prefix,
                                            '{}.configure'.format(permission_prefix),
                                            label="Configure {}".format(config_title))
             config.add_route('{}.configure'.format(route_prefix),
                              cls.get_config_url())
@@ -5296,14 +5757,24 @@
                             permission='{}.versions'.format(permission_prefix))
             config.add_route('{}.version'.format(route_prefix),
                              '{}/versions/{{txnid}}'.format(instance_url_prefix))
             config.add_view(cls, attr='view_version',
                             route_name='{}.version'.format(route_prefix),
                             permission='{}.versions'.format(permission_prefix))
 
+            # revisions data (AJAX)
+            config.add_route(f'{route_prefix}.revisions_data',
+                             f'{instance_url_prefix}/revisions-data',
+                             request_method='GET')
+            config.add_view(cls, attr='revisions_data',
+                            route_name=f'{route_prefix}.revisions_data',
+                            permission=f'{permission_prefix}.versions',
+                            renderer='json')
+
+
     @classmethod
     def _defaults_edit_help(cls, config, **kwargs):
         route_prefix = cls.get_route_prefix()
         url_prefix = cls.get_url_prefix()
         model_title_plural = cls.get_model_title_plural()
 
         # nb. if caller specifies permission prefix, it's assumed they
@@ -5360,14 +5831,17 @@
     def __init__(self, master):
         self.master = master
         self.request = master.request
         self.model = master.model
         self.rattail_config = master.rattail_config
         self.Session = master.Session
 
+    def get_rattail_app(self):
+        return self.master.get_rattail_app()
+
     def get_grid_query(self, query):
         """
         Return the "base" query for the grid.  This is invoked from
         within :meth:`tailbone.views.master.MasterView.query()`.
 
         A typical grid query is
         essentially:
```

### Comparing `Tailbone-0.9.9/tailbone/views/stores.py` & `Tailbone-0.9.90/tailbone/views/stores.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/email.py` & `Tailbone-0.9.90/tailbone/views/email.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,35 +20,35 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Email Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
+import logging
 import re
 import warnings
 
-import six
-
 from rattail import mail
 from rattail.db import model
 from rattail.config import parse_list
 from rattail.util import simple_error
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import HTML
 
 from tailbone import grids
 from tailbone.db import Session
 from tailbone.views import View, MasterView
 
 
+log = logging.getLogger(__name__)
+
+
 class EmailSettingView(MasterView):
     """
     Master view for email admin (settings/preview).
     """
     normalized_model_name = 'emailprofile'
     model_title = "Email Setting"
     model_key = 'key'
@@ -101,17 +101,23 @@
 
     def get_data(self, session=None):
         data = []
         if self.has_perm('configure'):
             emails = self.email_handler.get_all_emails()
         else:
             emails = self.email_handler.get_available_emails()
-        for key, Email in six.iteritems(emails):
+        for key, Email in emails.items():
             email = Email(self.rattail_config, key)
-            data.append(self.normalize(email))
+            try:
+                normalized = self.normalize(email)
+            except:
+                log.warning("cannot normalize email: %s", email,
+                            exc_info=True)
+            else:
+                data.append(normalized)
         return data
 
     def configure_grid(self, g):
         g.sorters['key'] = g.make_simple_sorter('key', foldcase=True)
         g.sorters['prefix'] = g.make_simple_sorter('prefix', foldcase=True)
         g.sorters['subject'] = g.make_simple_sorter('subject', foldcase=True)
         g.sorters['enabled'] = g.make_simple_sorter('enabled')
@@ -262,45 +268,86 @@
         app.save_setting(session, 'rattail.mail.{}.prefix'.format(key), data['prefix'])
         app.save_setting(session, 'rattail.mail.{}.subject'.format(key), data['subject'])
         app.save_setting(session, 'rattail.mail.{}.from'.format(key), data['sender'])
         app.save_setting(session, 'rattail.mail.{}.replyto'.format(key), data['replyto'])
         app.save_setting(session, 'rattail.mail.{}.to'.format(key), (data['to'] or '').replace('\n', ', '))
         app.save_setting(session, 'rattail.mail.{}.cc'.format(key), (data['cc'] or '').replace('\n', ', '))
         app.save_setting(session, 'rattail.mail.{}.bcc'.format(key), (data['bcc'] or '').replace('\n', ', '))
-        app.save_setting(session, 'rattail.mail.{}.enabled'.format(key), six.text_type(data['enabled']).lower())
+        app.save_setting(session, 'rattail.mail.{}.enabled'.format(key), str(data['enabled']).lower())
         if self.has_perm('configure'):
-            app.save_setting(session, 'rattail.mail.{}.hidden'.format(key), six.text_type(data['hidden']).lower())
+            app.save_setting(session, 'rattail.mail.{}.hidden'.format(key), str(data['hidden']).lower())
         return data
 
     def template_kwargs_view(self, **kwargs):
+        kwargs = super().template_kwargs_view(**kwargs)
+        app = self.get_rattail_app()
+
         key = self.request.matchdict['key']
         kwargs['email'] = self.email_handler.get_email(key)
+
+        kwargs['user_email_address'] = app.get_contact_email_address(self.request.user)
+
         return kwargs
 
     def configure_get_simple_settings(self):
         config = self.rattail_config
         return [
 
+            # general
+            {'section': 'rattail.mail',
+             'option': 'handler'},
+            {'section': 'rattail.mail',
+             'option': 'templates'},
+
             # sending
             {'section': 'rattail.mail',
              'option': 'record_attempts',
              'type': bool},
             {'section': 'rattail.mail',
              'option': 'send_email_on_failure',
              'type': bool},
         ]
 
+    def configure_get_context(self, *args, **kwargs):
+        context = super().configure_get_context(*args, **kwargs)
+        app = self.get_rattail_app()
+
+        # prettify list of template paths
+        templates = self.rattail_config.parse_list(
+            context['simple_settings']['rattail.mail.templates'])
+        context['simple_settings']['rattail.mail.templates'] = ', '.join(templates)
+
+        context['user_email_address'] = app.get_contact_email_address(self.request.user)
+
+        return context
+
     def toggle_hidden(self):
         app = self.get_rattail_app()
         data = self.request.json_body
         name = 'rattail.mail.{}.hidden'.format(data['key'])
         app.save_setting(self.Session(), name,
                          'true' if data['hidden'] else 'false')
         return {'ok': True}
 
+    def send_test(self):
+        """
+        AJAX view for sending a test email.
+        """
+        data = self.request.json_body
+
+        recip = data.get('recipient')
+        if not recip:
+            return {'error': "Must specify recipient"}
+
+        app = self.get_rattail_app()
+        app.send_email('hello', to=[recip], cc=None, bcc=None,
+                       default_subject="Hello world")
+
+        return {'ok': True}
+
     @classmethod
     def defaults(cls, config):
         cls._email_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _email_defaults(cls, config):
@@ -314,14 +361,24 @@
                          '{}/toggle-hidden'.format(url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='toggle_hidden',
                         route_name='{}.toggle_hidden'.format(route_prefix),
                         permission='{}.configure'.format(permission_prefix),
                         renderer='json')
 
+        # send test
+        config.add_route('{}.send_test'.format(route_prefix),
+                         '{}/send-test'.format(url_prefix),
+                         request_method='POST')
+        config.add_view(cls, attr='send_test',
+                        route_name='{}.send_test'.format(route_prefix),
+                        permission='{}.configure'.format(permission_prefix),
+                        renderer='json')
+
+
 # TODO: deprecate / remove this
 ProfilesView = EmailSettingView
 
 
 class ToggleHidden(grids.GridAction):
     """
     Grid action for toggling the 'hidden' flag for an email profile.
```

### Comparing `Tailbone-0.9.9/tailbone/views/luigi.py` & `Tailbone-0.9.90/tailbone/views/luigi.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/reports.py` & `Tailbone-0.9.90/tailbone/views/reports.py`

 * *Files 1% similar despite different names*

```diff
@@ -25,21 +25,22 @@
 """
 
 import calendar
 import json
 import re
 import datetime
 import logging
+from collections import OrderedDict
 
 import rattail
 from rattail.db import model, Session as RattailSession
 from rattail.files import resource_path
 from rattail.time import localtime
 from rattail.threads import Thread
-from rattail.util import simple_error, OrderedDict
+from rattail.util import simple_error
 
 import colander
 from deform import widget as dfwidget
 from mako.template import Template
 from pyramid.response import Response
 from webhelpers2.html import HTML, tags
 
@@ -368,15 +369,15 @@
         values = [(r.type_key, r.name) for r in reports.values()]
         values.sort(key=lambda r: r[1])
         form.set_widget('report_type', forms.widgets.CustomSelectWidget(values=values))
         form.widgets['report_type'].set_template_values(input_handler='reportTypeChanged')
 
         # if form validates, that means user has chosen a report type, so we
         # just redirect to the appropriate "new report" page
-        if form.validate(newstyle=True):
+        if form.validate():
             raise self.redirect(self.request.route_url('generate_specific_report',
                                                        type_key=form.validated['report_type']))
 
         return self.render_to_response('choose', {
             'form': form,
             'dform': form.make_deform_form(),
             'reports': reports,
@@ -426,15 +427,16 @@
                 node.missing = None
 
             # maybe set default value
             if hasattr(param, 'default'):
                 node.default = param.default
 
             # set docstring
-            helptext[param.name] = param.helptext
+            # nb. must avoid newlines, they cause some weird "blank page" error?!
+            helptext[param.name] = param.helptext.replace('\n', ' ')
 
             schema.add(node)
 
         form = forms.Form(schema=schema, request=self.request, helptext=helptext)
         form.submit_label = "Generate this Report"
         form.cancel_url = self.request.get_referrer(
             default=self.request.route_url('{}.create'.format(route_prefix)))
@@ -460,15 +462,15 @@
                     if param.type is datetime.date:
                         value = app.parse_date(value)
                     elif param.type is bool:
                         value = self.rattail_config.parse_bool(value)
                     form.set_default(param.name, value)
 
         # if form validates, start generating new report output; show progress page
-        if form.validate(newstyle=True):
+        if form.validate():
             key = 'report_output.generate'
             progress = self.make_progress(key)
             kwargs = {'progress': progress}
             thread = Thread(target=self.generate_thread,
                             args=(report, form.validated, self.request.user.uuid),
                             kwargs=kwargs)
             thread.start()
@@ -624,15 +626,17 @@
         for system_key, reports in organized.items():
             for report in reports.values():
                 data.append(self.normalize(report))
 
         return data
 
     def configure_grid(self, g):
-        super(ProblemReportView, self).configure_grid(g)
+        super().configure_grid(g)
+
+        g.set_searchable('system_key')
 
         g.set_renderer('email_recipients', self.render_email_recipients)
 
         g.set_searchable('problem_title')
 
         g.set_link('problem_key')
         g.set_link('problem_title')
```

### Comparing `Tailbone-0.9.9/tailbone/views/filemon.py` & `Tailbone-0.9.90/tailbone/views/filemon.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/customergroups.py` & `Tailbone-0.9.90/tailbone/views/customergroups.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/bouncer.py` & `Tailbone-0.9.90/tailbone/views/bouncer.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,40 +20,35 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for Email Bounces
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import os
 import datetime
 
-import six
-
 from rattail.db import model
-from rattail.bouncer import get_handler
 from rattail.bouncer.config import get_profile_keys
 
-from pyramid.response import FileResponse
 from webhelpers2.html import HTML, tags
 
 from tailbone.views import MasterView
 
 
 class EmailBounceView(MasterView):
     """
     Master view for email bounces.
     """
     model_class = model.EmailBounce
     model_title_plural = "Email Bounces"
     url_prefix = '/email-bounces'
     creatable = False
     editable = False
+    downloadable = True
 
     labels = {
         'config_key': "Source",
         'bounce_recipient_address': "Bounced To",
         'intended_recipient_address': "Intended For",
     }
 
@@ -62,42 +57,47 @@
         'bounced',
         'bounce_recipient_address',
         'intended_recipient_address',
         'processed_by',
     ]
 
     def __init__(self, request):
-        super(EmailBounceView, self).__init__(request)
+        super().__init__(request)
         self.handler_options = sorted(get_profile_keys(self.rattail_config))
 
     def get_handler(self, bounce):
-        return get_handler(self.rattail_config, bounce.config_key)
+        app = self.get_rattail_app()
+        return app.get_bounce_handler(bounce.config_key)
 
     def configure_grid(self, g):
-        super(EmailBounceView, self).configure_grid(g)
+        super().configure_grid(g)
+        model = self.model
 
         g.filters['config_key'].set_choices(self.handler_options)
         g.filters['config_key'].default_active = True
         g.filters['config_key'].default_verb = 'equal'
 
-        g.joiners['processed_by'] = lambda q: q.outerjoin(model.User)
         g.filters['processed'].default_active = True
         g.filters['processed'].default_verb = 'is_null'
-        g.filters['processed_by'] = g.make_filter('processed_by', model.User.username)
-        g.sorters['processed_by'] = g.make_sorter(model.User.username)
+
+        # processed_by
+        g.set_joiner('processed_by', lambda q: q.outerjoin(model.User))
+        g.set_sorter('processed_by', model.User.username)
+        g.set_filter('processed_by', model.User.username)
+
         g.set_sort_defaults('bounced', 'desc')
 
         g.set_label('bounce_recipient_address', "Bounced To")
         g.set_label('intended_recipient_address', "Intended For")
 
         g.set_link('bounced')
         g.set_link('intended_recipient_address')
 
     def configure_form(self, f):
-        super(EmailBounceView, self).configure_form(f)
+        super().configure_form(f)
         bounce = f.model_instance
         f.set_renderer('message', self.render_message_file)
         f.set_renderer('links', self.render_links)
         f.fields = [
             'config_key',
             'message',
             'bounced',
@@ -138,19 +138,24 @@
         bounce = kwargs['instance']
         kwargs['bounce'] = bounce
         handler = self.get_handler(bounce)
         kwargs['handler'] = handler
         path = handler.msgpath(bounce)
         if os.path.exists(path):
             with open(path, 'rb') as f:
-                kwargs['message'] = f.read()
+                # TODO: how to determine encoding? (is utf_8 guaranteed?)
+                kwargs['message'] = f.read().decode('utf_8')
         else:
             kwargs['message'] = "(file not found)"
         return kwargs
 
+    def download_path(self, bounce, filename):
+        handler = self.get_handler(bounce)
+        return handler.msgpath(bounce)
+
     # TODO: should require POST here
     def process(self):
         """
         View for marking a bounce as processed.
         """
         bounce = self.get_instance()
         bounce.processed = datetime.datetime.utcnow()
@@ -165,28 +170,21 @@
         """
         bounce = self.get_instance()
         bounce.processed = None
         bounce.processed_by = None
         self.request.session.flash("Email bounce has been marked UN-processed.")
         return self.redirect(self.get_action_url('view', bounce))
 
-    def download(self):
-        """
-        View for downloading the message file associated with a bounce.
-        """
-        bounce = self.get_instance()
-        handler = self.get_handler(bounce)
-        path = handler.msgpath(bounce)
-        response = FileResponse(path, request=self.request)
-        response.headers[b'Content-Length'] = six.binary_type(os.path.getsize(path))
-        response.headers[b'Content-Disposition'] = b'attachment; filename="bounce.eml"'
-        return response
-
     @classmethod
     def defaults(cls, config):
+        cls._bounce_defaults(config)
+        cls._defaults(config)
+
+    @classmethod
+    def _bounce_defaults(cls, config):
 
         config.add_tailbone_permission_group('emailbounces', "Email Bounces", overwrite=False)
 
         # mark bounce as processed
         config.add_route('emailbounces.process', '/email-bounces/{uuid}/process')
         config.add_view(cls, attr='process', route_name='emailbounces.process',
                         permission='emailbounces.process')
@@ -196,23 +194,14 @@
         # mark bounce as *not* processed
         config.add_route('emailbounces.unprocess', '/email-bounces/{uuid}/unprocess')
         config.add_view(cls, attr='unprocess', route_name='emailbounces.unprocess',
                         permission='emailbounces.unprocess')
         config.add_tailbone_permission('emailbounces', 'emailbounces.unprocess',
                                        "Mark Email Bounce as UN-processed")
 
-        # download raw email
-        config.add_route('emailbounces.download', '/email-bounces/{uuid}/download')
-        config.add_view(cls, attr='download', route_name='emailbounces.download',
-                        permission='emailbounces.download')
-        config.add_tailbone_permission('emailbounces', 'emailbounces.download',
-                                       "Download raw message of Email Bounce")
-
-        cls._defaults(config)
-
 
 def defaults(config, **kwargs):
     base = globals()
 
     EmailBounceView = kwargs.get('EmailBounceView', base['EmailBounceView'])
     EmailBounceView.defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/views/categories.py` & `Tailbone-0.9.90/tailbone/views/categories.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/shifts/timesheet.py` & `Tailbone-0.9.90/tailbone/views/shifts/timesheet.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/shifts/core.py` & `Tailbone-0.9.90/tailbone/views/shifts/core.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,39 +20,40 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for employee shifts
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import datetime
 
-import six
-
 from rattail.db import model
 from rattail.time import localtime
-from rattail.util import pretty_hours, hours_as_decimal
+from rattail.util import hours_as_decimal
 
 from webhelpers2.html import tags, HTML
 
 from tailbone.views import MasterView
 
 
-def render_shift_length(shift, field):
-    if not shift.start_time or not shift.end_time:
-        return ""
-    if shift.end_time < shift.start_time:
-        return "??"
-    length = shift.end_time - shift.start_time
-    return HTML.tag('span', title="{} hrs".format(hours_as_decimal(length)), c=[pretty_hours(length)])
+class ShiftViewMixin:
+
+    def render_shift_length(self, shift, field):
+        if not shift.start_time or not shift.end_time:
+            return ""
+        if shift.end_time < shift.start_time:
+            return "??"
+        app = self.get_rattail_app()
+        length = shift.end_time - shift.start_time
+        return HTML.tag('span',
+                        title="{} hrs".format(hours_as_decimal(length)),
+                        c=[app.render_duration(delta=length)])
 
 
-class ScheduledShiftView(MasterView):
+class ScheduledShiftView(MasterView, ShiftViewMixin):
     """
     Master view for employee scheduled shifts.
     """
     model_class = model.ScheduledShift
     url_prefix = '/shifts/scheduled'
 
     grid_columns = [
@@ -74,28 +75,28 @@
     def configure_grid(self, g):
         g.joiners['employee'] = lambda q: q.join(model.Employee).join(model.Person)
         g.filters['employee'] = g.make_filter('employee', model.Person.display_name,
                                               default_active=True, default_verb='contains')
 
         g.set_sort_defaults('start_time', 'desc')
 
-        g.set_renderer('length', render_shift_length)
+        g.set_renderer('length', self.render_shift_length)
 
         g.set_label('employee', "Employee Name")
 
     def configure_form(self, f):
-        super(ScheduledShiftView, self).configure_form(f)
+        super().configure_form(f)
 
-        f.set_renderer('length', render_shift_length)
+        f.set_renderer('length', self.render_shift_length)
 
 # TODO: deprecate / remove this
 ScheduledShiftsView = ScheduledShiftView
 
 
-class WorkedShiftView(MasterView):
+class WorkedShiftView(MasterView, ShiftViewMixin):
     """
     Master view for employee worked shifts.
     """
     model_class = model.WorkedShift
     url_prefix = '/shifts/worked'
     results_downloadable_xlsx = True
     has_versions = True
@@ -113,77 +114,80 @@
         'store',
         'start_time',
         'end_time',
         'length',
     ]
 
     def configure_grid(self, g):
-        super(WorkedShiftView, self).configure_grid(g)
-
-        g.joiners['employee'] = lambda q: q.join(model.Employee).join(model.Person)
-        g.filters['employee'] = g.make_filter('employee', model.Person.display_name)
-        g.sorters['employee'] = g.make_sorter(model.Person.display_name)
+        super().configure_grid(g)
+        model = self.model
 
-        g.joiners['store'] = lambda q: q.join(model.Store)
-        g.filters['store'] = g.make_filter('store', model.Store.name)
-        g.sorters['store'] = g.make_sorter(model.Store.name)
+        # employee
+        g.set_joiner('employee', lambda q: q.join(model.Employee).join(model.Person))
+        g.set_sorter('employee', model.Person.display_name)
+        g.set_filter('employee', model.Person.display_name)
+
+        # store
+        g.set_joiner('store', lambda q: q.join(model.Store))
+        g.set_sorter('store', model.Store.name)
+        g.set_filter('store', model.Store.name)
 
         # TODO: these sorters should be automatic once we fix the schema
-        g.sorters['start_time'] = g.make_sorter(model.WorkedShift.punch_in)
-        g.sorters['end_time'] = g.make_sorter(model.WorkedShift.punch_out)
+        g.set_sorter('start_time', model.WorkedShift.punch_in)
+        g.set_sorter('end_time', model.WorkedShift.punch_out)
         # TODO: same goes for these renderers
         g.set_type('start_time', 'datetime')
         g.set_type('end_time', 'datetime')
         # (but we'll still have to set this)
         g.set_sort_defaults('start_time', 'desc')
 
-        g.set_renderer('length', render_shift_length)
+        g.set_renderer('length', self.render_shift_length)
 
         g.set_label('employee', "Employee Name")
         g.set_label('store', "Store Name")
         g.set_label('punch_in', "Start Time")
         g.set_label('punch_out', "End Time")
 
     def get_instance_title(self, shift):
         time = shift.start_time or shift.end_time
         date = localtime(self.rattail_config, time).date()
         return "WorkedShift: {}, {}".format(shift.employee, date)
 
     def configure_form(self, f):
-        super(WorkedShiftView, self).configure_form(f)
+        super().configure_form(f)
 
         f.set_readonly('employee')
         f.set_renderer('employee', self.render_employee)
 
-        f.set_renderer('length', render_shift_length)
+        f.set_renderer('length', self.render_shift_length)
         if self.editing:
             f.remove('length')
 
     def render_employee(self, shift, field):
         employee = shift.employee
         if not employee:
             return ""
-        text = six.text_type(employee)
+        text = str(employee)
         url = self.request.route_url('employees.view', uuid=employee.uuid)
         return tags.link_to(text, url)
 
     def get_xlsx_fields(self):
-        fields = super(WorkedShiftView, self).get_xlsx_fields()
+        fields = super().get_xlsx_fields()
 
         # add employee name
         i = fields.index('employee_uuid')
         fields.insert(i + 1, 'employee_name')
 
         # add hours
         fields.append('hours')
 
         return fields
 
     def get_xlsx_row(self, shift, fields):
-        row = super(WorkedShiftView, self).get_xlsx_row(shift, fields)
+        row = super().get_xlsx_row(shift, fields)
 
         # localize start and end times (Excel requires time with no zone)
         if shift.punch_in:
             row['punch_in'] = localtime(self.rattail_config, shift.punch_in, from_utc=True, tzinfo=False)
         if shift.punch_out:
             row['punch_out'] = localtime(self.rattail_config, shift.punch_out, from_utc=True, tzinfo=False)
```

### Comparing `Tailbone-0.9.9/tailbone/views/shifts/lib.py` & `Tailbone-0.9.90/tailbone/views/shifts/lib.py`

 * *Files 1% similar despite different names*

```diff
@@ -27,15 +27,15 @@
 import datetime
 
 import sqlalchemy as sa
 
 from rattail import enum
 from rattail.db import model, api
 from rattail.time import localtime, make_utc, get_sunday
-from rattail.util import pretty_hours, hours_as_decimal
+from rattail.util import hours_as_decimal
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import tags, HTML
 
 from tailbone import forms
 from tailbone.db import Session
@@ -160,29 +160,29 @@
         return {'date': date, 'employee': employee}
 
     def process_filter_form(self, form):
         """
         Process a "shift filter" form if one was in fact POST'ed.  If it was
         then we store new context in session and redirect to display as normal.
         """
-        if form.validate(newstyle=True):
+        if form.validate():
             store = form.validated['store']
             self.request.session['timesheet.{}.store'.format(self.key)] = store.uuid if store else None
             department = form.validated['department']
             self.request.session['timesheet.{}.department'.format(self.key)] = department.uuid if department else None
             date = form.validated['date']
             self.request.session['timesheet.{}.date'.format(self.key)] = date.strftime('%m/%d/%Y') if date else None
             raise self.redirect(self.request.current_route_url())
 
     def process_employee_filter_form(self, form):
         """
         Process an "employee shift filter" form if one was in fact POST'ed.  If it
         was then we store new context in session and redirect to display as normal.
         """
-        if form.validate(newstyle=True):
+        if form.validate():
             employee = form.validated['employee']
             self.request.session['timesheet.{}.employee'.format(self.key)] = employee.uuid if employee else None
             date = form.validated['date']
             self.request.session['timesheet.{}.employee.date'.format(self.key)] = date.strftime('%m/%d/%Y') if date else None
             raise self.redirect(self.request.current_route_url())
 
     def make_full_filter_form(self, context):
@@ -397,14 +397,16 @@
         self.fetch_shift_data(self.model_class, employees, weekdays)
 
     def fetch_shift_data(self, cls, employees, weekdays):
         """
         Fetch all shift data of the given model class (``cls``), according to
         the given params.  The cached shift data is attached to each employee.
         """
+        app = self.get_rattail_app()
+
         # TODO: a bit hacky, this?  display hours as HH:MM by default, but
         # check config in order to display as HH.HH for certain users
         hours_style = 'pretty'
         if self.request.user:
             hours_style = self.rattail_config.get('tailbone', 'hours_style.{}'.format(self.request.user.username),
                                                   default='pretty')
         if hours_style != 'decimal':
@@ -461,26 +463,26 @@
                         del employee_shifts[0]
                     else:
                         break
 
                 hours = empday['{}_hours'.format(shift_type)]
                 if hours:
                     if hours_style == 'pretty':
-                        display = pretty_hours(hours)
+                        display = app.render_duration(hours=hours)
                     else: # decimal
                         display = str(hours_as_decimal(hours))
                     if empday['hours_incomplete']:
                         display = '{} ?'.format(display)
                     empday['{}_hours_display'.format(shift_type)] = display
                 employee.weekdays[i].update(empday)
 
             hours = getattr(employee, '{}_hours'.format(shift_type))
             if hours:
                 if hours_style == 'pretty':
-                    display = pretty_hours(hours)
+                    display = app.render_duration(hours=hours)
                 else: # decimal
                     display = str(hours_as_decimal(hours))
                 if hours_incomplete:
                     display = '{} ?'.format(display)
                 setattr(employee, '{}_hours_display'.format(shift_type), display)
 
     @classmethod
```

### Comparing `Tailbone-0.9.9/tailbone/views/shifts/__init__.py` & `Tailbone-0.9.90/tailbone/views/shifts/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/shifts/schedule.py` & `Tailbone-0.9.90/tailbone/views/shifts/schedule.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/upgrades.py` & `Tailbone-0.9.90/tailbone/views/upgrades.py`

 * *Files 1% similar despite different names*

```diff
@@ -25,22 +25,22 @@
 """
 
 import json
 import os
 import re
 import logging
 import warnings
+from collections import OrderedDict
 
 import sqlalchemy as sa
 
 from rattail.core import Object
 from rattail.db import model, Session as RattailSession
 from rattail.time import make_utc
 from rattail.threads import Thread
-from rattail.util import OrderedDict
 
 from deform import widget as dfwidget
 from webhelpers2.html import tags, HTML
 
 from tailbone.views import MasterView
 from tailbone.progress import get_progress_session #, SessionProgress
 from tailbone.config import should_expose_websockets
@@ -396,14 +396,18 @@
                 'commit_url': 'https://kallithea.rattailproject.org/rattail-project/theo/changelog/{new_version}/?size=10',
                 'release_url': 'https://kallithea.rattailproject.org/rattail-project/theo/files/v{new_version}/CHANGES.rst',
             },
         }
         return projects
 
     def get_changelog_url(self, project, old_version, new_version):
+        # cannot generate URL if new version is unknown
+        if not new_version:
+            return
+
         projects = self.get_changelog_projects()
 
         project_name = project
         if project_name not in projects:
             # cannot generate a changelog URL for unknown project
             return
```

### Comparing `Tailbone-0.9.9/tailbone/views/progress.py` & `Tailbone-0.9.90/tailbone/views/progress.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/views.py` & `Tailbone-0.9.90/tailbone/views/views.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import os
 import sys
 
 from rattail.db.util import get_fieldnames
 from rattail.util import simple_error
 
 import colander
@@ -76,15 +74,15 @@
                     'route_prefix': view['route_prefix'],
                     'permission_prefix': view['permission_prefix'],
                 })
 
         return data
 
     def configure_grid(self, g):
-        super(ModelViewView, self).configure_grid(g)
+        super().configure_grid(g)
 
         # label
         g.sorters['label'] = g.make_simple_sorter('label')
         g.set_sort_defaults('label')
         g.set_link('label')
         g.set_searchable('label')
 
@@ -103,15 +101,15 @@
     def default_view_url(self):
         return lambda view, i: self.request.route_url(view['route_prefix'])
 
     def make_form_schema(self):
         return ModelViewSchema()
 
     def template_kwargs_create(self, **kwargs):
-        kwargs = super(ModelViewView, self).template_kwargs_create(**kwargs)
+        kwargs = super().template_kwargs_create(**kwargs)
         app = self.get_rattail_app()
         db_handler = app.get_db_handler()
 
         model_classes = db_handler.get_model_classes()
         kwargs['model_names'] = [cls.__name__ for cls in model_classes]
 
         pkg = self.rattail_config.get('rattail', 'running_from_source.rootpkg')
```

### Comparing `Tailbone-0.9.9/tailbone/views/common.py` & `Tailbone-0.9.90/tailbone/views/common.py`

 * *Files 12% similar despite different names*

```diff
@@ -21,17 +21,18 @@
 #
 ################################################################################
 """
 Various common views
 """
 
 import os
+from collections import OrderedDict
 
 from rattail.batch import consume_batch_id
-from rattail.util import OrderedDict, simple_error, import_module_path
+from rattail.util import simple_error, import_module_path
 from rattail.files import resource_path
 
 from pyramid import httpexceptions
 from pyramid.response import Response
 
 from tailbone import forms
 from tailbone.forms.common import Feedback
@@ -61,19 +62,37 @@
 
         context = {
             'image_url': image_url,
             'index_title': self.rattail_config.node_title(),
             'help_url': global_help_url(self.rattail_config),
         }
 
-        if self.expose_quickie_search:
+        if self.should_expose_quickie_search():
             context['quickie'] = self.get_quickie_context()
 
         return context
 
+    # nb. this is only invoked from home() view
+    def should_expose_quickie_search(self):
+        if self.expose_quickie_search:
+            return True
+        # TODO: for now we are assuming *people* search
+        app = self.get_rattail_app()
+        return app.get_people_handler().should_expose_quickie_search()
+
+    def get_quickie_perm(self):
+        return 'people.quickie'
+
+    def get_quickie_url(self):
+        return self.request.route_url('people.quickie')
+
+    def get_quickie_placeholder(self):
+        app = self.get_rattail_app()
+        return app.get_people_handler().get_quickie_search_placeholder()
+
     def robots_txt(self):
         """
         Returns a basic 'robots.txt' response
         """
         with open(self.robots_txt_path, 'rt') as f:
             content = f.read()
         response = self.request.response
@@ -156,15 +175,15 @@
         """
         Generic view to handle the user feedback form.
         """
         app = self.get_rattail_app()
         model = self.model
         schema = Feedback().bind(session=Session())
         form = forms.Form(schema=schema, request=self.request)
-        if form.validate(newstyle=True):
+        if form.validate():
             data = dict(form.validated)
             if data['user']:
                 data['user'] = Session.get(model.User, data['user'])
                 data['user_url'] = self.request.route_url('users.view', uuid=data['user'].uuid)
             data['client_ip'] = self.request.client_addr
             app.send_email('user_feedback', data=data)
             return {'ok': True}
@@ -270,14 +289,19 @@
             config.add_exception_view(cls, attr='exception', renderer='/exception.mako')
 
         # permissions
         config.add_tailbone_permission_group('common', "(common)", overwrite=False)
         config.add_tailbone_permission('common', 'common.edit_help',
                                        "Edit help info for *any* page")
 
+        # API swagger
+        if rattail_config.getbool('tailbone', 'expose_api_swagger'):
+            config.add_tailbone_permission('common', 'common.api_swagger',
+                                           "Explore the API with Swagger tools")
+
         # home
         config.add_route('home', '/')
         config.add_view(cls, attr='home', route_name='home', renderer='/home.mako')
 
         # robots.txt
         config.add_route('robots.txt', '/robots.txt')
         config.add_view(cls, attr='robots_txt', route_name='robots.txt')
```

### Comparing `Tailbone-0.9.9/tailbone/views/auth.py` & `Tailbone-0.9.90/tailbone/views/auth.py`

 * *Files 2% similar despite different names*

```diff
@@ -97,19 +97,17 @@
         # redirect if already logged in
         if self.request.user:
             self.request.session.flash("{} is already logged in".format(self.request.user), 'error')
             return self.redirect(referrer)
 
         form = forms.Form(schema=UserLogin(), request=self.request)
         form.save_label = "Login"
-        form.auto_disable_save = False
-        form.auto_disable = False # TODO: deprecate / remove this
         form.show_reset = True
         form.show_cancel = False
-        if form.validate(newstyle=True):
+        if form.validate():
             user = self.authenticate_user(form.validated['username'],
                                           form.validated['password'])
             if user:
                 # okay now they're truly logged in
                 headers = login_user(self.request, user)
                 # treat URL from session as referrer, if available
                 referrer = self.request.session.pop('next_url', referrer)
@@ -171,21 +169,25 @@
     def change_password(self):
         """
         Allows a user to change his or her password.
         """
         if not self.request.user:
             return self.redirect(self.request.route_url('home'))
 
-        if self.user_is_protected(self.request.user) and not self.request.is_root:
-            self.request.session.flash("Cannot change password for user: {}".format(self.request.user))
+        if ((self.request.user.prevent_password_change
+             or self.user_is_protected(self.request.user))
+            and not self.request.is_root):
+
+            self.request.session.flash("Cannot change password for user: {}".format(
+                self.request.user))
             return self.redirect(self.request.get_referrer())
 
         schema = ChangePassword().bind(user=self.request.user, request=self.request)
         form = forms.Form(schema=schema, request=self.request)
-        if form.validate(newstyle=True):
+        if form.validate():
             set_user_password(self.request.user, form.validated['new_password'])
             self.request.session.flash("Your password has been changed.")
             return self.redirect(self.request.get_referrer())
 
         return {'form': form}
 
     def become_root(self):
```

### Comparing `Tailbone-0.9.9/tailbone/views/features.py` & `Tailbone-0.9.90/tailbone/views/features.py`

 * *Files 2% similar despite different names*

```diff
@@ -58,23 +58,23 @@
             for key, value in feature.get_defaults().items():
                 form.set_default(key, value)
             feature_forms[feature.feature_key] = form
 
         result = rendered_result = None
         feature_type = 'new-report'
         if self.request.method == 'POST':
-            if app_form.validate(newstyle=True):
+            if app_form.validate():
 
                 feature_type = self.request.POST['feature_type']
                 feature = self.handler.get_feature(feature_type)
                 if not feature:
                     raise ValueError("Unknown feature type: {}".format(feature_type))
 
                 feature_form = feature_forms[feature.feature_key]
-                if feature_form.validate(newstyle=True):
+                if feature_form.validate():
                     context = dict(app_form.validated)
                     context.update(feature_form.validated)
                     result = self.handler.do_generate(feature, **context)
                     rendered_result = self.render_result(result)
 
         context = {
             'index_title': "Generate Feature",
```

### Comparing `Tailbone-0.9.9/tailbone/views/datasync.py` & `Tailbone-0.9.90/tailbone/views/datasync.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,21 +20,18 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 DataSync Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import json
 import subprocess
 import logging
 
-import six
 import sqlalchemy as sa
 
 from rattail.db import model
 from rattail.datasync.util import purge_datasync_settings
 from rattail.util import simple_error
 
 from tailbone.views import MasterView
@@ -113,15 +110,15 @@
         all_changes = {}
         for row in result:
             all_changes[(row.source, row.consumer)] = row.changes
 
         watcher_data = []
         consumer_data = []
         now = app.localtime()
-        for key, profile in six.iteritems(profiles):
+        for key, profile in profiles.items():
             watcher = profile.watcher
 
             lastrun = self.datasync_handler.get_watcher_lastrun(
                 watcher.key, local=True, session=self.Session())
 
             status = "okay"
             if (now - lastrun).total_seconds() >= (watcher.delay * 2):
@@ -254,15 +251,15 @@
 
             for profile in json.loads(data['profiles']):
                 pkey = profile['key']
                 if profile['enabled']:
                     watch.append(pkey)
 
                 settings.extend([
-                    {'name': 'rattail.datasync.{}.watcher'.format(pkey),
+                    {'name': 'rattail.datasync.{}.watcher.spec'.format(pkey),
                      'value': profile['watcher_spec']},
                     {'name': 'rattail.datasync.{}.watcher.db'.format(pkey),
                      'value': profile['watcher_dbkey']},
                     {'name': 'rattail.datasync.{}.watcher.delay'.format(pkey),
                      'value': profile['watcher_delay']},
                     {'name': 'rattail.datasync.{}.watcher.retry_attempts'.format(pkey),
                      'value': profile['watcher_retry_attempts']},
@@ -285,30 +282,30 @@
                 else:
 
                     for consumer in profile['consumers_data']:
                         ckey = consumer['key']
                         if consumer['enabled']:
                             consumers.append(ckey)
                         settings.extend([
-                            {'name': 'rattail.datasync.{}.consumer.{}'.format(pkey, ckey),
+                            {'name': f'rattail.datasync.{pkey}.consumer.{ckey}.spec',
                              'value': consumer['consumer_spec']},
                             {'name': 'rattail.datasync.{}.consumer.{}.db'.format(pkey, ckey),
                              'value': consumer['consumer_dbkey']},
                             {'name': 'rattail.datasync.{}.consumer.{}.delay'.format(pkey, ckey),
                              'value': consumer['consumer_delay']},
                             {'name': 'rattail.datasync.{}.consumer.{}.retry_attempts'.format(pkey, ckey),
                              'value': consumer['consumer_retry_attempts']},
                             {'name': 'rattail.datasync.{}.consumer.{}.retry_delay'.format(pkey, ckey),
                              'value': consumer['consumer_retry_delay']},
                             {'name': 'rattail.datasync.{}.consumer.{}.runas'.format(pkey, ckey),
                              'value': consumer['consumer_runas']},
                         ])
 
                 settings.extend([
-                    {'name': 'rattail.datasync.{}.consumers'.format(pkey),
+                    {'name': 'rattail.datasync.{}.consumers.list'.format(pkey),
                      'value': ', '.join(consumers)},
                 ])
 
             if watch:
                 settings.append({'name': 'rattail.datasync.watch',
                                  'value': ', '.join(watch)})
```

### Comparing `Tailbone-0.9.9/tailbone/views/ifps.py` & `Tailbone-0.9.90/tailbone/views/ifps.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/people.py` & `Tailbone-0.9.90/tailbone/views/people.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2023 Lance Edgar
+#  Copyright  2010-2024 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -22,47 +22,52 @@
 ################################################################################
 """
 Person Views
 """
 
 import datetime
 import logging
+from collections import OrderedDict
 
 import sqlalchemy as sa
 from sqlalchemy import orm
+import sqlalchemy_continuum as continuum
 
-from rattail.db import model, api
+from rattail.db import api
+from rattail.db.model import Person, PersonNote, MergePeopleRequest
 from rattail.db.util import maxlen
 from rattail.time import localtime
-from rattail.util import OrderedDict, simple_error
+from rattail.util import simple_error
 
 import colander
 from pyramid.httpexceptions import HTTPFound, HTTPNotFound
 from webhelpers2.html import HTML, tags
 
 from tailbone import forms, grids
 from tailbone.views import MasterView
+from tailbone.util import raw_datetime
 
 
 log = logging.getLogger(__name__)
 
 
 class PersonView(MasterView):
     """
     Master view for the Person class.
     """
-    model_class = model.Person
+    model_class = Person
     model_title_plural = "People"
     route_prefix = 'people'
     touchable = True
     has_versions = True
     bulk_deletable = True
     is_contact = True
-    manage_notes_from_profile_view = False
     supports_autocomplete = True
+    supports_quickie_search = True
+    configurable = True
 
     labels = {
         'default_phone': "Phone Number",
         'default_email': "Email Address",
     }
 
     grid_columns = [
@@ -87,76 +92,114 @@
         'members',
         'users',
     ]
 
     mergeable = True
 
     def __init__(self, request):
-        super(PersonView, self).__init__(request)
+        super().__init__(request)
         app = self.get_rattail_app()
 
         # always get a reference to the People Handler
         self.people_handler = app.get_people_handler()
         self.merge_handler = self.people_handler
         # TODO: deprecate / remove this
         self.handler = self.people_handler
 
     def make_grid_kwargs(self, **kwargs):
-        kwargs = super(PersonView, self).make_grid_kwargs(**kwargs)
+        kwargs = super().make_grid_kwargs(**kwargs)
 
         # turn on checkboxes if user can create a merge reqeust
         if self.mergeable and self.has_perm('request_merge'):
             kwargs['checkboxes'] = True
 
         return kwargs
 
     def configure_grid(self, g):
-        super(PersonView, self).configure_grid(g)
+        super().configure_grid(g)
+        route_prefix = self.get_route_prefix()
+        model = self.model
 
-        g.joiners['email'] = lambda q: q.outerjoin(model.PersonEmailAddress, sa.and_(
-            model.PersonEmailAddress.parent_uuid == model.Person.uuid,
-            model.PersonEmailAddress.preference == 1))
-        g.joiners['phone'] = lambda q: q.outerjoin(model.PersonPhoneNumber, sa.and_(
-            model.PersonPhoneNumber.parent_uuid == model.Person.uuid,
-            model.PersonPhoneNumber.preference == 1))
+        # email
+        g.set_label('email', "Email Address")
+        g.set_joiner('email', lambda q: q.outerjoin(
+            model.PersonEmailAddress,
+            sa.and_(
+                model.PersonEmailAddress.parent_uuid == model.Person.uuid,
+                model.PersonEmailAddress.preference == 1)))
+        g.set_sorter('email', model.PersonEmailAddress.address)
+        g.set_filter('email', model.PersonEmailAddress.address)
 
-        g.filters['email'] = g.make_filter('email', model.PersonEmailAddress.address)
+        # phone
+        g.set_label('phone', "Phone Number")
+        g.set_joiner('phone', lambda q: q.outerjoin(
+            model.PersonPhoneNumber,
+            sa.and_(
+                model.PersonPhoneNumber.parent_uuid == model.Person.uuid,
+                model.PersonPhoneNumber.preference == 1)))
+        g.set_sorter('phone', model.PersonPhoneNumber.number)
         g.set_filter('phone', model.PersonPhoneNumber.number,
                      factory=grids.filters.AlchemyPhoneNumberFilter)
 
-        g.joiners['customer_id'] = lambda q: q.outerjoin(model.CustomerPerson).outerjoin(model.Customer)
-        g.filters['customer_id'] = g.make_filter('customer_id', model.Customer.id)
+        Customer_ID = orm.aliased(model.Customer)
+        CustomerPerson_ID = orm.aliased(model.CustomerPerson)
+
+        Customer_Number = orm.aliased(model.Customer)
+        CustomerPerson_Number = orm.aliased(model.CustomerPerson)
+
+        g.joiners['customer_id'] = lambda q: q.outerjoin(CustomerPerson_ID).outerjoin(Customer_ID)
+        g.filters['customer_id'] = g.make_filter('customer_id', Customer_ID.id)
+
+        g.joiners['customer_number'] = lambda q: q.outerjoin(CustomerPerson_Number).outerjoin(Customer_Number)
+        g.filters['customer_number'] = g.make_filter('customer_number', Customer_Number.number)
 
         g.filters['first_name'].default_active = True
         g.filters['first_name'].default_verb = 'contains'
 
         g.filters['last_name'].default_active = True
         g.filters['last_name'].default_verb = 'contains'
 
         g.set_joiner('employee_status', lambda q: q.outerjoin(model.Employee))
         g.set_filter('employee_status', model.Employee.status,
                      value_enum=self.enum.EMPLOYEE_STATUS)
 
-        g.sorters['email'] = lambda q, d: q.order_by(getattr(model.PersonEmailAddress.address, d)())
-        g.sorters['phone'] = lambda q, d: q.order_by(getattr(model.PersonPhoneNumber.number, d)())
-
         g.set_label('merge_requested', "MR")
         g.set_renderer('merge_requested', self.render_merge_requested)
 
         g.set_sort_defaults('display_name')
 
         g.set_label('display_name', "Full Name")
-        g.set_label('phone', "Phone Number")
-        g.set_label('email', "Email Address")
         g.set_label('customer_id', "Customer ID")
 
+        if (self.has_perm('view_profile')
+            and self.should_link_straight_to_profile()):
+
+            # add View Raw action
+            url = lambda r, i: self.request.route_url(
+                f'{route_prefix}.view', **self.get_action_route_kwargs(r))
+            # nb. insert to slot 1, just after normal View action
+            g.main_actions.insert(1, self.make_action(
+                'view_raw', url=url, icon='eye'))
+
         g.set_link('display_name')
         g.set_link('first_name')
         g.set_link('last_name')
 
+    def default_view_url(self):
+        if (self.has_perm('view_profile')
+            and self.should_link_straight_to_profile()):
+            return lambda p, i: self.get_action_url('view_profile', p)
+
+        return super().default_view_url()
+
+    def should_link_straight_to_profile(self):
+        return self.rattail_config.getbool('rattail',
+                                           'people.straight_to_profile',
+                                           default=False)
+
     def render_merge_requested(self, person, field):
         model = self.model
         merge_request = self.Session.query(model.MergePeopleRequest)\
                                     .filter(sa.or_(
                                         model.MergePeopleRequest.removing_uuid == person.uuid,
                                         model.MergePeopleRequest.keeping_uuid == person.uuid))\
                                     .filter(model.MergePeopleRequest.merged == None)\
@@ -164,14 +207,15 @@
         if merge_request:
             return HTML.tag('span',
                             class_='has-text-danger has-text-weight-bold',
                             title="A merge has been requested for this person.",
                             c="MR")
 
     def get_instance(self):
+        model = self.model
         # TODO: I don't recall why this fallback check for a vendor contact
         # exists here, but leaving it intact for now.
         key = self.request.matchdict['uuid']
         instance = self.Session.get(model.Person, key)
         if instance:
             return instance
         instance = self.Session.get(model.VendorContact, key)
@@ -191,25 +235,35 @@
         return not self.is_person_protected(person)
 
     def deletable_instance(self, person):
         if self.request.is_root:
             return True
         return not self.is_person_protected(person)
 
+    def configure_form(self, f):
+        super().configure_form(f)
+
+        # preferred_first_name
+        if self.people_handler.should_use_preferred_first_name():
+            f.insert_after('first_name', 'preferred_first_name')
+
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
 
         # do normal create/update
-        person = super(PersonView, self).objectify(form, data)
+        person = super().objectify(form, data)
 
         # collect data from all name fields
         names = {}
         if 'first_name' in form:
             names['first'] = data['first_name']
+        if self.people_handler.should_use_preferred_first_name():
+            if 'preferred_first_name' in form:
+                names['preferred_first'] = data['preferred_first_name']
         if 'middle_name' in form:
             names['middle'] = data['middle_name']
         if 'last_name' in form:
             names['last'] = data['last_name']
         if 'display_name' in form and 'display_name' not in form.readonly_fields:
             names['full'] = data['display_name']
 
@@ -237,25 +291,27 @@
         for cp in list(person._customers):
             customer = cp.customer
             session.delete(cp)
             # session.flush()
             customer._people.reorder()
 
         # continue with normal logic
-        super(PersonView, self).delete_instance(person)
+        super().delete_instance(person)
 
     def touch_instance(self, person):
         """
         Supplements the default logic as follows:
 
         In addition to "touching" the person proper, we also "touch" each
         contact info record associated with them.
         """
+        model = self.model
+
         # touch person, as per usual
-        super(PersonView, self).touch_instance(person)
+        super().touch_instance(person)
 
         def touch(obj):
             change = model.Change()
             change.class_name = obj.__class__.__name__
             change.instance_uuid = obj.uuid
             change.deleted = False
             self.Session.add(change)
@@ -269,15 +325,15 @@
             touch(email)
 
         # mailing addresses
         for address in person.addresses:
             touch(address)
 
     def configure_common_form(self, f):
-        super(PersonView, self).configure_common_form(f)
+        super().configure_common_form(f)
         person = f.model_instance
 
         f.set_label('display_name', "Full Name")
 
         # TODO: should remove this?
         f.set_readonly('phone')
         f.set_label('phone', "Phone Number")
@@ -330,27 +386,31 @@
         if not employee:
             return ""
         text = str(employee)
         url = self.request.route_url('employees.view', uuid=employee.uuid)
         return tags.link_to(text, url)
 
     def render_customers(self, person, field):
-        customers = person._customers
+        app = self.get_rattail_app()
+        clientele = app.get_clientele_handler()
+
+        customers = clientele.get_customers_for_account_holder(person)
         if not customers:
-            return ""
+            return
+
         items = []
         for customer in customers:
-            customer = customer.customer
             text = str(customer)
             if customer.number:
                 text = "(#{}) {}".format(customer.number, text)
             elif customer.id:
                 text = "({}) {}".format(customer.id, text)
             url = self.request.route_url('customers.view', uuid=customer.uuid)
             items.append(HTML.tag('li', c=[tags.link_to(text, url)]))
+
         return HTML.tag('ul', c=items)
 
     def render_members(self, person, field):
         members = person.members
         if not members:
             return ""
         items = []
@@ -376,70 +436,125 @@
         elif self.viewing and self.request.has_perm('users.create'):
             return HTML.tag('b-button', type='is-primary', c="Make User",
                             **{'@click': 'clickMakeUser()'})
         else:
             return ""
 
     def get_version_child_classes(self):
+        model = self.model
         return [
             (model.PersonPhoneNumber, 'parent_uuid'),
             (model.PersonEmailAddress, 'parent_uuid'),
             (model.PersonMailingAddress, 'parent_uuid'),
             (model.Employee, 'person_uuid'),
             (model.CustomerPerson, 'person_uuid'),
             (model.VendorContact, 'person_uuid'),
         ]
 
+    def should_expose_quickie_search(self):
+        if self.expose_quickie_search:
+            return True
+        app = self.get_rattail_app()
+        return app.get_people_handler().should_expose_quickie_search()
+
+    def do_quickie_lookup(self, entry):
+        app = self.get_rattail_app()
+        return app.get_people_handler().quickie_lookup(entry, self.Session())
+
+    def get_quickie_placeholder(self):
+        app = self.get_rattail_app()
+        return app.get_people_handler().get_quickie_search_placeholder()
+
+    def get_quickie_result_url(self, person):
+        return self.get_action_url('view_profile', person)
+
     def view_profile(self):
         """
         View which exposes the "full profile" for a given person, i.e. all
         related customer, employee, user info etc.
         """
         self.viewing = True
+        app = self.get_rattail_app()
         person = self.get_instance()
-        employee = person.employee
+
         context = {
             'person': person,
             'instance': person,
             'instance_title': self.get_instance_title(person),
-            'today': localtime(self.rattail_config).date(),
+            'dynamic_content_title': self.get_context_content_title(person),
+            'tabchecks': self.get_context_tabchecks(person),
             'person_data': self.get_context_person(person),
             'phone_type_options': self.get_phone_type_options(),
             'email_type_options': self.get_email_type_options(),
             'max_lengths': self.get_max_lengths(),
-            'customers_data': self.get_context_customers(person),
-            'customer_xref_buttons': self.get_customer_xref_buttons(person),
-            'members_data': self.get_context_members(person),
-            'member_xref_buttons': self.get_member_xref_buttons(person),
-            'employee': employee,
-            'employee_data': self.get_context_employee(employee) if employee else {},
-            'employee_view_url': self.request.route_url('employees.view', uuid=employee.uuid) if employee else None,
-            'employee_history': employee.get_current_history() if employee else None,
-            'employee_history_data': self.get_context_employee_history(employee),
-            'dynamic_content_title': self.get_context_content_title(person),
+            'expose_customer_people': self.customers_should_expose_people(),
+            'expose_customer_shoppers': self.customers_should_expose_shoppers(),
+            'max_one_member': app.get_membership_handler().max_one_per_person(),
+            'use_preferred_first_name': self.people_handler.should_use_preferred_first_name(),
         }
 
-        template = 'view_profile_buefy'
-        return self.render_to_response(template, context)
+        if self.request.has_perm('people_profile.view_versions'):
+            context['revisions_grid'] = self.profile_revisions_grid(person)
+
+        return self.render_to_response('view_profile_buefy', context)
+
+    def get_context_tabchecks(self, person):
+        app = self.get_rattail_app()
+        membership = app.get_membership_handler()
+        clientele = app.get_clientele_handler()
+        tabchecks = {}
+
+        # TODO: for efficiency, should only calculate checks for tabs
+        # actually in use by app..(how) should that be configurable?
+
+        # personal
+        tabchecks['personal'] = True
+
+        # member
+        if membership.max_one_per_person():
+            member = app.get_member(person)
+            tabchecks['member'] = bool(member and member.active)
+        else:
+            members = membership.get_members_for_account_holder(person)
+            tabchecks['member'] = any([m.active for m in members])
+
+        # customer
+        customers = clientele.get_customers_for_account_holder(person)
+        tabchecks['customer'] = bool(customers)
+
+        # shopper
+        # TODO: what a hack! surely some of this belongs in handler
+        shoppers = person.customer_shoppers
+        shoppers = [shopper for shopper in shoppers
+                    if shopper.shopper_number != 1]
+        tabchecks['shopper'] = bool(shoppers)
+
+        # employee
+        employee = app.get_employee(person)
+        tabchecks['employee'] = bool(employee and employee.status == self.enum.EMPLOYEE_STATUS_CURRENT)
 
-    def get_customer_xref_buttons(self, person):
-        buttons = []
-        for supp in self.iter_view_supplements():
-            if hasattr(supp, 'get_customer_xref_buttons'):
-                buttons.extend(supp.get_customer_xref_buttons(person) or [])
-        buttons = self.normalize_xref_buttons(buttons)
-        return buttons
-
-    def get_member_xref_buttons(self, person):
-        buttons = []
-        for supp in self.iter_view_supplements():
-            if hasattr(supp, 'get_member_xref_buttons'):
-                buttons.extend(supp.get_member_xref_buttons(person) or [])
-        buttons = self.normalize_xref_buttons(buttons)
-        return buttons
+        # notes
+        tabchecks['notes'] = bool(person.notes)
+
+        # user
+        tabchecks['user'] = bool(person.users)
+
+        return tabchecks
+
+    def profile_changed_response(self, person):
+        """
+        Return common context result for all AJAX views which may
+        change the profile details.  This is enough to update the
+        page-wide things, and let other tabs know they should be
+        refreshed when next displayed.
+        """
+        return {
+            'person': self.get_context_person(person),
+            'tabchecks': self.get_context_tabchecks(person),
+        }
 
     def template_kwargs_view_profile(self, **kwargs):
         """
         Stub method so subclass can call `super()` for it.
         """
         return kwargs
 
@@ -449,24 +564,27 @@
         It by default invokes :meth:`template_kwargs_view_profile()`
         and returns that result.
         """
         return self.template_kwargs_view_profile(**kwargs)
 
     def get_max_lengths(self):
         model = self.model
-        return {
+        lengths = {
             'person_first_name': maxlen(model.Person.first_name),
             'person_middle_name': maxlen(model.Person.middle_name),
             'person_last_name': maxlen(model.Person.last_name),
             'address_street': maxlen(model.PersonMailingAddress.street),
             'address_street2': maxlen(model.PersonMailingAddress.street2),
             'address_city': maxlen(model.PersonMailingAddress.city),
             'address_state': maxlen(model.PersonMailingAddress.state),
             'address_zipcode': maxlen(model.PersonMailingAddress.zipcode),
         }
+        if self.people_handler.should_use_preferred_first_name():
+            lengths['person_preferred_first_name'] = maxlen(model.Person.preferred_first_name)
+        return lengths
 
     def get_phone_type_options(self):
         """
         Returns a list of "phone type" options, for use in dropdown.
         """
         # TODO: should probably define this list somewhere else
         phone_types = [
@@ -503,19 +621,59 @@
             'view_url': self.get_action_url('view', person),
             'view_profile_url': self.get_action_url('view_profile', person),
             'phones': self.get_context_phones(person),
             'emails': self.get_context_emails(person),
             'dynamic_content_title': self.get_context_content_title(person),
         }
 
+        if self.people_handler.should_use_preferred_first_name():
+            context['preferred_first_name'] = person.preferred_first_name
+
         if person.address:
             context['address'] = self.get_context_address(person.address)
 
         return context
 
+    def get_context_shoppers(self, shoppers):
+        data = []
+        for shopper in shoppers:
+            data.append(self.get_context_shopper(shopper))
+        return data
+
+    def get_context_shopper(self, shopper):
+        app = self.get_rattail_app()
+        customer = shopper.customer
+        person = shopper.person
+        customer_key = self.get_customer_key_field()
+        account_holder = app.get_person(customer)
+        context = {
+            'uuid': shopper.uuid,
+            'customer_uuid': customer.uuid,
+            'customer_key': getattr(customer, customer_key),
+            'customer_name': customer.name,
+            'account_holder_uuid': customer.account_holder_uuid,
+            'person_uuid': person.uuid,
+            'first_name': person.first_name,
+            'middle_name': person.middle_name,
+            'last_name': person.last_name,
+            'display_name': person.display_name,
+            'view_profile_url': self.get_action_url('view_profile', person),
+            'phones': self.get_context_phones(person),
+            'emails': self.get_context_emails(person),
+        }
+
+        if account_holder:
+            context.update({
+                'account_holder_name': account_holder.display_name,
+                'account_holder_view_profile_url': self.get_action_url(
+                    'view_profile', account_holder),
+            })
+
+        return context
+
     def get_context_content_title(self, person):
         return str(person)
 
     def get_context_address(self, address):
         context = {
             'uuid': address.uuid,
             'street': address.street,
@@ -530,67 +688,123 @@
         if isinstance(address, model.PersonMailingAddress):
             person = address.person
             context['invalid'] = self.handler.address_is_invalid(person, address)
 
         return context
 
     def get_context_customers(self, person):
+        app = self.get_rattail_app()
+        clientele = app.get_clientele_handler()
+        expose_shoppers = self.customers_should_expose_shoppers()
+        expose_people = self.customers_should_expose_people()
+
+        customers = clientele.get_customers_for_account_holder(person)
+        key = self.get_customer_key_field()
         data = []
-        for cp in person._customers:
-            customer = cp.customer
-            data.append({
+
+        for customer in customers:
+            context = {
                 'uuid': customer.uuid,
-                'ordinal': cp.ordinal,
+                '_key': getattr(customer, key),
                 'id': customer.id,
                 'number': customer.number,
                 'name': customer.name,
                 'view_url': self.request.route_url('customers.view',
                                                    uuid=customer.uuid),
-                'people': [self.get_context_person(p)
-                           for p in customer.people],
                 'addresses': [self.get_context_address(a)
                               for a in customer.addresses],
-            })
+                'external_links': [],
+            }
+
+            if customer.account_holder:
+                context['account_holder'] = self.get_context_person(
+                    customer.account_holder)
+
+            if expose_shoppers:
+                context['shoppers'] = [self.get_context_shopper(s)
+                                       for s in customer.shoppers]
+
+            if expose_people:
+                context['people'] = [self.get_context_person(p)
+                                     for p in customer.people]
+
+            for supp in self.iter_view_supplements():
+                if hasattr(supp, 'get_context_for_customer'):
+                    context = supp.get_context_for_customer(customer, context)
+
+            data.append(context)
+
         return data
 
+    # TODO: this is duplicated in customers view module
+    def customers_should_expose_shoppers(self):
+        return self.rattail_config.getbool('rattail',
+                                           'customers.expose_shoppers',
+                                           default=True)
+
+    # TODO: this is duplicated in customers view module
+    def customers_should_expose_people(self):
+        return self.rattail_config.getbool('rattail',
+                                           'customers.expose_people',
+                                           default=True)
+
     def get_context_members(self, person):
+        app = self.get_rattail_app()
+        membership = app.get_membership_handler()
+
         data = OrderedDict()
 
-        for member in person.members:
+        members = membership.get_members_for_account_holder(person)
+        for member in members:
             data[member.uuid] = self.get_context_member(member)
 
-        for customer in person.customers:
-            for member in customer.members:
-                if member.uuid not in data:
-                    data[member.uuid] = self.get_context_member(member)
-
         return list(data.values())
 
     def get_context_member(self, member):
+        app = self.get_rattail_app()
+        person = app.get_person(member)
+
         profile_url = None
-        if member.person:
+        if person:
             profile_url = self.request.route_url('people.view_profile',
-                                                 uuid=member.person_uuid)
+                                                 uuid=person.uuid)
 
-        return {
+        key = self.get_member_key_field()
+        equity_total = sum([payment.amount for payment in member.equity_payments])
+        data = {
             'uuid': member.uuid,
+            '_key': getattr(member, key),
             'number': member.number,
             'id': member.id,
             'active': member.active,
             'joined': str(member.joined) if member.joined else None,
             'withdrew': str(member.withdrew) if member.withdrew else None,
             'customer_uuid': member.customer_uuid,
             'customer_name': member.customer.name if member.customer else None,
             'person_uuid': member.person_uuid,
             'display': str(member),
             'person_display_name': member.person.display_name if member.person else None,
             'view_url': self.request.route_url('members.view', uuid=member.uuid),
             'view_profile_url': profile_url,
+            'equity_total_display': app.render_currency(equity_total),
+            'external_links': [],
         }
 
+        membership_type = member.membership_type
+        if membership_type:
+            data.update({
+                'membership_type_uuid': membership_type.uuid,
+                'membership_type_number': membership_type.number,
+                'membership_type_name': membership_type.name,
+                'view_membership_type_url': self.request.route_url(
+                    'membership_types.view', uuid=membership_type.uuid),
+            })
+
+        return data
+
     def get_context_employee(self, employee):
         """
         Return a dict of context data for the given employee.
         """
         app = self.get_rattail_app()
         handler = app.get_employment_handler()
         context = handler.get_context_employee(employee)
@@ -604,42 +818,98 @@
                 data.append({
                     'uuid': history.uuid,
                     'start_date': str(history.start_date),
                     'end_date': str(history.end_date or ''),
                 })
         return data
 
+    def get_context_notes(self, person):
+        data = []
+        notes = sorted(person.notes, key=lambda n: n.created, reverse=True)
+        for note in notes:
+            data.append(self.get_context_note(note))
+        return data
+
+    def get_context_note(self, note):
+        app = self.get_rattail_app()
+        return {
+            'uuid': note.uuid,
+            'note_type': note.type,
+            'note_type_display': self.enum.PERSON_NOTE_TYPE.get(note.type, note.type),
+            'subject': note.subject,
+            'text': note.text,
+            'created_display': raw_datetime(self.rattail_config, note.created),
+            'created_by_display': str(note.created_by),
+        }
+
+    def get_note_type_options(self):
+        return [{'value': k, 'label': v}
+                for k, v in self.enum.PERSON_NOTE_TYPE.items()]
+
+    def get_context_users(self, person):
+        data = []
+        users = person.users
+        for user in users:
+            data.append(self.get_context_user(user))
+        return data
+
+    def get_context_user(self, user):
+        app = self.get_rattail_app()
+        return {
+            'uuid': user.uuid,
+            'username': user.username,
+            'display_name': user.display_name,
+            'email_address': app.get_contact_email_address(user),
+            'active': user.active,
+            'view_url': self.request.route_url('users.view', uuid=user.uuid),
+        }
+
     def ensure_customer(self, person):
         """
         Return the `Customer` record for the given person, establishing it
         first if necessary.
         """
         app = self.get_rattail_app()
         handler = app.get_clientele_handler()
         customer = handler.ensure_customer(person)
         return customer
 
+    def profile_tab_personal(self):
+        """
+        Fetch personal tab data for profile view.
+        """
+        # TODO: no need to return primary person data, since that
+        # always comes back via normal profile_changed_response()
+        # ..so for now this is a no-op..
+
+        # person = self.get_instance()
+        return {
+            # 'person': self.get_context_person(person),
+        }
+
     def profile_edit_name(self):
         """
         View which allows a person's name to be updated.
         """
         person = self.get_instance()
         data = dict(self.request.json_body)
 
-        self.handler.update_names(person,
-                                  first=data['first_name'],
-                                  middle=data['middle_name'],
-                                  last=data['last_name'])
+        kw = {
+            'first': data['first_name'],
+            'middle': data['middle_name'],
+            'last': data['last_name'],
+        }
+
+        if self.people_handler.should_use_preferred_first_name():
+            kw['preferred_first'] = data['preferred_first_name']
+
+        self.handler.update_names(person, **kw)
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-            'dynamic_content_title': self.get_context_content_title(person),
-        }
+        return self.profile_changed_response(person)
 
     def get_context_phones(self, person):
         data = []
         for phone in person.phones:
             data.append({
                 'uuid': phone.uuid,
                 'type': phone.type,
@@ -661,23 +931,21 @@
                                            type=data['phone_type'],
                                            preferred=data['phone_preferred'])
         except Exception as error:
             log.warning("failed to add phone", exc_info=True)
             return {'error': simple_error(error)}
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_update_phone(self):
         """
         View which updates a phone number for the person.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         phone = self.Session.get(model.PersonPhoneNumber, data['phone_uuid'])
         if not phone:
             return {'error': "Phone not found."}
 
@@ -691,64 +959,57 @@
         try:
             phone = self.handler.update_phone(person, phone, **kwargs)
         except Exception as error:
             log.warning("failed to update phone", exc_info=True)
             return {'error': simple_error(error)}
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_delete_phone(self):
         """
         View which allows a person's phone number to be deleted.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         # validate phone
         phone = self.Session.get(model.PersonPhoneNumber, data['phone_uuid'])
         if not phone:
             return {'error': "Phone not found."}
         if phone not in person.phones:
             return {'error': "Phone does not belong to this person."}
 
         # remove phone
         person.remove_phone(phone)
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_set_preferred_phone(self):
         """
         View which allows a person's "preferred" phone to be set.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         # validate phone
         phone = self.Session.get(model.PersonPhoneNumber, data['phone_uuid'])
         if not phone:
             return {'error': "Phone not found."}
         if phone not in person.phones:
             return {'error': "Phone does not belong to this person."}
 
         # update phone preference
         person.set_primary_phone(phone)
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def get_context_emails(self, person):
         data = []
         for email in person.emails:
             data.append({
                 'uuid': email.uuid,
                 'type': email.type,
@@ -776,23 +1037,21 @@
         try:
             email = self.handler.add_email(person, data['email_address'], **kwargs)
         except Exception as error:
             log.warning("failed to add email", exc_info=True)
             return {'error': simple_error(error)}
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_update_email(self):
         """
         View which updates an email address for the person.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         email = self.Session.get(model.PersonEmailAddress, data['email_uuid'])
         if not email:
             return {'error': "Email not found."}
 
@@ -802,81 +1061,130 @@
                                               type=data['email_type'],
                                               invalid=data['email_invalid'])
         except Exception as error:
             log.warning("failed to add email", exc_info=True)
             return {'error': simple_error(error)}
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_delete_email(self):
         """
         View which allows a person's email address to be deleted.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         # validate email
         email = self.Session.get(model.PersonEmailAddress, data['email_uuid'])
         if not email:
             return {'error': "Email not found."}
         if email not in person.emails:
             return {'error': "Email does not belong to this person."}
 
         # remove email
         person.remove_email(email)
 
         self.Session.flush()
-
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_set_preferred_email(self):
         """
         View which allows a person's "preferred" email to be set.
         """
+        model = self.model
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         # validate email
         email = self.Session.get(model.PersonEmailAddress, data['email_uuid'])
         if not email:
             return {'error': "Email not found."}
         if email not in person.emails:
             return {'error': "Email does not belong to this person."}
 
         # update email preference
         person.set_primary_email(email)
 
         self.Session.flush()
-        return {
-            'success': True,
-            'person': self.get_context_person(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_edit_address(self):
         """
         View which allows a person's mailing address to be updated.
         """
         person = self.get_instance()
         data = dict(self.request.json_body)
 
         # update person address
         address = self.people_handler.ensure_address(person)
         self.people_handler.update_address(person, address, **data)
 
         self.Session.flush()
+        return self.profile_changed_response(person)
+
+    def profile_tab_member(self):
+        """
+        Fetch member tab data for profile view.
+        """
+        app = self.get_rattail_app()
+        membership = app.get_membership_handler()
+        person = self.get_instance()
+
+        max_one_member = membership.max_one_per_person()
+
+        context = {
+            'max_one_member': max_one_member,
+        }
+
+        if max_one_member:
+            member = app.get_member(person)
+            context['member'] = {'exists': bool(member)}
+            if member:
+                context['member'].update(self.get_context_member(member))
+        else:
+            context['members'] = self.get_context_members(person)
+
+        return context
+
+    def profile_tab_customer(self):
+        """
+        Fetch customer tab data for profile view.
+        """
+        person = self.get_instance()
         return {
-            'success': True,
-            'person': self.get_context_person(person),
+            'customers': self.get_context_customers(person),
+        }
+
+    def profile_tab_shopper(self):
+        """
+        Fetch shopper tab data for profile view.
+        """
+        person = self.get_instance()
+
+        # TODO: what a hack! surely some of this belongs in handler
+        shoppers = person.customer_shoppers
+        shoppers = [shopper for shopper in shoppers
+                    if shopper.shopper_number != 1]
+
+        return {
+            'shoppers': self.get_context_shoppers(shoppers),
+        }
+
+    def profile_tab_employee(self):
+        """
+        Fetch employee tab data for profile view.
+        """
+        app = self.get_rattail_app()
+        person = self.get_instance()
+        employee = app.get_employee(person)
+        return {
+            'employee': self.get_context_employee(employee) if employee else {},
+            'employee_history': self.get_context_employee_history(employee),
         }
 
     def profile_start_employee(self):
         """
         View which will cause the person to start being an employee.
         """
         person = self.get_instance()
@@ -888,26 +1196,15 @@
             return {'error': reason}
 
         data = self.request.json_body
         start_date = datetime.datetime.strptime(data['start_date'], '%Y-%m-%d').date()
         employee = handler.begin_employment(person, start_date,
                                             employee_id=data['id'])
         self.Session.flush()
-        return self.profile_start_employee_result(employee, start_date)
-
-    def profile_start_employee_result(self, employee, start_date):
-        person = employee.person
-        return {
-            'success': True,
-            'employee': self.get_context_employee(employee),
-            'employee_view_url': self.request.route_url('employees.view', uuid=employee.uuid),
-            'start_date': str(start_date),
-            'employee_history_data': self.get_context_employee_history(employee),
-            'dynamic_content_title': self.get_context_content_title(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_end_employee(self):
         """
         View which will cause the person to stop being an employee.
         """
         person = self.get_instance()
         app = self.get_rattail_app()
@@ -919,31 +1216,21 @@
 
         data = dict(self.request.json_body)
         end_date = datetime.datetime.strptime(data['end_date'], '%Y-%m-%d').date()
         employee = handler.get_employee(person)
         handler.end_employment(employee, end_date,
                                revoke_access=data.get('revoke_access'))
         self.Session.flush()
-        return self.profile_end_employee_result(employee, end_date)
-
-    def profile_end_employee_result(self, employee, end_date):
-        person = employee.person
-        return {
-            'success': True,
-            'employee': self.get_context_employee(employee),
-            'employee_view_url': self.request.route_url('employees.view', uuid=employee.uuid),
-            'end_date': str(end_date),
-            'employee_history_data': self.get_context_employee_history(employee),
-            'dynamic_content_title': self.get_context_content_title(person),
-        }
+        return self.profile_changed_response(person)
 
     def profile_edit_employee_history(self):
         """
         AJAX view for updating an employee history record.
         """
+        model = self.model
         person = self.get_instance()
         employee = person.employee
 
         uuid = self.request.json_body['uuid']
         history = self.Session.get(model.EmployeeHistory, uuid)
         if not history or history not in employee.history:
             return {'error': "Must specify a valid Employee History record for this Person."}
@@ -956,118 +1243,304 @@
         # only update end_date if history already had one
         if history.end_date:
             end_date = self.request.json_body['end_date']
             end_date = datetime.datetime.strptime(end_date, '%Y-%m-%d').date()
             history.end_date = end_date
 
         self.Session.flush()
-        current_history = employee.get_current_history()
-        return {
-            'success': True,
-            'employee': self.get_context_employee(employee),
-            'start_date': str(current_history.start_date),
-            'end_date': str(current_history.end_date or ''),
-            'employee_history_data': self.get_context_employee_history(employee),
-        }
+        return self.profile_changed_response(person)
 
     def profile_update_employee_id(self):
         """
         View to update an employee's ID value.
         """
         app = self.get_rattail_app()
         employment = app.get_employment_handler()
 
         person = self.get_instance()
         employee = employment.get_employee(person)
 
         data = self.request.json_body
         employee.id = data['employee_id']
+
         self.Session.flush()
+        return self.profile_changed_response(person)
+
+    def profile_tab_notes(self):
+        """
+        Fetch notes tab data for profile view.
+        """
+        person = self.get_instance()
+        return {
+            'notes': self.get_context_notes(person),
+            'note_types': self.get_note_type_options(),
+        }
 
+    def profile_tab_user(self):
+        """
+        Fetch user tab data for profile view.
+        """
+        person = self.get_instance()
         return {
-            'success': True,
-            'employee': self.get_context_employee(employee),
+            'users': self.get_context_users(person),
         }
 
+    def profile_revisions_grid(self, person):
+        route_prefix = self.get_route_prefix()
+        factory = self.get_grid_factory()
+        g = factory(
+            '{}.profile.revisions'.format(route_prefix),
+            [],                 # start with empty data!
+            request=self.request,
+            columns=[
+                'changed',
+                'changed_by',
+                'remote_addr',
+                'comment',
+            ],
+            labels={
+                'remote_addr': "IP Address",
+            },
+            linked_columns=[
+                'changed',
+                'changed_by',
+                'comment',
+            ],
+            main_actions=[
+                self.make_action('view', icon='eye', url='#',
+                                 click_handler='viewRevision(props.row)'),
+            ],
+        )
+        return g
+
+    def profile_revisions_collect(self, person, versions=None):
+        model = self.model
+        versions = versions or []
+
+        # Person
+        cls = continuum.version_class(model.Person)
+        query = self.Session.query(cls)\
+                            .filter(cls.uuid == person.uuid)
+        versions.extend(query.all())
+
+        # User
+        cls = continuum.version_class(model.User)
+        query = self.Session.query(cls)\
+                            .filter(cls.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # Member
+        cls = continuum.version_class(model.Member)
+        query = self.Session.query(cls)\
+                            .filter(cls.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # Employee
+        cls = continuum.version_class(model.Employee)
+        query = self.Session.query(cls)\
+                            .filter(cls.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # EmployeeHistory
+        cls = continuum.version_class(model.EmployeeHistory)
+        query = self.Session.query(cls)\
+                            .join(model.Employee,
+                                  model.Employee.uuid == cls.employee_uuid)\
+                            .filter(model.Employee.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # PersonPhoneNumber
+        cls = continuum.version_class(model.PersonPhoneNumber)
+        query = self.Session.query(cls)\
+                            .filter(cls.parent_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # PersonEmailAddress
+        cls = continuum.version_class(model.PersonEmailAddress)
+        query = self.Session.query(cls)\
+                            .filter(cls.parent_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # PersonMailingAddress
+        cls = continuum.version_class(model.PersonMailingAddress)
+        query = self.Session.query(cls)\
+                            .filter(cls.parent_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # Customer (account_holder)
+        cls = continuum.version_class(model.Customer)
+        query = self.Session.query(cls)\
+                            .filter(cls.account_holder_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # CustomerShopper (from Customer perspective)
+        cls = continuum.version_class(model.CustomerShopper)
+        query = self.Session.query(cls)\
+                            .join(model.Customer, model.Customer.uuid == cls.customer_uuid)\
+                            .filter(model.Customer.account_holder_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # CustomerShopperHistory (from Customer perspective)
+        cls = continuum.version_class(model.CustomerShopperHistory)
+        standin = continuum.version_class(model.CustomerShopper)
+        query = self.Session.query(cls)\
+                            .join(standin, standin.uuid == cls.shopper_uuid)\
+                            .join(model.Customer, model.Customer.uuid == standin.customer_uuid)\
+                            .filter(model.Customer.account_holder_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # CustomerShopper (from Shopper perspective)
+        cls = continuum.version_class(model.CustomerShopper)
+        query = self.Session.query(cls)\
+                            .filter(cls.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # CustomerShopperHistory (from Shopper perspective)
+        cls = continuum.version_class(model.CustomerShopperHistory)
+        standin = continuum.version_class(model.CustomerShopper)
+        query = self.Session.query(cls)\
+                            .join(standin, standin.uuid == cls.shopper_uuid)\
+                            .filter(standin.person_uuid == person.uuid)
+        versions.extend(query.all())
+
+        # PersonNote
+        cls = continuum.version_class(model.PersonNote)
+        query = self.Session.query(cls)\
+                            .filter(cls.parent_uuid == person.uuid)
+        versions.extend(query.all())
+
+        return versions
+
+    def profile_revisions_data(self):
+        """
+        View which locates and organizes all relevant "transaction"
+        (version) history data for a given Person.  Returns JSON, for
+        use with the Buefy table element on the full profile view.
+        """
+        person = self.get_instance()
+        versions = self.profile_revisions_collect(person)
+
+        # organize final table data
+        data = []
+        all_txns = set([v.transaction for v in versions])
+        for i, txn in enumerate(
+                sorted(all_txns, key=lambda txn: txn.issued_at, reverse=True),
+                1):
+            data.append({
+                'txnid': txn.id,
+                'changed': raw_datetime(self.rattail_config, txn.issued_at),
+                'changed_by': str(txn.user or '') or None,
+                'remote_addr': txn.remote_addr,
+                'comment': txn.meta.get('comment'),
+            })
+            # also stash the sequential index for this transaction, for use later
+            txn._sequential_index = i
+
+        # also organize final transaction/versions (diff) map
+        vmap = {}
+        for version in versions:
+            fields = self.fields_for_version(version)
+
+            old_data = {}
+            new_data = {}
+            for field in fields:
+                if version.previous:
+                    old_data[field] = getattr(version.previous, field)
+                new_data[field] = getattr(version, field)
+            diff = self.make_version_diff(version, old_data, new_data, fields=fields)
+
+            if version.transaction_id not in vmap:
+                txn = version.transaction
+                prev_txnid = None
+                next_txnid = None
+                if txn._sequential_index < len(data):
+                    prev_txnid = data[txn._sequential_index]['txnid']
+                if txn._sequential_index > 1:
+                    next_txnid = data[txn._sequential_index - 2]['txnid']
+                vmap[txn.id] = {
+                    'index': txn._sequential_index,
+                    'txnid': txn.id,
+                    'prev_txnid': prev_txnid,
+                    'next_txnid': next_txnid,
+                    'changed': raw_datetime(self.rattail_config, txn.issued_at,
+                                            verbose=True),
+                    'changed_by': str(txn.user or '') or None,
+                    'remote_addr': txn.remote_addr,
+                    'comment': txn.meta.get('comment'),
+                    'versions': [],
+                }
+
+            vmap[version.transaction_id]['versions'].append(diff.as_struct())
+
+        return {'data': data, 'vmap': vmap}
+
     def make_note_form(self, mode, person):
         schema = NoteSchema().bind(session=self.Session(),
                                    person_uuid=person.uuid)
         if mode == 'create':
             del schema['uuid']
         form = forms.Form(schema=schema, request=self.request)
+        if mode != 'delete':
+            form.set_validator('note_type', colander.OneOf(self.enum.PERSON_NOTE_TYPE))
         return form
 
     def profile_add_note(self):
         person = self.get_instance()
         form = self.make_note_form('create', person)
-        if form.validate(newstyle=True):
-            note = self.create_note(person, form)
-            self.Session.flush()
-            return self.profile_add_note_success(note)
-        else:
-            return self.profile_add_note_failure(person, form)
+        if not form.validate():
+            return {'error': str(form.make_deform_form().error)}
+
+        note = self.create_note(person, form)
+        self.Session.flush()
+        return self.profile_changed_response(person)
 
     def create_note(self, person, form):
+        model = self.model
         note = model.PersonNote()
         note.type = form.validated['note_type']
         note.subject = form.validated['note_subject']
         note.text = form.validated['note_text']
         note.created_by = self.request.user
         person.notes.append(note)
         return note
 
-    def profile_add_note_success(self, note):
-        return self.redirect(self.get_action_url('view_profile', person))
-
-    def profile_add_note_failure(self, person, form):
-        return self.redirect(self.get_action_url('view_profile', person))
-
     def profile_edit_note(self):
         person = self.get_instance()
         form = self.make_note_form('edit', person)
-        if form.validate(newstyle=True):
-            note = self.update_note(person, form)
-            self.Session.flush()
-            return self.profile_edit_note_success(note)
-        else:
-            return self.profile_edit_note_failure(person, form)
+        if not form.validate():
+            return {'error': str(form.make_deform_form().error)}
+
+        note = self.update_note(person, form)
+        self.Session.flush()
+        return self.profile_changed_response(person)
 
     def update_note(self, person, form):
+        model = self.model
         note = self.Session.get(model.PersonNote, form.validated['uuid'])
         note.subject = form.validated['note_subject']
         note.text = form.validated['note_text']
         return note
 
-    def profile_edit_note_success(self, note):
-        return self.redirect(self.get_action_url('view_profile', person))
-
-    def profile_edit_note_failure(self, person, form):
-        return self.redirect(self.get_action_url('view_profile', person))
-
     def profile_delete_note(self):
         person = self.get_instance()
         form = self.make_note_form('delete', person)
-        if form.validate(newstyle=True):
-            self.delete_note(person, form)
-            self.Session.flush()
-            return self.profile_delete_note_success(person)
-        else:
-            return self.profile_delete_note_failure(person, form)
+        if not form.validate():
+            return {'error': str(form.make_deform_form().error)}
+
+        self.delete_note(person, form)
+        self.Session.flush()
+        return self.profile_changed_response(person)
 
     def delete_note(self, person, form):
+        model = self.model
         note = self.Session.get(model.PersonNote, form.validated['uuid'])
         self.Session.delete(note)
 
-    def profile_delete_note_success(self, person):
-        return self.redirect(self.get_action_url('view_profile', person))
-
-    def profile_delete_note_failure(self, person, form):
-        return self.redirect(self.get_action_url('view_profile', person))
-
     def make_user(self):
+        model = self.model
         uuid = self.request.POST['person_uuid']
         person = self.Session.get(model.Person, uuid)
         if not person:
             return self.notfound()
         if person.users:
             raise RuntimeError("person {} already has {} user accounts: ".format(
                 person.uuid, len(person.users), person))
@@ -1085,14 +1558,29 @@
         Create a new merge request for the given 2 people.
         """
         self.handler.request_merge(self.request.user,
                                    self.request.POST['removing_uuid'],
                                    self.request.POST['keeping_uuid'])
         return self.redirect(self.get_index_url())
 
+    def configure_get_simple_settings(self):
+        return [
+
+            # General
+            {'section': 'rattail',
+             'option': 'people.straight_to_profile',
+             'type': bool},
+            {'section': 'rattail',
+             'option': 'people.expose_quickie_search',
+             'type': bool},
+            {'section': 'rattail',
+             'option': 'people.handler'},
+
+        ]
+
     @classmethod
     def defaults(cls, config):
         cls._people_defaults(config)
         cls._defaults(config)
 
     @classmethod
     def _people_defaults(cls, config):
@@ -1116,14 +1604,22 @@
         config.add_tailbone_permission(permission_prefix, '{}.view_profile'.format(permission_prefix),
                                        "View full \"profile\" for {}".format(model_title))
         config.add_route('{}.view_profile'.format(route_prefix), '{}/{{{}}}/profile'.format(url_prefix, model_key),
                          request_method='GET')
         config.add_view(cls, attr='view_profile', route_name='{}.view_profile'.format(route_prefix),
                         permission='{}.view_profile'.format(permission_prefix))
 
+        # profile - refresh personal tab
+        config.add_route(f'{route_prefix}.profile_tab_personal',
+                         f'{instance_url_prefix}/profile/tab-personal',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_personal',
+                        route_name=f'{route_prefix}.profile_tab_personal',
+                        renderer='json')
+
         # profile - edit personal details
         config.add_tailbone_permission('people_profile',
                                        'people_profile.edit_person',
                                        "Edit the Personal details")
 
         # profile - edit name
         config.add_route('{}.profile_edit_name'.format(route_prefix),
@@ -1211,14 +1707,46 @@
                          '{}/profile/edit-address'.format(instance_url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='profile_edit_address',
                         route_name='{}.profile_edit_address'.format(route_prefix),
                         renderer='json',
                         permission='people_profile.edit_person')
 
+        # profile - refresh member tab
+        config.add_route(f'{route_prefix}.profile_tab_member',
+                         f'{instance_url_prefix}/profile/tab-member',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_member',
+                        route_name=f'{route_prefix}.profile_tab_member',
+                        renderer='json')
+
+        # profile - refresh customer tab
+        config.add_route(f'{route_prefix}.profile_tab_customer',
+                         f'{instance_url_prefix}/profile/tab-customer',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_customer',
+                        route_name=f'{route_prefix}.profile_tab_customer',
+                        renderer='json')
+
+        # profile - refresh shopper tab
+        config.add_route(f'{route_prefix}.profile_tab_shopper',
+                         f'{instance_url_prefix}/profile/tab-shopper',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_shopper',
+                        route_name=f'{route_prefix}.profile_tab_shopper',
+                        renderer='json')
+
+        # profile - refresh employee tab
+        config.add_route(f'{route_prefix}.profile_tab_employee',
+                         f'{instance_url_prefix}/profile/tab-employee',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_employee',
+                        route_name=f'{route_prefix}.profile_tab_employee',
+                        renderer='json')
+
         # profile - start employee
         config.add_route('{}.profile_start_employee'.format(route_prefix), '{}/profile/start-employee'.format(instance_url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='profile_start_employee', route_name='{}.profile_start_employee'.format(route_prefix),
                         permission='people_profile.toggle_employee', renderer='json')
 
         # profile - end employee
@@ -1238,40 +1766,77 @@
                          '{}/profile/update-employee-id'.format(instance_url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='profile_update_employee_id',
                         route_name='{}.profile_update_employee_id'.format(route_prefix),
                         renderer='json',
                         permission='employees.edit')
 
-        # manage notes from profile view
-        if cls.manage_notes_from_profile_view:
+        # profile - refresh notes tab
+        config.add_route(f'{route_prefix}.profile_tab_notes',
+                         f'{instance_url_prefix}/profile/tab-notes',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_notes',
+                        route_name=f'{route_prefix}.profile_tab_notes',
+                        renderer='json')
+
+        # profile - refresh user tab
+        config.add_route(f'{route_prefix}.profile_tab_user',
+                         f'{instance_url_prefix}/profile/tab-user',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_tab_user',
+                        route_name=f'{route_prefix}.profile_tab_user',
+                        renderer='json')
+
+        # profile - revisions data
+        config.add_tailbone_permission('people_profile',
+                                       'people_profile.view_versions',
+                                       "View full version history for a profile")
+        config.add_route(f'{route_prefix}.view_profile_revisions',
+                         f'{instance_url_prefix}/profile/revisions',
+                         request_method='GET')
+        config.add_view(cls, attr='profile_revisions_data',
+                        route_name=f'{route_prefix}.view_profile_revisions',
+                        permission='people_profile.view_versions',
+                        renderer='json')
 
-            # add note
-            config.add_tailbone_permission('people_profile', 'people_profile.add_note',
-                                           "Add new {} Note records".format(model_title))
-            config.add_route('{}.profile_add_note'.format(route_prefix), '{}/{{{}}}/profile/new-note'.format(url_prefix, model_key),
-                             request_method='POST')
-            config.add_view(cls, attr='profile_add_note', route_name='{}.profile_add_note'.format(route_prefix),
-                            permission='people_profile.add_note')
+        # profile - add note
+        config.add_tailbone_permission('people_profile',
+                                       'people_profile.add_note',
+                                       "Add new Note records")
+        config.add_route(f'{route_prefix}.profile_add_note',
+                         f'{instance_url_prefix}/profile/new-note',
+                         request_method='POST')
+        config.add_view(cls, attr='profile_add_note',
+                        route_name=f'{route_prefix}.profile_add_note',
+                        permission='people_profile.add_note',
+                        renderer='json')
 
-            # edit note
-            config.add_tailbone_permission('people_profile', 'people_profile.edit_note',
-                                           "Edit {} Note records".format(model_title))
-            config.add_route('{}.profile_edit_note'.format(route_prefix), '{}/{{{}}}/profile/edit-note'.format(url_prefix, model_key),
-                             request_method='POST')
-            config.add_view(cls, attr='profile_edit_note', route_name='{}.profile_edit_note'.format(route_prefix),
-                            permission='people_profile.edit_note')
+        # profile - edit note
+        config.add_tailbone_permission('people_profile',
+                                       'people_profile.edit_note',
+                                       "Edit Note records")
+        config.add_route(f'{route_prefix}.profile_edit_note',
+                         f'{instance_url_prefix}/profile/edit-note',
+                         request_method='POST')
+        config.add_view(cls, attr='profile_edit_note',
+                        route_name=f'{route_prefix}.profile_edit_note',
+                        permission='people_profile.edit_note',
+                        renderer='json')
 
-            # delete note
-            config.add_tailbone_permission('people_profile', 'people_profile.delete_note',
-                                           "Delete {} Note records".format(model_title))
-            config.add_route('{}.profile_delete_note'.format(route_prefix), '{}/{{{}}}/profile/delete-note'.format(url_prefix, model_key),
-                             request_method='POST')
-            config.add_view(cls, attr='profile_delete_note', route_name='{}.profile_delete_note'.format(route_prefix),
-                            permission='people_profile.delete_note')
+        # profile - delete note
+        config.add_tailbone_permission('people_profile',
+                                       'people_profile.delete_note',
+                                       "Delete Note records")
+        config.add_route(f'{route_prefix}.profile_delete_note',
+                         f'{instance_url_prefix}/profile/delete-note',
+                         request_method='POST')
+        config.add_view(cls, attr='profile_delete_note',
+                        route_name=f'{route_prefix}.profile_delete_note',
+                        permission='people_profile.delete_note',
+                        renderer='json')
 
         # make user for person
         config.add_route('{}.make_user'.format(route_prefix), '{}/make-user'.format(url_prefix),
                          request_method='POST')
         config.add_view(cls, attr='make_user', route_name='{}.make_user'.format(route_prefix),
                         permission='users.create')
 
@@ -1285,15 +1850,15 @@
                             permission='{}.request_merge'.format(permission_prefix))
 
 
 class PersonNoteView(MasterView):
     """
     Master view for the PersonNote class.
     """
-    model_class = model.PersonNote
+    model_class = PersonNote
     route_prefix = 'person_notes'
     url_prefix = '/people/notes'
     has_versions = True
 
     grid_columns = [
         'person',
         'type',
@@ -1311,15 +1876,16 @@
         'created_by',
     ]
 
     def get_instance_title(self, note):
         return note.subject or "(no subject)"
 
     def configure_grid(self, g):
-        super(PersonNoteView, self).configure_grid(g)
+        super().configure_grid(g)
+        model = self.model
 
         # person
         g.set_joiner('person', lambda q: q.join(model.Person,
                                                 model.Person.uuid == model.PersonNote.parent_uuid))
         g.set_sorter('person', model.Person.display_name)
         g.set_filter('person', model.Person.display_name, label="Person Name")
 
@@ -1332,15 +1898,15 @@
         g.set_sort_defaults('created', 'desc')
 
         g.set_link('person')
         g.set_link('subject')
         g.set_link('created')
 
     def configure_form(self, f):
-        super(PersonNoteView, self).configure_form(f)
+        super().configure_form(f)
 
         # person
         f.set_readonly('person')
         f.set_renderer('person', self.render_person)
 
         # created
         f.set_readonly('created')
@@ -1351,15 +1917,15 @@
 
 
 @colander.deferred
 def valid_note_uuid(node, kw):
     session = kw['session']
     person_uuid = kw['person_uuid']
     def validate(node, value):
-        note = session.get(model.PersonNote, value)
+        note = session.get(PersonNote, value)
         if not note:
             raise colander.Invalid(node, "Note not found")
         if note.person.uuid != person_uuid:
             raise colander.Invalid(node, "Note is for the wrong person")
         return note.uuid
     return validate
 
@@ -1376,15 +1942,15 @@
     note_text = colander.SchemaNode(colander.String(), missing='')
 
 
 class MergePeopleRequestView(MasterView):
     """
     Master view for the MergePeopleRequest class.
     """
-    model_class = model.MergePeopleRequest
+    model_class = MergePeopleRequest
     route_prefix = 'people_merge_requests'
     url_prefix = '/people/merge-requests'
     creatable = False
     editable = False
 
     labels = {
         'removing_uuid': "Removing",
@@ -1406,51 +1972,53 @@
         'requested',
         'requested_by',
         'merged',
         'merged_by',
     ]
 
     def configure_grid(self, g):
-        super(MergePeopleRequestView, self).configure_grid(g)
+        super().configure_grid(g)
 
         g.set_renderer('removing_uuid', self.render_referenced_person_name)
         g.set_renderer('keeping_uuid', self.render_referenced_person_name)
 
         g.filters['merged'].default_active = True
         g.filters['merged'].default_verb = 'is_null'
 
         g.set_sort_defaults('requested', 'desc')
 
         g.set_link('removing_uuid')
         g.set_link('keeping_uuid')
 
     def render_referenced_person_name(self, merge_request, field):
+        model = self.model
         uuid = getattr(merge_request, field)
-        person = self.Session.get(self.model.Person, uuid)
+        person = self.Session.get(model.Person, uuid)
         if person:
             return str(person)
         return "(person not found)"
 
     def get_instance_title(self, merge_request):
         model = self.model
         removing = self.Session.get(model.Person, merge_request.removing_uuid)
         keeping = self.Session.get(model.Person, merge_request.keeping_uuid)
         return "{} -> {}".format(
             removing or "(not found)",
             keeping or "(not found)")
 
     def configure_form(self, f):
-        super(MergePeopleRequestView, self).configure_form(f)
+        super().configure_form(f)
 
         f.set_renderer('removing_uuid', self.render_referenced_person)
         f.set_renderer('keeping_uuid', self.render_referenced_person)
 
     def render_referenced_person(self, merge_request, field):
+        model = self.model
         uuid = getattr(merge_request, field)
-        person = self.Session.get(self.model.Person, uuid)
+        person = self.Session.get(model.Person, uuid)
         if person:
             text = str(person)
             url = self.request.route_url('people.view', uuid=person.uuid)
             return tags.link_to(text, url)
         return "(person not found)"
```

### Comparing `Tailbone-0.9.9/tailbone/views/roles.py` & `Tailbone-0.9.90/tailbone/views/roles.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/users.py` & `Tailbone-0.9.90/tailbone/views/users.py`

 * *Files 12% similar despite different names*

```diff
@@ -34,27 +34,32 @@
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import HTML, tags
 
 from tailbone import forms
 from tailbone.views import MasterView, View
 from tailbone.views.principal import PrincipalMasterView, PermissionsRenderer
+from tailbone.util import raw_datetime
 
 
 class UserView(PrincipalMasterView):
     """
     Master view for the User model.
     """
     model_class = User
     has_rows = True
     model_row_class = UserEvent
     has_versions = True
     touchable = True
     mergeable = True
 
+    labels = {
+        'api_tokens': "API Tokens",
+    }
+
     grid_columns = [
         'username',
         'person',
         'active',
         'local_only',
     ]
 
@@ -63,14 +68,16 @@
         'person',
         'first_name_',
         'last_name_',
         'display_name_',
         'active',
         'active_sticky',
         'set_password',
+        'prevent_password_change',
+        'api_tokens',
         'roles',
         'permissions',
     ]
 
     row_grid_columns = [
         'type_code',
         'occurred',
@@ -206,18 +213,32 @@
         elif not self.creating:
             # must provide custom renderer as well
             f.set_renderer('first_name_', self.render_person_name)
             f.set_renderer('last_name_', self.render_person_name)
             f.set_renderer('display_name_', self.render_person_name)
 
         # set_password
-        f.set_widget('set_password', dfwidget.CheckedPasswordWidget())
+        if self.editing and user.prevent_password_change and not self.request.is_root:
+            f.remove('set_password')
+        else:
+            f.set_widget('set_password', dfwidget.CheckedPasswordWidget())
         # if self.creating:
         #     f.set_required('password')
 
+        # api_tokens
+        if self.creating or self.editing:
+            f.remove('api_tokens')
+        elif self.has_perm('manage_api_tokens'):
+            f.set_renderer('api_tokens', self.render_api_tokens)
+            f.set_vuejs_component_kwargs(**{':apiTokens': 'apiTokens',
+                                            '@api-new-token': 'apiNewToken',
+                                            '@api-token-delete': 'apiTokenDelete'})
+        else:
+            f.remove('api_tokens')
+
         # roles
         f.set_renderer('roles', self.render_roles)
         if self.creating or self.editing:
             if not self.has_perm('edit_roles'):
                 f.remove_field('roles')
             else:
                 roles = self.get_possible_roles().all()
@@ -252,14 +273,83 @@
                                                               include_authenticated=True))
         else:
             f.remove('permissions')
 
         if self.viewing or self.deleting:
             f.remove('set_password')
 
+    def render_api_tokens(self, user, field):
+        route_prefix = self.get_route_prefix()
+        permission_prefix = self.get_permission_prefix()
+
+        factory = self.get_grid_factory()
+        g = factory(
+            key='{}.api_tokens'.format(route_prefix),
+            data=[],
+            columns=['description', 'created'],
+            main_actions=[
+                self.make_action('delete', icon='trash',
+                                 click_handler="$emit('api-token-delete', props.row)")])
+
+        button = self.make_buefy_button("New", is_primary=True,
+                                        icon_left='plus',
+                                        **{'@click': "$emit('api-new-token')"})
+
+        table = HTML.literal(
+            g.render_buefy_table_element(data_prop='apiTokens'))
+
+        return HTML.tag('div', c=[button, table])
+
+    def add_api_token(self):
+        user = self.get_instance()
+        data = self.request.json_body
+
+        token = self.auth_handler.add_api_token(user, data['description'])
+        self.Session.flush()
+
+        return {'ok': True,
+                'raw_token': token.token_string,
+                'tokens': self.get_api_tokens(user)}
+
+    def delete_api_token(self):
+        model = self.model
+        user = self.get_instance()
+        data = self.request.json_body
+
+        token = self.Session.get(model.UserAPIToken, data['uuid'])
+        if not token:
+            return {'error': "API token not found"}
+
+        if token.user is not user:
+            return {'error': "API token not found"}
+
+        self.auth_handler.delete_api_token(token)
+        self.Session.flush()
+
+        return {'ok': True,
+                'tokens': self.get_api_tokens(user)}
+
+    def template_kwargs_view(self, **kwargs):
+        kwargs = super(UserView, self).template_kwargs_view(**kwargs)
+        user = kwargs['instance']
+
+        kwargs['api_tokens_data'] = self.get_api_tokens(user)
+
+        return kwargs
+
+    def get_api_tokens(self, user):
+        tokens = []
+        for token in reversed(user.api_tokens):
+            tokens.append({
+                'uuid': token.uuid,
+                'description': token.description,
+                'created': raw_datetime(self.rattail_config, token.created),
+            })
+        return tokens
+
     def get_possible_roles(self):
         model = self.model
 
         # some roles should never have users "belong" to them
         excluded = [
             guest_role(self.Session()).uuid,
             authenticated_role(self.Session()).uuid,
@@ -312,15 +402,15 @@
 
         # force "local only" flag unless global access granted
         if self.secure_global_objects:
             if not self.has_perm('view_global'):
                 user.person.local_only = True
 
         # maybe set user password
-        if data['set_password']:
+        if 'set_password' in form and data['set_password']:
             set_user_password(user, data['set_password'])
 
         # update roles for user
         self.update_roles(user, data)
 
         return user
 
@@ -546,14 +636,33 @@
 
         # view/edit roles
         config.add_tailbone_permission(permission_prefix, '{}.view_roles'.format(permission_prefix),
                                        "View the Roles to which a {} belongs".format(model_title))
         config.add_tailbone_permission(permission_prefix, '{}.edit_roles'.format(permission_prefix),
                                        "Edit the Roles to which a {} belongs".format(model_title))
 
+        # manage API tokens
+        config.add_tailbone_permission(permission_prefix,
+                                       '{}.manage_api_tokens'.format(permission_prefix),
+                                       "Manage API tokens for any {}".format(model_title))
+        config.add_route('{}.add_api_token'.format(route_prefix),
+                         '{}/add-api-token'.format(instance_url_prefix),
+                         request_method='POST')
+        config.add_view(cls, attr='add_api_token',
+                        route_name='{}.add_api_token'.format(route_prefix),
+                        permission='{}.manage_api_tokens'.format(permission_prefix),
+                        renderer='json')
+        config.add_route('{}.delete_api_token'.format(route_prefix),
+                         '{}/delete-api-token'.format(instance_url_prefix),
+                         request_method='POST')
+        config.add_view(cls, attr='delete_api_token',
+                        route_name='{}.delete_api_token'.format(route_prefix),
+                        permission='{}.manage_api_tokens'.format(permission_prefix),
+                        renderer='json')
+
         # edit preferences for any user
         config.add_tailbone_permission(permission_prefix,
                                        '{}.preferences'.format(permission_prefix),
                                        "Edit preferences for any {}".format(model_title))
         config.add_route('{}.preferences'.format(route_prefix),
                          '{}/preferences'.format(instance_url_prefix))
         config.add_view(cls, attr='preferences',
```

### Comparing `Tailbone-0.9.9/tailbone/views/subdepartments.py` & `Tailbone-0.9.90/tailbone/views/subdepartments.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/tables.py` & `Tailbone-0.9.90/tailbone/views/tables.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,21 +20,19 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views with info about the underlying Rattail tables
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import os
 import sys
 import warnings
 
-import six
+import sqlalchemy as sa
 from sqlalchemy_utils import get_mapper
 
 from rattail.util import simple_error
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import HTML
@@ -95,16 +93,16 @@
         # schema name within the results grid?
         sql = """
         select relname, n_live_tup
         from pg_stat_user_tables
         where schemaname = 'public'
         order by n_live_tup desc;
         """
-        result = self.Session.execute(sql)
-        return [dict(table_name=row['relname'], row_count=row['n_live_tup'])
+        result = self.Session.execute(sa.text(sql))
+        return [dict(table_name=row.relname, row_count=row.n_live_tup)
                 for row in result]
 
     def configure_grid(self, g):
         super(TableView, self).configure_grid(g)
 
         # table_name
         g.sorters['table_name'] = g.make_simple_sorter('table_name', foldcase=True)
@@ -192,23 +190,25 @@
         return buttons
 
     def template_kwargs_create(self, **kwargs):
         kwargs = super(TableView, self).template_kwargs_create(**kwargs)
         app = self.get_rattail_app()
         model = self.model
 
+        kwargs['alembic_current_head'] = self.db_handler.check_alembic_current_head()
+
         kwargs['branch_name_options'] = self.db_handler.get_alembic_branch_names()
 
         branch_name = app.get_table_prefix()
         if branch_name not in kwargs['branch_name_options']:
             branch_name = None
         kwargs['branch_name'] = branch_name
 
-        kwargs['existing_tables'] = [{'name': table.name}
-                                     for table in model.Base.metadata.sorted_tables]
+        kwargs['existing_tables'] = [{'name': table}
+                                     for table in sorted(model.Base.metadata.tables)]
 
         kwargs['model_dir'] = (os.path.dirname(model.__file__)
                                + os.sep)
 
         return kwargs
 
     def write_model_file(self):
@@ -290,15 +290,15 @@
     def get_row_data(self, table):
         data = []
         for i, column in enumerate(table['table'].columns, 1):
             data.append({
                 'column': column,
                 'sequence': i,
                 'column_name': column.name,
-                'data_type': six.text_type(repr(column.type)),
+                'data_type': str(repr(column.type)),
                 'nullable': column.nullable,
                 'description': column.doc,
             })
         return data
 
     def configure_row_grid(self, g):
         super(TableView, self).configure_row_grid(g)
@@ -329,14 +329,19 @@
         max_length = 80
 
         if len(text) < max_length:
             return text
 
         return HTML.tag('span', title=text, c="{} ...".format(text[:max_length]))
 
+    def migrations(self):
+        # TODO: allow alembic upgrade on POST
+        # TODO: pass current revisions to page context
+        return self.render_to_response('migrations', {})
+
     @classmethod
     def defaults(cls, config):
         rattail_config = config.registry.settings.get('rattail_config')
 
         # allow creating tables only if *not* production
         if not rattail_config.production():
             cls.creatable = True
@@ -346,14 +351,25 @@
 
     @classmethod
     def _table_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         url_prefix = cls.get_url_prefix()
         permission_prefix = cls.get_permission_prefix()
 
+        # migrations
+        config.add_tailbone_permission(permission_prefix,
+                                       '{}.migrations'.format(permission_prefix),
+                                       "View / apply Alembic migrations")
+        config.add_route('{}.migrations'.format(route_prefix),
+                         '{}/migrations'.format(url_prefix))
+        config.add_view(cls, attr='migrations',
+                        route_name='{}.migrations'.format(route_prefix),
+                        renderer='json',
+                        permission='{}.migrations'.format(permission_prefix))
+
         if cls.creatable:
 
             # write model class to file
             config.add_route('{}.write_model_file'.format(route_prefix),
                              '{}/write-model-file'.format(url_prefix),
                              request_method='POST')
             config.add_view(cls, attr='write_model_file',
```

### Comparing `Tailbone-0.9.9/tailbone/views/brands.py` & `Tailbone-0.9.90/tailbone/views/brands.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/principal.py` & `Tailbone-0.9.90/tailbone/views/principal.py`

 * *Files 26% similar despite different names*

```diff
@@ -21,19 +21,18 @@
 #
 ################################################################################
 """
 "Principal" master view
 """
 
 import copy
+from collections import OrderedDict
 
 from rattail.core import Object
-from rattail.util import OrderedDict
 
-import wtforms
 from webhelpers2.html import HTML
 
 from tailbone.db import Session
 from tailbone.views import MasterView
 
 
 class PrincipalMasterView(MasterView):
@@ -50,48 +49,53 @@
         key, value = item
         return value['label'].lower()
 
     def find_by_perm(self):
         """
         View for finding all users who have been granted a given permission
         """
-        permissions = copy.deepcopy(self.request.registry.settings.get('tailbone_permissions', {}))
+        permissions = copy.deepcopy(
+            self.request.registry.settings.get('tailbone_permissions', {}))
 
         # sort groups, and permissions for each group, for UI's sake
         sorted_perms = sorted(permissions.items(), key=self.perm_sortkey)
         for key, group in sorted_perms:
             group['perms'] = sorted(group['perms'].items(), key=self.perm_sortkey)
 
-        # group options are stable, permission options may depend on submitted group
-        group_choices = [(gkey, group['label']) for gkey, group in sorted_perms]
-        permission_choices = [('_any_', "(any)")]
-        if self.request.method == 'POST':
-            if self.request.POST.get('permission_group') in permissions:
-                permission_choices.extend([
-                    (pkey, perm['label'])
-                    for pkey, perm in permissions[self.request.POST['permission_group']]['perms']
-                ])
-
-        class PermissionForm(wtforms.Form):
-            permission_group = wtforms.SelectField(choices=group_choices)
-            permission = wtforms.SelectField(choices=permission_choices)
-
+        # if both field values are in query string, do lookup
         principals = None
-        form = PermissionForm(self.request.POST)
-        if self.request.method == 'POST' and form.validate():
-            permission = form.permission.data
-            principals = self.find_principals_with_permission(self.Session(), permission)
+        permission_group = self.request.GET.get('permission_group')
+        permission = self.request.GET.get('permission')
+        if permission_group and permission:
+            principals = self.find_principals_with_permission(self.Session(),
+                                                              permission)
+        else: # otherwise clear both values
+            permission_group = None
+            permission = None
 
-        context = {'form': form, 'permissions': sorted_perms, 'principals': principals}
+        context = {'permissions': sorted_perms, 'principals': principals}
 
         perms = self.get_buefy_perms_data(sorted_perms)
         context['buefy_perms'] = perms
         context['buefy_sorted_groups'] = list(perms)
-        context['selected_group'] = self.request.POST.get('permission_group', 'common')
-        context['selected_permission'] = self.request.POST.get('permission', None)
+
+        if permission_group and permission_group not in perms:
+            permission_group = None
+        if permission:
+            if permission_group:
+                group = dict([(p['permkey'], p) for p in perms[permission_group]['permissions']])
+                if permission in group:
+                    context['selected_permission_label'] = group[permission]['label']
+                else:
+                    permission = None
+            else:
+                permission = None
+
+        context['selected_group'] = permission_group
+        context['selected_permission'] = permission
 
         return self.render_to_response('find_by_perm', context)
 
     def get_buefy_perms_data(self, sorted_perms):
         data = OrderedDict()
         for gkey, group in sorted_perms:
 
@@ -119,16 +123,19 @@
     def _principal_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         url_prefix = cls.get_url_prefix()
         permission_prefix = cls.get_permission_prefix()
         model_title_plural = cls.get_model_title_plural()
 
         # find principal by permission
-        config.add_route('{}.find_by_perm'.format(route_prefix), '{}/find-by-perm'.format(url_prefix))
-        config.add_view(cls, attr='find_by_perm', route_name='{}.find_by_perm'.format(route_prefix),
+        config.add_route('{}.find_by_perm'.format(route_prefix),
+                         '{}/find-by-perm'.format(url_prefix),
+                         request_method='GET')
+        config.add_view(cls, attr='find_by_perm',
+                        route_name='{}.find_by_perm'.format(route_prefix),
                         permission='{}.find_by_perm'.format(permission_prefix))
         config.add_tailbone_permission(permission_prefix, '{}.find_by_perm'.format(permission_prefix),
                                        "Find all {} with permission X".format(model_title_plural))
 
 
 class PermissionsRenderer(Object):
     permissions = None
```

### Comparing `Tailbone-0.9.9/tailbone/views/core.py` & `Tailbone-0.9.90/tailbone/views/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -157,14 +157,17 @@
         response.content_length = os.path.getsize(path)
         if attachment:
             if not filename:
                 filename = os.path.basename(path)
             response.content_disposition = str('attachment; filename="{}"'.format(filename))
         return response
 
+    def should_expose_quickie_search(self):
+        return self.expose_quickie_search
+
     def get_quickie_context(self):
         return Object(
             url=self.get_quickie_url(),
             perm=self.get_quickie_perm(),
             placeholder=self.get_quickie_placeholder())
 
     def get_quickie_url(self):
```

### Comparing `Tailbone-0.9.9/tailbone/views/importing.py` & `Tailbone-0.9.90/tailbone/views/importing.py`

 * *Files 5% similar despite different names*

```diff
@@ -291,23 +291,50 @@
         f.set_readonly('host_title')
         f.set_readonly('local_title')
 
         keys = handler.get_importer_keys()
         f.set_widget('models', dfwidget.SelectWidget(values=[(k, k) for k in keys],
                                                      multiple=True,
                                                      size=len(keys)))
-        # f.set_default('models', keys)
 
-        f.set_default('create', True)
-        f.set_default('update', True)
-        f.set_default('delete', False)
+        allow_create = True
+        allow_update = True
+        allow_delete = True
+        if len(keys) == 1:
+            importers = handler.get_importers().values()
+            importer = list(importers)[0]
+            allow_create = importer.allow_create
+            allow_update = importer.allow_update
+            allow_delete = importer.allow_delete
+
+        if allow_create:
+            f.set_default('create', True)
+        else:
+            f.remove('create')
+
+        if allow_update:
+            f.set_default('update', True)
+        else:
+            f.remove('update')
+
+        if allow_delete:
+            f.set_default('delete', False)
+        else:
+            f.remove('delete')
+
         # f.set_default('runas', self.rattail_config.get('rattail', 'runas.default') or '')
+
         f.set_default('versioning', True)
+        f.set_helptext('versioning', "If set, version history will be updated as appropriate")
+
         f.set_default('dry_run', False)
+        f.set_helptext('dry_run', "If set, data will not actually be written")
+
         f.set_default('warnings', False)
+        f.set_helptext('warnings', "If set, will send an email if any diffs")
 
     def do_runjob(self, handler_info, form):
         handler = handler_info['_handler']
         handler_key = handler.get_key()
 
         if self.request.POST.get('runjob') == 'true':
```

### Comparing `Tailbone-0.9.9/tailbone/views/workorders.py` & `Tailbone-0.9.90/tailbone/views/workorders.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/readings.py` & `Tailbone-0.9.90/tailbone/views/tempmon/readings.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,17 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for tempmon readings
 """
 
-from __future__ import unicode_literals, absolute_import
-
-import six
 from sqlalchemy import orm
 
 from rattail_tempmon.db import model as tempmon
 
 from webhelpers2.html import tags
 
 from tailbone.views.tempmon import MasterView
@@ -66,25 +63,29 @@
 
     def query(self, session):
         return session.query(tempmon.Reading)\
                       .join(tempmon.Client)\
                       .options(orm.joinedload(tempmon.Reading.client))
 
     def configure_grid(self, g):
-        super(TempmonReadingView, self).configure_grid(g)
-
-        g.sorters['client_key'] = g.make_sorter(tempmon.Client.config_key)
-        g.filters['client_key'] = g.make_filter('client_key', tempmon.Client.config_key)
+        super().configure_grid(g)
 
-        g.sorters['client_host'] = g.make_sorter(tempmon.Client.hostname)
-        g.filters['client_host'] = g.make_filter('client_host', tempmon.Client.hostname)
+        # client_key
+        g.set_sorter('client_key', tempmon.Client.config_key)
+        g.set_filter('client_key', tempmon.Client.config_key)
+
+        # client_host
+        g.set_sorter('client_host', tempmon.Client.hostname)
+        g.set_filter('client_host', tempmon.Client.hostname)
 
-        g.joiners['probe'] = lambda q: q.join(tempmon.Probe, tempmon.Probe.uuid == tempmon.Reading.probe_uuid)
-        g.sorters['probe'] = g.make_sorter(tempmon.Probe.description)
-        g.filters['probe'] = g.make_filter('probe', tempmon.Probe.description)
+        # probe
+        g.set_joiner('probe', lambda q: q.join(tempmon.Probe,
+                                               tempmon.Probe.uuid == tempmon.Reading.probe_uuid))
+        g.set_sorter('probe', tempmon.Probe.description)
+        g.set_filter('probe', tempmon.Probe.description)
 
         g.set_sort_defaults('taken', 'desc')
         g.set_type('taken', 'datetime')
 
         g.set_renderer('client_key', self.render_client_key)
         g.set_renderer('client_host', self.render_client_host)
 
@@ -94,37 +95,37 @@
     def render_client_key(self, reading, column):
         return reading.client.config_key
 
     def render_client_host(self, reading, column):
         return reading.client.hostname
 
     def configure_form(self, f):
-        super(TempmonReadingView, self).configure_form(f)
+        super().configure_form(f)
 
         # client
         f.set_renderer('client', self.render_client)
         f.set_label('client', "Tempmon Client")
 
         # probe
         f.set_renderer('probe', self.render_probe)
         f.set_label('probe', "Tempmon Probe")
 
     def render_client(self, reading, field):
         client = reading.client
         if not client:
             return ""
-        text = six.text_type(client)
+        text = str(client)
         url = self.request.route_url('tempmon.clients.view', uuid=client.uuid)
         return tags.link_to(text, url)
 
     def render_probe(self, reading, field):
         probe = reading.probe
         if not probe:
             return ""
-        text = six.text_type(probe)
+        text = str(probe)
         url = self.request.route_url('tempmon.probes.view', uuid=probe.uuid)
         return tags.link_to(text, url)
 
 
 def defaults(config, **kwargs):
     base = globals()
```

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/appliances.py` & `Tailbone-0.9.90/tailbone/views/tempmon/appliances.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/clients.py` & `Tailbone-0.9.90/tailbone/views/tempmon/clients.py`

 * *Files 6% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for tempmon clients
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import subprocess
 
 from rattail.config import parse_list
 from rattail_tempmon.db import model as tempmon
 
 import colander
 from webhelpers2.html import HTML, tags
@@ -47,14 +45,15 @@
     model_title = "TempMon Client"
     model_title_plural = "TempMon Clients"
     route_prefix = 'tempmon.clients'
     url_prefix = '/tempmon/clients'
 
     has_rows = True
     model_row_class = tempmon.Reading
+    rows_title = "Readings"
 
     grid_columns = [
         'config_key',
         'hostname',
         'location',
         'delay',
         'enabled',
@@ -79,15 +78,15 @@
     row_grid_columns = [
         'probe',
         'degrees_f',
         'taken',
     ]
 
     def configure_grid(self, g):
-        super(TempmonClientView, self).configure_grid(g)
+        super().configure_grid(g)
 
         # config_key
         g.set_label('config_key', "Key")
         g.set_sort_defaults('config_key')
         g.set_link('config_key')
 
         # hostname
@@ -112,15 +111,15 @@
 
     def render_enabled_grid(self, client, field):
         if client.enabled:
             return "Yes"
         return "No"
 
     def configure_form(self, f):
-        super(TempmonClientView, self).configure_form(f)
+        super().configure_form(f)
 
         # config_key
         f.set_validator('config_key', self.unique_config_key)
 
         # disk_type
         f.set_enum('disk_type', self.enum.TEMPMON_DISK_TYPE)
         f.widgets['disk_type'].values.insert(0, ('', "(unknown)"))
@@ -156,15 +155,15 @@
         else:
             f.set_helptext('online', tempmon.Client.online.__doc__)
 
         # archived
         f.set_helptext('archived', tempmon.Client.archived.__doc__)
 
     def template_kwargs_view(self, **kwargs):
-        kwargs = super(TempmonClientView, self).template_kwargs_view(**kwargs)
+        kwargs = super().template_kwargs_view(**kwargs)
         client = kwargs['instance']
 
         kwargs['probes_data'] = self.normalize_probes(client.probes)
 
         return kwargs
 
     def objectify(self, form, data=None):
@@ -173,15 +172,15 @@
         # simple edits are being done to the client.  i.e. we do want to set
         # the timestamp when it was previously null, but not otherwise.
         if self.editing:
             data = dict(data or form.validated)
             if data['enabled'] and form.model_instance.enabled:
                 data['enabled'] = form.model_instance.enabled
 
-        return super(TempmonClientView, self).objectify(form, data=data)
+        return super().objectify(form, data=data)
 
     def unique_config_key(self, node, value):
         query = self.Session.query(tempmon.Client)\
                             .filter(tempmon.Client.config_key == value)
         if self.editing:
             client = self.get_instance()
             query = query.filter(tempmon.Client.uuid != client.uuid)
@@ -226,15 +225,15 @@
                             .filter(tempmon.Reading.client == client)
         return query
 
     def get_parent(self, reading):
         return reading.client
 
     def configure_row_grid(self, g):
-        super(TempmonClientView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         # probe
         g.set_filter('probe', tempmon.Probe.description)
         g.set_sorter('probe', tempmon.Probe.description)
 
         g.set_sort_defaults('taken', 'desc')
```

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/core.py` & `Tailbone-0.9.90/tailbone/views/tempmon/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -51,15 +51,15 @@
                 '_action_url_view': view_url,
                 '_action_url_edit': edit_url,
                 'description': probe.description,
                 'critical_temp_min': probe.critical_temp_min,
                 'good_temp_min': probe.good_temp_min,
                 'good_temp_max': probe.good_temp_max,
                 'critical_temp_max': probe.critical_temp_max,
-                'status': self.enum.TEMPMON_PROBE_STATUS[probe.status],
+                'status': self.enum.TEMPMON_PROBE_STATUS.get(probe.status, '??'),
                 'enabled': "Yes" if probe.enabled else "No",
             })
         app = self.get_rattail_app()
         data = app.json_friendly(data)
         return data
 
     def render_probes(self, obj, field):
```

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/probes.py` & `Tailbone-0.9.90/tailbone/views/tempmon/probes.py`

 * *Files 4% similar despite different names*

```diff
@@ -22,20 +22,19 @@
 ################################################################################
 """
 Views for tempmon probes
 """
 
 import datetime
 
-from rattail.time import make_utc, localtime
 from rattail_tempmon.db import model as tempmon
 
 import colander
 from deform import widget as dfwidget
-from webhelpers2.html import tags, HTML
+from webhelpers2.html import tags
 
 from tailbone import forms, grids
 from tailbone.views.tempmon import MasterView
 from tailbone.util import raw_datetime
 
 
 class TempmonProbeView(MasterView):
@@ -46,14 +45,15 @@
     model_title = "TempMon Probe"
     model_title_plural = "TempMon Probes"
     route_prefix = 'tempmon.probes'
     url_prefix = '/tempmon/probes'
 
     has_rows = True
     model_row_class = tempmon.Reading
+    rows_title = "Readings"
 
     labels = {
         'critical_max_timeout': "Critical High Timeout",
         'good_max_timeout': "High Timeout",
         'good_min_timeout': "Low Timeout",
         'critical_min_timeout': "Critical Low Timeout",
     }
@@ -95,18 +95,19 @@
 
     row_grid_columns = [
         'degrees_f',
         'taken',
     ]
 
     def configure_grid(self, g):
-        super(TempmonProbeView, self).configure_grid(g)
+        super().configure_grid(g)
 
-        g.joiners['client'] = lambda q: q.join(tempmon.Client)
-        g.sorters['client'] = g.make_sorter(tempmon.Client.config_key)
+        # client
+        g.set_joiner('client', lambda q: q.join(tempmon.Client))
+        g.set_sorter('client', tempmon.Client.config_key)
         g.set_sort_defaults('client')
 
         g.set_enum('appliance_type', self.enum.TEMPMON_APPLIANCE_TYPE)
         g.set_enum('status', self.enum.TEMPMON_PROBE_STATUS)
 
         g.set_renderer('enabled', self.render_enabled_grid)
 
@@ -118,15 +119,15 @@
 
     def render_enabled_grid(self, probe, field):
         if probe.enabled:
             return "Yes"
         return "No"
 
     def configure_form(self, f):
-        super(TempmonProbeView, self).configure_form(f)
+        super().configure_form(f)
 
         # config_key
         f.set_validator('config_key', self.unique_config_key)
 
         # client
         f.set_renderer('client', self.render_client)
         f.set_label('client', "Tempmon Client")
@@ -183,15 +184,15 @@
         # simple edits are being done to the probe.  i.e. we do want to set the
         # timestamp when it was previously null, but not otherwise.
         if self.editing:
             data = dict(data or form.validated)
             if data['enabled'] and form.model_instance.enabled:
                 data['enabled'] = form.model_instance.enabled
 
-        return super(TempmonProbeView, self).objectify(form, data=data)
+        return super().objectify(form, data=data)
 
     def unique_config_key(self, node, value):
         query = self.Session.query(tempmon.Probe)\
                             .filter(tempmon.Probe.config_key == value)
         if self.editing:
             probe = self.get_instance()
             query = query.filter(tempmon.Probe.uuid != probe.uuid)
@@ -237,15 +238,15 @@
                             .filter(tempmon.Reading.probe == probe)
         return query
 
     def get_parent(self, reading):
         return reading.client
 
     def configure_row_grid(self, g):
-        super(TempmonProbeView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         # # probe
         # g.set_filter('probe', tempmon.Probe.description)
         # g.set_sorter('probe', tempmon.Probe.description)
 
         g.set_sort_defaults('taken', 'desc')
 
@@ -254,35 +255,24 @@
 
         key = 'tempmon.probe.{}.graph_time_range'.format(probe.uuid)
         selected = self.request.params.get('time-range')
         if not selected:
             selected = self.request.session.get(key, 'last hour')
         self.request.session[key] = selected
 
-        range_options = tags.Options([
-            tags.Option("Last Hour", 'last hour'),
-            tags.Option("Last 6 Hours", 'last 6 hours'),
-            tags.Option("Last Day", 'last day'),
-            tags.Option("Last Week", 'last week'),
-        ])
-
-        time_range = HTML.tag('b-select', c=[range_options.render()],
-                              **{'v-model': 'currentTimeRange',
-                                 '@input': 'timeRangeChanged'})
-
         context = {
             'probe': probe,
             'parent_title': str(probe),
             'parent_url': self.get_action_url('view', probe),
-            'time_range': time_range,
             'current_time_range': selected,
         }
         return self.render_to_response('graph', context)
 
     def graph_readings(self):
+        app = self.get_rattail_app()
         probe = self.get_instance()
 
         key = 'tempmon.probe.{}.graph_time_range'.format(probe.uuid)
         selected = self.request.params['time-range']
         assert selected
         self.request.session[key] = selected
 
@@ -295,24 +285,24 @@
             cutoff = 60 * 60 * 24       # hour x 24
         elif selected == 'last week':
             cutoff = 60 * 60 * 24 * 7   # day x 7
         else:
             raise NotImplementedError("Unknown time range: {}".format(selected))
 
         # figure out which readings we need to graph
-        cutoff = make_utc() - datetime.timedelta(seconds=cutoff)
+        cutoff = app.make_utc() - datetime.timedelta(seconds=cutoff)
         readings = self.Session.query(tempmon.Reading)\
                                .filter(tempmon.Reading.probe == probe)\
                                .filter(tempmon.Reading.taken >= cutoff)\
                                .order_by(tempmon.Reading.taken)\
                                .all()
 
         # convert readings to data for scatter plot
         data = [{
-            'x': localtime(self.rattail_config, reading.taken, from_utc=True).isoformat(),
+            'x': app.localtime(reading.taken, from_utc=True).isoformat(),
             'y': float(reading.degrees_f),
         } for reading in readings]
         return data
 
     @classmethod
     def defaults(cls, config):
         route_prefix = cls.get_route_prefix()
```

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/dashboard.py` & `Tailbone-0.9.90/tailbone/views/tempmon/dashboard.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/tempmon/__init__.py` & `Tailbone-0.9.90/tailbone/views/tempmon/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/handheld.py` & `Tailbone-0.9.90/tailbone/views/handheld.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,20 +20,18 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 (DEPRECATED) Views for handheld batches
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import warnings
 
 # nb. this is imported only for sake of legacy callers
 from tailbone.views.batch.handheld import HandheldBatchView
 
 
 def includeme(config):
     warnings.warn("tailbone.views.handheld is a deprecated module; "
                   "please use tailbone.views.batch.handheld instead",
-                  DeprecationWarning)
+                  DeprecationWarning, stacklevel=2)
     config.include('tailbone.views.batch.handheld')
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/delproduct.py` & `Tailbone-0.9.90/tailbone/views/batch/delproduct.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/batch/product.py` & `Tailbone-0.9.90/tailbone/views/batch/product.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2020 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,18 +20,17 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for generic product batches
 """
 
-from __future__ import unicode_literals, absolute_import
+from collections import OrderedDict
 
 from rattail.db import model
-from rattail.util import OrderedDict
 
 import colander
 from webhelpers2.html import HTML
 
 from tailbone import forms
 from tailbone.views.batch import BatchMasterView
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/inventory.py` & `Tailbone-0.9.90/tailbone/views/batch/inventory.py`

 * *Files 5% similar despite different names*

```diff
@@ -23,20 +23,21 @@
 """
 Views for inventory batches
 """
 
 import re
 import decimal
 import logging
+from collections import OrderedDict
 
 from rattail import pod
 from rattail.db import model
 from rattail.db.util import make_full_description
 from rattail.gpc import GPC
-from rattail.util import pretty_quantity, OrderedDict
+from rattail.util import pretty_quantity
 
 import colander
 from deform import widget as dfwidget
 from webhelpers2.html import HTML, tags
 
 from tailbone import forms, grids
 from tailbone.views import MasterView
@@ -223,21 +224,21 @@
         return super(InventoryBatchView, self).delete_row()
 
     def create_row(self):
         """
         Desktop workflow view for adding items to inventory batch.
         """
         batch = self.get_instance()
-        if batch.executed:
+        if batch.executed or batch.complete:
             return self.redirect(self.get_action_url('view', batch))
 
         schema = DesktopForm().bind(session=self.Session())
         form = forms.Form(schema=schema, request=self.request)
         if self.request.method == 'POST':
-            if form.validate(newstyle=True):
+            if form.validate():
 
                 product = self.Session.get(model.Product, form.validated['product'])
 
                 row = None
                 if self.should_aggregate_products(batch):
                     row = self.find_row_for_product(batch, product)
                     if row:
@@ -355,19 +356,25 @@
 
     # TODO: deprecate / remove
     def find_row_for_product(self, batch, product):
         return self.handler.find_row_for_product(self.Session(), batch, product)
 
     # TODO: deprecate / remove (?)
     def find_product(self, entry):
-        lookup_by_code = self.rattail_config.getbool(
-            'tailbone', 'inventory.lookup_by_code', default=False)
+        lookup_fields = [
+            'uuid',
+            '_product_key_',
+        ]
+
+        if self.rattail_config.getbool('tailbone', 'inventory.lookup_by_code',
+                                       default=False):
+            lookup_fields.append('alt_code')
 
-        return self.handler.locate_product_for_entry(
-            self.Session(), entry, lookup_by_code=lookup_by_code)
+        return self.handler.locate_product_for_entry(self.Session(), entry,
+                                                     lookup_fields=lookup_fields)
 
     def product_info(self, product):
         data = {}
         if product and (not product.deleted or self.request.has_perm('products.view_deleted')):
             data['uuid'] = product.uuid
             data['upc'] = str(product.upc)
             data['upc_pretty'] = product.upc.pretty()
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/newproduct.py` & `Tailbone-0.9.90/tailbone/views/batch/newproduct.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,18 +20,18 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for new product batches
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from rattail.db import model
 
+from deform import widget as dfwidget
+
 from tailbone.views.batch import BatchMasterView
 
 
 class NewProductBatchView(BatchMasterView):
     """
     Master view for new product batches.
     """
@@ -45,19 +45,25 @@
     bulk_deletable = True
     rows_editable = True
     rows_bulk_deletable = True
 
     configurable = True
     has_input_file_templates = True
 
+    labels = {
+        'type2_lookup': "Type-2 UPC Lookups",
+    }
+
     form_fields = [
         'id',
         'input_filename',
         'description',
         'notes',
+        'type2_lookup',
+        'params',
         'created',
         'created_by',
         'rowcount',
         'executed',
         'executed_by',
     ]
 
@@ -125,23 +131,51 @@
             {'key': 'default',
              'label': "Default",
              'default_url': self.request.static_url(
                  'tailbone:static/files/newproduct_template.xlsx')},
         ]
 
     def configure_form(self, f):
-        super(NewProductBatchView, self).configure_form(f)
+        super().configure_form(f)
 
         # input_filename
         if self.creating:
             f.set_type('input_filename', 'file')
         else:
             f.set_readonly('input_filename')
             f.set_renderer('input_filename', self.render_downloadable_file)
 
+        # type2_lookup
+        if self.creating:
+            values = [
+                ('', "(use default behavior)"),
+                ('always', "Always try Type-2 lookup, when applicable"),
+                ('never', "Never try Type-2 lookup"),
+            ]
+            f.set_widget('type2_lookup', dfwidget.SelectWidget(values=values))
+            f.set_default('type2_lookup', '')
+        else:
+            f.remove('type2_lookup')
+
+    def save_create_form(self, form):
+        batch = super().save_create_form(form)
+
+        if 'type2_lookup' in form:
+            type2_lookup = form.validated['type2_lookup']
+            if type2_lookup == 'always':
+                type2_lookup = True
+            elif type2_lookup == 'never':
+                type2_lookup = False
+            else:
+                type2_lookup = None
+            if type2_lookup is not None:
+                batch.set_param('type2_lookup', type2_lookup)
+
+        return batch
+
     def configure_row_grid(self, g):
         super(NewProductBatchView, self).configure_row_grid(g)
 
         g.set_type('case_cost', 'currency')
         g.set_type('unit_cost', 'currency')
         g.set_type('regular_price', 'currency')
         g.set_type('pack_price', 'currency')
@@ -161,26 +195,27 @@
         if row.status_code in (row.STATUS_CATEGORY_NOT_FOUND,
                                row.STATUS_FAMILY_NOT_FOUND,
                                row.STATUS_REPORTCODE_NOT_FOUND,
                                row.STATUS_CANNOT_CALCULATE_PRICE):
             return 'notice'
 
     def configure_row_form(self, f):
-        super(NewProductBatchView, self).configure_row_form(f)
+        super().configure_row_form(f)
 
         f.set_readonly('product')
         f.set_readonly('vendor')
         f.set_readonly('department')
         f.set_readonly('subdepartment')
         f.set_readonly('category')
         f.set_readonly('family')
         f.set_readonly('report')
 
         f.set_type('upc', 'gpc')
 
+        f.set_renderer('product', self.render_product)
         f.set_renderer('vendor', self.render_vendor)
         f.set_renderer('department', self.render_department)
         f.set_renderer('subdepartment', self.render_subdepartment)
         f.set_renderer('report', self.render_report)
 
 
 def defaults(config, **kwargs):
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/vendorinvoice.py` & `Tailbone-0.9.90/tailbone/views/batch/vendorinvoice.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/batch/labels.py` & `Tailbone-0.9.90/tailbone/views/batch/labels.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/batch/importer.py` & `Tailbone-0.9.90/tailbone/views/batch/importer.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2023 Lance Edgar
+#  Copyright  2010-2024 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -22,26 +22,26 @@
 ################################################################################
 """
 Views for importer batches
 """
 
 import sqlalchemy as sa
 
-from rattail.db import model
+from rattail.db.model import ImporterBatch
 
 import colander
 
 from tailbone.views.batch import BatchMasterView
 
 
 class ImporterBatchView(BatchMasterView):
     """
     Master view for importer batches.
     """
-    model_class = model.ImporterBatch
+    model_class = ImporterBatch
     default_handler_spec = 'rattail.batch.importer:ImporterBatchHandler'
     route_prefix = 'batch.importer'
     url_prefix = '/batches/importer'
     template_prefix = '/batch/importer'
     creatable = False
     refreshable = False
     bulk_deletable = True
@@ -87,15 +87,15 @@
         'sequence',
         'object_key',
         'object_str',
         'status_code',
     ]
 
     def configure_form(self, f):
-        super(ImporterBatchView, self).configure_form(f)
+        super().configure_form(f)
 
         # readonly fields
         f.set_readonly('import_handler_spec')
         f.set_readonly('host_title')
         f.set_readonly('local_title')
         f.set_readonly('importer_key')
         f.set_readonly('row_table')
@@ -106,41 +106,41 @@
         title as first member, and number of rows with that status as second
         member.
         """
         if kwargs.get('rows') is None:
             self.make_row_table(batch.row_table)
             kwargs['rows'] = self.Session.query(self.current_row_table).all()
         kwargs.setdefault('status_enum', self.enum.IMPORTER_BATCH_ROW_STATUS)
-        breakdown = super(ImporterBatchView, self).make_status_breakdown(
-            batch, **kwargs)
+        breakdown = super().make_status_breakdown(batch, **kwargs)
         return breakdown
 
     def delete_instance(self, batch):
         self.make_row_table(batch.row_table)
         if self.current_row_table is not None:
             self.current_row_table.drop()
-        super(ImporterBatchView, self).delete_instance(batch)
+        super().delete_instance(batch)
 
     def make_row_table(self, name):
         if not hasattr(self, 'current_row_table'):
-            metadata = sa.MetaData(schema='batch', bind=self.Session.bind)
+            metadata = sa.MetaData(schema='batch')
             try:
-                self.current_row_table = sa.Table(name, metadata, autoload=True)
+                self.current_row_table = sa.Table(name, metadata,
+                                                  autoload_with=self.Session.bind)
             except sa.exc.NoSuchTableError:
                 self.current_row_table = None
 
     def get_row_data(self, batch):
         self.make_row_table(batch.row_table)
         return self.Session.query(self.current_row_table)
 
     def get_row_status_enum(self):
         return self.enum.IMPORTER_BATCH_ROW_STATUS
 
     def configure_row_grid(self, g):
-        super(ImporterBatchView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         def make_filter(field, **kwargs):
             column = getattr(self.current_row_table.c, field)
             g.set_filter(field, column, **kwargs)
 
         make_filter('object_key')
         make_filter('object_str')
@@ -186,15 +186,15 @@
         self.make_row_table(batch_uuid)
         return self.Session.query(self.current_row_table)\
                            .filter(self.current_row_table.c.uuid == row_uuid)\
                            .one()
 
     def get_parent(self, row):
         uuid = self.current_row_table.name
-        return self.Session.get(model.ImporterBatch, uuid)
+        return self.Session.get(ImporterBatch, uuid)
 
     def get_row_instance_title(self, row):
         if row.object_str:
             return row.object_str
         if row.object_key:
             return row.object_key
         return "Row {}".format(row.sequence)
@@ -238,15 +238,15 @@
 
         row = dict([(field, getattr(instance, field))
                     for field in fields])
         row['status_text'] = instance.status_text
 
         kwargs.setdefault('schema', colander.Schema())
         kwargs.setdefault('cancel_url', None)
-        return super(ImporterBatchView, self).make_row_form(instance=row, **kwargs)
+        return super().make_row_form(instance=row, **kwargs)
 
     def configure_row_form(self, f):
         """
         Configure the row form.
         """
         # object_str
         f.set_label('object_str', "Object Description")
@@ -273,29 +273,29 @@
         return self.redirect(self.get_action_url('view', batch))
 
     def bulk_delete_rows(self):
         batch = self.get_instance()
         query = self.get_effective_row_data(sort=False)
         batch.rowcount -= query.count()
         delete_query = self.current_row_table.delete().where(self.current_row_table.c.uuid.in_([row.uuid for row in query]))
-        delete_query.execute()
+        self.Session.bind.execute(delete_query)
         return self.redirect(self.get_action_url('view', batch))
 
     def get_row_xlsx_fields(self):
         return [
             'sequence',
             'object_key',
             'object_str',
             'status',
             'status_code',
             'status_text',
         ]
 
     def get_row_xlsx_row(self, row, fields):
-        xlrow = super(ImporterBatchView, self).get_row_xlsx_row(row, fields)
+        xlrow = super().get_row_xlsx_row(row, fields)
 
         xlrow['status'] = self.enum.IMPORTER_BATCH_ROW_STATUS[row.status_code]
 
         return xlrow
 
 
 def defaults(config, **kwargs):
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/core.py` & `Tailbone-0.9.90/tailbone/views/batch/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -96,18 +96,18 @@
     ]
 
     form_fields = [
         'id',
         'description',
         'notes',
         'params',
-        'created',
-        'created_by',
         'rowcount',
         'status_code',
+        'created',
+        'created_by',
         'executed',
         'executed_by',
     ]
 
     row_labels = {
         'upc': "UPC",
         'item_id': "Item ID",
@@ -562,15 +562,15 @@
 
     def toggle_complete(self):
         batch = self.get_instance()
         if batch.executed:
             self.request.session.flash("Request ignored, since batch has already been executed")
         else:
             form = forms.Form(schema=ToggleComplete(), request=self.request)
-            if form.validate(newstyle=True):
+            if form.validate():
                 if form.validated['complete']:
                     self.mark_batch_complete(batch)
                 else:
                     self.mark_batch_incomplete(batch)
         return self.redirect(self.get_action_url('view', batch))
 
     def mark_batch_complete(self, batch):
@@ -927,15 +927,15 @@
                           command='rattail', command_args=None,
                           subcommand=None, subcommand_args=None):
 
         # construct command
         prefix = self.rattail_config.get('rattail', 'command_prefix',
                                          default=sys.prefix)
         cmd = [os.path.join(prefix, 'bin/{}'.format(command))]
-        for path in self.rattail_config.files_read:
+        for path in self.rattail_config.prioritized_files:
             cmd.extend(['--config', path])
         if username:
             cmd.extend(['--runas', username])
         if command_args:
             cmd.extend(command_args)
         cmd.extend([
             '--progress',
@@ -965,14 +965,18 @@
         the handler says versioning must be avoided during the action.  It must
         launch a separate process with versioning disabled in order to act on
         the batch.
         """
         batch_uuid = key[0]
 
         # figure out the (sub)command args we'll be passing
+        if handler_action == 'auto_receive':
+            subcommand = 'auto-receive'
+        else:
+            subcommand = f'{handler_action}-batch'
         subargs = [
             '--batch-type',
             self.handler.batch_key,
             batch_uuid,
         ]
         if handler_action == 'execute' and kwargs:
             subargs.extend([
@@ -983,15 +987,15 @@
         # invoke command to act on batch in separate process
         try:
             self.launch_subprocess(port=port, username=username,
                                    command='rattail',
                                    command_args=[
                                        '--no-versioning',
                                    ],
-                                   subcommand='{}-batch'.format(handler_action),
+                                   subcommand=subcommand,
                                    subcommand_args=subargs)
         except Exception as error:
             log.warning("%s of '%s' batch failed: %s", handler_action, self.handler.batch_key, batch_uuid, exc_info=True)
 
             # TODO: write minimal error info to socket
             if progress:
                 progress.session.load()
@@ -1049,15 +1053,16 @@
         batch = session.get(self.model_class, batch_uuid)
         user = session.get(model.User, user_uuid)
         try:
             self.handler.do_populate(batch, user, progress=progress)
             session.flush()
         except Exception as error:
             session.rollback()
-            log.exception("population failed for batch %s: %s", batch.uuid, batch)
+            log.warning("population failed for batch %s: %s", batch.uuid, batch,
+                        exc_info=True)
             session.close()
             if progress:
                 progress.session.load()
                 progress.session['error'] = True
                 progress.session['error_msg'] = simple_error(error)
                 progress.session.save()
             return
@@ -1269,15 +1274,15 @@
         """
         Execute a batch.  Starts a separate thread for the execution, and
         displays a progress indicator page.
         """
         batch = self.get_instance()
         self.executing = True
         form = self.make_execute_form(batch)
-        if form.validate(newstyle=True):
+        if form.validate():
             kwargs = dict(form.validated)
 
             # cache options to use as defaults next time
             for key, value in form.validated.items():
                 self.request.session['batch.{}.execute_option.{}'.format(batch.batch_key, key)] = value
 
             return self.handler_action(batch, 'execute', **kwargs)
@@ -1340,15 +1345,15 @@
     def execute_results(self):
         """
         Execute all batches which are returned from the current index query.
         Starts a separate thread for the execution, and displays a progress
         indicator page.
         """
         form = self.make_execute_form()
-        if form.validate(newstyle=True):
+        if form.validate():
             kwargs = dict(form.validated)
 
             # cache options to use as defaults next time
             for key, value in form.validated.items():
                 self.request.session['batch.{}.execute_option.{}'.format(self.model_class.batch_key, key)] = value
 
             key = '{}.execute_results'.format(self.model_class.__tablename__)
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/handheld.py` & `Tailbone-0.9.90/tailbone/views/batch/handheld.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,18 +20,17 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Views for handheld batches
 """
 
-from __future__ import unicode_literals, absolute_import
+from collections import OrderedDict
 
 from rattail.db import model
-from rattail.util import OrderedDict
 
 import colander
 from webhelpers2.html import tags
 
 from tailbone import forms
 from tailbone.views.batch import FileBatchMasterView
```

### Comparing `Tailbone-0.9.9/tailbone/views/batch/__init__.py` & `Tailbone-0.9.90/tailbone/views/batch/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/batch/pricing.py` & `Tailbone-0.9.90/tailbone/views/batch/pricing.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/batch/vendorcatalog.py` & `Tailbone-0.9.90/tailbone/views/batch/vendorcatalog.py`

 * *Files 1% similar despite different names*

```diff
@@ -256,21 +256,14 @@
             f.set_type('cache_products', 'boolean')
             f.set_helptext('cache_products',
                            "If set, will pre-cache all products for quicker "
                            "lookups when loading the catalog.")
         else:
             f.remove('cache_products')
 
-    def valid_vendor_uuid(self, node, value):
-        model = self.model
-        if value:
-            vendor = self.Session.get(model.Vendor, value)
-            if not vendor:
-                raise colander.Invalid(node, "Vendor not found")
-
     def render_parser_key(self, batch, field):
         key = getattr(batch, field)
         if not key:
             return
         app = self.get_rattail_app()
         vendor_handler = app.get_vendor_handler()
         parser = vendor_handler.get_catalog_parser(key)
```

### Comparing `Tailbone-0.9.9/tailbone/views/exports.py` & `Tailbone-0.9.90/tailbone/views/exports.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/uoms.py` & `Tailbone-0.9.90/tailbone/views/uoms.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/departments.py` & `Tailbone-0.9.90/tailbone/views/departments.py`

 * *Files 8% similar despite different names*

```diff
@@ -20,51 +20,56 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Department Views
 """
 
-from rattail.db import model
+from rattail.db.model import Department, Product
 
 from webhelpers2.html import HTML
 
 from tailbone.views import MasterView
 
 
 class DepartmentView(MasterView):
     """
     Master view for the Department class.
     """
-    model_class = model.Department
+    model_class = Department
     touchable = True
     has_versions = True
     results_downloadable = True
     supports_autocomplete = True
 
     grid_columns = [
         'number',
         'name',
         'product',
         'personnel',
+        'tax',
+        'food_stampable',
         'exempt_from_gross_sales',
     ]
 
     form_fields = [
         'number',
         'name',
         'product',
         'personnel',
+        'tax',
+        'food_stampable',
         'exempt_from_gross_sales',
+        'default_custorder_discount',
         'allow_product_deletions',
         'employees',
     ]
 
     has_rows = True
-    model_row_class = model.Product
+    model_row_class = Product
     rows_title = "Products"
 
     row_labels = {
         'upc': "UPC",
     }
 
     row_grid_columns = [
@@ -74,41 +79,49 @@
         'size',
         'vendor',
         'regular_price',
         'current_price',
     ]
 
     def configure_grid(self, g):
-        super(DepartmentView, self).configure_grid(g)
+        super().configure_grid(g)
 
         # number
         g.set_sort_defaults('number')
         g.set_link('number')
 
         # name
         g.filters['name'].default_active = True
         g.filters['name'].default_verb = 'contains'
         g.set_link('name')
 
         g.set_type('product', 'boolean')
         g.set_type('personnel', 'boolean')
 
     def configure_form(self, f):
-        super(DepartmentView, self).configure_form(f)
+        super().configure_form(f)
 
         f.remove_field('subdepartments')
 
         if self.creating or self.editing:
             f.remove('employees')
         else:
             f.set_renderer('employees', self.render_employees)
 
         f.set_type('product', 'boolean')
         f.set_type('personnel', 'boolean')
 
+        # tax
+        f.set_renderer('tax', self.render_tax)
+        # TODO: make this editable
+        f.set_readonly('tax')
+
+        # default_custorder_discount
+        f.set_type('default_custorder_discount', 'percent')
+
     def render_employees(self, department, field):
         route_prefix = self.get_route_prefix()
         permission_prefix = self.get_permission_prefix()
 
         factory = self.get_grid_factory()
         g = factory(
             key='{}.employees'.format(route_prefix),
@@ -126,15 +139,15 @@
         if self.request.has_perm('employees.edit'):
             g.main_actions.append(self.make_action('edit', icon='edit'))
 
         return HTML.literal(
             g.render_buefy_table_element(data_prop='employeesData'))
 
     def template_kwargs_view(self, **kwargs):
-        kwargs = super(DepartmentView, self).template_kwargs_view(**kwargs)
+        kwargs = super().template_kwargs_view(**kwargs)
         department = kwargs['instance']
         department_employees = sorted(department.employees, key=str)
 
         employees = []
         for employee in department_employees:
             person = employee.person
             employees.append({
@@ -149,31 +162,33 @@
         return kwargs
 
     def before_delete(self, department):
         """
         Check to see if there are any products which belong to the department;
         if there are then we do not allow delete and redirect the user.
         """
+        model = self.model
         count = self.Session.query(model.Product)\
                             .filter(model.Product.department == department)\
                             .count()
         if count:
             self.request.session.flash("Will not delete department which still has {} products: {}".format(
                 count, department), 'error')
             raise self.redirect(self.get_action_url('view', department))
 
     def get_row_data(self, department):
+        model = self.model
         return self.Session.query(model.Product)\
                            .filter(model.Product.department == department)
 
     def get_parent(self, product):
         return product.department
 
     def configure_row_grid(self, g):
-        super(DepartmentView, self).configure_row_grid(g)
+        super().configure_row_grid(g)
 
         app = self.get_rattail_app()
         self.handler = app.get_products_handler()
         g.set_renderer('regular_price', self.render_price)
         g.set_renderer('current_price', self.render_price)
 
         g.set_sort_defaults('upc')
@@ -187,14 +202,15 @@
     def row_view_action_url(self, product, i):
         return self.request.route_url('products.view', uuid=product.uuid)
 
     def list_by_vendor(self):
         """
         View list of departments by vendor
         """
+        model = self.model
         data = self.Session.query(model.Department)\
                            .outerjoin(model.Product)\
                            .join(model.ProductCost)\
                            .join(model.Vendor)\
                            .filter(model.Vendor.uuid == self.request.params['uuid'])\
                            .distinct()\
                            .order_by(model.Department.name)
```

### Comparing `Tailbone-0.9.9/tailbone/views/poser/master.py` & `Tailbone-0.9.90/tailbone/views/poser/master.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/poser/reports.py` & `Tailbone-0.9.90/tailbone/views/poser/reports.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/poser/views.py` & `Tailbone-0.9.90/tailbone/views/poser/views.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/poser/__init__.py` & `Tailbone-0.9.90/tailbone/views/poser/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/settings.py` & `Tailbone-0.9.90/tailbone/views/settings.py`

 * *Files 0% similar despite different names*

```diff
@@ -24,20 +24,21 @@
 Settings Views
 """
 
 import os
 import re
 import subprocess
 import sys
+from collections import OrderedDict
 
 import json
 
 from rattail.db import model
 from rattail.settings import Setting
-from rattail.util import import_module_path, OrderedDict
+from rattail.util import import_module_path
 
 import colander
 
 from tailbone import forms
 from tailbone.db import Session
 from tailbone.views import MasterView, View
 from tailbone.util import get_libver, get_liburl
@@ -269,15 +270,15 @@
                                                setting.namespace,
                                                setting.name))
         groups = sorted(set([setting.group for setting in settings]))
         current_group = None
 
         form = self.make_form(settings)
         form.cancel_url = self.request.current_route_url()
-        if form.validate(newstyle=True):
+        if form.validate():
             self.save_form(form)
             group = self.request.POST.get('settings-group')
             if group is not None:
                 self.request.session['appsettings.current_group'] = group
             self.request.session.flash("App Settings have been saved.")
             return self.redirect(self.request.current_route_url())
```

### Comparing `Tailbone-0.9.9/tailbone/views/depositlinks.py` & `Tailbone-0.9.90/tailbone/views/depositlinks.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/__init__.py` & `Tailbone-0.9.90/tailbone/views/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/families.py` & `Tailbone-0.9.90/tailbone/views/families.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/trainwreck/defaults.py` & `Tailbone-0.9.90/tailbone/views/trainwreck/defaults.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/trainwreck/base.py` & `Tailbone-0.9.90/tailbone/views/trainwreck/base.py`

 * *Files 3% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Trainwreck views
 """
 
-from rattail.time import localtime
-
 from webhelpers2.html import HTML, tags
 
 from tailbone.db import Session, TrainwreckSession, ExtraTrainwreckSessions
 from tailbone.views import MasterView
 
 
 class TransactionView(MasterView):
@@ -40,14 +38,15 @@
     model_title = "Trainwreck Transaction"
     model_title_plural = "Trainwreck Transactions"
     route_prefix = 'trainwreck.transactions'
     url_prefix = '/trainwreck/transactions'
     creatable = False
     editable = False
     deletable = False
+    results_downloadable = True
 
     supports_multiple_engines = True
     engine_type_key = 'trainwreck'
     SessionDefault = TrainwreckSession
     SessionExtras = ExtraTrainwreckSessions
 
     configurable = True
@@ -148,23 +147,44 @@
     ]
 
     def get_db_engines(self):
         app = self.get_rattail_app()
         trainwreck_handler = app.get_trainwreck_handler()
         return trainwreck_handler.get_trainwreck_engines(include_hidden=False)
 
+    def make_isolated_session(self):
+        from rattail.trainwreck.db import Session as TrainwreckSession
+
+        dbkey = self.get_current_engine_dbkey()
+        if dbkey != 'default':
+            app = self.get_rattail_app()
+            trainwreck_handler = app.get_trainwreck_handler()
+            trainwreck_engines = trainwreck_handler.get_trainwreck_engines()
+            if dbkey in trainwreck_engines:
+                return TrainwreckSesssion(bind=trainwreck_engines[dbkey])
+
+        return TrainwreckSession()
+
     def configure_grid(self, g):
-        super(TransactionView, self).configure_grid(g)
+        super().configure_grid(g)
+        app = self.get_rattail_app()
+
         g.filters['receipt_number'].default_active = True
         g.filters['receipt_number'].default_verb = 'equal'
 
+        # end_time
+        g.set_sort_defaults('end_time', 'desc')
         g.filters['end_time'].default_active = True
         g.filters['end_time'].default_verb = 'equal'
-        g.filters['end_time'].default_value = str(localtime(self.rattail_config).date())
-        g.set_sort_defaults('end_time', 'desc')
+        # TODO: should expose this setting somewhere
+        if self.rattail_config.getbool('trainwreck', 'show_yesterday_first'):
+            date = app.yesterday()
+        else:
+            date = app.today()
+        g.filters['end_time'].default_value = str(date)
 
         g.set_enum('system', self.enum.TRAINWRECK_SYSTEM)
         g.set_type('total', 'currency')
         g.set_type('patronage', 'currency')
         g.set_label('terminal_id', "Terminal")
         g.set_label('receipt_number', "Receipt No.")
         g.set_label('customer_id', "Customer ID")
```

### Comparing `Tailbone-0.9.9/tailbone/views/trainwreck/__init__.py` & `Tailbone-0.9.90/tailbone/views/trainwreck/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/versions.py` & `Tailbone-0.9.90/tailbone/views/versions.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/views/messages.py` & `Tailbone-0.9.90/tailbone/views/messages.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,20 +80,20 @@
     def get_index_url(self, **kwargs):
         # not really used, but necessary to make certain other code happy
         return self.request.route_url('messages.inbox')
 
     def index(self):
         if not self.request.user:
             raise httpexceptions.HTTPForbidden
-        return super(MessageView, self).index()
+        return super().index()
 
     def get_instance(self):
         if not self.request.user:
             raise httpexceptions.HTTPForbidden
-        message = super(MessageView, self).get_instance()
+        message = super().get_instance()
         if not self.associated_with(message):
             raise httpexceptions.HTTPForbidden
         return message
 
     def associated_with(self, message):
         if message.sender is self.request.user:
             return True
@@ -104,19 +104,26 @@
 
     def query(self, session):
         return session.query(model.Message)\
                       .outerjoin(model.MessageRecipient)\
                       .filter(model.MessageRecipient.recipient == self.request.user)
 
     def configure_grid(self, g):
-        
-        g.joiners['sender'] = lambda q: q.join(model.User, model.User.uuid == model.Message.sender_uuid).outerjoin(model.Person)
-        g.filters['sender'] = g.make_filter('sender', model.Person.display_name,
-                                            default_active=True, default_verb='contains')
-        g.sorters['sender'] = g.make_sorter(model.Person.display_name)
+        super().configure_grid(g)
+        model = self.model
+
+        # sender
+        g.set_joiner('sender',
+                     lambda q: q.join(model.User,
+                                      model.User.uuid == model.Message.sender_uuid)\
+                     .outerjoin(model.Person))
+        g.set_sorter('sender', model.Person.display_name)
+        g.set_filter('sender', model.Person.display_name,
+                     default_active=True,
+                     default_verb='contains')
 
         g.filters['subject'].default_active = True
         g.filters['subject'].default_verb = 'contains'
 
         g.set_sort_defaults('sent', 'desc')
 
         g.set_renderer('sent', self.render_sent)
@@ -197,15 +204,15 @@
     #     if self.creating:
     #         form.id = 'new-message'
     #         form.cancel_url = self.request.get_referrer(default=self.request.route_url('messages.inbox'))
     #         form.create_label = "Send Message"
     #     return form
 
     def configure_form(self, f):
-        super(MessageView, self).configure_form(f)
+        super().configure_form(f)
 
         f.submit_label = "Send Message"
 
         # TODO: A fair amount of this still seems hacky...
 
         f.set_renderer('sender', self.render_sender)
         f.set_label('sender', "From")
@@ -217,19 +224,21 @@
         f.set_label('recipients', "To")
 
         # subject
         f.set_renderer('subject', self.render_subject_bold)
         if self.creating:
             f.set_widget('subject', dfwidget.TextInputWidget(
                 placeholder="please enter a subject",
-                autocomplete='off'))
+                autocomplete='off',
+                attributes={'@keydown.native': 'subjectKeydown'}))
             f.set_required('subject')
 
         # body
-        f.set_widget('body', dfwidget.TextAreaWidget(cols=50, rows=15))
+        f.set_widget('body', dfwidget.TextAreaWidget(
+            cols=50, rows=15, attributes={'ref': 'messageBody'}))
 
         if self.creating:
             f.remove('sender', 'sent')
 
             # recipients
             f.insert_after('recipients', 'set_recipients')
             f.remove('recipients')
@@ -268,15 +277,15 @@
 
         elif self.viewing:
             f.remove('body')
 
     def objectify(self, form, data=None):
         if data is None:
             data = form.validated
-        message = super(MessageView, self).objectify(form, data)
+        message = super().objectify(form, data)
 
         if self.creating:
             if self.request.user:
                 message.sender = self.request.user
 
             for uuid in data['set_recipients']:
                 user = self.Session.get(model.User, uuid)
@@ -457,15 +466,15 @@
     grid_key = 'messages.inbox'
     index_title = "Message Inbox"
 
     def get_index_url(self, **kwargs):
         return self.request.route_url('messages.inbox')
 
     def query(self, session):
-        q = super(InboxView, self).query(session)
+        q = super().query(session)
         return q.filter(model.MessageRecipient.status == self.enum.MESSAGE_STATUS_INBOX)
 
 
 class ArchiveView(MessageView):
     """
     Archived message view.
     """
@@ -473,15 +482,15 @@
     grid_key = 'messages.archive'
     index_title = "Message Archive"
 
     def get_index_url(self, **kwargs):
         return self.request.route_url('messages.archive')
 
     def query(self, session):
-        q = super(ArchiveView, self).query(session)
+        q = super().query(session)
         return q.filter(model.MessageRecipient.status == self.enum.MESSAGE_STATUS_ARCHIVE)
 
 
 class SentView(MessageView):
     """
     Sent messages view.
     """
@@ -494,15 +503,15 @@
         return self.request.route_url('messages.sent')
 
     def query(self, session):
         return session.query(model.Message)\
                       .filter(model.Message.sender == self.request.user)
 
     def configure_grid(self, g):
-        super(SentView, self).configure_grid(g)
+        super().configure_grid(g)
         g.filters['sender'].default_active = False
         g.joiners['recipients'] = lambda q: q.join(model.MessageRecipient)\
                                              .join(model.User, model.User.uuid == model.MessageRecipient.recipient_uuid)\
                                              .join(model.Person)
         g.filters['recipients'] = g.make_filter('recipients', model.Person.display_name,
                                                 default_active=True, default_verb='contains')
```

### Comparing `Tailbone-0.9.9/tailbone/helpers.py` & `Tailbone-0.9.90/tailbone/helpers.py`

 * *Files 11% similar despite different names*

```diff
@@ -20,23 +20,21 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Template Context Helpers
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import os
 import datetime
 from decimal import Decimal
+from collections import OrderedDict
 
 from rattail.time import localtime, make_utc
-from rattail.util import (pretty_quantity, pretty_hours, hours_as_decimal,
-                          OrderedDict)
+from rattail.util import pretty_quantity, pretty_hours, hours_as_decimal
 from rattail.db.util import maxlen
 
 from webhelpers2.html import *
 from webhelpers2.html.tags import *
 
 from tailbone.util import (csrf_token, get_csrf_token,
                            pretty_datetime, raw_datetime,
```

### Comparing `Tailbone-0.9.9/tailbone/api/products.py` & `Tailbone-0.9.90/tailbone/api/products.py`

 * *Files 15% similar despite different names*

```diff
@@ -121,14 +121,32 @@
                                                                  entry)
         if not product:
             return {'error': "Product not found"}
 
         return {'ok': True,
                 'product': self.normalize(product)}
 
+    def label_profiles(self):
+        """
+        Returns the set of label profiles available for use with
+        printing label for product.
+        """
+        app = self.get_rattail_app()
+        label_handler = app.get_label_handler()
+        model = self.model
+
+        profiles = []
+        for profile in label_handler.get_label_profiles(self.Session()):
+            profiles.append({
+                'uuid': profile.uuid,
+                'description': profile.description,
+            })
+
+        return {'label_profiles': profiles}
+
     def print_labels(self):
         app = self.get_rattail_app()
         label_handler = app.get_label_handler()
         model = self.model
         data = self.request.json_body
 
         uuid = data.get('label_profile_uuid')
@@ -172,14 +190,21 @@
         # quick lookup
         quick_lookup = Service(name='{}.quick_lookup'.format(route_prefix),
                                path='{}/quick-lookup'.format(collection_url_prefix))
         quick_lookup.add_view('GET', 'quick_lookup', klass=cls,
                               permission='{}.list'.format(permission_prefix))
         config.add_cornice_service(quick_lookup)
 
+        # label profiles
+        label_profiles = Service(name=f'{route_prefix}.label_profiles',
+                                 path=f'{collection_url_prefix}/label-profiles')
+        label_profiles.add_view('GET', 'label_profiles', klass=cls,
+                                permission=f'{permission_prefix}.print_labels')
+        config.add_cornice_service(label_profiles)
+
         # print labels
         print_labels = Service(name='{}.print_labels'.format(route_prefix),
                                path='{}/print-labels'.format(collection_url_prefix))
         print_labels.add_view('POST', 'print_labels', klass=cls,
                               permission='{}.print_labels'.format(permission_prefix))
         config.add_cornice_service(print_labels)
```

### Comparing `Tailbone-0.9.9/tailbone/api/customers.py` & `Tailbone-0.9.90/tailbone/api/customers.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/master.py` & `Tailbone-0.9.90/tailbone/api/master.py`

 * *Files 1% similar despite different names*

```diff
@@ -29,21 +29,15 @@
 from rattail.config import parse_bool
 from rattail.db.util import get_fieldnames
 
 from cornice import resource, Service
 
 from tailbone.api import APIView, api
 from tailbone.db import Session
-
-
-class SortColumn(object):
-
-    def __init__(self, field_name, model_name=None):
-        self.field_name = field_name
-        self.model_name = model_name
+from tailbone.util import SortColumn
 
 
 class APIMasterView(APIView):
     """
     Base class for data model REST API views.
     """
     listable = True
```

### Comparing `Tailbone-0.9.9/tailbone/api/vendors.py` & `Tailbone-0.9.90/tailbone/api/vendors.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/master2.py` & `Tailbone-0.9.90/tailbone/api/master2.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/upgrades.py` & `Tailbone-0.9.90/tailbone/api/upgrades.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/common.py` & `Tailbone-0.9.90/tailbone/api/common.py`

 * *Files 18% similar despite different names*

```diff
@@ -20,20 +20,23 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API - "Common" Views
 """
 
+from collections import OrderedDict
+
 import rattail
 from rattail.db import model
 from rattail.mail import send_email
-from rattail.util import OrderedDict
 
 from cornice import Service
+from cornice.service import get_services
+from cornice_swagger import CorniceSwagger
 
 import tailbone
 from tailbone import forms
 from tailbone.forms.common import Feedback
 from tailbone.api import APIView, api
 from tailbone.db import Session
 
@@ -84,15 +87,15 @@
         """
         View to handle user feedback form submits.
         """
         # TODO: this logic was copied from tailbone.views.common and is largely
         # identical; perhaps should merge somehow?
         schema = Feedback().bind(session=Session())
         form = forms.Form(schema=schema, request=self.request)
-        if form.validate(newstyle=True):
+        if form.validate():
             data = dict(form.validated)
 
             # figure out who the sending user is, if any
             if self.request.user:
                 data['user'] = self.request.user
             elif data['user']:
                 data['user'] = Session.get(model.User, data['user'])
@@ -104,32 +107,50 @@
             data['client_ip'] = self.request.client_addr
             email_key = data['email_key'] or self.feedback_email_key
             send_email(self.rattail_config, email_key, data=data)
             return {'ok': True}
 
         return {'error': "Form did not validate!"}
 
+    def swagger(self):
+        doc = CorniceSwagger(get_services())
+        app = self.get_rattail_app()
+        spec = doc.generate(f"{app.get_node_title()} API docs",
+                            app.get_version(),
+                            base_path='/api') # TODO
+        return spec
+
     @classmethod
     def defaults(cls, config):
         cls._common_defaults(config)
 
     @classmethod
     def _common_defaults(cls, config):
+        rattail_config = config.registry.settings.get('rattail_config')
+        app = rattail_config.get_app()
 
         # about
         about = Service(name='about', path='/about')
         about.add_view('GET', 'about', klass=cls)
         config.add_cornice_service(about)
 
         # feedback
         feedback = Service(name='feedback', path='/feedback')
         feedback.add_view('POST', 'feedback', klass=cls,
                           permission='common.feedback')
         config.add_cornice_service(feedback)
 
+        # swagger
+        swagger = Service(name='swagger',
+                          path='/swagger.json',
+                          description=f"OpenAPI documentation for {app.get_title()}")
+        swagger.add_view('GET', 'swagger', klass=cls,
+                         permission='common.api_swagger')
+        config.add_cornice_service(swagger)
+
 
 def defaults(config, **kwargs):
     base = globals()
 
     CommonView = kwargs.get('CommonView', base['CommonView'])
     CommonView.defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/api/auth.py` & `Tailbone-0.9.90/tailbone/api/auth.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API - Auth Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from rattail.db.auth import set_user_password
 
 from cornice import Service
 
 from tailbone.api import APIView, api
 from tailbone.db import Session
 from tailbone.auth import login_user, logout_user
@@ -164,14 +162,17 @@
         """
         if self.request.method == 'OPTIONS':
             return self.request.response
 
         if not self.request.user:
             raise self.forbidden()
 
+        if self.request.user.prevent_password_change and not self.request.is_root:
+            raise self.forbidden()
+
         data = self.request.json_body
 
         # first make sure "current" password is accurate
         if not self.authenticate_user(self.request.user, data['current_password']):
             return {'error': "The current/old password you provided is incorrect"}
 
         # okay then, set new password
```

### Comparing `Tailbone-0.9.9/tailbone/api/labels.py` & `Tailbone-0.9.90/tailbone/api/labels.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/people.py` & `Tailbone-0.9.90/tailbone/api/people.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/users.py` & `Tailbone-0.9.90/tailbone/api/users.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API - User Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from rattail.db import model
 
 from tailbone.api import APIMasterView
 
 
 class UserView(APIMasterView):
     """
@@ -53,14 +51,18 @@
         return self.sortcol(order_by)
 
     def join_for_sort_model(self, query, model_name):
         if model_name == 'Person':
             query = query.outerjoin(model.Person)
         return query
 
+    def update_object(self, user, data):
+        # TODO: should ensure prevent_password_change is respected
+        return super(UserView, self).update_object(user, data)
+
 
 def defaults(config, **kwargs):
     base = globals()
 
     UserView = kwargs.get('UserView', base['UserView'])
     UserView.defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/api/core.py` & `Tailbone-0.9.90/tailbone/api/core.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API - Core Views
 """
 
-from __future__ import unicode_literals, absolute_import
-
 from tailbone.views import View
 
 
 def api(view_meth):
     """
     Common decorator for all API views.  Ideally this would not be needed..but
     for now, alas, it is.
@@ -97,28 +95,28 @@
                # override display name
                info['display_name'] = "TODO"
                # remove short_name
                info.pop('short_name', None)
                return info
         """
         app = self.get_rattail_app()
-        auth_handler = app.get_auth_handler()
+        auth = app.get_auth_handler()
 
         # basic / default info
         is_admin = user.is_admin()
-        employee = user.employee
+        employee = app.get_employee(user)
         info = {
             'uuid': user.uuid,
             'username': user.username,
             'display_name': user.display_name,
-            'short_name': user.get_short_name(),
+            'short_name': auth.get_short_display_name(user),
             'is_admin': is_admin,
             'is_root': is_admin and self.request.session.get('is_root', False),
             'employee_uuid': employee.uuid if employee else None,
-            'email_address': auth_handler.get_email_address(user),
+            'email_address': app.get_contact_email_address(user),
         }
 
         # maybe get/use "extra" info
         extra = self.rattail_config.get('tailbone.api', 'extra_user_info',
                                         usedb=False)
         if extra:
             extra = app.load_object(extra)
```

### Comparing `Tailbone-0.9.9/tailbone/api/workorders.py` & `Tailbone-0.9.90/tailbone/api/workorders.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/batch/inventory.py` & `Tailbone-0.9.90/tailbone/api/batch/inventory.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,46 +20,43 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API - Inventory Batches
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import decimal
 
-import six
+import sqlalchemy as sa
 
 from rattail import pod
-from rattail.db import model
-from rattail.util import pretty_quantity
+from rattail.db.model import InventoryBatch, InventoryBatchRow
 
 from cornice import Service
 
 from tailbone.api.batch import APIBatchView, APIBatchRowView
 
 
 class InventoryBatchViews(APIBatchView):
 
-    model_class = model.InventoryBatch
+    model_class = InventoryBatch
     default_handler_spec = 'rattail.batch.inventory:InventoryBatchHandler'
     route_prefix = 'inventory'
     permission_prefix = 'batch.inventory'
     collection_url_prefix = '/inventory-batches'
     object_url_prefix = '/inventory-batch'
     supports_toggle_complete = True
 
     def normalize(self, batch):
-        data = super(InventoryBatchViews, self).normalize(batch)
+        data = super().normalize(batch)
 
         data['mode'] = batch.mode
         data['mode_display'] = self.enum.INVENTORY_MODE.get(batch.mode)
         if data['mode_display'] is None and batch.mode is not None:
-            data['mode_display'] = six.text_type(batch.mode)
+            data['mode_display'] = str(batch.mode)
 
         data['reason_code'] = batch.reason_code
 
         return data
 
     def count_modes(self):
         """
@@ -115,42 +112,43 @@
         adjustment_reasons.add_view('GET', 'adjustment_reasons', klass=cls,
                                     permission='{}.list'.format(permission_prefix))
         config.add_cornice_service(adjustment_reasons)
 
 
 class InventoryBatchRowViews(APIBatchRowView):
 
-    model_class = model.InventoryBatchRow
+    model_class = InventoryBatchRow
     default_handler_spec = 'rattail.batch.inventory:InventoryBatchHandler'
     route_prefix = 'inventory.rows'
     permission_prefix = 'batch.inventory'
     collection_url_prefix = '/inventory-batch-rows'
     object_url_prefix = '/inventory-batch-row'
     editable = True
     supports_quick_entry = True
 
     def normalize(self, row):
         batch = row.batch
-        data = super(InventoryBatchRowViews, self).normalize(row)
+        data = super().normalize(row)
+        app = self.get_rattail_app()
 
         data['item_id'] = row.item_id
-        data['upc'] = six.text_type(row.upc)
+        data['upc'] = str(row.upc)
         data['upc_pretty'] = row.upc.pretty() if row.upc else None
         data['brand_name'] = row.brand_name
         data['description'] = row.description
         data['size'] = row.size
         data['full_description'] = row.product.full_description if row.product else row.description
         data['image_url'] = pod.get_image_url(self.rattail_config, row.upc) if row.upc else None
-        data['case_quantity'] = pretty_quantity(row.case_quantity or 1)
+        data['case_quantity'] = app.render_quantity(row.case_quantity or 1)
 
         data['cases'] = row.cases
         data['units'] = row.units
         data['unit_uom'] = 'LB' if row.product and row.product.weighed else 'EA'
         data['quantity_display'] = "{} {}".format(
-            pretty_quantity(row.cases or row.units),
+            app.render_quantity(row.cases or row.units),
             'CS' if row.cases else data['unit_uom'])
 
         data['allow_cases'] = self.batch_handler.allow_cases(batch)
 
         return data
 
     def update_object(self, row, data):
@@ -170,15 +168,25 @@
         if 'units' in data:
             if data['units'] == '':
                 data['units'] = None
             elif data['units']:
                 data['units'] = decimal.Decimal(data['units'])
 
         # update row per usual
-        row = super(InventoryBatchRowViews, self).update_object(row, data)
+        try:
+            row = super().update_object(row, data)
+        except sa.exc.DataError as error:
+            # detect when user scans barcode for cases/units field
+            if hasattr(error, 'orig'):
+                orig = type(error.orig)
+                if hasattr(orig, '__name__'):
+                    # nb. this particular error is from psycopg2
+                    if orig.__name__ == 'NumericValueOutOfRange':
+                        return {'error': "Numeric value out of range"}
+            raise
         return row
 
 
 def defaults(config, **kwargs):
     base = globals()
 
     InventoryBatchViews = kwargs.get('InventoryBatchViews', base['InventoryBatchViews'])
```

### Comparing `Tailbone-0.9.9/tailbone/api/batch/receiving.py` & `Tailbone-0.9.90/tailbone/api/batch/receiving.py`

 * *Files 4% similar despite different names*

```diff
@@ -27,14 +27,15 @@
 import logging
 
 import humanize
 
 from rattail.db import model
 from rattail.util import pretty_quantity
 
+from cornice import Service
 from deform import widget as dfwidget
 
 from tailbone import forms
 from tailbone.api.batch import APIBatchView, APIBatchRowView
 from tailbone.forms.receiving import ReceiveRow
 
 
@@ -54,35 +55,42 @@
 
     def base_query(self):
         query = super(ReceivingBatchViews, self).base_query()
         query = query.filter(model.PurchaseBatch.mode == self.enum.PURCHASE_BATCH_MODE_RECEIVING)
         return query
 
     def normalize(self, batch):
-        data = super(ReceivingBatchViews, self).normalize(batch)
+        data = super().normalize(batch)
 
         data['vendor_uuid'] = batch.vendor.uuid
         data['vendor_display'] = str(batch.vendor)
 
         data['department_uuid'] = batch.department_uuid
         data['department_display'] = str(batch.department) if batch.department else None
 
+        data['po_number'] = batch.po_number
         data['po_total'] = batch.po_total
         data['invoice_total'] = batch.invoice_total
         data['invoice_total_calculated'] = batch.invoice_total_calculated
 
         data['can_auto_receive'] = self.batch_handler.can_auto_receive(batch)
 
         return data
 
     def create_object(self, data):
         data = dict(data)
+
+        # all about receiving mode here
         data['mode'] = self.enum.PURCHASE_BATCH_MODE_RECEIVING
-        batch = super(ReceivingBatchViews, self).create_object(data)
-        return batch
+
+        # assume "receive from PO" if given a PO key
+        if data.get('purchase_key'):
+            data['receiving_workflow'] = 'from_po'
+
+        return super().create_object(data)
 
     def auto_receive(self):
         """
         View which handles auto-marking as received, all items within
         a pending batch.
         """
         batch = self.get_object()
@@ -139,34 +147,34 @@
     @classmethod
     def _receiving_batch_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         permission_prefix = cls.get_permission_prefix()
         collection_url_prefix = cls.get_collection_url_prefix()
         object_url_prefix = cls.get_object_url_prefix()
 
-        # auto-receive
-        config.add_route('{}.auto_receive'.format(route_prefix),
-                         '{}/{{uuid}}/auto-receive'.format(object_url_prefix))
-        config.add_view(cls, attr='auto_receive',
-                        route_name='{}.auto_receive'.format(route_prefix),
-                        permission='{}.auto_receive'.format(permission_prefix),
-                        renderer='json')
-
-        # mark receiving complete
-        config.add_route('{}.mark_receiving_complete'.format(route_prefix), '{}/{{uuid}}/mark-receiving-complete'.format(object_url_prefix))
-        config.add_view(cls, attr='mark_receiving_complete', route_name='{}.mark_receiving_complete'.format(route_prefix),
-                        permission='{}.edit'.format(permission_prefix),
-                        renderer='json')
+        # auto_receive
+        auto_receive = Service(name='{}.auto_receive'.format(route_prefix),
+                               path='{}/{{uuid}}/auto-receive'.format(object_url_prefix))
+        auto_receive.add_view('GET', 'auto_receive', klass=cls,
+                              permission='{}.auto_receive'.format(permission_prefix))
+        config.add_cornice_service(auto_receive)
+
+        # mark_receiving_complete
+        mark_receiving_complete = Service(name='{}.mark_receiving_complete'.format(route_prefix),
+                                          path='{}/{{uuid}}/mark-receiving-complete'.format(object_url_prefix))
+        mark_receiving_complete.add_view('POST', 'mark_receiving_complete', klass=cls,
+                                         permission='{}.edit'.format(permission_prefix))
+        config.add_cornice_service(mark_receiving_complete)
 
         # eligible purchases
-        config.add_route('{}.eligible_purchases'.format(route_prefix), '{}/eligible-purchases'.format(collection_url_prefix),
-                         request_method='GET')
-        config.add_view(cls, attr='eligible_purchases', route_name='{}.eligible_purchases'.format(route_prefix),
-                        permission='{}.create'.format(permission_prefix),
-                        renderer='json')
+        eligible_purchases = Service(name='{}.eligible_purchases'.format(route_prefix),
+                                     path='{}/eligible-purchases'.format(collection_url_prefix))
+        eligible_purchases.add_view('GET', 'eligible_purchases', klass=cls,
+                                    permission='{}.create'.format(permission_prefix))
+        config.add_cornice_service(eligible_purchases)
 
 
 class ReceivingBatchRowViews(APIBatchRowView):
 
     model_class = model.PurchaseBatchRow
     default_handler_spec = 'rattail.batch.purchase:PurchaseBatchHandler'
     route_prefix = 'receiving.rows'
@@ -268,14 +276,23 @@
                     filters.extend([
                         {'or': [
                             {'field': 'cases_expired', 'op': '!=', 'value': 0},
                             {'field': 'units_expired', 'op': '!=', 'value': 0},
                         ]},
                     ])
 
+                # is_missing
+                elif filtr['field'] == 'is_missing' and filtr['op'] == 'eq' and filtr['value'] is True:
+                    filters.extend([
+                        {'or': [
+                            {'field': 'cases_missing', 'op': '!=', 'value': 0},
+                            {'field': 'units_missing', 'op': '!=', 'value': 0},
+                        ]},
+                    ])
+
                 else: # just some filter, use as-is
                     filters.append(filtr)
 
         return filters
 
     def normalize(self, row):
         data = super(ReceivingBatchRowViews, self).normalize(row)
@@ -314,21 +331,25 @@
 
         data['cases_damaged'] = row.cases_damaged
         data['units_damaged'] = row.units_damaged
 
         data['cases_expired'] = row.cases_expired
         data['units_expired'] = row.units_expired
 
+        data['cases_missing'] = row.cases_missing
+        data['units_missing'] = row.units_missing
+
         cases, units = self.batch_handler.get_unconfirmed_counts(row)
         data['cases_unconfirmed'] = cases
         data['units_unconfirmed'] = units
 
         data['po_unit_cost'] = row.po_unit_cost
         data['po_total'] = row.po_total
 
+        data['invoice_number'] = row.invoice_number
         data['invoice_unit_cost'] = row.invoice_unit_cost
         data['invoice_total'] = row.invoice_total
         data['invoice_total_calculated'] = row.invoice_total_calculated
 
         data['allow_cases'] = self.batch_handler.allow_cases()
 
         data['quick_receive'] = self.rattail_config.getbool(
@@ -402,17 +423,17 @@
         View which handles "receiving" against a particular batch row.
         """
         # first do basic input validation
         schema = ReceiveRow().bind(session=self.Session())
         form = forms.Form(schema=schema, request=self.request)
         # TODO: this seems hacky, but avoids "complex" date value parsing
         form.set_widget('expiration_date', dfwidget.TextInputWidget())
-        if not form.validate(newstyle=True):
-            log.debug("form did not validate: %s",
-                      form.make_deform_form().error)
+        if not form.validate():
+            log.warning("form did not validate: %s",
+                        form.make_deform_form().error)
             return {'error': "Form did not validate"}
 
         # fetch / validate row object
         row = self.Session.get(model.PurchaseBatchRow, form.validated['row'])
         if row is not self.get_object():
             return {'error': "Specified row does not match the route!"}
 
@@ -433,19 +454,19 @@
     @classmethod
     def _receiving_batch_row_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         permission_prefix = cls.get_permission_prefix()
         object_url_prefix = cls.get_object_url_prefix()
 
         # receive (row)
-        config.add_route('{}.receive'.format(route_prefix), '{}/{{uuid}}/receive'.format(object_url_prefix),
-                         request_method=('OPTIONS', 'POST'))
-        config.add_view(cls, attr='receive', route_name='{}.receive'.format(route_prefix),
-                        permission='{}.edit_row'.format(permission_prefix),
-                        renderer='json')
+        receive = Service(name='{}.receive'.format(route_prefix),
+                          path='{}/{{uuid}}/receive'.format(object_url_prefix))
+        receive.add_view('POST', 'receive', klass=cls,
+                         permission='{}.edit_row'.format(permission_prefix))
+        config.add_cornice_service(receive)
 
 
 def defaults(config, **kwargs):
     base = globals()
 
     ReceivingBatchViews = kwargs.get('ReceivingBatchViews', base['ReceivingBatchViews'])
     ReceivingBatchViews.defaults(config)
```

### Comparing `Tailbone-0.9.9/tailbone/api/batch/ordering.py` & `Tailbone-0.9.90/tailbone/api/batch/ordering.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -23,20 +23,16 @@
 """
 Tailbone Web API - Ordering Batches
 
 These views expose the basic CRUD interface to "ordering" batches, for the web
 API.
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import datetime
 
-import six
-
 from rattail.db import model
 from rattail.util import pretty_quantity
 
 from cornice import Service
 
 from tailbone.api.batch import APIBatchView, APIBatchRowView
 
@@ -63,18 +59,18 @@
         query = query.filter(model.PurchaseBatch.mode == self.enum.PURCHASE_BATCH_MODE_ORDERING)
         return query
 
     def normalize(self, batch):
         data = super(OrderingBatchViews, self).normalize(batch)
 
         data['vendor_uuid'] = batch.vendor.uuid
-        data['vendor_display'] = six.text_type(batch.vendor)
+        data['vendor_display'] = str(batch.vendor)
 
         data['department_uuid'] = batch.department_uuid
-        data['department_display'] = six.text_type(batch.department) if batch.department else None
+        data['department_display'] = str(batch.department) if batch.department else None
 
         data['po_total_calculated_display'] = "${:0.2f}".format(batch.po_total_calculated or 0)
         data['ship_method'] = batch.ship_method
         data['notes_to_vendor'] = batch.notes_to_vendor
         return data
 
     def create_object(self, data):
@@ -148,15 +144,15 @@
                     }
                 subdepartment_dict = subdepartments[None]
 
             subdept_costs = subdepartment_dict.setdefault('costs', [])
             product = cost.product
             subdept_costs.append({
                 'uuid': cost.uuid,
-                'upc': six.text_type(product.upc),
+                'upc': str(product.upc),
                 'upc_pretty': product.upc.pretty() if product.upc else None,
                 'brand_name': product.brand.name if product.brand else None,
                 'description': product.description,
                 'size': product.size,
                 'case_size': cost.case_size,
                 'uom_display': "LB" if product.weighed else "EA",
                 'vendor_item_code': cost.code,
@@ -169,26 +165,28 @@
                 # 'units_ordered': None,
                 # 'po_total': None,
                 # 'po_total_display': None,
             })
 
         # sort the (sub)department groupings
         sorted_departments = []
-        for dept in sorted(six.itervalues(departments), key=lambda d: d['name']):
-            dept['subdepartments'] = sorted(six.itervalues(dept['subdepartments']),
+        for dept in sorted(departments.values(), key=lambda d: d['name']):
+            dept['subdepartments'] = sorted(dept['subdepartments'].values(),
                                             key=lambda s: s['name'])
             sorted_departments.append(dept)
 
         # fetch recent purchase history, sort/pad for template convenience
         history = self.batch_handler.get_order_form_history(batch, costs, 6)
         for i in range(6 - len(history)):
             history.append(None)
         history = list(reversed(history))
         # must convert some date objects to string, for JSON sake
         for h in history:
+            if not h:
+                continue
             purchase = h.get('purchase')
             if purchase:
                 dt = purchase.get('date_ordered')
                 if dt and isinstance(dt, datetime.date):
                     purchase['date_ordered'] = app.render_date(dt)
                 dt = purchase.get('date_received')
                 if dt and isinstance(dt, datetime.date):
@@ -233,15 +231,15 @@
     editable = True
 
     def normalize(self, row):
         batch = row.batch
         data = super(OrderingBatchRowViews, self).normalize(row)
 
         data['item_id'] = row.item_id
-        data['upc'] = six.text_type(row.upc)
+        data['upc'] = str(row.upc)
         data['upc_pretty'] = row.upc.pretty() if row.upc else None
         data['brand_name'] = row.brand_name
         data['description'] = row.description
         data['size'] = row.size
         data['full_description'] = row.product.full_description if row.product else row.description
 
         # # only provide image url if so configured
@@ -258,15 +256,15 @@
         data['units_ordered_display'] = pretty_quantity(row.units_ordered or 0, empty_zero=False)
 
         data['po_unit_cost'] = row.po_unit_cost
         data['po_unit_cost_display'] = "${:0.2f}".format(row.po_unit_cost) if row.po_unit_cost is not None else None
         data['po_total_calculated'] = row.po_total_calculated
         data['po_total_calculated_display'] = "${:0.2f}".format(row.po_total_calculated) if row.po_total_calculated is not None else None
         data['status_code'] = row.status_code
-        data['status_display'] = row.STATUS.get(row.status_code, six.text_type(row.status_code))
+        data['status_display'] = row.STATUS.get(row.status_code, str(row.status_code))
 
         return data
 
     def update_object(self, row, data):
         """
         Overrides the default logic as follows:
```

### Comparing `Tailbone-0.9.9/tailbone/api/batch/labels.py` & `Tailbone-0.9.90/tailbone/api/batch/labels.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/api/batch/core.py` & `Tailbone-0.9.90/tailbone/api/batch/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -62,17 +62,15 @@
 
         Note that the 'key' for a batch is generally the same as its primary
         table name, although technically it is whatever value returns from the
         ``batch_key`` attribute of the main batch model class.
         """
         app = self.get_rattail_app()
         key = self.get_batch_class().batch_key
-        spec = self.rattail_config.get('rattail.batch', '{}.handler'.format(key),
-                                       default=self.default_handler_spec)
-        return app.load_object(spec)(self.rattail_config)
+        return app.get_batch_handler(key, default=self.default_handler_spec)
 
 
 class APIBatchView(APIBatchMixin, APIMasterView):
     """
     Base class for all API views which are meant to handle "batch" *and/or*
     "batch row" data.
     """
@@ -329,14 +327,17 @@
                         self.batch_handler.batch_key, batch.id_str, entry,
                         exc_info=True)
             msg = str(error)
             if not msg and isinstance(error, NotImplementedError):
                 msg = "Feature is not implemented"
             return {'error': msg}
 
+        if not row:
+            return {'error': "Could not identify product"}
+
         self.Session.flush()
         result = self._get(obj=row)
         result['ok'] = True
         return result
 
     @classmethod
     def defaults(cls, config):
@@ -344,17 +345,16 @@
         cls._batch_row_defaults(config)
 
     @classmethod
     def _batch_row_defaults(cls, config):
         route_prefix = cls.get_route_prefix()
         permission_prefix = cls.get_permission_prefix()
         collection_url_prefix = cls.get_collection_url_prefix()
-        object_url_prefix = cls.get_object_url_prefix()
 
         if cls.supports_quick_entry:
 
             # quick entry
-            config.add_route('{}.quick_entry'.format(route_prefix), '{}/quick-entry'.format(collection_url_prefix),
-                             request_method=('OPTIONS', 'POST'))
-            config.add_view(cls, attr='quick_entry', route_name='{}.quick_entry'.format(route_prefix),
-                            permission='{}.edit'.format(permission_prefix),
-                            renderer='json')
+            quick_entry = Service(name='{}.quick_entry'.format(route_prefix),
+                                  path='{}/quick-entry'.format(collection_url_prefix))
+            quick_entry.add_view('POST', 'quick_entry', klass=cls,
+                                 permission='{}.edit'.format(permission_prefix))
+            config.add_cornice_service(quick_entry)
```

### Comparing `Tailbone-0.9.9/tailbone/api/batch/__init__.py` & `Tailbone-0.9.90/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2019 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,13 +17,13 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-Tailbone Web API - Batches
+Setup script for Tailbone
 """
 
-from __future__ import unicode_literals, absolute_import
+from setuptools import setup
 
-from .core import APIBatchView, APIBatchRowView, BatchAPIMasterView
+setup()
```

### Comparing `Tailbone-0.9.9/tailbone/api/__init__.py` & `Tailbone-0.9.90/tailbone/api/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/exceptions.py` & `Tailbone-0.9.90/tailbone/exceptions.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/tweens.py` & `Tailbone-0.9.90/tailbone/tweens.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/providers.py` & `Tailbone-0.9.90/tailbone/providers.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/__init__.py` & `Tailbone-0.9.90/tailbone/__init__.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/asgi.py` & `Tailbone-0.9.90/tailbone/asgi.py`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/webapi.py` & `Tailbone-0.9.90/tailbone/webapi.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2021 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -20,60 +20,75 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Tailbone Web API
 """
 
-from __future__ import unicode_literals, absolute_import
+import simplejson
 
+from cornice.renderer import CorniceRenderer
 from pyramid.config import Configurator
-from pyramid.authentication import SessionAuthenticationPolicy
 
 from tailbone import app
-from tailbone.auth import TailboneAuthorizationPolicy
+from tailbone.auth import TailboneAuthenticationPolicy, TailboneAuthorizationPolicy
+from tailbone.providers import get_all_providers
 
 
 def make_rattail_config(settings):
     """
     Make a Rattail config object from the given settings.
     """
     rattail_config = app.make_rattail_config(settings)
     return rattail_config
 
 
 def make_pyramid_config(settings):
     """
     Make a Pyramid config object from the given settings.
     """
+    rattail_config = settings['rattail_config']
     pyramid_config = Configurator(settings=settings, root_factory=app.Root)
 
     # configure user authorization / authentication
+    pyramid_config.set_authentication_policy(TailboneAuthenticationPolicy())
     pyramid_config.set_authorization_policy(TailboneAuthorizationPolicy())
-    pyramid_config.set_authentication_policy(SessionAuthenticationPolicy())
 
     # always require CSRF token protection
     pyramid_config.set_default_csrf_options(require_csrf=True,
                                             token='_csrf',
                                             header='X-XSRF-TOKEN')
 
     # bring in some Pyramid goodies
     pyramid_config.include('tailbone.beaker')
     pyramid_config.include('pyramid_tm')
     pyramid_config.include('cornice')
 
+    # use simplejson to serialize cornice view context; cf.
+    # https://cornice.readthedocs.io/en/latest/upgrading.html#x-to-5-x
+    # https://docs.pylonsproject.org/projects/pyramid/en/latest/narr/renderers.html
+    json_renderer = CorniceRenderer(serializer=simplejson.dumps)
+    pyramid_config.add_renderer('cornicejson', json_renderer)
+
     # bring in the pyramid_retry logic, if available
     # TODO: pretty soon we can require this package, hopefully..
     try:
         import pyramid_retry
     except ImportError:
         pass
     else:
         pyramid_config.include('pyramid_retry')
 
+    # fetch all tailbone providers
+    providers = get_all_providers(rattail_config)
+    for provider in providers.values():
+
+        # configure DB sessions associated with transaction manager
+        provider.configure_db_sessions(rattail_config, pyramid_config)
+
     # add some permissions magic
     pyramid_config.add_directive('add_tailbone_permission_group', 'tailbone.auth.add_permission_group')
     pyramid_config.add_directive('add_tailbone_permission', 'tailbone.auth.add_permission')
 
     return pyramid_config
```

### Comparing `Tailbone-0.9.9/tailbone/static/files/vendor_catalog_template.xlsx` & `Tailbone-0.9.90/tailbone/static/files/vendor_catalog_template.xlsx`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/files/newproduct_template.xlsx` & `Tailbone-0.9.90/tailbone/static/files/newproduct_template.xlsx`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/codehilite.css` & `Tailbone-0.9.90/tailbone/static/css/codehilite.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/grids.css` & `Tailbone-0.9.90/tailbone/static/css/grids.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/forms.css` & `Tailbone-0.9.90/tailbone/static/css/forms.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/diffs.css` & `Tailbone-0.9.90/tailbone/static/css/diffs.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/progress.css` & `Tailbone-0.9.90/tailbone/static/css/progress.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/perms.css` & `Tailbone-0.9.90/tailbone/static/css/perms.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/layout.css` & `Tailbone-0.9.90/tailbone/static/css/layout.css`

 * *Files 17% similar despite different names*

```diff
@@ -53,25 +53,22 @@
 
 header span.header-text {
     font-size: 2em;
     font-weight: bold;
     margin-right: 10px;
 }
 
-header .level .theme-picker {
-    display: inline-flex;
-}
-
-#content-title {
-    padding: 0.3rem;
-}
-
 #content-title h1 {
-    font-size: 2rem;
-    margin-left: 1rem;
+    margin-bottom: 0;
+    margin-right: 1rem;
+    max-width: 50%;
+    overflow: hidden;
+    padding: 0 0.3rem;
+    text-overflow: ellipsis;
+    white-space: nowrap;
 }
 
 /******************************
  * content
  ******************************/
 
 #page-body {
```

### Comparing `Tailbone-0.9.9/tailbone/static/css/normalize.css` & `Tailbone-0.9.90/tailbone/static/css/normalize.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/timesheet.css` & `Tailbone-0.9.90/tailbone/static/css/timesheet.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/css/grids.rowstatus.css` & `Tailbone-0.9.90/tailbone/static/css/grids.rowstatus.css`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.oncebutton.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.oncebutton.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/debounce.js` & `Tailbone-0.9.90/tailbone/static/js/debounce.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.autocomplete.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.autocomplete.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/numeric.js` & `Tailbone-0.9.90/tailbone/static/js/numeric.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.feedback.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.feedback.js`

 * *Files 18% similar despite different names*

#### js-beautify {}

```diff
@@ -7,14 +7,15 @@
         pleaseReplyChanged(value) {
             this.$nextTick(() => {
                 this.$refs.userEmail.focus()
             })
         },
 
         showFeedback() {
+            this.referrer = location.href
             this.showDialog = true
             this.$nextTick(function() {
                 this.$refs.textarea.focus()
             })
         },
 
         sendFeedback() {
```

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.numericinput.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.numericinput.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.datepicker.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.datepicker.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.message_recipients.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.message_recipients.js`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/js/tailbone.buefy.grid.js` & `Tailbone-0.9.90/tailbone/static/js/tailbone.buefy.grid.js`

 * *Files 5% similar despite different names*

#### js-beautify {}

```diff
@@ -23,14 +23,25 @@
             } else {
                 this.startValue = this.value
             }
         } else {
             this.startValue = this.value
         }
     },
+    watch: {
+        // when changing from e.g. 'equal' to 'between' filter verbs,
+        // must proclaim new filter value, to reflect (lack of) range
+        wantsRange(val) {
+            if (val) {
+                this.$emit('input', this.startValue + '|' + this.endValue)
+            } else {
+                this.$emit('input', this.startValue)
+            }
+        },
+    },
     methods: {
         focus() {
             this.$refs.startValue.focus()
         },
         startValueChanged(value) {
             if (this.wantsRange) {
                 value += '|' + this.endValue
```

### Comparing `Tailbone-0.9.9/tailbone/static/img/loading.gif` & `Tailbone-0.9.90/tailbone/static/img/loading.gif`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/view.png` & `Tailbone-0.9.90/tailbone/static/img/view.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/save.png` & `Tailbone-0.9.90/tailbone/static/img/save.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/product.png` & `Tailbone-0.9.90/tailbone/static/img/product.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/edit.png` & `Tailbone-0.9.90/tailbone/static/img/edit.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/Hymenocephalus_italicus.jpg` & `Tailbone-0.9.90/tailbone/static/img/Hymenocephalus_italicus.jpg`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/home_logo.png` & `Tailbone-0.9.90/tailbone/static/img/home_logo.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/rattail.ico` & `Tailbone-0.9.90/tailbone/static/img/rattail.ico`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/testing.png` & `Tailbone-0.9.90/tailbone/static/img/testing.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/img/delete.png` & `Tailbone-0.9.90/tailbone/static/img/delete.png`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/tailbone/static/__init__.py` & `Tailbone-0.9.90/tasks.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2017 Lance Edgar
+#  Copyright  2010-2022 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,16 +17,34 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-Static Assets
+Tasks for Tailbone
 """
 
 from __future__ import unicode_literals, absolute_import
 
+import os
+import shutil
 
-def includeme(config):
-    config.add_static_view('tailbone', 'tailbone:static')
-    config.add_static_view('deform', 'deform:static')
+from invoke import task
+
+
+here = os.path.abspath(os.path.dirname(__file__))
+exec(open(os.path.join(here, 'tailbone', '_version.py')).read())
+
+
+@task
+def release(c, tests=False):
+    """
+    Release a new version of 'Tailbone'.
+    """
+    if tests:
+        c.run('tox')
+
+    if os.path.exists('Tailbone.egg-info'):
+        shutil.rmtree('Tailbone.egg-info')
+    c.run('python -m build --sdist')
+    c.run('twine upload dist/Tailbone-{}.tar.gz'.format(__version__))
```

### Comparing `Tailbone-0.9.9/tailbone/config.py` & `Tailbone-0.9.90/tailbone/config.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,16 +20,14 @@
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
 Rattail config extension for Tailbone
 """
 
-from __future__ import unicode_literals, absolute_import
-
 import warnings
 
 from rattail.config import ConfigExtension as BaseExtension
 from rattail.db.config import configure_session
 
 from tailbone.db import Session
 
@@ -47,15 +45,15 @@
     key = 'tailbone'
 
     def configure(self, config):
         Session.configure(rattail_config=config)
         configure_session(config, Session)
 
         # provide default theme selection
-        config.setdefault('tailbone', 'themes', 'default, falafel')
+        config.setdefault('tailbone', 'themes.keys', 'default, falafel')
         config.setdefault('tailbone', 'themes.expose_picker', 'true')
 
 
 def csrf_token_name(config):
     return config.get('tailbone', 'csrf_token_name', default='_csrf')
```

### Comparing `Tailbone-0.9.9/COPYING.txt` & `Tailbone-0.9.90/COPYING.txt`

 * *Files identical despite different names*

### Comparing `Tailbone-0.9.9/CHANGES.rst` & `Tailbone-0.9.90/CHANGES.rst`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,756 @@
 
 CHANGELOG
 =========
 
+Unreleased
+----------
+
+0.9.90 (2024-04-01)
+-------------------
+
+* Add basic CRUD for Person "preferred first name".
+
+
+0.9.89 (2024-03-27)
+-------------------
+
+* Fix bulk-delete rows for import/export batch.
+
+
+0.9.88 (2024-03-26)
+-------------------
+
+* Update some SQLAlchemy logic per upcoming 2.0 changes.
+
+
+0.9.87 (2023-12-26)
+-------------------
+
+* Auto-disable submit button for login form.
+
+* Hide single invoice file field for multi-invoice receiving batch.
+
+* Use common logic to render invoice total for receiving.
+
+* Expose default custorder discount for Departments.
+
+
+0.9.86 (2023-12-12)
+-------------------
+
+* Use ``ltrim(rtrim())`` instead of just ``trim()`` in grid filters.
+
+
+0.9.85 (2023-12-01)
+-------------------
+
+* Use clientele handler to populate customer dropdown widget.
+
+
+0.9.84 (2023-11-30)
+-------------------
+
+* Provide a way to show enum display text for some version diff fields.
+
+
+0.9.83 (2023-11-30)
+-------------------
+
+* Avoid error when editing a department.
+
+
+0.9.82 (2023-11-19)
+-------------------
+
+* Fix DB picker, theme picker per Buefy conventions.
+
+
+0.9.81 (2023-11-15)
+-------------------
+
+* Log warning instead of error for batch population error.
+
+* Remove reference to ``pytz`` library.
+
+* Avoid outright error if user scans barcode for inventory count.
+
+
+0.9.80 (2023-11-05)
+-------------------
+
+* Expose status code for equity payments.
+
+
+0.9.79 (2023-11-01)
+-------------------
+
+* Add button to confirm all costs for receiving.
+
+
+0.9.78 (2023-11-01)
+-------------------
+
+* Use shared logic to get batch handler.
+
+* Fix config key for default themes list.
+
+
+0.9.77 (2023-11-01)
+-------------------
+
+* Encode values for "between" query filter.
+
+* Avoid error when rendering version diff.
+
+
+0.9.76 (2023-11-01)
+-------------------
+
+* Fix missing import.
+
+
+0.9.75 (2023-11-01)
+-------------------
+
+* Add deprecation warnings for ambgiguous config keys.
+
+
+0.9.74 (2023-10-30)
+-------------------
+
+* Log warning / avoid error if email profile can't be normalized.
+
+
+0.9.73 (2023-10-29)
+-------------------
+
+* Add way to "ignore" a pending product.
+
+* Tweak param docs for ``Form.set_validator()``.
+
+* Remove unused "simple menus" module approach.
+
+
+0.9.72 (2023-10-26)
+-------------------
+
+* Use product lookup component for "resolve pending product" tool.
+
+
+0.9.71 (2023-10-25)
+-------------------
+
+* Fix bug when editing vendor.
+
+* Show user warning if "add item to custorder" fails.
+
+* Allow pending product fields to be required, for new custorder.
+
+* Add price confirm prompt when adding unknown item to custorder.
+
+* Use ``<b-select>`` for theme picker.
+
+* Add ``column_only`` kwarg for ``Grid.set_label()`` method.
+
+* Do not show profile buttons for inactive customer shoppers.
+
+* Add separate perm for making new custorder for unknown product.
+
+* Expand the "product lookup" component to include autocomplete.
+
+
+0.9.70 (2023-10-24)
+-------------------
+
+* Fix config file priority for display, and batch subprocess commands.
+
+
+0.9.69 (2023-10-24)
+-------------------
+
+* Allow override of version diff for master views.
+
+* No need to configure logging.
+
+
+0.9.68 (2023-10-23)
+-------------------
+
+* Expose more permissions for POS.
+
+* Fix order xlsx download if missing order date.
+
+* Replace dropdowns with autocomplete, for "find principals by perm".
+
+* Use ``Grid.make_sorter()`` instead of legacy code.
+
+* Avoid "None" when rendering product UOM field.
+
+* Fix default grid filter when "local" date times are involved.
+
+* Expose new fields for POS batch/row.
+
+* Remove sorter for "Credits?" column in purchasing batch row grid.
+
+* Add validation to prevent duplicate files for multi-invoice receiving.
+
+* Include invoice number for receiving batch row API.
+
+* Show food stamp tender info for POS batch.
+
+* Stop using sa-filters for basic grid sorting.
+
+
+0.9.67 (2023-10-12)
+-------------------
+
+* Fix grid sorting when column key/name differ.
+
+* Expose department tax, FS flag.
+
+* Add permission for testing error handling at POS.
+
+* Add some awareness of suspend/resume for POS batch.
+
+* Fix version child classes for Customers view.
+
+
+0.9.66 (2023-10-11)
+-------------------
+
+* Make grid JS ``loadAsyncData()`` method truly async.
+
+* Add support for multi-column grid sorting.
+
+* Add smarts to show display text for some version diff fields.
+
+* Allow null for FalafelDateTime form fields.
+
+* Show full version history within the "view" page.
+
+* Use autocomplete instead of dropdown for grid "add filter".
+
+
+0.9.65 (2023-10-07)
+-------------------
+
+* Avoid deprecated logic for fetching vendor contact email/phone.
+
+* Add "mark complete" button for inventory batch row entry page.
+
+* Expose tender ref in POS batch rows; new tender flags.
+
+* Improve views for taxes, esp. in POS batches.
+
+
+0.9.64 (2023-10-06)
+-------------------
+
+* Fix bug for param helptext in New Report page.
+
+
+0.9.63 (2023-10-06)
+-------------------
+
+* Fix CRUD pages for tempmon clients, probes.
+
+* Fix bug in POS batch view.
+
+* Expose permissions for POS, if so configured.
+
+
+0.9.62 (2023-10-04)
+-------------------
+
+* Avoid deprecated ``pretty_hours()`` function.
+
+* Improve master view ``oneoff_import()`` method.
+
+
+0.9.61 (2023-10-04)
+-------------------
+
+* Use enum to display ``POS_ROW_TYPE``.
+
+* Expose cash-back flags for tenders.
+
+* Re-work FalafelDateTime logic a bit.
+
+
+0.9.60 (2023-10-01)
+-------------------
+
+* Do not allow executing custorder if no customer is set.
+
+* Add clone support for POS batches.
+
+* Expose views for tenders, more columns for POS batch/rows.
+
+* Tidy up logic for vendor filtering in products grid.
+
+* Add support for void rows in POS batch.
+
+
+0.9.59 (2023-09-25)
+-------------------
+
+* Add custom form type/widget for time fields.
+
+
+0.9.58 (2023-09-25)
+-------------------
+
+* Expose POS batch views as "typical".
+
+
+0.9.57 (2023-09-24)
+-------------------
+
+* Show yesterday by default for Trainwreck if so configured.
+
+* Add ``remove_sorter()`` method for grids.
+
+* Show "true" (calculated) equity total in members grid.
+
+* Add basic views for POS batches.
+
+* Show customer for POS batches.
+
+* Use header button instead of link for "touch" instance.
+
+
+0.9.56 (2023-09-19)
+-------------------
+
+* Add link to vendor name for receiving batches grid.
+
+* Prevent catalog/invoice cost edits if receiving batch is complete.
+
+* Use small text input for receiving cost editor fields.
+
+* Show catalog/invoice costs as 2-decimal currency in receiving.
+
+
+0.9.55 (2023-09-18)
+-------------------
+
+* Show user warning if receive quick lookup fails.
+
+* Fix bug for new receiving from scratch via API.
+
+
+0.9.54 (2023-09-17)
+-------------------
+
+* Add "falafel" custom date/time field type and widget.
+
+* Avoid error when history has blanks for ordering worksheet.
+
+* Include PO number for receiving batch details via API.
+
+* Tweaks to improve handling of "missing" items for receiving.
+
+
+0.9.53 (2023-09-16)
+-------------------
+
+* Make member key field readonly when viewing equity payment.
+
+
+0.9.52 (2023-09-15)
+-------------------
+
+* Add basic feature for "grid totals".
+
+
+0.9.51 (2023-09-15)
+-------------------
+
+* Tweak default field list for batch views.
+
+* Add ``get_rattail_app()`` method for view supplements.
+
+
+0.9.50 (2023-09-12)
+-------------------
+
+* Avoid legacy logic for ``Customer.people`` schema.
+
+* Show events instead of notes, in field subgrid for custorder item.
+
+
+0.9.49 (2023-09-11)
+-------------------
+
+* Add custom hook for grid "apply filters".
+
+* Use common POST logic for submitting new customer order.
+
+* Optionally configure SQLAlchemy Session with ``future=True``.
+
+* Show related customer orders for Pending Product view.
+
+* Set stacklevel for all deprecation warnings.
+
+* Add support for toggling custorder item "flagged".
+
+* Add support for "mark received" when viewing custorder item.
+
+* Misc. improvements for custorder views.
+
+
+0.9.48 (2023-09-08)
+-------------------
+
+* Add grid link for equity payment description.
+
+* Fix msg body display, download link for email bounces.
+
+* Fix member key display for equity payment form.
+
+
+0.9.47 (2023-09-07)
+-------------------
+
+* Fallback to None when getting values for merge preview.
+
+
+0.9.46 (2023-09-07)
+-------------------
+
+* Improve display for member equity payments.
+
+
+0.9.45 (2023-09-02)
+-------------------
+
+* Add grid filter type for BigInteger columns.
+
+* Add products API route to fetch label profiles for use w/ printing.
+
+* Tweaks for cost editing within a receiving batch.
+
+
+0.9.44 (2023-08-31)
+-------------------
+
+* Avoid deprecated ``User.email_address`` property.
+
+* Preserve URL hash when redirecting in grid "reset to defaults".
+
+
+0.9.43 (2023-08-30)
+-------------------
+
+* Let "new product" batch override type-2 UPC lookup behavior.
+
+
+0.9.42 (2023-08-29)
+-------------------
+
+* When bulk-deleting, skip objects which are not "deletable".
+
+* Declare "from PO" receiving workflow if applicable, in API.
+
+* Auto-select text when editing costs for receiving.
+
+* Include shopper history from parent customer account perspective.
+
+* Link to product record, for New Product batch row.
+
+* Fix profile history to show when a CustomerShopperHistory is deleted.
+
+* Fairly massive overhaul of the Profile view; standardize tabs etc..
+
+* Add support for "missing" credit in mobile receiving.
+
+
+0.9.41 (2023-08-08)
+-------------------
+
+* Add common logic to validate employee reference field.
+
+* Fix HTML rendering for UOM choice options.
+
+* Fix custom cell click handlers in main buefy grid tables.
+
+
+0.9.40 (2023-08-03)
+-------------------
+
+* Make system key searchable for problem report grid.
+
+
+0.9.39 (2023-07-15)
+-------------------
+
+* Show invoice number for each row in receiving.
+
+* Tweak display options for tempmon probe readings graph.
+
+
+0.9.38 (2023-07-07)
+-------------------
+
+* Optimize "auto-receive" batch process.
+
+
+0.9.37 (2023-07-03)
+-------------------
+
+* Avoid deprecated product key field getter.
+
+* Allow "arbitrary" PO attachment to purchase batch.
+
+
+0.9.36 (2023-06-20)
+-------------------
+
+* Include user "active" flag in profile view context.
+
+
+0.9.35 (2023-06-20)
+-------------------
+
+* Add views etc. for member equity payments.
+
+* Improve merge support for records with no uuid.
+
+* Turn on quickie person search for CustomerShopper views.
+
+
+0.9.34 (2023-06-17)
+-------------------
+
+* Add basic Shopper tab for profile view.
+
+* Cleanup some wording in profile view template.
+
+* Tweak ``SimpleRequestMixin`` to not rely on ``response.data.ok``.
+
+* Add support for Notes tab in profile view.
+
+* Add basic support for Person quickie lookup.
+
+* Hide unwanted revisions for CustomerPerson etc.
+
+* Fix some things for viewing a member.
+
+
+0.9.33 (2023-06-16)
+-------------------
+
+* Update usage of app handler per upstream changes.
+
+
+0.9.32 (2023-06-16)
+-------------------
+
+* Fix grid filter bug when switching from 'equal' to 'between' verbs.
+
+* Add users context data for profile view.
+
+* Join the Person model for Customers grid differently based on config.
+
+
+0.9.31 (2023-06-15)
+-------------------
+
+* Prefer account holder, shoppers over legacy ``Customers.people``.
+
+
+0.9.30 (2023-06-12)
+-------------------
+
+* Add basic support for exposing ``Customer.shoppers``.
+
+* Move "view history" and related buttons, for person profile view.
+
+* Consider vendor catalog batch views "typical".
+
+* Let external customer link buttons be more dynamic, for profile view.
+
+* Add options for grid results to link straight to Profile view.
+
+* Change label for Member.person to "Account Holder".
+
+
+0.9.29 (2023-06-06)
+-------------------
+
+* Add "typical" view config, for e.g. Theo and the like.
+
+* Add customer number filter for People grid.
+
+* Tweak logic for ``MasterView.get_action_route_kwargs()``.
+
+* Add "touch" support for Members.
+
+* Add support for "configured customer/member key".
+
+* Use *actual* current URL for user feedback msg.
+
+* Remove old/unused feedback templates.
+
+* Add basic support for membership types.
+
+* Add support for version history in person profile view.
+
+
+0.9.28 (2023-06-02)
+-------------------
+
+* Expose mail handler and template paths in email config page.
+
+
+0.9.27 (2023-06-01)
+-------------------
+
+* Share some code for validating vendor field.
+
+* Save datasync config with new keys, per RattailConfiguration.
+
+
+0.9.26 (2023-05-25)
+-------------------
+
+* Prevent bug in upgrade diff for empty new version.
+
+* Expose basic way to send test email.
+
+* Avoid error when filter params not valid.
+
+* Tweak byjove project generator form.
+
+* Define essential views for API.
+
+
+0.9.25 (2023-05-18)
+-------------------
+
+* Add initial swagger.json endpoint for API.
+
+* Add workaround for "share grid link" on insecure sites.
+
+
+0.9.24 (2023-05-16)
+-------------------
+
+* Replace ``setup.py`` contents with ``setup.cfg``.
+
+* Prevent error in old product search logic.
+
+
+0.9.23 (2023-05-15)
+-------------------
+
+* Get rid of ``newstyle`` flag for ``Form.validate()`` method.
+
+* Add basic support for managing, and accepting API tokens.
+
+
+0.9.22 (2023-05-13)
+-------------------
+
+* Tweak button wording in "find role by perm" form.
+
+* Warn user if DB not up to date, in new table wizard.
+
+
+0.9.21 (2023-05-10)
+-------------------
+
+* Move row delete check logic for receiving to batch handler.
+
+
+0.9.20 (2023-05-09)
+-------------------
+
+* Add form config for generating 'shopfoo' projects.
+
+* Misc. tweaks for "run import job" form.
+
+
+0.9.19 (2023-05-05)
+-------------------
+
+* Massive overhaul of "generate project" feature.
+
+* Include project views by default, in "essential" views.
+
+
+0.9.18 (2023-05-03)
+-------------------
+
+* Avoid error if tempmon probe has invalid status.
+
+* Expose, honor the ``prevent_password_change`` flag for Users.
+
+
+0.9.17 (2023-04-17)
+-------------------
+
+* Allow bulk-delete for products grid.
+
+* Improve global menu search behavior for multiple terms.
+
+
+0.9.16 (2023-03-27)
+-------------------
+
+* Avoid accidental auto-submit of new msg form, for subject field.
+
+* Add ``has_perm()`` etc. to request during the NewRequest event.
+
+* Fix table sorting for FK reference column in new table wizard.
+
+* Overhaul the "find by perm" feature a bit.
+
+
+0.9.15 (2023-03-15)
+-------------------
+
+* Remove version workaround for sphinx.
+
+* Let providers do DB connection setup for web API.
+
+
+0.9.14 (2023-03-09)
+-------------------
+
+* Fix JSON rendering for Cornice API views.
+
+
+0.9.13 (2023-03-08)
+-------------------
+
+* Remove version cap for cornice, now that we require python3.
+
+
+0.9.12 (2023-03-02)
+-------------------
+
+* Add "equal to any of" verb for string-type grid filters.
+
+* Allow download results for Trainwreck.
+
+
+0.9.11 (2023-02-24)
+-------------------
+
+* Allow sort/filter by vendor for sample files grid.
+
+
+0.9.10 (2023-02-22)
+-------------------
+
+* Add views for sample vendor files.
+
+
 0.9.9 (2023-02-21)
 ------------------
 
 * Validate vendor for catalog batch upload.
 
 
 0.9.8 (2023-02-20)
```

### Comparing `Tailbone-0.9.9/tasks.py` & `Tailbone-0.9.90/tailbone/views/tenders.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # -*- coding: utf-8; -*-
 ################################################################################
 #
 #  Rattail -- Retail Software Framework
-#  Copyright  2010-2022 Lance Edgar
+#  Copyright  2010-2023 Lance Edgar
 #
 #  This file is part of Rattail.
 #
 #  Rattail is free software: you can redistribute it and/or modify it under the
 #  terms of the GNU General Public License as published by the Free Software
 #  Foundation, either version 3 of the License, or (at your option) any later
 #  version.
@@ -17,34 +17,69 @@
 #  details.
 #
 #  You should have received a copy of the GNU General Public License along with
 #  Rattail.  If not, see <http://www.gnu.org/licenses/>.
 #
 ################################################################################
 """
-Tasks for Tailbone
+Views for tenders
 """
 
-from __future__ import unicode_literals, absolute_import
+from rattail.db.model import Tender
 
-import os
-import shutil
+from tailbone.views import MasterView
 
-from invoke import task
 
+class TenderView(MasterView):
+    """
+    Master view for the Tender class.
+    """
+    model_class = Tender
+    has_versions = True
 
-here = os.path.abspath(os.path.dirname(__file__))
-exec(open(os.path.join(here, 'tailbone', '_version.py')).read())
+    grid_columns = [
+        'code',
+        'name',
+        'is_cash',
+        'is_foodstamp',
+        'allow_cash_back',
+        'kick_drawer',
+    ]
 
+    form_fields = [
+        'code',
+        'name',
+        'is_cash',
+        'is_foodstamp',
+        'allow_cash_back',
+        'kick_drawer',
+        'notes',
+        'disabled',
+    ]
+
+    def configure_grid(self, g):
+        super().configure_grid(g)
+
+        g.set_link('code')
+
+        g.set_link('name')
+        g.set_sort_defaults('name')
+
+    def grid_extra_class(self, tender, i):
+        if tender.disabled:
+            return 'warning'
+
+    def configure_form(self, f):
+        super().configure_form(f)
+
+        f.set_type('notes', 'text')
+
+
+def defaults(config, **kwargs):
+    base = globals()
+
+    TenderView = kwargs.get('TenderView', base['TenderView'])
+    TenderView.defaults(config)
 
-@task
-def release(c, tests=False):
-    """
-    Release a new version of 'Tailbone'.
-    """
-    if tests:
-        c.run('tox')
 
-    if os.path.exists('Tailbone.egg-info'):
-        shutil.rmtree('Tailbone.egg-info')
-    c.run('python -m build --sdist')
-    c.run('twine upload dist/Tailbone-{}.tar.gz'.format(__version__))
+def includeme(config):
+    defaults(config)
```

### Comparing `Tailbone-0.9.9/Tailbone.egg-info/SOURCES.txt` & `Tailbone-0.9.90/Tailbone.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -34,14 +34,15 @@
 tailbone/util.py
 tailbone/webapi.py
 tailbone/api/__init__.py
 tailbone/api/auth.py
 tailbone/api/common.py
 tailbone/api/core.py
 tailbone/api/customers.py
+tailbone/api/essentials.py
 tailbone/api/labels.py
 tailbone/api/master.py
 tailbone/api/master2.py
 tailbone/api/people.py
 tailbone/api/products.py
 tailbone/api/upgrades.py
 tailbone/api/users.py
@@ -110,21 +111,17 @@
 tailbone/templates/base.mako
 tailbone/templates/base_meta.mako
 tailbone/templates/change_password.mako
 tailbone/templates/configure-menus.mako
 tailbone/templates/configure.mako
 tailbone/templates/diff.mako
 tailbone/templates/exception.mako
-tailbone/templates/feedback.mako
-tailbone/templates/feedback_dialog.mako
-tailbone/templates/feedback_dialog_buefy.mako
 tailbone/templates/form.mako
 tailbone/templates/formposter.mako
 tailbone/templates/generate_feature.mako
-tailbone/templates/generate_project.mako
 tailbone/templates/home.mako
 tailbone/templates/login.mako
 tailbone/templates/menu.mako
 tailbone/templates/multi_file_upload.mako
 tailbone/templates/page.mako
 tailbone/templates/page_help.mako
 tailbone/templates/progress.mako
@@ -136,35 +133,38 @@
 tailbone/templates/batch/edit.mako
 tailbone/templates/batch/index.mako
 tailbone/templates/batch/view.mako
 tailbone/templates/batch/worksheet.mako
 tailbone/templates/batch/importer/view_row.mako
 tailbone/templates/batch/inventory/desktop_form.mako
 tailbone/templates/batch/newproduct/configure.mako
+tailbone/templates/batch/pos/view.mako
 tailbone/templates/batch/pricing/configure.mako
 tailbone/templates/batch/vendorcatalog/configure.mako
 tailbone/templates/batch/vendorcatalog/create.mako
 tailbone/templates/batch/vendorcatalog/index.mako
 tailbone/templates/batch/vendorcatalog/view_row.mako
 tailbone/templates/customers/configure.mako
 tailbone/templates/customers/view.mako
 tailbone/templates/customers/pending/view.mako
 tailbone/templates/custorders/configure.mako
 tailbone/templates/custorders/create.mako
+tailbone/templates/custorders/view.mako
 tailbone/templates/custorders/items/view.mako
 tailbone/templates/datasync/configure.mako
 tailbone/templates/datasync/status.mako
 tailbone/templates/datasync/changes/index.mako
 tailbone/templates/deform/autocomplete_jquery.pt
 tailbone/templates/deform/cases_units.pt
 tailbone/templates/deform/checkbox.pt
 tailbone/templates/deform/checkbox_dynamic.pt
 tailbone/templates/deform/checked_password.pt
 tailbone/templates/deform/date_jquery.pt
 tailbone/templates/deform/date_plain.pt
+tailbone/templates/deform/datetime_falafel.pt
 tailbone/templates/deform/file_upload.pt
 tailbone/templates/deform/message_recipients_buefy.pt
 tailbone/templates/deform/multi_file_upload.pt
 tailbone/templates/deform/numberinput.pt
 tailbone/templates/deform/numericinput.pt
 tailbone/templates/deform/password.pt
 tailbone/templates/deform/percentinput.pt
@@ -172,27 +172,28 @@
 tailbone/templates/deform/problem_report_days.pt
 tailbone/templates/deform/select.pt
 tailbone/templates/deform/select_dynamic.pt
 tailbone/templates/deform/select_jquery.pt
 tailbone/templates/deform/select_plain.pt
 tailbone/templates/deform/textarea.pt
 tailbone/templates/deform/textinput.pt
+tailbone/templates/deform/time_falafel.pt
 tailbone/templates/deform/time_jquery.pt
 tailbone/templates/departments/view.mako
 tailbone/templates/email-bounces/view.mako
+tailbone/templates/employees/configure.mako
 tailbone/templates/employees/view.mako
 tailbone/templates/forms/deform_buefy.mako
 tailbone/templates/forms/form.mako
 tailbone/templates/forms/util.mako
+tailbone/templates/generated-projects/create.mako
 tailbone/templates/grids/b-table.mako
 tailbone/templates/grids/buefy.mako
-tailbone/templates/grids/complete.mako
 tailbone/templates/grids/filters.mako
 tailbone/templates/grids/filters_buefy.mako
-tailbone/templates/grids/grid.mako
 tailbone/templates/grids/nav.mako
 tailbone/templates/ifps-plu-codes/index.mako
 tailbone/templates/importing/configure.mako
 tailbone/templates/importing/index.mako
 tailbone/templates/importing/runjob.mako
 tailbone/templates/importing/view.mako
 tailbone/templates/labels/profiles/create.mako
@@ -212,25 +213,27 @@
 tailbone/templates/master/import_file.mako
 tailbone/templates/master/index.mako
 tailbone/templates/master/merge.mako
 tailbone/templates/master/versions.mako
 tailbone/templates/master/view.mako
 tailbone/templates/master/view_row.mako
 tailbone/templates/master/view_version.mako
+tailbone/templates/members/configure.mako
 tailbone/templates/members/view.mako
 tailbone/templates/messages/create.mako
 tailbone/templates/messages/index.mako
 tailbone/templates/messages/recipients.mako
 tailbone/templates/messages/view.mako
 tailbone/templates/messages/archive/index.mako
 tailbone/templates/messages/inbox/index.mako
 tailbone/templates/messages/sent/index.mako
 tailbone/templates/ordering/create.mako
 tailbone/templates/ordering/view.mako
 tailbone/templates/ordering/worksheet.mako
+tailbone/templates/people/configure.mako
 tailbone/templates/people/index.mako
 tailbone/templates/people/view.mako
 tailbone/templates/people/view_profile_buefy.mako
 tailbone/templates/people/merge-requests/view.mako
 tailbone/templates/poser/setup.mako
 tailbone/templates/poser/reports/view.mako
 tailbone/templates/poser/views/configure.mako
@@ -274,14 +277,16 @@
 tailbone/templates/shifts/schedule.mako
 tailbone/templates/shifts/schedule_edit.mako
 tailbone/templates/shifts/schedule_print.mako
 tailbone/templates/shifts/schedule_print_employee.mako
 tailbone/templates/shifts/timesheet.mako
 tailbone/templates/shifts/timesheet_edit.mako
 tailbone/templates/tables/create.mako
+tailbone/templates/tables/index.mako
+tailbone/templates/tables/migrations.mako
 tailbone/templates/tempmon/dashboard.mako
 tailbone/templates/tempmon/appliances/index.mako
 tailbone/templates/tempmon/appliances/view.mako
 tailbone/templates/tempmon/clients/index.mako
 tailbone/templates/tempmon/clients/view.mako
 tailbone/templates/tempmon/probes/graph.mako
 tailbone/templates/tempmon/probes/index.mako
@@ -342,14 +347,16 @@
 tailbone/views/reports.py
 tailbone/views/roles.py
 tailbone/views/settings.py
 tailbone/views/stores.py
 tailbone/views/subdepartments.py
 tailbone/views/tables.py
 tailbone/views/taxes.py
+tailbone/views/tenders.py
+tailbone/views/typical.py
 tailbone/views/uoms.py
 tailbone/views/upgrades.py
 tailbone/views/users.py
 tailbone/views/versions.py
 tailbone/views/views.py
 tailbone/views/workorders.py
 tailbone/views/asgi/__init__.py
@@ -359,14 +366,15 @@
 tailbone/views/batch/core.py
 tailbone/views/batch/delproduct.py
 tailbone/views/batch/handheld.py
 tailbone/views/batch/importer.py
 tailbone/views/batch/inventory.py
 tailbone/views/batch/labels.py
 tailbone/views/batch/newproduct.py
+tailbone/views/batch/pos.py
 tailbone/views/batch/pricing.py
 tailbone/views/batch/product.py
 tailbone/views/batch/vendorcatalog.py
 tailbone/views/batch/vendorinvoice.py
 tailbone/views/custorders/__init__.py
 tailbone/views/custorders/batch.py
 tailbone/views/custorders/creating.py
@@ -401,8 +409,11 @@
 tailbone/views/tempmon/readings.py
 tailbone/views/trainwreck/__init__.py
 tailbone/views/trainwreck/base.py
 tailbone/views/trainwreck/defaults.py
 tailbone/views/vendors/__init__.py
 tailbone/views/vendors/catalogs.py
 tailbone/views/vendors/core.py
-tailbone/views/vendors/invoices.py
+tailbone/views/vendors/invoices.py
+tailbone/views/vendors/samplefiles.py
+tests/test_app.py
+tests/test_helpers.py
```

