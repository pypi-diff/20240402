# Comparing `tmp/asktable-0.13.3-py3-none-any.whl.zip` & `tmp/asktable-0.13.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,34 @@
-Zip file size: 26749 bytes, number of entries: 32
--rw-r--r--  2.0 unx       86 b- defN 24-Apr-01 06:18 asktable/__init__.py
+Zip file size: 27960 bytes, number of entries: 32
+-rw-r--r--  2.0 unx       86 b- defN 24-Apr-02 15:29 asktable/__init__.py
 -rw-r--r--  2.0 unx     2180 b- defN 24-Apr-01 06:16 asktable/api.py
 -rw-r--r--  2.0 unx     1667 b- defN 24-Apr-01 06:16 asktable/cli.py
 -rw-r--r--  2.0 unx     1220 b- defN 24-Apr-01 06:16 asktable/client.py
 -rw-r--r--  2.0 unx       41 b- defN 24-Apr-01 06:16 asktable/exceptions.py
 -rw-r--r--  2.0 unx      875 b- defN 24-Apr-01 06:44 asktable/log.py
 -rw-r--r--  2.0 unx     1492 b- defN 24-Apr-01 06:16 asktable/upload.py
 -rw-r--r--  2.0 unx      152 b- defN 24-Apr-01 06:16 asktable/models/__init__.py
 -rw-r--r--  2.0 unx     2588 b- defN 24-Apr-01 06:16 asktable/models/base.py
 -rw-r--r--  2.0 unx     2769 b- defN 24-Apr-01 06:16 asktable/models/chat.py
--rw-r--r--  2.0 unx     6371 b- defN 24-Apr-02 12:05 asktable/models/datasource.py
+-rw-r--r--  2.0 unx     7671 b- defN 24-Apr-02 15:29 asktable/models/datasource.py
 -rw-r--r--  2.0 unx     1264 b- defN 24-Apr-01 06:16 asktable/models/message.py
 -rw-r--r--  2.0 unx      878 b- defN 24-Apr-01 06:16 asktable/models/run.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Dec-08 14:27 atcommon/__init__.py
 -rw-r--r--  2.0 unx     3352 b- defN 24-Mar-20 07:26 atcommon/tools.py
--rw-r--r--  2.0 unx       16 b- defN 24-Apr-02 12:06 atcommon/version.py
+-rw-r--r--  2.0 unx       16 b- defN 24-Apr-02 15:30 atcommon/version.py
 -rw-r--r--  2.0 unx        0 b- defN 24-Jan-31 13:33 atcommon/exceptions/__init__.py
--rw-r--r--  2.0 unx     1060 b- defN 24-Apr-01 06:16 atcommon/exceptions/client.py
+-rw-r--r--  2.0 unx     1282 b- defN 24-Apr-02 15:21 atcommon/exceptions/client.py
 -rw-r--r--  2.0 unx       95 b- defN 24-Apr-01 06:16 atcommon/exceptions/server.py
--rw-r--r--  2.0 unx     1979 b- defN 24-Apr-01 13:45 atcommon/exceptions/server_base.py
+-rw-r--r--  2.0 unx     2089 b- defN 24-Apr-02 14:43 atcommon/exceptions/server_base.py
 -rw-r--r--  2.0 unx      589 b- defN 24-Apr-01 06:16 atcommon/exceptions/server_plugins.py
 -rw-r--r--  2.0 unx      466 b- defN 24-Apr-01 06:16 atcommon/models/__init__.py
 -rw-r--r--  2.0 unx      731 b- defN 24-Jan-20 03:26 atcommon/models/base.py
 -rw-r--r--  2.0 unx     2344 b- defN 24-Apr-01 06:16 atcommon/models/bi.py
 -rw-r--r--  2.0 unx     1069 b- defN 24-Apr-01 06:16 atcommon/models/chat.py
--rw-r--r--  2.0 unx      682 b- defN 24-Apr-01 06:16 atcommon/models/datasource.py
--rw-r--r--  2.0 unx    21682 b- defN 24-Apr-01 06:28 atcommon/models/meta.py
--rw-r--r--  2.0 unx     8309 b- defN 24-Apr-02 12:06 asktable-0.13.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-02 12:06 asktable-0.13.3.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 24-Apr-02 12:06 asktable-0.13.3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       18 b- defN 24-Apr-02 12:06 asktable-0.13.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2557 b- defN 24-Apr-02 12:06 asktable-0.13.3.dist-info/RECORD
-32 files, 66671 bytes uncompressed, 22669 bytes compressed:  66.0%
+-rw-r--r--  2.0 unx     1535 b- defN 24-Apr-02 14:59 atcommon/models/datasource.py
+-rw-r--r--  2.0 unx    23566 b- defN 24-Apr-02 12:29 atcommon/models/meta.py
+-rw-r--r--  2.0 unx     8309 b- defN 24-Apr-02 15:30 asktable-0.13.4.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-02 15:30 asktable-0.13.4.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 24-Apr-02 15:30 asktable-0.13.4.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       18 b- defN 24-Apr-02 15:30 asktable-0.13.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2558 b- defN 24-Apr-02 15:30 asktable-0.13.4.dist-info/RECORD
+32 files, 71041 bytes uncompressed, 23880 bytes compressed:  66.4%
```

## zipnote {}

```diff
@@ -75,23 +75,23 @@
 
 Filename: atcommon/models/datasource.py
 Comment: 
 
 Filename: atcommon/models/meta.py
 Comment: 
 
-Filename: asktable-0.13.3.dist-info/METADATA
+Filename: asktable-0.13.4.dist-info/METADATA
 Comment: 
 
-Filename: asktable-0.13.3.dist-info/WHEEL
+Filename: asktable-0.13.4.dist-info/WHEEL
 Comment: 
 
-Filename: asktable-0.13.3.dist-info/entry_points.txt
+Filename: asktable-0.13.4.dist-info/entry_points.txt
 Comment: 
 
-Filename: asktable-0.13.3.dist-info/top_level.txt
+Filename: asktable-0.13.4.dist-info/top_level.txt
 Comment: 
 
-Filename: asktable-0.13.3.dist-info/RECORD
+Filename: asktable-0.13.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## asktable/models/datasource.py

```diff
@@ -1,13 +1,19 @@
 import os
-
+import time
+from asktable.log import log
 from atcommon.models import DataSourceCore, MetaData
 from asktable.models.chat import ChatList
 from asktable.models.base import convert_to_object, BaseResourceList
-from atcommon.exceptions.client import DataSourceNotFound, UnsupportedFileType
+from atcommon.exceptions.client import (
+    DataSourceNotFound,
+    UnsupportedFileType,
+    DataSourceMetaProcessError,
+    DataSourceMetaProcessTimeout
+)
 from asktable.upload import upload_to_oss
 
 
 class MetaDataClientModel(MetaData):
 
     def sync(self):
         new_meta_dict = self.api.send(endpoint=f"/datasources/{self.datasource_id}/meta", method="POST")
@@ -126,14 +132,39 @@
         data = {
             "type": type, "name": name,
             "access_config": access_config
         }
         return self.api.send(endpoint=self.endpoint, method="POST",
                              data=data)
 
+    @convert_to_object(cls=DataSourceClientModel)
+    def register_wait_success(self, type, access_config, name=None, timeout=180):
+        # 注册数据源并获取其ID
+        ds = self.register(type, access_config, name)
+        start_time = time.time()
+
+        while True:
+            # 获取数据源的最新状态
+            ds_refreshed = self.get(id=ds.id)
+
+            if ds_refreshed.meta_status == 'success':
+                log.info(f"Data Source {ds.id} Meta 更新成功。")
+                return ds_refreshed
+            elif ds_refreshed.meta_status == 'failed':
+                log.error(f"Data Source {ds.id} Meta 更新失败。")
+                raise DataSourceMetaProcessError(f"DataSource Meta update failed: {ds.id}")
+
+            if time.time() - start_time > timeout:
+                log.error(f"Data Source {ds.id} Meta 更新超时。")
+                raise DataSourceMetaProcessTimeout(
+                    f"DataSource Meta update timed out after {timeout} seconds for {ds.id}")
+
+            log.info(f"Data Source {ds.id} Meta 状态为 {ds_refreshed.meta_status}，正在等待更新...")
+            time.sleep(10)  # 每10秒检查一次
+
     def upload_file_to_oss(self, local_file_path):
         oss_info = self.create_upload_params()['oss']
         file_name = os.path.basename(local_file_path)
         oss_file_uri = f"{oss_info['oss_uri_prefix']}{file_name}"
         url = upload_to_oss(oss_info, local_file_path, oss_file_uri)
         return url
```

## atcommon/version.py

```diff
@@ -1 +1 @@
-VERSION="0.13.3"
+VERSION="0.13.4"
```

## atcommon/exceptions/client.py

```diff
@@ -26,14 +26,24 @@
 
 
 class UnsupportedFileType(Exception):
     code = 9004
     message = "Unsupported File Type"
 
 
+class DataSourceMetaProcessError(Exception):
+    code = 9005
+    message = "Datasource Meta Process Error"
+
+
+class DataSourceMetaProcessTimeout(Exception):
+    code = 9006
+    message = "Datasource Meta Process Timeout"
+
+
 def get_exception_by_code(code):
     for name, obj in inspect.getmembers(sys.modules[__name__]):
         if inspect.isclass(obj):
             if getattr(obj, 'code') == code:
                 return obj
     return None
```

## atcommon/exceptions/server_base.py

```diff
@@ -59,14 +59,19 @@
     code = 1005
     message = "Datasource config error"
 
 class TenantNotFound(ManagementError):
     code = 1006
     message = "Tenant not found"
 
+class DataSourceMetaProcessing(ManagementError):
+    code = 1007
+    message = "Datasource meta processing"
+
+
 ################################
 
 class QAErrorNoMatchDataSource(QAError):
     code = 2002
     message = "No match datasource"
```

## atcommon/models/datasource.py

```diff
@@ -1,23 +1,46 @@
 # 通用的数据源类，提供了各种数据源均需要的基本属性和方法，比如Original MetaData以及获取MetaData的方法
 from atcommon.models.base import BaseCoreModel
 
 
 class DataSourceCore(BaseCoreModel):
 
-    __properties_init__ = ['tenant_id', 'id', 'created_at', 'name', 'type', 'access_config', 'sample_questions']
+    __properties_init__ = ['tenant_id', 'id', 'created_at',
+                           'name', 'type', 'access_config',
+                           'sample_questions', 'meta_status']
 
     def __repr__(self):
         if self.id:
-            return f"<{self.id}: {self.name} >"
+            if self.name:
+                return f"<{self.id}-{self.name} >"
+            else:
+                return f"<{self.id}-(not named)>"
         else:
-            return f"<{self.type}: {self.name} (not saved)>"
+            return f"<{self.type} (not saved)>"
 
     def __str__(self):
         return self.__repr__()
 
-
     @property
     def safe_access_config(self):
-        # TODO: 保护敏感信息
-        return self.access_config
+        # 复制access_config以避免修改原始数据
+        safe_config = dict(self.access_config)
+        # 定义需要替换值的敏感键列表
+        sensitive_keys = ['password', 'pwd', 'passwd']
+
+        # 遍历敏感键列表，将敏感信息值替换为"******"
+        for key in sensitive_keys:
+            if key in safe_config:
+                safe_config[key] = "******"
+        return safe_config
+
+    def safe_to_dict(self):
+        # 首先调用基类的 to_dict 方法获取字典表示
+        data = super().to_dict()
+
+        # 然后获取安全的 access_config
+        safe_access_config = self.safe_access_config
+
+        # 替换 access_config 为其安全版本
+        data['access_config'] = safe_access_config
 
+        return data
```

## atcommon/models/meta.py

```diff
@@ -1,8 +1,9 @@
 from typing import Dict, List, Optional
+from copy import deepcopy
 from functools import wraps
 import json
 from tabulate import tabulate
 from atcommon.tools import dict_to_markdown
 
 def json_to_string(func):
     # 将函数返回的JSON dict对象转换为字符串
@@ -553,7 +554,49 @@
     @property
     def table_count(self):
         return sum([len(schema.tables) for schema in self.schemas])
 
     @property
     def field_count(self):
         return sum([len(table.fields) for schema in self.schemas for table in schema.tables])
+
+    def split_into_chunks(self, max_tables_per_chunk=1):
+        """
+        Split the MetaData into smaller MetaData chunks, each with a maximum of 10 tables.
+        """
+        chunks = []
+        current_chunk = None
+        table_count = 0
+
+        for schema in self.schemas:
+            for table in schema.tables:
+                # 当前 chunk 已满或不存在时，创建新的 chunk
+                if current_chunk is None or table_count >= max_tables_per_chunk:
+                    current_chunk = MetaData(name=f"{self.name}_chunk{len(chunks) + 1}",
+                                             datasource_id=self.datasource_id)
+                    chunks.append(current_chunk)
+                    table_count = 0
+
+                # 在新的 chunk 中添加当前 schema 和 table
+                cloned_schema = current_chunk.schemas_dict.get(schema.name)
+                if cloned_schema is None:
+                    cloned_schema = DataSchema(name=schema.name,
+                                               metadata=current_chunk,
+                                               origin_desc=schema.origin_desc,
+                                               curr_desc=schema.curr_desc,
+                                               curr_desc_stat=schema.curr_desc_stat,
+                                               custom_configs=schema.custom_configs)
+                    current_chunk.add_schema(cloned_schema)
+
+                # 使用 deepcopy 来复制表
+                cloned_table = deepcopy(table)
+
+                # 请确保在复制前后，更新 cloned_table 的 schema 属性
+                cloned_table.schema = cloned_schema
+
+                # 现在可以安全地添加 cloned_table 到新 schema 中
+                cloned_schema.add_table(cloned_table)
+
+
+                table_count += 1
+
+        return chunks
```

## Comparing `asktable-0.13.3.dist-info/METADATA` & `asktable-0.13.4.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: asktable
-Version: 0.13.3
+Version: 0.13.4
 Summary: AskTable SDK
 Home-page: https://asktable.com/
 Author: lele
 Description-Content-Type: text/markdown
 Requires-Dist: requests
 Requires-Dist: tabulate
 Requires-Dist: pybase62
```

## Comparing `asktable-0.13.3.dist-info/RECORD` & `asktable-0.13.4.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -4,29 +4,29 @@
 asktable/client.py,sha256=pfj9w1I5-0I78_maqds6pzS2OJmO7G8h_siwR09kUCw,1220
 asktable/exceptions.py,sha256=HUys_aPowtoLqjO4XhANXBQCUUpty1zLxV4fWPqBkLc,41
 asktable/log.py,sha256=CIRsQtXMB24sD5fFsUn2hxlEVJB33Ej8TIQKyET2pQ8,875
 asktable/upload.py,sha256=ZctBvZtKnBZWucRXzvdp25zBNGz3eQ6PAfdhzLzfMUU,1492
 asktable/models/__init__.py,sha256=LDrDHxIjYwQN-fLW4BKMkuogEUcDfLxMYtlEkq0Xzfk,152
 asktable/models/base.py,sha256=vDe19yuK6SJglgRlz8Gq9qKg_x1Cxs2tK82VKeJ3UCI,2588
 asktable/models/chat.py,sha256=Z-2p_crBI5HwljcIxtRNV46_FfsVmNc5oRrwq3dNigE,2769
-asktable/models/datasource.py,sha256=nLKmyA8mQ832ulT7mvc6B6MfNoepOU7T-qSQ6QeTqqA,6371
+asktable/models/datasource.py,sha256=rUA9tbNCKeO9DDlxo4l6-K2eGXZL5wHYvHyRZcuenkw,7671
 asktable/models/message.py,sha256=4bIt5VTBXvH5iQYb5_LoOIIbbNEkjmUsLfkjx4Il7-M,1264
 asktable/models/run.py,sha256=xf4oNReawEmQk0rmYn-uWPu_zkZD7ws1-77bOfUWYTw,878
 atcommon/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atcommon/tools.py,sha256=s0C_ti20oi8HfeSuEn5Oo5hLY7Jjo0tlzi8hAcpyXyg,3352
-atcommon/version.py,sha256=umQ1GgcfOyyJ-ctVYlUvRVGZ-30oMBO1-F5sIgF_OB0,16
+atcommon/version.py,sha256=GiwVHXr1SbRgh2t6drDgphW12LbIw2AhFIgCEwfpk5w,16
 atcommon/exceptions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-atcommon/exceptions/client.py,sha256=WaVggqCBVXKC7d9iTZsNfFg1uj0jgzuYUbWrHy8mBME,1060
+atcommon/exceptions/client.py,sha256=qHJfByYYiVOwdAs_L-R655tBmep6Kpg1ixvktBNQNA0,1282
 atcommon/exceptions/server.py,sha256=BSlYmdfDasoAq6oK9fyGhws3EBPII_hkHpx_JQmMdAY,95
-atcommon/exceptions/server_base.py,sha256=Bae0oZrN30QJozYY8sq4BwGYJA75Berq7h7z2Db6XhY,1979
+atcommon/exceptions/server_base.py,sha256=-X7xH1cmypIwl007CvuN2MIGqCv89sYb5jVi7s-Uzkc,2089
 atcommon/exceptions/server_plugins.py,sha256=MqQgXsGHUn0JB3EAos1vlf8SLjUMNGXAY7lcBKSA_8c,589
 atcommon/models/__init__.py,sha256=QDsebmmUAHCKrMs789lDMt9HU9DR0kH-TGnE1CtW9kU,466
 atcommon/models/base.py,sha256=UVM9dKL22-k4k44H6DYQeNIe35vJ1Vg0ppGDZiVDiIU,731
 atcommon/models/bi.py,sha256=77HEtXOEj2tJwXe34s5Shsu4LWDihxAols8Rcz5cOFU,2344
 atcommon/models/chat.py,sha256=Si_eo8H8h_NtIOc76qhXoYcHp_tPMavud2sEnUXEejo,1069
-atcommon/models/datasource.py,sha256=WXYeAYpk_kLNp0sEDs0MJhAogn8VSjGuS7nenRpbCV0,682
-atcommon/models/meta.py,sha256=koGi9LvRdBskdblTtgbUpbF2lIThEbCVr-v27vZ_2JA,21682
-asktable-0.13.3.dist-info/METADATA,sha256=YZff2_vOv11ZSZmLwJyOcOGLxZYJES2iVOeIH7Z2J4U,8309
-asktable-0.13.3.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
-asktable-0.13.3.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
-asktable-0.13.3.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
-asktable-0.13.3.dist-info/RECORD,,
+atcommon/models/datasource.py,sha256=lNXrhSTLhk7EBqUgxgYgippHdWZTILIMCNJ2Hmv0e4A,1535
+atcommon/models/meta.py,sha256=mN-vlRo433lXAtoDKq7vTaEaw9u3LFdFBJc_EHptF2A,23566
+asktable-0.13.4.dist-info/METADATA,sha256=wTCWrunApNgGHrRDEhPqgpXV6kDGf0SPJ8WQdMvpOIo,8309
+asktable-0.13.4.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
+asktable-0.13.4.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
+asktable-0.13.4.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
+asktable-0.13.4.dist-info/RECORD,,
```

